<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Tag: python - Shawn&#039;Blog Test</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Shawn&#039;Blog Test"><meta name="msapplication-TileImage" content="/img/favicon.ico"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Shawn&#039;Blog Test"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Shawn&#039;Blog Test"><meta property="og:url" content="https://bearfly1990.github.io/"><meta property="og:site_name" content="Shawn&#039;Blog Test"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://bearfly1990.github.io/img/og_image.png"><meta property="article:author" content="Shawn"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://bearfly1990.github.io"},"headline":"Shawn'Blog Test","image":["https://bearfly1990.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Shawn"},"description":""}</script><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/favicon.ico" alt="Shawn&#039;Blog Test" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/bearfly1990"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">Tags</a></li><li class="is-active"><a href="#" aria-current="page">python</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-10-12T16:00:00.000Z" title="2019/10/13 上午12:00:00">2019-10-13</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-09-08T15:43:26.417Z" title="2020/9/8 下午11:43:26">2020-09-08</time></span><span class="level-item"> BF </span><span class="level-item">6 minutes read (About 905 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/10/13/2019/10/2019-10-13-CompareData/">Compare data by pandas</a></h1><div class="content"><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>最近的项目会根据一些数据的值来得到一定的结果，用户原来使用 python 直接生成 excel 文件，我们相当于移植到数据库中，使用 SP 去做业务逻辑。</p>
<p>所以理论上最后的结果需要一致，之前没有做全部数据的对比，这次相关 features 由我在改动，所以无论如何还是要保证数据能对比上，所以就写了相关的脚本来处理。</p>
<h1 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h1><p>情况是这样的，假设：</p>
<ol>
<li>User 有一份 output 文件(output_user.xlsx)，数据库中有我们处理后对应的 output 数据。</li>
<li>User 的 output 文件是有多余的数据，我们在数据库中已经剔除，所以对比前需要把 output 文件的冗余数据剔除掉。</li>
<li>需要把数据库中我们的 output 数据也输出到文件中(output_db.xlsx)</li>
<li>将 output_user.xlsx 与 output_db.xlsx 中的需要对比的字段进行比较，最后将不同的数据行出来到 compare_result.xlsx 文件中。</li>
</ol>
<h1 id="假设"><a href="#假设" class="headerlink" title="假设"></a>假设</h1><p>User Output 文件中的 output_user.xlsx 数据为：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>UserName</th>
<th>Age</th>
<th>Country</th>
<th>Status</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>cx</td>
<td>29</td>
<td>China</td>
<td>Success</td>
</tr>
<tr>
<td>2</td>
<td>xm</td>
<td>27</td>
<td>China</td>
<td>Pending</td>
</tr>
<tr>
<td>3</td>
<td>ll</td>
<td>30</td>
<td>China</td>
<td>Failed</td>
</tr>
<tr>
<td>4</td>
<td>zz</td>
<td>20</td>
<td>China</td>
<td>Success</td>
</tr>
<tr>
<td>5</td>
<td>yy</td>
<td>21</td>
<td>USA</td>
<td>Success</td>
</tr>
<tr>
<td>5</td>
<td>yy</td>
<td>-21</td>
<td>USA</td>
<td>Success</td>
</tr>
<tr>
<td>6</td>
<td>xx</td>
<td>-21</td>
<td>USA</td>
<td>Success</td>
</tr>
</tbody></table>
<p>数据库中的数据为：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>UserName</th>
<th>Age</th>
<th>Country</th>
<th>Status</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>cx</td>
<td>29</td>
<td>China</td>
<td>Success</td>
</tr>
<tr>
<td>2</td>
<td>xm</td>
<td>27</td>
<td>China</td>
<td>Success</td>
</tr>
<tr>
<td>3</td>
<td>ll</td>
<td>30</td>
<td>China</td>
<td>Failed</td>
</tr>
<tr>
<td>4</td>
<td>zz</td>
<td>20</td>
<td>China</td>
<td>Pending</td>
</tr>
</tbody></table>
<p>剔除的 logic:</p>
<ul>
<li>id 不能重复</li>
<li>Age 不能为负数(value&lt;0)</li>
</ul>
<p>所以在 output_user.xlsx 中 id 为 5，6 的需要被去除</p>
<h1 id="step01-剔除冗余数据"><a href="#step01-剔除冗余数据" class="headerlink" title="step01 剔除冗余数据"></a>step01 剔除冗余数据</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_exception_indexes</span>(<span class="params">df</span>):</span></span><br><span class="line">    indexes_removed = <span class="built_in">set</span>()</span><br><span class="line">    df_age = df[df[<span class="string">&#x27;Age&#x27;</span>].apply(<span class="keyword">lambda</span> x: x &lt; <span class="number">0</span> <span class="keyword">or</span> <span class="built_in">str</span>(x) <span class="keyword">in</span> (<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;nan&#x27;</span>))][<span class="string">&#x27;Age&#x27;</span>]</span><br><span class="line">    indexes_removed.update(<span class="built_in">list</span>(df_age.index.values))</span><br><span class="line">    df_duplicated_ids = df[df.duplicated(subset=[<span class="string">&#x27;id&#x27;</span>], keep=<span class="literal">False</span>)]</span><br><span class="line">    df_duplicated_group = df_duplicated_ids.groupby(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">id</span> <span class="keyword">in</span> df_duplicated_group.groups.keys():</span><br><span class="line">        indexes_removed.update(df_duplicated_group.groups[<span class="built_in">id</span>])</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(indexes_removed)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    df_output_user = pd.read_excel(<span class="string">&#x27;output_user.xlsx&#x27;</span>, sheet_name=<span class="string">&#x27;Data&#x27;</span>)</span><br><span class="line">    index_removed = get_exception_indexes(df_output_user)</span><br><span class="line"></span><br><span class="line">    df_output_user_removed = df_output_user.iloc[index_removed]</span><br><span class="line">    df_output_user_keeped = df_output_user.drop(index=index_removed)</span><br><span class="line"></span><br><span class="line">    writer = pd.ExcelWriter(<span class="string">&#x27;output_user.removed.xlsx&#x27;</span>, engine=<span class="string">&#x27;openpyxl&#x27;</span>)</span><br><span class="line">    df_output_user_keeped.to_excel(writer, sheet_name=<span class="string">&#x27;Data&#x27;</span>, index=<span class="literal">False</span>)</span><br><span class="line">    df_output_user_removed.to_excel(writer, sheet_name=<span class="string">&#x27;Removed&#x27;</span>, index=<span class="literal">False</span>)</span><br><span class="line">    writer.save()</span><br></pre></td></tr></table></figure>
<p>得到结果：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>UserName</th>
<th>Age</th>
<th>Country</th>
<th>Status</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>cx</td>
<td>29</td>
<td>China</td>
<td>Success</td>
</tr>
<tr>
<td>2</td>
<td>xm</td>
<td>27</td>
<td>China</td>
<td>Pending</td>
</tr>
<tr>
<td>3</td>
<td>ll</td>
<td>30</td>
<td>China</td>
<td>Failed</td>
</tr>
<tr>
<td>4</td>
<td>zz</td>
<td>20</td>
<td>China</td>
<td>Success</td>
</tr>
</tbody></table>
<h1 id="step02-从数据库中导出到Excel中"><a href="#step02-从数据库中导出到Excel中" class="headerlink" title="step02 从数据库中导出到Excel中"></a>step02 从数据库中导出到Excel中</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    conn=pyodbc.connect(<span class="string">r&#x27;DRIVER=&#123;SQL Server&#125;;SERVER=PC-CX\SQLEXPRESS;UID=test;PWD=test&#x27;</span>)</span><br><span class="line">    sql_str = <span class="string">&#x27;select * from [BFTest].[dbo].[Test_Output]&#x27;</span></span><br><span class="line"></span><br><span class="line">    sql_query = pd.read_sql_query(sql_str, conn)</span><br><span class="line">    df_output_db = pd.DataFrame(sql_query)</span><br><span class="line"></span><br><span class="line">    writer = pd.ExcelWriter(<span class="string">&#x27;output_db.xlsx&#x27;</span>, engine=<span class="string">&#x27;openpyxl&#x27;</span>)</span><br><span class="line">    df_output_db.to_excel(writer, sheet_name=<span class="string">&#x27;Data&#x27;</span>, index=<span class="literal">False</span>)</span><br><span class="line">    writer.save()</span><br></pre></td></tr></table></figure>

<h1 id="step03-对比数据"><a href="#step03-对比数据" class="headerlink" title="step03 对比数据"></a>step03 对比数据</h1><p>最后将没有匹配的数据分别放到sheet User和DB中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> pyodbc</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_key_value</span>(<span class="params">x</span>):</span></span><br><span class="line">    key_value = [x[<span class="string">&#x27;id&#x27;</span>], x[<span class="string">&#x27;UserName&#x27;</span>], x[<span class="string">&#x27;Country&#x27;</span>], x[<span class="string">&#x27;Status&#x27;</span>]]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;,&#x27;</span>.join([<span class="built_in">str</span>(x).replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>).lower() <span class="keyword">for</span> x <span class="keyword">in</span> key_value])</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    df_output_user = pd.read_excel(<span class="string">&#x27;output_user.removed.xlsx&#x27;</span>, sheet_name=<span class="string">&#x27;Data&#x27;</span>)</span><br><span class="line">    df_output_db = pd.read_excel(<span class="string">&#x27;output_db.xlsx&#x27;</span>, sheet_name=<span class="string">&#x27;Data&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    df_output_user[<span class="string">&#x27;key_value&#x27;</span>] = df_output_user.apply(<span class="keyword">lambda</span> x: get_key_value(x), axis=<span class="number">1</span>)</span><br><span class="line">    df_output_user[<span class="string">&#x27;source&#x27;</span>] = <span class="string">&#x27;User&#x27;</span></span><br><span class="line">    df_user_compare = df_output_user[[<span class="string">&#x27;key_value&#x27;</span>, <span class="string">&#x27;source&#x27;</span>]]</span><br><span class="line"></span><br><span class="line">    df_output_db[<span class="string">&#x27;key_value&#x27;</span>] = df_output_db.apply(<span class="keyword">lambda</span> x: get_key_value(x), axis=<span class="number">1</span>)</span><br><span class="line">    df_output_db[<span class="string">&#x27;source&#x27;</span>] = <span class="string">&#x27;DB&#x27;</span></span><br><span class="line">    df_db_compare = df_output_db[[<span class="string">&#x27;key_value&#x27;</span>, <span class="string">&#x27;source&#x27;</span>]]</span><br><span class="line"></span><br><span class="line">    df_compare = pd.concat([df_user_compare, df_db_compare])</span><br><span class="line">    df_compare = df_compare.drop_duplicates(subset=[<span class="string">&#x27;key_value&#x27;</span>], keep=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    indexes_user = df_compare.index[df_compare[<span class="string">&#x27;source&#x27;</span>] == <span class="string">&#x27;User&#x27;</span>].tolist()</span><br><span class="line">    indexes_db = df_compare.index[df_compare[<span class="string">&#x27;source&#x27;</span>] == <span class="string">&#x27;DB&#x27;</span>].tolist()</span><br><span class="line"></span><br><span class="line">    df_output_user = df_output_user.iloc[indexes_user]</span><br><span class="line">    df_output_db = df_output_db.iloc[indexes_db]</span><br><span class="line">    writer = pd.ExcelWriter(<span class="string">&#x27;compare_result.xlsx&#x27;</span>, engine=<span class="string">&#x27;openpyxl&#x27;</span>)</span><br><span class="line">    df_output_user.to_excel(writer, sheet_name=<span class="string">&#x27;User&#x27;</span>, index=<span class="literal">False</span>)</span><br><span class="line">    df_output_db.to_excel(writer, sheet_name=<span class="string">&#x27;DB&#x27;</span>, index=<span class="literal">False</span>)</span><br><span class="line">    writer.save()</span><br></pre></td></tr></table></figure>

<p>最后的代码在<a target="_blank" rel="noopener" href="https://github.com/bearfly1990/PowerScript/tree/master/Python3/pandas/demo03_get_data_from_db">demo03_get_data_from_db</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-08-28T16:00:00.000Z" title="2019/8/29 上午12:00:00">2019-08-29</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-09-08T15:43:26.415Z" title="2020/9/8 下午11:43:26">2020-09-08</time></span><span class="level-item"> BF </span><span class="level-item">5 minutes read (About 688 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/08/29/2019/08/2019-08-29-CountRowsInExcel/">Count data rows in excel</a></h1><div class="content"><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>今天手动给用户提供了 Report，其中需要对 excel 中的数据与数据库中的进行对比。数据文件不少，我要一个个打开去数，真的很费时间。</p>
<p>想要写一个小脚本，但发现没那么快，还是先手动给做了，写一个还是挺快的。</p>
<h1 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h1><p>情况是这样的，假设： </p>
<ol>
<li>都是有效的文件 </li>
<li>有多个 excel 文件在同一个目录中 </li>
<li>有 xls 和 xlsx 后缀的 </li>
<li>统计每个文件的文件名，Sheet，及 Sheet 中有多少有效数据 </li>
<li>将结果写到 output 文件中</li>
</ol>
<p>最后的代码在<a target="_blank" rel="noopener" href="https://github.com/bearfly1990/PowerScript/tree/master/Python3/pandas/demo02_get_data_rows">这里
</a></p>
<h1 id="读取一个-excel，并输出相关信息"><a href="#读取一个-excel，并输出相关信息" class="headerlink" title="读取一个 excel，并输出相关信息"></a>读取一个 excel，并输出相关信息</h1><p>需求我们一个个实现，首先，读取一个 excel，遍历每个 sheet，得到数据的条数。</p>
<p>下面是一个简单的样例,可以得到想要的结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">df_sheet_map = pd.read_excel(<span class="string">&quot;./Test1.xlsx&quot;</span>, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">sheets = <span class="built_in">list</span>(df_sheet_map.keys())</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> sheet <span class="keyword">in</span> sheets:</span><br><span class="line">    df_sheet = df_sheet_map[sheet]</span><br><span class="line">    <span class="built_in">print</span>(sheet, <span class="built_in">len</span>(df_sheet.index))</span><br></pre></td></tr></table></figure>

<p>output:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Sheet1 6</span><br><span class="line">Test 4</span><br><span class="line">Demo 7</span><br></pre></td></tr></table></figure>

<h1 id="遍历目录下所有的-excel-文件"><a href="#遍历目录下所有的-excel-文件" class="headerlink" title="遍历目录下所有的 excel 文件"></a>遍历目录下所有的 excel 文件</h1><p>可以使用 glob 去遍历目录及子目录下，所有后缀为 xls 或者 xlsx 的文件，再直接读取：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"></span><br><span class="line">files = glob.glob(<span class="string">&#x27;**/*.xlsx&#x27;</span>, recursive=<span class="literal">True</span>)</span><br><span class="line">files = files + glob.glob(<span class="string">&#x27;**/*.xls&#x27;</span>, recursive=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(files)</span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">    <span class="built_in">print</span>(file)</span><br><span class="line">    df_sheet_map = pd.read_excel(file, <span class="literal">None</span>)</span><br><span class="line">    sheets = <span class="built_in">list</span>(df_sheet_map.keys())</span><br><span class="line">    <span class="keyword">for</span> sheet <span class="keyword">in</span> sheets:</span><br><span class="line">        df_sheet = df_sheet_map[sheet]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;--&#x27;</span>,sheet, <span class="string">&#x27;:&#x27;</span>, <span class="built_in">len</span>(df_sheet.index))</span><br></pre></td></tr></table></figure>

<p>output:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[&#39;Test1.xlsx&#39;, &#39;Test2.xlsx&#39;, &#39;Test3.xls&#39;, &#39;sub_folder\\Test4.xls&#39;]</span><br><span class="line">Test1.xlsx</span><br><span class="line">-- Sheet1 : 6</span><br><span class="line">-- Test : 4</span><br><span class="line">-- Demo : 7</span><br><span class="line">Test2.xlsx</span><br><span class="line">-- Sheet1 : 16</span><br><span class="line">-- Test : 8</span><br><span class="line">-- Demo : 11</span><br><span class="line">Test3.xls</span><br><span class="line">-- Sheet1 : 10</span><br><span class="line">-- Test : 5</span><br><span class="line">-- Demo : 8</span><br><span class="line">sub_folder\Test4.xls</span><br><span class="line">-- Sheet1 : 10</span><br><span class="line">-- Test : 5</span><br><span class="line">-- Demo : 8</span><br></pre></td></tr></table></figure>

<h1 id="将结果写到-output-文件中"><a href="#将结果写到-output-文件中" class="headerlink" title="将结果写到 output 文件中"></a>将结果写到 output 文件中</h1><p>信息都有了，想要写到文件中，最简单写到 txt，这里我们用了 pandas，就直接写到 excel 中好了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dict_output = &#123;&#125;</span><br><span class="line">dict_output[<span class="string">&#x27;fileName&#x27;</span>] = []</span><br><span class="line">dict_output[<span class="string">&#x27;sheet&#x27;</span>] = []</span><br><span class="line">dict_output[<span class="string">&#x27;rows&#x27;</span>] = []</span><br><span class="line"></span><br><span class="line">files = glob.glob(<span class="string">&#x27;**/*.xlsx&#x27;</span>, recursive=<span class="literal">True</span>)</span><br><span class="line">files = files + glob.glob(<span class="string">&#x27;**/*.xls&#x27;</span>, recursive=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(files)</span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">    <span class="built_in">print</span>(file)</span><br><span class="line">    df_sheet_map = pd.read_excel(file, <span class="literal">None</span>)</span><br><span class="line">    sheets = <span class="built_in">list</span>(df_sheet_map.keys())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> sheet <span class="keyword">in</span> sheets:</span><br><span class="line">        df_sheet = df_sheet_map[sheet]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;--&#x27;</span>,sheet, <span class="string">&#x27;:&#x27;</span>, <span class="built_in">len</span>(df_sheet.index))</span><br><span class="line">        dict_output[<span class="string">&#x27;fileName&#x27;</span>].append(file)</span><br><span class="line">        dict_output[<span class="string">&#x27;sheet&#x27;</span>].append(sheet)</span><br><span class="line">        dict_output[<span class="string">&#x27;rows&#x27;</span>].append(<span class="built_in">len</span>(df_sheet.index))</span><br><span class="line"></span><br><span class="line">df_output = pd.DataFrame(dict_output)</span><br><span class="line"></span><br><span class="line">df_output.to_excel(<span class="string">&quot;output.xlsx&quot;</span>, sheet_name=<span class="string">&#x27;details&#x27;</span>, index=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># with pd.ExcelWriter(&#x27;output.xlsx&#x27;) as writer:  # doctest: +SKIP</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#     ...     df1.to_excel(writer, sheet_name=&#x27;Sheet_name_1&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#     df2.to_excel(writer, sheet_name=&#x27;Sheet_name_2&#x27;</span></span><br></pre></td></tr></table></figure>
<p>output in excel:</p>
<table>
<thead>
<tr>
<th align="left">fileName</th>
<th align="left">sheet</th>
<th align="right">rows</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Test1.xlsx</td>
<td align="left">Sheet1</td>
<td align="right">6</td>
</tr>
<tr>
<td align="left">Test1.xlsx</td>
<td align="left">Test</td>
<td align="right">4</td>
</tr>
<tr>
<td align="left">Test1.xlsx</td>
<td align="left">Demo</td>
<td align="right">7</td>
</tr>
<tr>
<td align="left">Test2.xlsx</td>
<td align="left">Sheet1</td>
<td align="right">16</td>
</tr>
<tr>
<td align="left">Test2.xlsx</td>
<td align="left">Test</td>
<td align="right">8</td>
</tr>
<tr>
<td align="left">Test2.xlsx</td>
<td align="left">Demo</td>
<td align="right">11</td>
</tr>
<tr>
<td align="left">Test3.xls</td>
<td align="left">Sheet1</td>
<td align="right">10</td>
</tr>
<tr>
<td align="left">Test3.xls</td>
<td align="left">Test</td>
<td align="right">5</td>
</tr>
<tr>
<td align="left">Test3.xls</td>
<td align="left">Demo</td>
<td align="right">8</td>
</tr>
<tr>
<td align="left">sub_folder\Test4.xls</td>
<td align="left">Sheet1</td>
<td align="right">10</td>
</tr>
<tr>
<td align="left">sub_folder\Test4.xls</td>
<td align="left">Test</td>
<td align="right">5</td>
</tr>
<tr>
<td align="left">sub_folder\Test4.xls</td>
<td align="left">Demo</td>
<td align="right">8</td>
</tr>
</tbody></table>
<p>参考:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/qingyuanjushi/p/8449151.html">python 获取 excel 文件的所有 sheet 名字</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/datasnail/p/9675410.html">pandas DataFrame的创建方法</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-08-16T16:00:00.000Z" title="2019/8/17 上午12:00:00">2019-08-17</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-09-08T15:43:26.413Z" title="2020/9/8 下午11:43:26">2020-09-08</time></span><span class="level-item"> BF </span><span class="level-item">11 minutes read (About 1597 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/08/17/2019/08/2019-08-17-Pandas/">Process data by pandas</a></h1><div class="content"><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>最近做了一些数据处理方面的事，用到了 pandas，记录一下。</p>
<ul>
<li>python 3.6.5</li>
<li>pandas 0.25</li>
<li>xlrd 1.2.0</li>
</ul>
<p>默认包引入：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br></pre></td></tr></table></figure>

<h1 id="读取-excel"><a href="#读取-excel" class="headerlink" title="读取 excel"></a>读取 excel</h1><p>假设有一张如下数据的 excel 表格：</p>
<table>
<thead>
<tr>
<th></th>
<th>Name</th>
<th>gender</th>
<th>Company</th>
<th>Salary</th>
</tr>
</thead>
<tbody><tr>
<td>Index_A</td>
<td>Shawn</td>
<td>man</td>
<td>SS</td>
<td>6666</td>
</tr>
<tr>
<td>Index_B</td>
<td>Andy</td>
<td>man</td>
<td>GG</td>
<td>5555</td>
</tr>
<tr>
<td>Index_C</td>
<td>Richard</td>
<td>man</td>
<td></td>
<td>3333</td>
</tr>
<tr>
<td>Index_D</td>
<td>Rose</td>
<td>female</td>
<td>SS</td>
<td>7777</td>
</tr>
<tr>
<td>Index_E</td>
<td></td>
<td></td>
<td>SS</td>
<td>6666</td>
</tr>
<tr>
<td>Index_F</td>
<td>June</td>
<td>female</td>
<td>GG</td>
<td>8888</td>
</tr>
<tr>
<td>Index_G</td>
<td>Richard</td>
<td>man</td>
<td>GG</td>
<td>4444</td>
</tr>
<tr>
<td>Index_G</td>
<td>Richard</td>
<td>mans</td>
<td>GG</td>
<td>4444</td>
</tr>
</tbody></table>
<p>使用 pandas 读取：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_sheet = pd.read_excel(<span class="string">&#x27;test_file.xlsx&#x27;</span>, sheet_name=<span class="string">&#x27;salary01&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(df_sheet)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  Unnamed: 0      Name  gender Company  Salary</span><br><span class="line">0    Index_A     Shawn     man      SS  6666.0</span><br><span class="line">1    Index_B      Andy     man      GG  5555.0</span><br><span class="line">2    Index_C   Richard     man      GG  3333.0</span><br><span class="line">3    Index_D      Rose  female      SS  7777.0</span><br><span class="line">4    Index_E       NaN     NaN      SS     NaN</span><br><span class="line">5    Index_F      June  female      GG  8888.0</span><br><span class="line">6    Index_G  Richard      man      GG  4444.0</span><br><span class="line">7    Index_H      Paul    mans      GG  5656.0</span><br></pre></td></tr></table></figure>

<p>可以看到第一列没有列名，默认给了<code>Unnamed: 0</code></p>
<p>index 为 6 那行<code>Richard</code>多了一个空格(在 excel 中故意空出来)</p>
<p>没有值的 cell 里，在 dateframe 中被填充成<code>NaN</code></p>
<h2 id="指定索引"><a href="#指定索引" class="headerlink" title="指定索引"></a>指定索引</h2><p>为了使我们第一列被成我们的索引，可以在读取时加参数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_sheet = pd.read_excel(<span class="string">&#x27;test_file.xlsx&#x27;</span>, sheet_name=<span class="string">&#x27;salary01&#x27;</span>, index_col = [<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(df_sheet)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">             Name  gender Company  Salary</span><br><span class="line">Index_A     Shawn     man      SS  6666.0</span><br><span class="line">Index_B      Andy     man      GG  5555.0</span><br><span class="line">Index_C   Richard     man     NaN  3333.0</span><br><span class="line">Index_D      Rose  female      SS  7777.0</span><br><span class="line">Index_E       NaN     NaN      SS     NaN</span><br><span class="line">Index_F      June  female      GG  8888.0</span><br><span class="line">Index_G  Richard      man      GG  4444.0</span><br><span class="line">Index_H      Paul    mans      GG  5656.0</span><br></pre></td></tr></table></figure>

<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p>当我们没有指定数据类型时，pandas 会按他的默认类型加载。</p>
<p>比如<code>Salary</code>那列默认使用 float 加载，但我们想要的是 int 的话，我们可以使用 convert：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_sheet = pd.read_excel(<span class="string">&#x27;test_file.xlsx&#x27;</span>, sheet_name=<span class="string">&#x27;salary01&#x27;</span>,  converters = &#123;<span class="string">&#x27;Name&#x27;</span>: <span class="built_in">str</span>, <span class="string">&#x27;Salary&#x27;</span>: <span class="built_in">int</span>&#125;, index_col = [<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(df_sheet)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">             Name  gender Company Salary</span><br><span class="line">Index_A     Shawn     man      SS   6666</span><br><span class="line">Index_B      Andy     man      GG   5555</span><br><span class="line">Index_C   Richard     man     NaN   3333</span><br><span class="line">Index_D      Rose  female      SS   7777</span><br><span class="line">Index_E       NaN     NaN      SS    NaN</span><br><span class="line">Index_F      June  female      GG   8888</span><br><span class="line">Index_G  Richard      man      GG   4444</span><br><span class="line">Index_H      Paul    mans      GG   5656</span><br></pre></td></tr></table></figure>

<p>更多读取 excel 的详细信息可以参考最后 <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_38546295/article/details/83537558">使用 pandas 读取 excel</a></p>
<h1 id="处理数据"><a href="#处理数据" class="headerlink" title="处理数据"></a>处理数据</h1><h2 id="得到基本信息"><a href="#得到基本信息" class="headerlink" title="得到基本信息"></a>得到基本信息</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 索引值</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [&#x27;Index_A&#x27;, &#x27;Index_B&#x27;, &#x27;Index_C&#x27;, &#x27;Index_D&#x27;, &#x27;Index_E&#x27;, &#x27;Index_F&#x27;, &#x27;Index_G&#x27;, &#x27;Index_H&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df_sheet.index.tolist())</span><br><span class="line"><span class="built_in">print</span>(df_sheet.index.to_list())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 行数 8</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df_sheet.shape[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(df_sheet))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列数 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [&#x27;Name&#x27;, &#x27;gender&#x27;, &#x27;Company&#x27;, &#x27;Salary&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df_sheet.shape[<span class="number">1</span>])</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="reset-index"><a href="#reset-index" class="headerlink" title="reset_index"></a>reset_index</h2><p>在上面我们使用了第一列做为索引，有时候我们希望还是用回默认的数字做为索引，那么就可以使用<code>reset_index</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_sheet = df_sheet.reset_index()</span><br><span class="line"><span class="built_in">print</span>(df_sheet)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">     index      Name  gender Company Salary</span><br><span class="line">0  Index_A     Shawn     man      SS   6666</span><br><span class="line">1  Index_B      Andy     man      GG   5555</span><br><span class="line">2  Index_C   Richard     man     NaN   3333</span><br><span class="line">3  Index_D      Rose  female      SS   7777</span><br><span class="line">4  Index_E       NaN     NaN      SS    NaN</span><br><span class="line">5  Index_F      June  female      GG   8888</span><br><span class="line">6  Index_G  Richard      man      GG   4444</span><br><span class="line">7  Index_H      Paul    mans      GG   5656</span><br></pre></td></tr></table></figure>

<p>如果不保留原来的索引，加上<code>drop=True</code>参数就可以了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_sheet = df_sheet.reset_index(drop=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h2 id="关于-nan-和-None"><a href="#关于-nan-和-None" class="headerlink" title="关于 nan 和 None"></a>关于 nan 和 None</h2><p><code>dataframe</code>中默认的空值为<code>NaN</code>，这是<code>numpy</code>中的一个类型，特殊的 float。<br><code>Series</code>和<code>DataFrame</code>都会自动把 None 转换成 NaN 然后 运算的时候会把 NaN 当成 0。</p>
<p>详细可以参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/onemorepoint/p/8966791.html">pandas numpy 处理缺失值，none 与 nan 比较</a></p>
<p>我们最后使用的时候，比如插入数据库前，需要使用 None，所以需要转换一下。</p>
<p>首先 pandas 提供 <code>fillna</code>方法把<code>NaN</code>数据替换成其它值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_sheet[<span class="string">&#x27;Salary&#x27;</span>] = df_sheet[<span class="string">&#x27;Salary&#x27;</span>].fillna(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(df_sheet)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">     index      Name  gender Company  Salary</span><br><span class="line">0  Index_A     Shawn     man      SS    6666</span><br><span class="line">1  Index_B      Andy     man      GG    5555</span><br><span class="line">2  Index_C   Richard     man     NaN    3333</span><br><span class="line">3  Index_D      Rose  female      SS    7777</span><br><span class="line">4  Index_E       NaN     NaN      SS       0</span><br><span class="line">5  Index_F      June  female      GG    8888</span><br><span class="line">6  Index_G  Richard      man      GG    4444</span><br><span class="line">7  Index_H      Paul    mans      GG    5656</span><br></pre></td></tr></table></figure>

<p>可以看到针对<code>Salary</code>这一列把<code>Nan</code>改成了<code>0</code>，但是如果直接用<code>None</code>却是不行的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df_sheet[<span class="string">&#x27;Salary&#x27;</span>] = df_sheet[<span class="string">&#x27;Salary&#x27;</span>].fillna(<span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">&quot;Must specify a fill &#x27;value&#x27; or &#x27;method&#x27;.&quot;</span>)</span><br><span class="line">ValueError: Must specify a fill <span class="string">&#x27;value&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;method&#x27;</span>.</span><br></pre></td></tr></table></figure>

<p>那么最直接的办法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_sheet = df_sheet.where(df_sheet.notnull(), <span class="literal">None</span>)</span><br><span class="line"><span class="built_in">print</span>(df_sheet)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">     index      Name  gender Company Salary</span><br><span class="line">0  Index_A     Shawn     man      SS   6666</span><br><span class="line">1  Index_B      Andy     man      GG   5555</span><br><span class="line">2  Index_C   Richard     man    None   3333</span><br><span class="line">3  Index_D      Rose  female      SS   7777</span><br><span class="line">4  Index_E      None    None      SS   None</span><br><span class="line">5  Index_F      June  female      GG   8888</span><br><span class="line">6  Index_G  Richard      man      GG   4444</span><br><span class="line">7  Index_H      Paul    mans      GG   5656</span><br></pre></td></tr></table></figure>

<h2 id="去掉重复行"><a href="#去掉重复行" class="headerlink" title="去掉重复行"></a>去掉重复行</h2><p>假设我们多了一条重复的数据(Index_H/Index_I) 如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">     index      Name  gender Company Salary</span><br><span class="line">0  Index_A     Shawn     man      SS   6666</span><br><span class="line">1  Index_B      Andy     man      GG   5555</span><br><span class="line">2  Index_C   Richard     man    None   3333</span><br><span class="line">3  Index_D      Rose  female      SS   7777</span><br><span class="line">4  Index_E      None    None      SS   None</span><br><span class="line">5  Index_F      June  female      GG   8888</span><br><span class="line">6  Index_G  Richard      man      GG   4444</span><br><span class="line">7  Index_H      Paul    mans      GG   5656</span><br><span class="line">8  Index_I      Paul    mans      GG   5656</span><br></pre></td></tr></table></figure>

<p>我们想要只留下一条数据，那么可以使用如下的方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_sheet.drop_duplicates([<span class="string">&#x27;Name&#x27;</span>, <span class="string">&#x27;gender&#x27;</span>, <span class="string">&#x27;Company&#x27;</span>, <span class="string">&#x27;Salary&#x27;</span>], keep=<span class="string">&#x27;last&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(df_sheet)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">     index      Name  gender Company Salary</span><br><span class="line">0  Index_A     Shawn     man      SS   6666</span><br><span class="line">1  Index_B      Andy     man      GG   5555</span><br><span class="line">2  Index_C   Richard     man    None   3333</span><br><span class="line">3  Index_D      Rose  female      SS   7777</span><br><span class="line">4  Index_E      None    None      SS   None</span><br><span class="line">5  Index_F      June  female      GG   8888</span><br><span class="line">6  Index_G  Richard      man      GG   4444</span><br><span class="line">8  Index_I      Paul    mans      GG   5656</span><br></pre></td></tr></table></figure>

<p>因为使用了<code>keep=&#39;last&#39;</code>，所以<code>Index_H</code>这行被删除了。如果想只保留最前面的那条，就可以使用<code>keep=&#39;first&#39;</code></p>
<h2 id="找到有问题的行列"><a href="#找到有问题的行列" class="headerlink" title="找到有问题的行列"></a>找到有问题的行列</h2><p>在<code>Index_I</code>我们可以看到这行的<code>gender</code>为<code>mans</code>是有问题的，我们可以找到他，只允许<code>man</code>和<code>female</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df_sheet_by_gender = df_sheet[(df_sheet[<span class="string">&#x27;gender&#x27;</span>]!=<span class="string">&#x27;man&#x27;</span>) &amp; (df_sheet[<span class="string">&#x27;gender&#x27;</span>]!=<span class="string">&#x27;female&#x27;</span>)]</span><br><span class="line"><span class="built_in">print</span>(df_sheet_by_gender)</span><br><span class="line"><span class="built_in">print</span>(df_sheet_by_gender.index.tolist())</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">     index  Name gender Company Salary</span><br><span class="line">4  Index_E  None   None      SS   None</span><br><span class="line">8  Index_I  Paul   mans      GG   5656</span><br><span class="line">[4, 8]</span><br></pre></td></tr></table></figure>

<p>也可以使用下面的方式:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">&#x27;man&#x27;</span>, <span class="string">&#x27;female&#x27;</span>]</span><br><span class="line">df_sheet_by_gender = df_sheet[df_sheet[<span class="string">&#x27;gender&#x27;</span>].apply(<span class="keyword">lambda</span> x: test(x))]</span><br><span class="line"><span class="built_in">print</span>(df_sheet_by_gender)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">     index  Name gender Company Salary</span><br><span class="line">4  Index_E  None   None      SS   None</span><br><span class="line">8  Index_I  Paul   mans      GG   5656</span><br></pre></td></tr></table></figure>

<p>当然还可以使用 iloc/loc 等其它方法找到你想要的值</p>
<h2 id="新增一列"><a href="#新增一列" class="headerlink" title="新增一列"></a>新增一列</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_sheet[<span class="string">&#x27;new_column&#x27;</span>] = df_sheet[<span class="string">&#x27;Salary&#x27;</span>]*<span class="number">3</span></span><br><span class="line"><span class="built_in">print</span>(df_sheet)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">     index      Name  gender Company Salary new_column</span><br><span class="line">0  Index_A     Shawn     man      SS   6666      19998</span><br><span class="line">1  Index_B      Andy     man      GG   5555      16665</span><br><span class="line">2  Index_C   Richard     man    None   3333       9999</span><br><span class="line">3  Index_D      Rose  female      SS   7777      23331</span><br><span class="line">4  Index_E      None    None      SS   None        NaN</span><br><span class="line">5  Index_F      June  female      GG   8888      26664</span><br><span class="line">6  Index_G  Richard      man      GG   4444      13332</span><br><span class="line">8  Index_I      Paul    mans      GG   5656      16968</span><br></pre></td></tr></table></figure>

<h1 id="输出到新的-Excel-中"><a href="#输出到新的-Excel-中" class="headerlink" title="输出到新的 Excel 中"></a>输出到新的 Excel 中</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_sheet.to_excel(<span class="string">&quot;output.xlsx&quot;</span>, sheet_name=<span class="string">&#x27;newsheet&#x27;</span>, index=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<p>可以选择需要的列</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_sheet.to_excel(<span class="string">&quot;output.xlsx&quot;</span>, sheet_name=<span class="string">&#x27;newsheet&#x27;</span>, index=<span class="literal">False</span>, columns=[<span class="string">&#x27;Name&#x27;</span>, <span class="string">&#x27;Company&#x27;</span>, <span class="string">&#x27;Salary&#x27;</span>])</span><br></pre></td></tr></table></figure>

<h1 id="dataframe-to-list"><a href="#dataframe-to-list" class="headerlink" title="dataframe to list"></a>dataframe to list</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(df_sheet.index.tolist())</span><br><span class="line"><span class="built_in">print</span>(df_sheet.values.tolist())</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[0, 1, 2, 3, 4, 5, 6, 8]</span><br><span class="line">[[&#39;Index_A&#39;, &#39;Shawn&#39;, &#39;man&#39;, &#39;SS&#39;, 6666, 19998], [&#39;Index_B&#39;, &#39;Andy&#39;, &#39;man&#39;, &#39;GG&#39;, 5555, 16665], [&#39;Index_C&#39;, &#39;Richard&#39;, &#39;man&#39;, None, 3333, 9999], [&#39;Index_D&#39;, &#39;Rose&#39;, &#39;female&#39;, &#39;SS&#39;, 7777, 23331], [&#39;Index_E&#39;, None, None, &#39;SS&#39;, None, nan], [&#39;Index_F&#39;, &#39;June&#39;, &#39;female&#39;, &#39;GG&#39;, 8888, 26664], [&#39;Index_G&#39;, &#39;Richard &#39;, &#39;man&#39;, &#39;GG&#39;, 4444, 13332], [&#39;Index_I&#39;, &#39;Paul&#39;, &#39;mans&#39;, &#39;GG&#39;, 5656, 16968]]</span><br></pre></td></tr></table></figure>

<p>参考:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_34377830/article/details/81872568">Pandas 读取并修改 excel</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_38546295/article/details/83537558">使用 pandas 读取 excel</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/louyifei0824/p/9942430.html">pandas 中的空值处理</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/onemorepoint/p/8966791.html">pandas numpy 处理缺失值，none 与 nan 比较</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/kancy110/article/details/70142728">Pandas 标记删除重复记录</a></li>
<li><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/whatsnew/v0.25.0.html">pandas 0.25.0 documentation</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-06-24T16:00:00.000Z" title="2019/6/25 上午12:00:00">2019-06-25</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-09-08T15:43:26.411Z" title="2020/9/8 下午11:43:26">2020-09-08</time></span><span class="level-item"> BF </span><span class="level-item">7 minutes read (About 1103 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/06/25/2019/06/2019-06-23-TkinterDemo/">Tinkter Demo</a></h1><div class="content"><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>最近在做数据的交互与导入导出，刚开始还是按照原先的方式，把所有的参数写在配置文件中。</p>
<p>在运行前需要把配置改掉，这样很容易遗漏。</p>
<p>所以想到了写点简单的界面来配置一些选项，相对来说所见即所得。</p>
<p>Python 里可以写界面的选择很多，也有很强大和专业的库(e.g. PyQt)，但是我们这种程度的使用，用原生的 tinkter 就足够了。</p>
<h1 id="tinkter-基本信息"><a href="#tinkter-基本信息" class="headerlink" title="tinkter 基本信息"></a>tinkter 基本信息</h1><p>现在基本上都是基于 python 3.0 在开发，所以 tkinter 的组件命名也发生的一些变化。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 2.x使用这行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#from Tkinter import *</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Python 3.x使用这行</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> *</span><br></pre></td></tr></table></figure>

<h2 id="ttk"><a href="#ttk" class="headerlink" title="ttk"></a>ttk</h2><p>程序都是直接使用 tkinter 模块下的 GUI 组件的，这些组件看上去特别“复古”，也就是丑，仿佛是从 20 年前的程序上抠出来的组件。</p>
<p>为了弥补这点不足，Tkinter 后来引入了一个 ttk 组件作为补充（主要就是简单包装、美化一下），并使用功能更强大的 Combobox 取代了原来的 Listbox，且新增了 LabeledScale（带标签的 Scale）、Notebook（多文档窗口）、Progressbar（进度条）、Treeview（树）等组件。</p>
<p>ttk 作为一个模块被放在 tkinter 包下，使用 ttk 组件与使用普通的 Tkinter 组件并没有多大的区别，只要导入 ttk 模块即可</p>
<h2 id="布局"><a href="#布局" class="headerlink" title="布局"></a>布局</h2><p>UI 组件需要我们摆放位置，tinkter 提供了三种布局方式：</p>
<ul>
<li>Pack</li>
<li>Grid</li>
<li>Place</li>
</ul>
<p>相对来说 Pack 和 Grid 相对多一些，Pack 更加灵活，而 Grid 适方方正正的类表格布局，而在同一个 Frame 中，布局方式只能有一种。</p>
<h1 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h1><p>在我下面列的参考文档中有很详细的组件与细节介绍，下面我直接放一个自己写的简单Demo。<br><img src="/img/post/2019/06/2019-06-23-TkinterDemo.png" alt="2019-06-23-TkinterDemo.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> webbrowser</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> ImageTk</span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> ttk</span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> messagebox</span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gamerun</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;run game...&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_menu</span>(<span class="params">root, imgGame, imgHelp</span>):</span></span><br><span class="line">    menubar =Menu(root)</span><br><span class="line">    root.config(menu = menubar)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#实例化菜单1，创建下拉菜单，调用add_separate创建分割线</span></span><br><span class="line">    menu1 =Menu(menubar,tearoff = <span class="number">0</span>)</span><br><span class="line">    menubar.add_cascade(label = <span class="string">&quot;Edit&quot;</span>,menu = menu1)</span><br><span class="line">    menu1.add_command(label = <span class="string">&quot;Do Nothing&quot;</span>)</span><br><span class="line">    menu1.add_separator()</span><br><span class="line">    menu1.add_command(label = <span class="string">&quot;Quit&quot;</span>,command = root.quit)</span><br><span class="line"></span><br><span class="line">    menu2 =Menu(menubar,tearoff = <span class="number">0</span>)</span><br><span class="line">    menubar.add_cascade(label = <span class="string">&quot;More&quot;</span>,menu = menu2)</span><br><span class="line">    menu2.add_command(label = <span class="string">&quot;New Job&quot;</span>,image = imgGame ,compound= <span class="string">&quot;left&quot;</span>,command = <span class="keyword">lambda</span>:gamerun())</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    menu2.add_command(label = <span class="string">&quot;Tkinter&quot;</span>,image = imgHelp,compound = <span class="string">&quot;left&quot;</span>,command =</span><br><span class="line">    <span class="keyword">lambda</span>:webbrowser.<span class="built_in">open</span>(<span class="string">&quot;http://effbot.org/tkinterbook/tkinter-index.htm&quot;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_userinfo</span>(<span class="params">root</span>):</span></span><br><span class="line">    frame_user_info = ttk.LabelFrame(root, text=<span class="string">&#x27;UserInfo:&#x27;</span>)</span><br><span class="line">    frame_user_info.pack(side=TOP, fill=X)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># myLabel= Label(frame_user_info, text=&#x27;UserInfo:&#x27;, font=&quot;Helvetica 10 bold&quot;)</span></span><br><span class="line">    <span class="comment"># myLabel[&quot;relief&quot;]=tk.SOLID#设置label的样式</span></span><br><span class="line">    <span class="comment"># myLabel[&quot;width&quot;]=10</span></span><br><span class="line">    <span class="comment"># myLabel[&quot;height&quot;]=5</span></span><br><span class="line">    <span class="comment"># myLabel.pack(side=LEFT)</span></span><br><span class="line">    <span class="comment"># myLabel.grid(row=0, sticky=W)</span></span><br><span class="line">    Label(frame_user_info, text=<span class="string">&quot;Username&quot;</span>).grid(row=<span class="number">1</span>, sticky=W)</span><br><span class="line">    Label(frame_user_info, text=<span class="string">&quot;Password&quot;</span>).grid(row=<span class="number">2</span>, sticky=W)</span><br><span class="line">    username = Entry(frame_user_info).grid(row=<span class="number">1</span>, column=<span class="number">1</span>, sticky=E)</span><br><span class="line">    password = Entry(frame_user_info, show=<span class="string">&#x27;*&#x27;</span>).grid(row=<span class="number">2</span>, column=<span class="number">1</span>, sticky=E)</span><br><span class="line">    <span class="comment"># Button(frame_user_info, text=&quot;Login&quot;).grid(row=2, column=1, sticky=E)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_radio</span>(<span class="params">root</span>):</span></span><br><span class="line">    frame_radio = ttk.Labelframe(root, text=<span class="string">&#x27;Radio Test&#x27;</span>,padding=<span class="number">20</span>)</span><br><span class="line">    frame_radio.pack(fill=BOTH, expand=YES, padx=<span class="number">10</span>, pady=<span class="number">10</span>)</span><br><span class="line">    books = [<span class="string">&#x27;C++&#x27;</span>, <span class="string">&#x27;Python&#x27;</span>, <span class="string">&#x27;Linux&#x27;</span>, <span class="string">&#x27;Java&#x27;</span>]</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    books_radio = []</span><br><span class="line">    <span class="keyword">for</span> book <span class="keyword">in</span> books:</span><br><span class="line">        intVar = IntVar()</span><br><span class="line">        books_radio.append(intVar)</span><br><span class="line">        Radiobutton(frame_radio, text=book,value=i,variable=intVar,command=changed).pack(side=LEFT)</span><br><span class="line">        i = i + <span class="number">1</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">changed</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;value changed&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_checkbutton</span>(<span class="params">root</span>):</span></span><br><span class="line">    frame_checkbutton = ttk.Labelframe(root, text=<span class="string">&#x27;Checkbutton Test&#x27;</span>,padding=<span class="number">20</span>)</span><br><span class="line">    frame_checkbutton.pack(fill=BOTH, expand=YES, padx=<span class="number">10</span>, pady=<span class="number">10</span>)</span><br><span class="line">    books = [<span class="string">&#x27;C++&#x27;</span>, <span class="string">&#x27;Python&#x27;</span>, <span class="string">&#x27;Linux&#x27;</span>, <span class="string">&#x27;Java&#x27;</span>]</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    books_checkbox = []</span><br><span class="line">    <span class="keyword">for</span> book <span class="keyword">in</span> books:</span><br><span class="line">        strVar = StringVar()</span><br><span class="line">        books_checkbox.append(strVar)</span><br><span class="line">        cb = ttk.Checkbutton(frame_checkbutton,</span><br><span class="line">            text = book,</span><br><span class="line">            variable = strVar, </span><br><span class="line">            onvalue = i,</span><br><span class="line">            offvalue = <span class="string">&#x27;None&#x27;</span>,</span><br><span class="line">            command = changed) </span><br><span class="line">        cb.pack(anchor=W)</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_combobox</span>(<span class="params">root</span>):</span></span><br><span class="line">    frame_combobox = ttk.Labelframe(root, text=<span class="string">&#x27;Combobox Test&#x27;</span>,padding=<span class="number">20</span>)</span><br><span class="line">    frame_combobox.pack(fill=BOTH, expand=YES, padx=<span class="number">10</span>, pady=<span class="number">10</span>)</span><br><span class="line">    strVar = StringVar()</span><br><span class="line">    <span class="comment"># 创建Combobox组件</span></span><br><span class="line">    cb = ttk.Combobox(frame_combobox,</span><br><span class="line">        textvariable=strVar, <span class="comment"># 绑定到self.strVar变量</span></span><br><span class="line">        postcommand=changed) <span class="comment"># 当用户单击下拉箭头时触发self.choose方法</span></span><br><span class="line">    cb.pack(side=TOP)</span><br><span class="line">    <span class="comment"># 为Combobox配置多个选项</span></span><br><span class="line">    cb[<span class="string">&#x27;values&#x27;</span>] = [<span class="string">&#x27;Python&#x27;</span>, <span class="string">&#x27;Ruby&#x27;</span>, <span class="string">&#x27;Kotlin&#x27;</span>, <span class="string">&#x27;Swift&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_it</span>():</span></span><br><span class="line">    messagebox.showinfo(title=<span class="string">&#x27;Alert&#x27;</span>, message=<span class="string">&quot;Please try again!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_showinfo</span>(<span class="params">root</span>):</span></span><br><span class="line">    frame_showinfo = ttk.LabelFrame(root, text=<span class="string">&#x27;ShowInfoTest:&#x27;</span>)</span><br><span class="line">    frame_showinfo.pack(side=TOP, fill=X)</span><br><span class="line">    Button(frame_showinfo, text=<span class="string">&quot;Click Me&quot;</span>, command=show_it).pack(side=LEFT, fill=Y)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_ui</span>():</span></span><br><span class="line">    root = Tk()</span><br><span class="line">    <span class="comment"># root.geometry(&#x27;580x680+200+100&#x27;)</span></span><br><span class="line">    root.resizable(width = <span class="literal">False</span>, height = <span class="literal">False</span>) </span><br><span class="line">    root.title(<span class="string">&quot;Test&quot;</span>)</span><br><span class="line">    root.iconbitmap(<span class="string">&#x27;login.ico&#x27;</span>)</span><br><span class="line">    imgGame = PhotoImage(file=<span class="string">&#x27;game.png&#x27;</span>)</span><br><span class="line">    imgHelp = ImageTk.PhotoImage(file=<span class="string">&quot;help.png&quot;</span>)</span><br><span class="line">    init_menu(root, imgGame, imgHelp)</span><br><span class="line">    init_userinfo(root)</span><br><span class="line">    init_showinfo(root)</span><br><span class="line">    init_radio(root)</span><br><span class="line">    init_checkbutton(root)</span><br><span class="line">    init_combobox(root)</span><br><span class="line">    root.mainloop()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    init_ui()</span><br></pre></td></tr></table></figure>

<p>参考:</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://c.biancheng.net/python/tkinter/">Python Tkinter 教程（GUI 图形界面开发教程）</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/f0a3c47c9c6c">Python2.7 Tkinter 创建简单登录注册界面</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-05-12T16:00:00.000Z" title="2019/5/13 上午12:00:00">2019-05-13</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-09-08T15:43:26.409Z" title="2020/9/8 下午11:43:26">2020-09-08</time></span><span class="level-item"> BF </span><span class="level-item">4 minutes read (About 560 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/05/13/2019/05/2019-05-13-ESTEDT2GMT/">Convert EST/EDT to GMT datetime</a></h1><div class="content"><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>最近在导数据的时候，需要把日期型字符串转换成 datetime 类型再导入数据库，其中一些带时区的数据，不能直接使用 strftime 格式化。</p>
<p>数据主要带 EST 和 EDT，需要先转成 GMT 再处理。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2019&#x2F;05&#x2F;14 03:20:10 EDT</span><br><span class="line">2019&#x2F;05&#x2F;14 03:20:10 EST</span><br></pre></td></tr></table></figure>

<h1 id="时区"><a href="#时区" class="headerlink" title="时区"></a>时区</h1><p>ST: Eastern Standard Time 东部（美国）标准时间</p>
<p>EDT: Eastern Daylight Time 东部（美国）夏令时时间</p>
<p>ET: Eastern Time 东部（美国）时间</p>
<p>GMT: Greenwich Mean Time 格林尼治标准时间</p>
<p>其中，EST 和 EDT 是 ET 在不同时间段的两种说法。</p>
<p>简单来说，ET 在夏季月份（summer months) 采用 EDT, 在其他月份采用 EST 时区，因此 EDT 和 EST 是不会同时存在的。</p>
<blockquote>
<p>在美国，EST 时区的采用时间段：<br>开始时间：当年 11 月份的第一个星期天凌晨 2.00（如 2018.11.4， 周日， 2.00）<br>结束时间：次年 3 月份的第二个星期天凌晨 2.00（如 2019.3.10，周日， 2.00）<br>其余时间采用 EDT 时区。</p>
</blockquote>
<h1 id="时区转换"><a href="#时区转换" class="headerlink" title="时区转换"></a>时区转换</h1><p>EDT 比 GMT 时间慢 5 个小时，即 EDT=GMT-5</p>
<p>EST 比 GMT 时间慢 4 个小时，即 EST=GMT-4</p>
<p>北京时区比 GMT 快 8 个小时，即北京时区=GMT+8</p>
<p>因此，可以得到：</p>
<p>EDT 比北京时间慢 13 个小时，即 EDT=北京时间-13</p>
<p>EST 比北京时间慢 12 个小时，即 EST=北京时间-12</p>
<h1 id="使用-pytz"><a href="#使用-pytz" class="headerlink" title="使用 pytz"></a>使用 pytz</h1><p>pytz 是 python 时间处理的一个模块，可以使用它进行时区的转换</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime <span class="keyword">as</span> dt</span><br><span class="line"><span class="keyword">import</span> pytz</span><br><span class="line"></span><br><span class="line">utc=pytz.utc</span><br><span class="line">eastern=pytz.timezone(<span class="string">&#x27;US/Eastern&#x27;</span>)</span><br><span class="line"></span><br><span class="line">format_without_tz   =<span class="string">&#x27;%Y/%m/%d %H:%M:%S&#x27;</span></span><br><span class="line">format_with_tz      = <span class="string">&#x27;%Y/%m/%d %H:%M:%S %Z%z&#x27;</span></span><br><span class="line"></span><br><span class="line">dt_time_str_full_list = [<span class="string">&#x27;2002/10/27 01:20:00 EDT&#x27;</span>, <span class="string">&#x27;2002/10/27 01:20:00 EST&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> dt_time_str_full <span class="keyword">in</span> dt_time_str_full_list:</span><br><span class="line">    dt_time_str = dt_time_str_full[<span class="number">0</span>:-<span class="number">4</span>]</span><br><span class="line">    dt_time_tz  = dt_time_str_full[-<span class="number">3</span>:]</span><br><span class="line">    <span class="keyword">if</span> dt_time_tz == <span class="string">&#x27;EDT&#x27;</span>:</span><br><span class="line">        is_dst_flag = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        is_dst_flag = <span class="literal">False</span></span><br><span class="line">   </span><br><span class="line">    dt_time = dt.datetime.strptime(dt_time_str, format_without_tz)</span><br><span class="line">    dt_time_with_tz = eastern.localize(dt_time, is_dst=is_dst_flag)</span><br><span class="line">    dt_time_with_tz2uct = dt_time_with_tz.astimezone(utc)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&#123;&#125;=&gt;&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(dt_time_with_tz.strftime(format_with_tz), dt_time_with_tz2uct.strftime(format_with_tz)))</span><br></pre></td></tr></table></figure>
<p>output:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2002&#x2F;10&#x2F;27 01:20:00 EDT-0400&#x3D;&gt;2002&#x2F;10&#x2F;27 05:20:00 UTC+0000</span><br><span class="line">2002&#x2F;10&#x2F;27 01:20:00 EST-0500&#x3D;&gt;2002&#x2F;10&#x2F;27 06:20:00 UTC+0000</span><br></pre></td></tr></table></figure>
<hr>
<p>参考:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/ddydavie/article/details/84869903">EST，EDT 和 GMT 时区转换</a></li>
<li><a target="_blank" rel="noopener" href="https://greenwichmeantime.com/time-zone/usa/eastern-time/">格林尼治时间官网</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-03-13T16:00:00.000Z" title="2019/3/14 上午12:00:00">2019-03-14</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-09-08T15:43:26.408Z" title="2020/9/8 下午11:43:26">2020-09-08</time></span><span class="level-item"> BF </span><span class="level-item">2 minutes read (About 357 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/03/14/2019/03/2019-03-14-PyCSVColumns/">Update CSV Column Values</a></h1><div class="content"><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>在一些 csv 文件中会有日期类型，而如果我们想按日期类型导入到数据库中，那么就需要在 insert 前以 date(datetime)的类型传入。</p>
<p>假设简单的 csv 文件(sample.csv)如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HolidayDate,Region</span><br><span class="line">2019-01-01,China</span><br><span class="line">2019-01-02,China</span><br><span class="line">2019-04-01,China</span><br><span class="line">2019-05-01,China</span><br><span class="line">2019-07-07,China</span><br><span class="line">2019-10-01,China</span><br><span class="line">2019-01-05,US</span><br><span class="line">2019-06-01,US</span><br></pre></td></tr></table></figure>

<h2 id="直接使用-cvs-库"><a href="#直接使用-cvs-库" class="headerlink" title="直接使用 cvs 库"></a>直接使用 cvs 库</h2><p>读取到 csv 后，直接遍历完成：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_csv_rows_list</span>(<span class="params">file_path</span>):</span></span><br><span class="line">    csv_row_list = []</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, newline=<span class="string">&#x27;&#x27;</span>) <span class="keyword">as</span> csvfile:</span><br><span class="line">        csvReader = csv.reader(csvfile, delimiter=<span class="string">&#x27;,&#x27;</span>, quotechar=<span class="string">&#x27;|&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> csvReader:</span><br><span class="line">            csv_row_list.append(row)</span><br><span class="line">    <span class="keyword">return</span> csv_row_list</span><br><span class="line"></span><br><span class="line">csv_row_list = read_csv_rows_list(<span class="string">&#x27;sample.csv&#x27;</span>)</span><br><span class="line">csv_row_list = csv_row_list[<span class="number">1</span>:]</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> csv_row_list:</span><br><span class="line">    row[<span class="number">0</span>] = datetime.strptime(row[<span class="number">0</span>], <span class="string">&#x27;%Y-%m-%d&#x27;</span>)</span><br><span class="line">[<span class="built_in">print</span>(row) <span class="keyword">for</span> row <span class="keyword">in</span> csv_row_list]</span><br></pre></td></tr></table></figure>

<p>output:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[datetime.datetime(2019, 1, 1, 0, 0), <span class="string">&#x27;China&#x27;</span>]</span><br><span class="line">[datetime.datetime(2019, 1, 2, 0, 0), <span class="string">&#x27;China&#x27;</span>]</span><br><span class="line">[datetime.datetime(2019, 4, 1, 0, 0), <span class="string">&#x27;China&#x27;</span>]</span><br><span class="line">[datetime.datetime(2019, 5, 1, 0, 0), <span class="string">&#x27;China&#x27;</span>]</span><br><span class="line">[datetime.datetime(2019, 7, 7, 0, 0), <span class="string">&#x27;China&#x27;</span>]</span><br><span class="line">[datetime.datetime(2019, 10, 1, 0, 0), <span class="string">&#x27;China&#x27;</span>]</span><br><span class="line">[datetime.datetime(2019, 1, 5, 0, 0), <span class="string">&#x27;US&#x27;</span>]</span><br><span class="line">[datetime.datetime(2019, 6, 1, 0, 0), <span class="string">&#x27;US&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h2 id="使用-pandas"><a href="#使用-pandas" class="headerlink" title="使用 pandas"></a>使用 pandas</h2><p>如果使用 pandas 就很方便：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">data = pd.read_csv(<span class="string">&#x27;sample.csv&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>,)</span><br><span class="line">data[<span class="string">u&#x27;HolidayDate&#x27;</span>] = pd.to_datetime(data[<span class="string">u&#x27;HolidayDate&#x27;</span>])</span><br><span class="line"><span class="comment"># data[u&#x27;HolidayDate&#x27;].astype(str)</span></span><br><span class="line"><span class="comment"># data[u&#x27;HolidayDate&#x27;] = data[u&#x27;HolidayDate&#x27;].apply(lambda x :datetime.strptime(x, &#x27;%Y-%m-%d&#x27;))</span></span><br><span class="line">data = np.array(data)<span class="comment">#np.ndarray()</span></span><br><span class="line">data_list = data.tolist()</span><br><span class="line">[<span class="built_in">print</span>(row) <span class="keyword">for</span> row <span class="keyword">in</span> data_list]</span><br><span class="line"><span class="comment">#data.to_csv(&#x27;sample.output.csv&#x27;,index=False, encoding=&#x27;utf-8&#x27;)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[Timestamp(<span class="string">&#x27;2019-01-01 00:00:00&#x27;</span>), <span class="string">&#x27;China&#x27;</span>]</span><br><span class="line">[Timestamp(<span class="string">&#x27;2019-01-02 00:00:00&#x27;</span>), <span class="string">&#x27;China&#x27;</span>]</span><br><span class="line">[Timestamp(<span class="string">&#x27;2019-04-01 00:00:00&#x27;</span>), <span class="string">&#x27;China&#x27;</span>]</span><br><span class="line">[Timestamp(<span class="string">&#x27;2019-05-01 00:00:00&#x27;</span>), <span class="string">&#x27;China&#x27;</span>]</span><br><span class="line">[Timestamp(<span class="string">&#x27;2019-07-07 00:00:00&#x27;</span>), <span class="string">&#x27;China&#x27;</span>]</span><br><span class="line">[Timestamp(<span class="string">&#x27;2019-10-01 00:00:00&#x27;</span>), <span class="string">&#x27;China&#x27;</span>]</span><br><span class="line">[Timestamp(<span class="string">&#x27;2019-01-05 00:00:00&#x27;</span>), <span class="string">&#x27;US&#x27;</span>]</span><br><span class="line">[Timestamp(<span class="string">&#x27;2019-06-01 00:00:00&#x27;</span>), <span class="string">&#x27;US&#x27;</span>]</span><br></pre></td></tr></table></figure>

<hr>
<p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/xiangxianghehe/article/details/72615711">pandas DataFrame数据转为list</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/325ffa92654a">pandas处理时间和日期类型数据</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/okm6666/article/details/81003397">Pandas修改csv文件某一列的值</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-02-18T16:00:00.000Z" title="2019/2/19 上午12:00:00">2019-02-19</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-09-08T15:43:26.404Z" title="2020/9/8 下午11:43:26">2020-09-08</time></span><span class="level-item"> BF </span><span class="level-item">16 minutes read (About 2407 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/02/19/2019/02/2019-02-19-Py2DifferPy3/">Difference between Python2 and Python3</a></h1><div class="content"><h1 id="Python2-x-与-3​​-x-版本区别"><a href="#Python2-x-与-3​​-x-版本区别" class="headerlink" title="Python2.x 与 3​​.x 版本区别"></a>Python2.x 与 3​​.x 版本区别</h1><p>Python 的 3​​.0 版本，常被称为 Python 3000，或简称 Py3k。相对于 Python 的早期版本，这是一个较大的升级。</p>
<p>为了不带入过多的累赘，Python 3.0 在设计的时候没有考虑向下相容。</p>
<p>许多针对早期 Python 版本设计的程式都无法在 Python 3.0 上正常执行。</p>
<p>为了照顾现有程式，Python 2.6 作为一个过渡版本，基本使用了 Python 2.x 的语法和库，同时考虑了向 Python 3.0 的迁移，允许使用部分 Python 3.0 的语法与函数。</p>
<p>新的 Python 程式建议使用 Python 3.0 版本的语法。</p>
<p>除非执行环境无法安装 Python 3.0 或者程式本身使用了不支援 Python 3.0 的第三方库。目前不支援 Python 3.0 的第三方库有 Twisted, py2exe, PIL 等。</p>
<p>大多数第三方库都正在努力地相容 Python 3.0 版本。即使无法立即使用 Python 3.0，也建议编写相容 Python 3.0 版本的程式，然后使用 Python 2.6, Python 2.7 来执行。</p>
<p>Python 3.0 的变化主要在以下几个方面:</p>
<h2 id="print-函数"><a href="#print-函数" class="headerlink" title="print 函数"></a>print 函数</h2><p>print 语句没有了，取而代之的是 print()函数。 Python 2.6 与 Python 2.7 部分地支持这种形式的 print 语法。在 Python 2.6 与 Python 2.7 里面，以下三种形式是等价的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span> <span class="string">&quot;fish&quot;</span></span><br><span class="line"><span class="built_in">print</span> (<span class="string">&quot;fish&quot;</span>) <span class="comment">#注意print后面有个空格</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;fish&quot;</span>) <span class="comment">#print()不能带有任何其它参数</span></span><br></pre></td></tr></table></figure>

<p>然而，Python 2.6 实际已经支持新的 print()语法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;fish&quot;</span>, <span class="string">&quot;panda&quot;</span>, sep=<span class="string">&#x27;, &#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Unicode"><a href="#Unicode" class="headerlink" title="Unicode"></a>Unicode</h2><p>Python 2 有 ASCII str() 类型，unicode() 是单独的，不是 byte 类型。</p>
<p>现在， 在 Python 3，我们最终有了 Unicode (utf-8) 字符串，以及一个字节类：byte 和 bytearrays。</p>
<p>由于 Python3.X 源码文件默认使用 utf-8 编码，这就使得以下代码是合法的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>中国 = <span class="string">&#x27;china&#x27;</span></span><br><span class="line">&gt;&gt;&gt;<span class="built_in">print</span>(中国)</span><br><span class="line">china</span><br></pre></td></tr></table></figure>

<p>Python 2.x</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">str</span> = <span class="string">&quot;我爱北京天安门&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">str</span></span><br><span class="line"><span class="string">&#x27;\xe6\x88\x91\xe7\x88\xb1\xe5\x8c\x97\xe4\xba\xac\xe5\xa4\xa9\xe5\xae\x89\xe9\x97\xa8&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">str</span> = <span class="string">u&quot;我爱北京天安门&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">str</span></span><br><span class="line"><span class="string">u&#x27;\u6211\u7231\u5317\u4eac\u5929\u5b89\u95e8&#x27;</span></span><br></pre></td></tr></table></figure>

<p>Python 3.x</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">str</span> = <span class="string">&quot;我爱北京天安门&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">str</span></span><br><span class="line"><span class="string">&#x27;我爱北京天安门&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="除法运算"><a href="#除法运算" class="headerlink" title="除法运算"></a>除法运算</h2><p>Python 中的除法较其它语言显得非常高端，有套很复杂的规则。Python 中的除法有两个运算符，/和//</p>
<p>首先来说/除法:</p>
<p>在 python 2.x 中/除法就跟我们熟悉的大多数语言，比如 Java 啊 C 啊差不多，整数相除的结果是一个整数，把小数部分完全忽略掉，浮点数除法会保留小数点的部分得到一个浮点数的结果。</p>
<p>在 python 3.x 中/除法不再这么做了，对于整数之间的相除，结果也会是浮点数。</p>
<p>Python 2.x:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span> / <span class="number">2</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1.0</span> / <span class="number">2.0</span></span><br><span class="line"><span class="number">0.5</span></span><br></pre></td></tr></table></figure>

<p>Python 3.x:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span>/<span class="number">2</span></span><br><span class="line"><span class="number">0.5</span></span><br></pre></td></tr></table></figure>

<p>而对于//除法，这种除法叫做 floor 除法，会对除法的结果自动进行一个 floor 操作，在 python 2.x 和 python 3.x 中是一致的。</p>
<p>python 2.x:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>-<span class="number">1</span> // <span class="number">2</span></span><br><span class="line">-<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>python 3.x:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>-<span class="number">1</span> // <span class="number">2</span></span><br><span class="line">-<span class="number">1</span></span><br><span class="line">注意的是并不是舍弃小数部分，而是执行 floor 操作，如果要截取整数部分，那么需要使用 math 模块的 trunc 函数</span><br></pre></td></tr></table></figure>

<p>python 3.x:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> math</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>math.trunc(<span class="number">1</span> / <span class="number">2</span>)</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>math.trunc(-<span class="number">1</span> / <span class="number">2</span>)</span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>

<h2 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h2><p>在 Python 3 中处理异常也轻微的改变了，在 Python 3 中我们现在使用 as 作为关键词。</p>
<p>捕获异常的语法由 except exc, var 改为 except exc as var。</p>
<p>使用语法 except (exc1, exc2) as var 可以同时捕获多种类别的异常。 Python 2.6 已经支持这两种语法。</p>
<ol>
<li>在 2.x 时代，所有类型的对象都是可以被直接抛出的，在 3.x 时代，只有继承自 BaseException 的对象才可以被抛出。</li>
<li>2.x raise 语句使用逗号将抛出对象类型和参数分开，3.x 取消了这种奇葩的写法，直接调用构造函数抛出对象即可。<br>在 2.x 时代，异常在代码中除了表示程序错误，还经常做一些普通控制结构应该做的事情，在 3.x 中可以看出，设计者让异常变的更加专一，只有在错误发生的情况才能去用异常捕获语句来处理。</li>
</ol>
<h2 id="xrange"><a href="#xrange" class="headerlink" title="xrange"></a>xrange</h2><p>在 Python 2 中 xrange() 创建迭代对象的用法是非常流行的。比如： for 循环或者是列表/集合/字典推导式。</p>
<p>这个表现十分像生成器（比如。”惰性求值”）。但是这个 xrange-iterable 是无穷的，意味着你可以无限遍历。</p>
<p>由于它的惰性求值，如果你不得仅仅不遍历它一次，xrange() 函数 比 range() 更快（比如 for 循环）。尽管如此，对比迭代一次，不建议你重复迭代多次，因为生成器每次都从头开始。</p>
<p>在 Python 3 中，range() 是像 xrange() 那样实现以至于一个专门的 xrange() 函数都不再存在（在 Python 3 中 xrange() 会抛出命名异常）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> timeit</span><br><span class="line"></span><br><span class="line">n = <span class="number">10000</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_range</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_xrange</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(n):</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>Python 2</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span> <span class="string">&#x27;Python&#x27;</span>, python_version()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;\ntiming range()&#x27;</span></span><br><span class="line">%timeit test_range(n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;\n\ntiming xrange()&#x27;</span></span><br><span class="line">%timeit test_xrange(n)</span><br><span class="line"></span><br><span class="line">Python <span class="number">2.7</span><span class="number">.6</span></span><br><span class="line"></span><br><span class="line">timing <span class="built_in">range</span>()</span><br><span class="line"><span class="number">1000</span> loops, best of <span class="number">3</span>: <span class="number">433</span> µs per loop</span><br><span class="line"></span><br><span class="line">timing xrange()</span><br><span class="line"><span class="number">1000</span> loops, best of <span class="number">3</span>: <span class="number">350</span> µs per loop</span><br></pre></td></tr></table></figure>

<p>Python 3</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Python&#x27;</span>, python_version())</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\ntiming range()&#x27;</span>)</span><br><span class="line">%timeit test_range(n)</span><br><span class="line"></span><br><span class="line">Python <span class="number">3.4</span><span class="number">.1</span></span><br><span class="line"></span><br><span class="line">timing <span class="built_in">range</span>()</span><br><span class="line"><span class="number">1000</span> loops, best of <span class="number">3</span>: <span class="number">520</span> µs per loop</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(xrange(<span class="number">10</span>))</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">NameError                                 Traceback (most recent call last)</span><br><span class="line">&lt;ipython-<span class="built_in">input</span>-<span class="number">5</span>-5d8f9b79ea70&gt; <span class="keyword">in</span> &lt;module&gt;()</span><br><span class="line">----&gt; 1 print(xrange(10))</span><br><span class="line"></span><br><span class="line">NameError: name <span class="string">&#x27;xrange&#x27;</span> <span class="keyword">is</span> <span class="keyword">not</span> defined</span><br></pre></td></tr></table></figure>

<h2 id="八进制字面量表示"><a href="#八进制字面量表示" class="headerlink" title="八进制字面量表示"></a>八进制字面量表示</h2><p>八进制数必须写成 0o777，原来的形式 0777 不能用了；二进制必须写成 0b111。</p>
<p>新增了一个 bin()函数用于将一个整数转换成二进制字串。 Python 2.6 已经支持这两种语法。</p>
<p>在 Python 3.x 中，表示八进制字面量的方式只有一种，就是 0o1000。</p>
<p>python 2.x</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0o1000</span></span><br><span class="line"><span class="number">512</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>01000</span><br><span class="line"><span class="number">512</span></span><br></pre></td></tr></table></figure>

<p>python 3.x</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>01000</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span></span><br><span class="line">    01000</span><br><span class="line">        ^</span><br><span class="line">SyntaxError: invalid token</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0o1000</span></span><br><span class="line"><span class="number">512</span></span><br></pre></td></tr></table></figure>

<h2 id="不等运算符"><a href="#不等运算符" class="headerlink" title="不等运算符"></a>不等运算符</h2><p>Python 2.x 中不等于有两种写法 != 和 &lt;&gt;</p>
<p>Python 3.x 中去掉了&lt;&gt;, 只有!=一种写法，还好，我从来没有使用&lt;&gt;的习惯</p>
<h2 id="去掉了-repr-表达式"><a href="#去掉了-repr-表达式" class="headerlink" title="去掉了 repr 表达式``"></a>去掉了 repr 表达式``</h2><p>Python 2.x 中反引号``相当于 repr 函数的作用</p>
<p>Python 3.x 中去掉了``这种写法，只允许使用 repr 函数，这样做的目的是为了使代码看上去更清晰么？不过我感觉用 repr 的机会很少，一般只在 debug 的时候才用，多数时候还是用 str 函数来用字符串描述对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sendMail</span>(<span class="params">from_: <span class="built_in">str</span>, to: <span class="built_in">str</span>, title: <span class="built_in">str</span>, body: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<h2 id="多个模块被改名（根据-PEP8）"><a href="#多个模块被改名（根据-PEP8）" class="headerlink" title="多个模块被改名（根据 PEP8）"></a>多个模块被改名（根据 PEP8）</h2><table>
<thead>
<tr>
<th>旧的名字</th>
<th>新的名字</th>
</tr>
</thead>
<tbody><tr>
<td>_winreg</td>
<td>winreg</td>
</tr>
<tr>
<td>ConfigParser</td>
<td>configparser</td>
</tr>
<tr>
<td>copy_reg</td>
<td>copyreg</td>
</tr>
<tr>
<td>Queue</td>
<td>queue</td>
</tr>
<tr>
<td>SocketServer</td>
<td>socketserver</td>
</tr>
<tr>
<td>repr</td>
<td>reprlib</td>
</tr>
</tbody></table>
<p>StringIO 模块现在被合并到新的 io 模组内。 new, md5, gopherlib 等模块被删除。 Python 2.6 已经支援新的 io 模组。</p>
<p>httplib, BaseHTTPServer, CGIHTTPServer, SimpleHTTPServer, Cookie, cookielib 被合并到 http 包内。</p>
<p>取消了 exec 语句，只剩下 exec()函数。 Python 2.6 已经支援 exec()函数。</p>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p>1）Py3.X 去除了 long 类型，现在只有一种整型——int，但它的行为就像 2.X 版本的 long</p>
<p>2）新增了 bytes 类型，对应于 2.X 版本的八位串，定义一个 bytes 字面量的方法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="string">b&#x27;china&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(b)</span><br><span class="line">&lt;<span class="built_in">type</span> <span class="string">&#x27;bytes&#x27;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>str 对象和 bytes 对象可以使用.encode() (str -&gt; bytes) or .decode() (bytes -&gt; str)方法相互转化。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = b.decode()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">&#x27;china&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b1 = s.encode()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b1</span><br><span class="line"><span class="string">b&#x27;china&#x27;</span></span><br></pre></td></tr></table></figure>
<p>3）dict的.keys()、.items 和.values()方法返回迭代器，而之前的iterkeys()等函数都被废弃。同时去掉的还有 dict.has_key()，用 in替代它吧.</p>
<h2 id="打开文件"><a href="#打开文件" class="headerlink" title="打开文件"></a>打开文件</h2><p>原：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">file( ..... )</span><br><span class="line">或 </span><br><span class="line"><span class="built_in">open</span>(.....)</span><br></pre></td></tr></table></figure>
<p>改为只能用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">open</span>(.....)</span><br></pre></td></tr></table></figure>
<p>从键盘录入一个字符串</p>
<p>原:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">raw_input( <span class="string">&quot;提示信息&quot;</span> )</span><br></pre></td></tr></table></figure>
<p>改为:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">input</span>( <span class="string">&quot;提示信息&quot;</span> )</span><br></pre></td></tr></table></figure>
<p>在python2.x中raw_input()和input( )，两个函数都存在，其中区别为：</p>
<p> raw_input()—将所有输入作为字符串看待，返回字符串类型<br> input()—–只能接收”数字”的输入，在对待纯数字输入时具有自己的特性，它返回所输入的数字的类型（int, float ）<br>在python3.x中raw_input()和input( )进行了整合，去除了raw_input()，仅保留了input()函数，其接收任意任性输入，将所有输入默认为字符串处理，并返回字符串类型。</p>
<h2 id="map、filter-和-reduce"><a href="#map、filter-和-reduce" class="headerlink" title="map、filter 和 reduce"></a>map、filter 和 reduce</h2><p>这三个函数号称是函数式编程的代表。在 Python3.x 和 Python2.x 中也有了很大的差异。</p>
<p>首先我们先简单的在 Python2.x 的交互下输入 map 和 filter,看到它们两者的类型是 built-in function(内置函数):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">map</span></span><br><span class="line">&lt;built-<span class="keyword">in</span> function <span class="built_in">map</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">filter</span></span><br><span class="line">&lt;built-<span class="keyword">in</span> function <span class="built_in">filter</span>&gt;</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>它们输出的结果类型都是列表:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">map</span>(<span class="keyword">lambda</span> x:x *<span class="number">2</span>, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">[<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">filter</span>(<span class="keyword">lambda</span> x:x %<span class="number">2</span> ==<span class="number">0</span>,<span class="built_in">range</span>(<span class="number">10</span>))</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>但是在Python 3.x中它们却不是这个样子了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">map</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">map</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">map</span>(<span class="params"><span class="built_in">print</span>,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span>)</span></span><br><span class="line"><span class="class">&lt;<span class="title">map</span> <span class="title">object</span> <span class="title">at</span> 0<span class="title">x10d8bd400</span>&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">filter</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">filter</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">filter</span>(<span class="params"><span class="keyword">lambda</span> x:x % <span class="number">2</span> == <span class="number">0</span>, <span class="built_in">range</span>(<span class="params"><span class="number">10</span></span>)</span>)</span></span><br><span class="line"><span class="class">&lt;<span class="title">filter</span> <span class="title">object</span> <span class="title">at</span> 0<span class="title">x10d8bd3c8</span>&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt;</span></span><br></pre></td></tr></table></figure>
<p>首先它们从函数变成了类，其次，它们的返回结果也从当初的列表成了一个可迭代的对象, 我们尝试用 next 函数来进行手工迭代:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f =<span class="built_in">filter</span>(<span class="keyword">lambda</span> x:x %<span class="number">2</span> ==<span class="number">0</span>, <span class="built_in">range</span>(<span class="number">10</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(f)</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(f)</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(f)</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(f)</span><br><span class="line"><span class="number">6</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>对于比较高端的 reduce 函数，它在 Python 3.x 中已经不属于 built-in 了，被挪到 functools 模块当中。</p>
<hr>
<p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://www.runoob.com/python/python-2x-3x.html">Python2.x与3​​.x版本区别</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/kendrick/p/7478304.html">Python2和Python3的差异</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/hanggegege/p/5840005.html">python3和Python2的区别（被坑太久了）</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-01-19T16:00:00.000Z" title="2019/1/20 上午12:00:00">2019-01-20</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-09-08T15:43:26.401Z" title="2020/9/8 下午11:43:26">2020-09-08</time></span><span class="level-item"> BF </span><span class="level-item">5 minutes read (About 808 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/01/20/2019/01/2019-01-20-CompareExcel/">Compare Excel</a></h1><div class="content"><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>下周可能有一个小任务是由于系统升级，需要保证生成的 excel 是一致的，所以写了一个非常简单的对比脚本。</p>
<h1 id="主要代码"><a href="#主要代码" class="headerlink" title="主要代码"></a>主要代码</h1><p>下面直接上代码，主要的思路就是从上到下依次对比，从 sheet name 开始，最后对比 cell 的值，数据类型，数据格式。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># author: xiche</span></span><br><span class="line"><span class="comment"># create at: 01/20/2019</span></span><br><span class="line"><span class="comment"># description:</span></span><br><span class="line"><span class="comment">#     simple script to compare excel</span></span><br><span class="line"><span class="comment"># Change log:</span></span><br><span class="line"><span class="comment"># Date          Author      Version     Description</span></span><br><span class="line"><span class="comment"># 01/20/2019    xiche       1.0         init</span></span><br><span class="line"><span class="comment"># 01/21/2019    xiche       1.1         add compare csvs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> openpyxl</span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compare_cell</span>(<span class="params">cell01, cell02</span>):</span></span><br><span class="line">    <span class="keyword">if</span>(cell01.value != cell02.value):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&#123;&#125;&#123;&#125;: &#123;&#125; / &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(cell01.column,</span><br><span class="line">                                     cell01.row, cell01.value, cell02.value))</span><br><span class="line">    <span class="keyword">elif</span>(cell01.data_type != cell02.data_type):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&#123;&#125;&#123;&#125;: &#123;&#125; / &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(cell01.column,</span><br><span class="line">                                     cell01.row, cell01.data_type, cell02.data_type))</span><br><span class="line">    <span class="keyword">elif</span>(cell01.number_format != cell02.number_format):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&#123;&#125;&#123;&#125;: &#123;&#125; / &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(cell01.column, cell01.row,</span><br><span class="line">                                     cell01.number_format, cell02.number_format))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compare_sheet</span>(<span class="params">sheet01, sheet02</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(sheet01.max_row != sheet02.max_row):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;row is not matched! &#123;&#125; / &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(sheet01.max_row, sheet02.max_row))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(sheet01.max_column != sheet02.max_column):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;column is not matched! &#123;&#125; / &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(sheet01.max_column,</span><br><span class="line">                                                      sheet02.max_column))</span><br><span class="line"></span><br><span class="line">    max_row = <span class="built_in">max</span>(sheet01.max_row, sheet02.max_row)</span><br><span class="line">    max_column = <span class="built_in">max</span>(sheet01.max_column, sheet02.max_column)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> index_row <span class="keyword">in</span> <span class="built_in">range</span>(max_row):</span><br><span class="line">        <span class="keyword">for</span> index_col <span class="keyword">in</span> <span class="built_in">range</span>(max_column):</span><br><span class="line">            compare_cell(sheet01.cell(column=index_col+<span class="number">1</span>, row=index_row+<span class="number">1</span>),</span><br><span class="line">                         sheet02.cell(column=index_col+<span class="number">1</span>, row=index_row+<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compare_excels</span>(<span class="params">excel_file01, excel_file02</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;------compare &#123;&#125; &amp; &#123;&#125;------&#x27;</span>.<span class="built_in">format</span>(excel_file01, excel_file02))</span><br><span class="line">    wb01 = openpyxl.load_workbook(excel_file01)</span><br><span class="line">    wb02 = openpyxl.load_workbook(excel_file02)</span><br><span class="line"></span><br><span class="line">    sheet_names_01 = wb01.get_sheet_names()</span><br><span class="line">    sheet_names_02 = wb02.get_sheet_names()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">len</span>(sheet_names_01) != <span class="built_in">len</span>(sheet_names_02)):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;sheets number are not matched!&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(sheet_names_01)):</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">len</span>(sheet_names_01[i]) != <span class="built_in">len</span>(sheet_names_02[i])):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;sheets name not matched!\n&#123;&#125;:&#123;&#125; / &#123;&#125;:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(excel_file01,</span><br><span class="line">                                                                   sheet_names_01[i], excel_file02, sheet_names_02[i]))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        sheet01 = wb01.get_sheet_by_name(sheet_names_01[i])</span><br><span class="line">        sheet02 = wb02.get_sheet_by_name(sheet_names_02[i])</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;compare &#123;&#125;:&#123;&#125; &amp; &#123;&#125;:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(excel_file01,</span><br><span class="line">                                             sheet01.title, excel_file02, sheet02.title))</span><br><span class="line">        compare_sheet(sheet01, sheet02)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compare_csv</span>(<span class="params">csv_file01, csv_file02</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;------compare &#123;&#125; &amp; &#123;&#125;------&#x27;</span>.<span class="built_in">format</span>(csv_file01, csv_file02))</span><br><span class="line">    is_diff = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(csv_file01, newline=<span class="string">&#x27;&#x27;</span>) <span class="keyword">as</span> csv_01, <span class="built_in">open</span>(csv_file02, newline=<span class="string">&#x27;&#x27;</span>) <span class="keyword">as</span> csv_02:</span><br><span class="line">        csv_reader_01 = csv.reader(csv_01, delimiter=<span class="string">&#x27;,&#x27;</span>, quotechar=<span class="string">&#x27;|&#x27;</span>)</span><br><span class="line">        csv_reader_02 = csv.reader(csv_02, delimiter=<span class="string">&#x27;,&#x27;</span>, quotechar=<span class="string">&#x27;|&#x27;</span>)</span><br><span class="line">        csv_list_01 = <span class="built_in">list</span>(csv_reader_01)</span><br><span class="line">        csv_list_02 = <span class="built_in">list</span>(csv_reader_02)</span><br><span class="line">        ccsv_list_02_copy = copy.deepcopy(csv_list_02)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> csv_list_01:</span><br><span class="line">            <span class="keyword">if</span> line <span class="keyword">not</span> <span class="keyword">in</span> csv_list_02:</span><br><span class="line">                is_diff = <span class="literal">True</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;&#123;&#125;:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(csv_file01, line))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                ccsv_list_02_copy.remove(line)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> ccsv_list_02_copy:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;&#123;&#125;:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(csv_file02, line))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> is_diff:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;No difference between these two csv&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="Compare-Excel"><a href="#Compare-Excel" class="headerlink" title="Compare Excel"></a>Compare Excel</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    compare_excels(<span class="string">&#x27;test01.xlsx&#x27;</span>, <span class="string">&#x27;test01.copy.xlsx&#x27;</span>)</span><br><span class="line">    compare_excels(<span class="string">&#x27;test01.xlsx&#x27;</span>, <span class="string">&#x27;test02.xlsx&#x27;</span>)</span><br><span class="line">    compare_excels(<span class="string">&#x27;test01.xlsx&#x27;</span>, <span class="string">&#x27;test03.xlsx&#x27;</span>)</span><br><span class="line">    compare_excels(<span class="string">&#x27;test01.xlsx&#x27;</span>, <span class="string">&#x27;test04.xlsx&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>目前的输出结果如下：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\mayn\Desktop\GitSpace\PowerScript\Python3\openpyxl\compare_excels&gt;python compare_excels.py</span><br><span class="line">-----<span class="literal">-compare</span> test01.xlsx &amp; test01.copy.xlsx------</span><br><span class="line"><span class="built_in">compare</span> test01.xlsx:Sheet1 &amp; test01.copy.xlsx:Sheet1</span><br><span class="line">-----<span class="literal">-compare</span> test01.xlsx &amp; test02.xlsx------</span><br><span class="line"><span class="built_in">compare</span> test01.xlsx:Sheet1 &amp; test02.xlsx:Sheet1</span><br><span class="line">row is not matched! <span class="number">4</span> / <span class="number">5</span></span><br><span class="line">B2: mm<span class="literal">-dd</span><span class="literal">-yy</span> / [<span class="variable">$</span>-<span class="number">409</span>]d\<span class="literal">-mmm</span>\<span class="literal">-yy</span>;<span class="selector-tag">@</span></span><br><span class="line">C4: Test03 / Test04</span><br><span class="line">B5: None / <span class="number">10</span>/<span class="number">21</span>/<span class="number">2010</span></span><br><span class="line">C5: None / Test05</span><br><span class="line">-----<span class="literal">-compare</span> test01.xlsx &amp; test03.xlsx------</span><br><span class="line">sheets name not matched!</span><br><span class="line">test01.xlsx:Sheet1 / test03.xlsx:NotMatch</span><br><span class="line">-----<span class="literal">-compare</span> test01.xlsx &amp; test04.xlsx------</span><br><span class="line"><span class="built_in">compare</span> test01.xlsx:Sheet1 &amp; test04.xlsx:sheet1</span><br><span class="line">row is not matched! <span class="number">4</span> / <span class="number">6</span></span><br><span class="line">column is not matched! <span class="number">3</span> / <span class="number">4</span></span><br><span class="line">B2: mm<span class="literal">-dd</span><span class="literal">-yy</span> / [<span class="variable">$</span>-<span class="number">409</span>]d\<span class="literal">-mmm</span>\<span class="literal">-yy</span>;<span class="selector-tag">@</span></span><br><span class="line">C4: Test03 / Test04</span><br><span class="line">B5: None / <span class="number">10</span>/<span class="number">21</span>/<span class="number">2010</span></span><br><span class="line">C5: None / Test05</span><br><span class="line">B6: None / test</span><br><span class="line">C6: None / test</span><br><span class="line">D6: None / test</span><br></pre></td></tr></table></figure>

<h1 id="Compare-CSV"><a href="#Compare-CSV" class="headerlink" title="Compare CSV"></a>Compare CSV</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    compare_csv(<span class="string">&#x27;demo01.csv&#x27;</span>, <span class="string">&#x27;demo01.copy.csv&#x27;</span>)</span><br><span class="line">    compare_csv(<span class="string">&#x27;demo01.csv&#x27;</span>, <span class="string">&#x27;demo02.csv&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><code>demo01.csv</code>和<code>demo02.csv</code>有两行数据不一值：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">c:\Users\mayn\Desktop\GitSpace\PowerScript\Python3\openpyxl\compare_excels&gt;python compare_excels.py</span><br><span class="line">-----<span class="literal">-compare</span> demo01.csv &amp; demo01.copy.csv------</span><br><span class="line">No difference between these two csv</span><br><span class="line">-----<span class="literal">-compare</span> demo01.csv &amp; demo02.csv------</span><br><span class="line">demo01.csv:[<span class="string">&#x27;R1&#x27;</span>, <span class="string">&#x27; R1&#x27;</span>, <span class="string">&#x27; R1&#x27;</span>]</span><br><span class="line">demo02.csv:[<span class="string">&#x27;Z5&#x27;</span>, <span class="string">&#x27; R4&#x27;</span>, <span class="string">&#x27; R4&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>不知道有没有第三方库直接提供对比的方法，自己的这个之后可以添加到自己的工具库中。</p>
<p>代码和测试的文件在：<a target="_blank" rel="noopener" href="https://github.com/bearfly1990/PowerScript/tree/master/Python3/openpyxl/compare_excels">compare_excels</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-01-04T16:00:00.000Z" title="2019/1/5 上午12:00:00">2019-01-05</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-09-08T15:43:26.397Z" title="2020/9/8 下午11:43:26">2020-09-08</time></span><span class="level-item"> BF </span><span class="level-item">16 minutes read (About 2397 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/01/05/2019/01/2019-01-05-PyAnalysisLearn01/">Analyze 1.usa.gove from bit.ly</a></h1><div class="content"><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>最近在看数据分析相关的知识点，同事那借了本 Python for Data Analysis 在看，接下来会记录一下学习心得和书上的例子，温故知新。</p>
<p>数据分析的门道还是挺多的，Python 的一些库(pandas, numpy, matplotlib)也很好用，不用自己去用标准库辛苦的写了，之前分析 log 如果了解这些知识点的话，效率会很高。</p>
<p>今天介绍书中的例子。</p>
<h1 id="数据源"><a href="#数据源" class="headerlink" title="数据源"></a>数据源</h1><p>今天分析的数据是 URL 缩短服务 bit.ly 与美国政府网站 usa.gov 合作，从生成.gov 或.mil 短链接的用户那里收集来的匿名数据（该服务已停止）。</p>
<p>我们可以看到下面的文档例子，里面每一行都是 json 数据。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/bearfly1990/pydata-book/blob/2nd-edition/datasets/bitly_usagov/example.txt">example.txt</a></p>
<p>下面是其中一行数据的例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&#x27;a&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.78 Safari/535.11&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;c&#x27;</span>: <span class="string">&#x27;US&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;nk&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&#x27;tz&#x27;</span>: <span class="string">&#x27;America/New_York&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;gr&#x27;</span>: <span class="string">&#x27;MA&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;g&#x27;</span>: <span class="string">&#x27;A6qOVH&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;h&#x27;</span>: <span class="string">&#x27;wfLQtf&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;l&#x27;</span>: <span class="string">&#x27;orofrog&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;al&#x27;</span>: <span class="string">&#x27;en-US,en;q=0.8&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;hh&#x27;</span>: <span class="string">&#x27;1.usa.gov&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;r&#x27;</span>: <span class="string">&#x27;http://www.facebook.com/l/7AQEFzjSi/1.usa.gov/wfLQtf&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;u&#x27;</span>: <span class="string">&#x27;http://www.ncbi.nlm.nih.gov/pubmed/22415991&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;t&#x27;</span>: <span class="number">1331923247</span>,</span><br><span class="line">    <span class="string">&#x27;hc&#x27;</span>: <span class="number">1331822918</span>,</span><br><span class="line">    <span class="string">&#x27;cy&#x27;</span>: <span class="string">&#x27;Danvers&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;ll&#x27;</span>: [<span class="number">42.576698</span>, -<span class="number">70.954903</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>像 <code>tz</code> 就是表示 time zone, <code>a</code> 则是用户浏览器的信息 agent，主要分析的数据便是他们，我们一步一步来看。</p>
<p>下面是对数据的初步处理，将文件读取进来，加入 Dict</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd; <span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> DataFrame, Series</span><br><span class="line"></span><br><span class="line">example_path = <span class="string">&#x27;example.txt&#x27;</span></span><br><span class="line"></span><br><span class="line">records = [json.loads(line) <span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">open</span>(example_path)]</span><br></pre></td></tr></table></figure>

<h1 id="对时区-tz-进行计数"><a href="#对时区-tz-进行计数" class="headerlink" title="对时区(tz)进行计数"></a>对时区(tz)进行计数</h1><p>这里我们就用到了 pandas 中的最重要的数据结构 DataFrame, 它用于将数据表示为一个表格。</p>
<p>下面的代码就是将之前读取的数据创建成 DataFrame，然后通过<code>.value_counts()</code>方法非常容易的对时区进行了计数, 并且也进行了排序，所以我们取前面 10 个便是 top 10。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">frame = DataFrame(records)</span><br><span class="line">tz_counts = frame[<span class="string">&#x27;tz&#x27;</span>].value_counts()</span><br><span class="line"><span class="built_in">print</span>(tz_counts[:<span class="number">10</span>])</span><br></pre></td></tr></table></figure>

<p>output:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">America/New_York       1251</span><br><span class="line">                        521</span><br><span class="line">America/Chicago         400</span><br><span class="line">America/Los_Angeles     382</span><br><span class="line">America/Denver          191</span><br><span class="line">Europe/London            74</span><br><span class="line">Asia/Tokyo               37</span><br><span class="line">Pacific/Honolulu         36</span><br><span class="line">Europe/Madrid            35</span><br><span class="line">America/Sao_Paulo        33</span><br><span class="line">Name: tz, dtype: int64</span><br></pre></td></tr></table></figure>

<p>那可能有人会好奇，这个生成的 DataFrame 对象是什么样的呢？下面是<code>print(frame)</code>的结果，可以看出它将 key value 值表格化（行转列了）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">       _heartbeat_                                                  a                        ...                                           tz                                                  u</span><br><span class="line">0              NaN  Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKi...                        ...                             America/New_York        http://www.ncbi.nlm.nih.gov/pubmed/22415991</span><br><span class="line">1              NaN                             GoogleMaps/RochesterNY                        ...                               America/Denver        http://www.monroecounty.gov/etc/911/rss.php</span><br><span class="line">2              NaN  Mozilla/4.0 (compatible; MSIE 8.0; Windows NT ...                        ...                             America/New_York  http://boxer.senate.gov/en/press/releases/0316...</span><br><span class="line">3              NaN  Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_8)...                        ...                            America/Sao_Paulo            http://apod.nasa.gov/apod/ap120312.html</span><br><span class="line">4              NaN  Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKi...                        ...                             America/New_York  http://www.shrewsbury-ma.gov/egov/gallery/1341...</span><br><span class="line">5              NaN  Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKi...                        ...                             America/New_York  http://www.shrewsbury-ma.gov/egov/gallery/1341...</span><br><span class="line">6              NaN  Mozilla/5.0 (Windows NT 5.1) AppleWebKit/535.1...                        ...                                Europe/Warsaw  http://www.nasa.gov/mission_pages/nustar/main/...</span><br><span class="line">7              NaN  Mozilla/5.0 (Windows NT 6.1; rv:2.0.1) Gecko/2...                        ...                                               http://www.nasa.gov/mission_pages/nustar/main/...</span><br><span class="line">8              NaN  Opera/9.80 (X11; Linux zbov; U; en) Presto/2.1...                        ...                                               http://www.nasa.gov/mission_pages/nustar/main/...</span><br><span class="line">9              NaN  Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKi...                        ...                                                         http://apod.nasa.gov/apod/ap120312.html</span><br><span class="line">10             NaN  Mozilla/5.0 (Windows NT 6.1; WOW64; rv:10.0.2)...                        ...                          America/Los_Angeles  https://www.nysdot.gov/rexdesign/design/commun...</span><br><span class="line">11             NaN  Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.4...                        ...                             America/New_York  http://oversight.house.gov/wp-content/uploads/...</span><br><span class="line">12             NaN  Mozilla/5.0 (Windows NT 6.1; WOW64; rv:10.0.2)...                        ...                             America/New_York  https://www.nysdot.gov/rexdesign/design/commun...</span><br><span class="line">13    1.331923e+09                                                NaN                        ...                                          NaN                                                NaN</span><br><span class="line">14             NaN  Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US...                        ...                             America/New_York               http://toxtown.nlm.nih.gov/index.php</span><br><span class="line">15             NaN  Mozilla/5.0 (Windows NT 6.1) AppleWebKit/535.1...                        ...                               Asia/Hong_Kong  http://www.ssd.noaa.gov/PS/TROP/TCFP/data/curr...</span><br><span class="line">16             NaN  Mozilla/5.0 (Windows NT 6.1) AppleWebKit/535.1...                        ...                               Asia/Hong_Kong  http://www.usno.navy.mil/NOOC/nmfc-ph/RSS/jtwc...</span><br><span class="line">17             NaN  Mozilla/5.0 (Macintosh; Intel Mac OS X 10.5; r...                        ...                             America/New_York  http://www.usda.gov/wps/portal/usda/usdahome?c...</span><br><span class="line">18             NaN                             GoogleMaps/RochesterNY                        ...                               America/Denver        http://www.monroecounty.gov/etc/911/rss.php</span><br><span class="line">19             NaN  Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKi...                        ...                                  Europe/Rome  http://www.nasa.gov/mission_pages/nustar/main/...</span><br><span class="line">20             NaN  Mozilla/5.0 (compatible; MSIE 9.0; Windows NT ...                        ...                                 Africa/Ceuta  http://voyager.jpl.nasa.gov/imagesvideo/uranus...</span><br><span class="line">21             NaN  Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6...                        ...                             America/New_York  http://www.nasa.gov/mission_pages/nustar/main/...</span><br><span class="line">22             NaN  Mozilla/4.0 (compatible; MSIE 8.0; Windows NT ...                        ...                             America/New_York  http://portal.hud.gov/hudportal/documents/hudd...</span><br><span class="line">23             NaN  Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_3)...                        ...                             America/New_York  http://www.tricare.mil/mybenefit/ProfileFilter...</span><br><span class="line">24             NaN  Mozilla/5.0 (Windows; U; Windows NT 5.1; es-ES...                        ...                                Europe/Madrid  http://www.nasa.gov/mission_pages/nustar/main/...</span><br><span class="line">25             NaN  Mozilla/5.0 (Windows NT 6.1) AppleWebKit/535.1...                        ...                            Asia/Kuala_Lumpur  http://www.nasa.gov/mission_pages/nustar/main/...</span><br><span class="line">26             NaN  Mozilla/5.0 (Windows NT 6.1) AppleWebKit/535.1...                        ...                                 Asia/Nicosia  http://www.nasa.gov/mission_pages/nustar/main/...</span><br><span class="line">27             NaN  Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_8)...                        ...                            America/Sao_Paulo            http://apod.nasa.gov/apod/ap120312.html</span><br><span class="line">28             NaN  Mozilla/5.0 (iPad; CPU OS 5_0_1 like Mac OS X)...                        ...                                               https://www.nysdot.gov/rexdesign/design/commun...</span><br><span class="line">29             NaN  Mozilla/5.0 (iPad; U; CPU OS 3_2 like Mac OS X...                        ...                                               http://www.ed.gov/news/media-advisories/us-dep...</span><br><span class="line">...            ...                                                ...                        ...                                          ...                                                ...</span><br><span class="line">3530           NaN  Mozilla/5.0 (Windows NT 6.0) AppleWebKit/535.1...                        ...                          America/Los_Angeles  http://www.nasa.gov/multimedia/imagegallery/im...</span><br><span class="line">3531           NaN  Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6...                        ...                                               http://www.nasa.gov/mission_pages/nustar/main/...</span><br><span class="line">3532           NaN  Mozilla/5.0 (Windows NT 6.1; WOW64; rv:10.0.2)...                        ...                             America/New_York  http://portal.hud.gov/hudportal/HUD?src=/press...</span><br><span class="line">3533           NaN  Mozilla/5.0 (iPad; CPU OS 5_1 like Mac OS X) A...                        ...                             America/New_York                         http://apod.nasa.gov/apod/</span><br><span class="line">3534           NaN  Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_8)...                        ...                              America/Chicago  https://www.nysdot.gov/rexdesign/design/commun...</span><br><span class="line">3535           NaN  Mozilla/5.0 (Windows NT 5.1; rv:10.0.2) Gecko/...                        ...                              America/Chicago  http://ntl.bts.gov/lib/44000/44300/44374/FHWA-...</span><br><span class="line">3536           NaN  Mozilla/5.0 (BlackBerry; U; BlackBerry 9800; e...                        ...                                               http://www.nasa.gov/mission_pages/hurricanes/a...</span><br><span class="line">3537           NaN  Mozilla/5.0 (Windows NT 6.1; WOW64; rv:10.0.2)...                        ...                          America/Tegucigalpa            http://apod.nasa.gov/apod/ap120312.html</span><br><span class="line">3538           NaN  Mozilla/5.0 (iPhone; CPU iPhone OS 5_1 like Ma...                        ...                          America/Los_Angeles  http://healthypeople.gov/2020/connect/webinars...</span><br><span class="line">3539           NaN    Mozilla/5.0 (compatible; Fedora Core 3) FC3 KDE                        ...                          America/Los_Angeles  http://www.federalreserve.gov/newsevents/press...</span><br><span class="line">3540           NaN  Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKi...                        ...                               America/Denver  http://www.nasa.gov/mission_pages/nustar/main/...</span><br><span class="line">3541           NaN  Mozilla/5.0 (X11; U; OpenVMS AlphaServer_ES40;...                        ...                          America/Los_Angeles  http://www.federalreserve.gov/newsevents/press...</span><br><span class="line">3542           NaN  Mozilla/5.0 (compatible; MSIE 9.0; Windows NT ...                        ...                          America/Los_Angeles  http://www.sba.gov/community/blogs/community-b...</span><br><span class="line">3543  1.331927e+09                                                NaN                        ...                                          NaN                                                NaN</span><br><span class="line">3544           NaN  Mozilla/5.0 (Windows NT 6.1; WOW64; rv:5.0.1) ...                        ...                              America/Chicago  https://www.nysdot.gov/rexdesign/design/commun...</span><br><span class="line">3545           NaN  Mozilla/5.0 (Windows NT 6.1; WOW64; rv:10.0.2)...                        ...                              America/Chicago  https://www.nysdot.gov/rexdesign/design/commun...</span><br><span class="line">3546           NaN  Mozilla/5.0 (iPhone; CPU iPhone OS 5_1 like Ma...                        ...                          America/Los_Angeles  http://healthypeople.gov/2020/connect/webinars...</span><br><span class="line">3547           NaN  Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_8)...                        ...                             America/New_York  http://www.epa.gov/otaq/regs/fuels/additive/e1...</span><br><span class="line">3548           NaN  Mozilla/5.0 (iPhone; CPU iPhone OS 5_1 like Ma...                        ...                              America/Chicago    http://www.fda.gov/Safety/Recalls/ucm296326.htm</span><br><span class="line">3549           NaN  Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKi...                        ...                             Europe/Stockholm  http://www.nasa.gov/mission_pages/WISE/main/<span class="keyword">in</span>...</span><br><span class="line">3550           NaN  Mozilla/4.0 (compatible; MSIE 8.0; Windows NT ...                        ...                             America/New_York  http://www.nlm.nih.gov/medlineplus/news/fullst...</span><br><span class="line">3551           NaN  Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKi...                        ...                                               http://www.nasa.gov/mission_pages/nustar/main/...</span><br><span class="line">3552           NaN  Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US...                        ...                              America/Chicago  http://travel.state.gov/passport/passport_5535...</span><br><span class="line">3553           NaN  Mozilla/4.0 (compatible; MSIE 7.0; Windows NT ...                        ...                             America/New_York  http://www.shrewsbury-ma.gov/egov/gallery/1341...</span><br><span class="line">3554           NaN  Mozilla/4.0 (compatible; MSIE 7.0; Windows NT ...                        ...                             America/New_York  http://www.shrewsbury-ma.gov/egov/gallery/1341...</span><br><span class="line">3555           NaN  Mozilla/4.0 (compatible; MSIE 9.0; Windows NT ...                        ...                             America/New_York  http://www.fda.gov/AdvisoryCommittees/Committe...</span><br><span class="line">3556           NaN  Mozilla/5.0 (Windows NT 5.1) AppleWebKit/535.1...                        ...                              America/Chicago  http://www.okc.gov/PublicNotificationSystem/Fo...</span><br><span class="line">3557           NaN                             GoogleMaps/RochesterNY                        ...                               America/Denver        http://www.monroecounty.gov/etc/911/rss.php</span><br><span class="line">3558           NaN                                     GoogleProducer                        ...                          America/Los_Angeles                http://www.ahrq.gov/qual/qitoolkit/</span><br><span class="line">3559           NaN  Mozilla/4.0 (compatible; MSIE 8.0; Windows NT ...                        ...                             America/New_York  http://herndon-va.gov/Content/public_safety/Pu...</span><br><span class="line"></span><br><span class="line">[3560 rows x 18 columns]</span><br></pre></td></tr></table></figure>

<h1 id="对时区数据进行微处理并生成图片"><a href="#对时区数据进行微处理并生成图片" class="headerlink" title="对时区数据进行微处理并生成图片"></a>对时区数据进行微处理并生成图片</h1><p>有一些数据的<code>tz</code>值是<code>&#39;&#39;</code>的，我们当成 Unknown，也有一些是缺省的，没有这个 key，我们就设成 Missing</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">clean_tz = frame[<span class="string">&#x27;tz&#x27;</span>].fillna(<span class="string">&#x27;Missing&#x27;</span>)</span><br><span class="line"><span class="comment"># print(clean_tz)</span></span><br><span class="line">clean_tz[clean_tz == <span class="string">&#x27;&#x27;</span>] = <span class="string">&#x27;Unknown&#x27;</span></span><br><span class="line">tz_counts = clean_tz.value_counts()</span><br><span class="line"><span class="built_in">print</span>(tz_counts[:<span class="number">10</span>])</span><br></pre></td></tr></table></figure>

<p>output:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">America/New_York       1251</span><br><span class="line">Unknown                 521</span><br><span class="line">America/Chicago         400</span><br><span class="line">America/Los_Angeles     382</span><br><span class="line">America/Denver          191</span><br><span class="line">Missing                 120</span><br><span class="line">Europe/London            74</span><br><span class="line">Asia/Tokyo               37</span><br><span class="line">Pacific/Honolulu         36</span><br><span class="line">Europe/Madrid            35</span><br><span class="line">Name: tz, dtype: int64</span><br></pre></td></tr></table></figure>

<p>之后我们可以画出对应的柱状图，如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tz_counts[:<span class="number">10</span>].plot(kind=<span class="string">&#x27;barh&#x27;</span>, rot=<span class="number">0</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<p><img src="/img/post/2019/01/2019-01-05-PyAnalysisLearn01.01.jpg" alt="2019-01-05-PyAnalysisLearn01.01.jpg"></p>
<h1 id="解析-Agent-信息"><a href="#解析-Agent-信息" class="headerlink" title="解析 Agent 信息"></a>解析 Agent 信息</h1><p>上面我们可以看到 Agent 的初始信息很多，字符串很长，但是我们可以根据特征使用字符串函数与正则表达式先解析出来。</p>
<p>下面就是将空值去掉并进行计数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">results = Series([x.split()[<span class="number">0</span>] <span class="keyword">for</span> x <span class="keyword">in</span> frame.a.dropna()])</span><br><span class="line">agent_counts = results.value_counts()[:<span class="number">8</span>]</span><br><span class="line"><span class="built_in">print</span>(agent_counts)</span><br></pre></td></tr></table></figure>

<p>output:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Mozilla/5.0                 2594</span><br><span class="line">Mozilla/4.0                  601</span><br><span class="line">GoogleMaps/RochesterNY       121</span><br><span class="line">Opera/9.80                    34</span><br><span class="line">TEST_INTERNET_AGENT           24</span><br><span class="line">GoogleProducer                21</span><br><span class="line">Mozilla/6.0                    5</span><br><span class="line">BlackBerry8520/5.0.0.681       4</span><br><span class="line">dtype: int64</span><br></pre></td></tr></table></figure>

<p>在 Agent 信息中我们可以看到一些有 Windows 的字样，表示是在 windows 系统下访问的，而没有的话，我们就认真是非 Windows 的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">frame.loc[frame.tz==<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;tz&#x27;</span>] = <span class="string">&#x27;Unknown&#x27;</span></span><br><span class="line">cframe = frame[frame.a.notnull()]</span><br><span class="line">operation_system = np.where(cframe[<span class="string">&#x27;a&#x27;</span>].<span class="built_in">str</span>.contains(<span class="string">&#x27;Windows&#x27;</span>), <span class="string">&#x27;Windows&#x27;</span>, <span class="string">&#x27;Not Windows&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(operation_system[:<span class="number">5</span>])</span><br></pre></td></tr></table></figure>

<p>我们可以看到前面 5 条数据 agent 中的情况<br>output:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&#x27;Windows&#x27;</span> <span class="string">&#x27;Not Windows&#x27;</span> <span class="string">&#x27;Windows&#x27;</span> <span class="string">&#x27;Not Windows&#x27;</span> <span class="string">&#x27;Windows&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h1 id="根据时区和系统进行分组解析"><a href="#根据时区和系统进行分组解析" class="headerlink" title="根据时区和系统进行分组解析"></a>根据时区和系统进行分组解析</h1><p>上面我们可以得到时区和所使用系统的分布，下面我们就可以根据这些来进行分组，得知在一个时区里系统的使用情况。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">by_tz_os = cframe.groupby([<span class="string">&#x27;tz&#x27;</span>, operation_system])</span><br><span class="line">agg_counts = by_tz_os.size().unstack().fillna(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(agg_counts[:<span class="number">10</span>])</span><br></pre></td></tr></table></figure>

<p>output:下面是取前面的 10 个值（还没有排序）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">                                Not Windows  Windows</span><br><span class="line">tz</span><br><span class="line">                                      245.0    276.0</span><br><span class="line">Africa/Cairo                            0.0      3.0</span><br><span class="line">Africa/Casablanca                       0.0      1.0</span><br><span class="line">Africa/Ceuta                            0.0      2.0</span><br><span class="line">Africa/Johannesburg                     0.0      1.0</span><br><span class="line">Africa/Lusaka                           0.0      1.0</span><br><span class="line">America/Anchorage                       4.0      1.0</span><br><span class="line">America/Argentina/Buenos_Aires          1.0      0.0</span><br><span class="line">America/Argentina/Cordoba               0.0      1.0</span><br><span class="line">America/Argentina/Mendoza               0.0      1.0</span><br></pre></td></tr></table></figure>

<p>接下来主要目的是选取最常出现的时区（即 Not Windows 和 Windows 的数量加起来的数量最多的时区，其实直接 count 时区是一样的），所以我们要先构造一个间接索引数组。<br>然后通过 take 按照这个顺序截取了最后 10 行,因为是升序，所以是 top10</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># order by asc</span></span><br><span class="line"></span><br><span class="line">indexer = agg_counts.<span class="built_in">sum</span>(<span class="number">1</span>).argsort()</span><br><span class="line">count_subset = agg_counts.take(indexer)[-<span class="number">10</span>:]</span><br><span class="line"><span class="built_in">print</span>(count_subset)</span><br><span class="line"></span><br><span class="line"><span class="comment"># draw the real number</span></span><br><span class="line"></span><br><span class="line">count_subset.plot(kind=<span class="string">&#x27;barh&#x27;</span>, stacked=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># draw with %</span></span><br><span class="line"></span><br><span class="line">normed_subset = count_subset = count_subset.div(count_subset.<span class="built_in">sum</span>(<span class="number">1</span>), axis=<span class="number">0</span>)</span><br><span class="line">normed_subset.plot(kind=<span class="string">&#x27;barh&#x27;</span>, stacked=<span class="literal">True</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<p>output:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">tz</span><br><span class="line">America/Sao_Paulo           13.0     20.0</span><br><span class="line">Europe/Madrid               16.0     19.0</span><br><span class="line">Pacific/Honolulu             0.0     36.0</span><br><span class="line">Asia/Tokyo                   2.0     35.0</span><br><span class="line">Europe/London               43.0     31.0</span><br><span class="line">America/Denver             132.0     59.0</span><br><span class="line">America/Los_Angeles        130.0    252.0</span><br><span class="line">America/Chicago            115.0    285.0</span><br><span class="line">Unknown                    245.0    276.0</span><br><span class="line">America/New_York           339.0    912.0</span><br></pre></td></tr></table></figure>

<p>这里画了两张图，一张为实际数值:<br><img src="/img/post/2019/01/2019-01-05-PyAnalysisLearn01.02.jpg" alt="2019-01-05-PyAnalysisLearn01.02.jpg"></p>
<p>另一张则为百分比：<br><img src="/img/post/2019/01/2019-01-05-PyAnalysisLearn01.03.jpg" alt="2019-01-05-PyAnalysisLearn01.03.jpg"></p>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>在学习的过程中，不出意外的我遇到了 SettingwithCopyWarning 的坑，这个是由于<strong>链式赋值（链式索引和赋值的组合）</strong>的引起的，还是有点意思的，下面的参考中就有一些资料帮助理解。<br>虽然只是warning，但还是不应该出现并且避免，因为说明有风险，赋值操作可能与想的不一样。</p>
<p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/haolexiao/article/details/81180571">pandas 的 SettingWithCopyWarning 警告出现的原因和如何避免</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/72274ccb647a">Pandas 中 SettingwithCopyWarning 的原理和解决方案</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/jmilk/article/details/78733409">Python 笔试集（1）：关于 Python 链式赋值的坑</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2018-12-17T16:00:00.000Z" title="2018/12/18 上午12:00:00">2018-12-18</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-09-08T15:43:26.393Z" title="2020/9/8 下午11:43:26">2020-09-08</time></span><span class="level-item"> BF </span><span class="level-item">12 minutes read (About 1866 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/12/18/2018/12/2018-12-18-PyRunJobsInParallel/">Run Jobs In Parallel</a></h1><div class="content"><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>这周的一个目标是把之前 Benchmark 的脚本改写，使它支持并发的跑 job。</p>
<p>之前的配置是使用 ini，不适合配置现在这种需求，也不想用之前的 xml 来配置，所以今天就简单的研究了下使用 yaml 来配置并运行。</p>
<h1 id="yaml-配置文件"><a href="#yaml-配置文件" class="headerlink" title="yaml 配置文件"></a>yaml 配置文件</h1><p>这面是简单的一个例子，希望最后执行的时候，不同的 task 之间是串行在跑的，而同一个 task 里的 job 是并发跑的：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">description:</span> <span class="string">sample</span> <span class="string">to</span> <span class="string">run</span> <span class="string">jobs</span> <span class="string">in</span> <span class="string">parallel</span></span><br><span class="line"><span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">taskid:</span> <span class="number">01</span></span><br><span class="line">    <span class="attr">desc:</span> <span class="string">task</span> <span class="number">01</span></span><br><span class="line">    <span class="attr">jobs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">jobid:</span> <span class="number">001</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">job</span> <span class="number">001</span> <span class="string">in</span> <span class="string">parallel</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">jobid:</span> <span class="number">002</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">job</span> <span class="number">002</span> <span class="string">in</span> <span class="string">parallel</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">jobid:</span> <span class="number">003</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">job</span> <span class="number">003</span> <span class="string">in</span> <span class="string">parallel</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">jobid:</span> <span class="number">004</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">job</span> <span class="number">004</span> <span class="string">in</span> <span class="string">parallel</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">taskid:</span> <span class="number">02</span></span><br><span class="line">    <span class="attr">desc:</span> <span class="string">task</span> <span class="number">02</span></span><br><span class="line">    <span class="attr">jobs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">jobid:</span> <span class="number">005</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">job</span> <span class="number">005</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">taskid:</span> <span class="number">03</span></span><br><span class="line">    <span class="attr">desc:</span> <span class="string">task</span> <span class="number">03</span></span><br><span class="line">    <span class="attr">jobs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">jobid:</span> <span class="number">06</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">job</span> <span class="number">006</span></span><br></pre></td></tr></table></figure>

<h1 id="使用-Queue-控制运行"><a href="#使用-Queue-控制运行" class="headerlink" title="使用 Queue 控制运行"></a>使用 Queue 控制运行</h1><p>下面直接上代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> random, time</span><br><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Job</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, jobid, name</span>):</span></span><br><span class="line">        self.jobid = jobid</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JobProcessor</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, queue</span>):</span></span><br><span class="line">        self.queue = queue</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run_job</span>(<span class="params">self, job</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;start run job &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(job.name))</span><br><span class="line">        time.sleep(random.randint(<span class="number">1</span>,<span class="number">10</span>))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;ended run job &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(job.name))</span><br><span class="line">        self.queue.task_done()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run_jobs</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> self.queue.empty():</span><br><span class="line">            job = self.queue.get()</span><br><span class="line">            myThread = threading.Thread(target=self.run_job, args=(job,))</span><br><span class="line">            myThread.start()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&#x27;jobs.yaml&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    yaml_content = f.read()</span><br><span class="line">    json_content = yaml.load(yaml_content)</span><br><span class="line">    tasks_list = json_content[<span class="string">&#x27;tasks&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> task <span class="keyword">in</span> tasks_list:</span><br><span class="line">        jobs = task[<span class="string">&#x27;jobs&#x27;</span>]</span><br><span class="line">        jobs_num = <span class="built_in">len</span>(jobs)</span><br><span class="line">        jobs_queue = queue.Queue(jobs_num)</span><br><span class="line">        <span class="keyword">for</span> job <span class="keyword">in</span> jobs:</span><br><span class="line">            jobs_queue.put(Job(job[<span class="string">&#x27;jobid&#x27;</span>], job[<span class="string">&#x27;name&#x27;</span>]))</span><br><span class="line">        JobProcessor(jobs_queue).run_jobs()</span><br><span class="line">        jobs_queue.join()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>仔细看的话，主要是利用 queue 存储了 job 信息，然后利用<code>.task_done</code>和<code>.join</code>方法，实现等待任务的完成的操作。</p>
<p>下面是运行的结果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\bearfly1990\Desktop\python_test\task_parallel&gt;python runjobs.py</span><br><span class="line">start run job job 001 <span class="keyword">in</span> parallel</span><br><span class="line">start run job job 002 <span class="keyword">in</span> parallel</span><br><span class="line">start run job job 003 <span class="keyword">in</span> parallel</span><br><span class="line">start run job job 004 <span class="keyword">in</span> parallel</span><br><span class="line">ended run job job 001 <span class="keyword">in</span> parallel</span><br><span class="line">ended run job job 004 <span class="keyword">in</span> parallel</span><br><span class="line">ended run job job 003 <span class="keyword">in</span> parallel</span><br><span class="line">ended run job job 002 <span class="keyword">in</span> parallel</span><br><span class="line">start run job job 005</span><br><span class="line">ended run job job 005</span><br><span class="line">start run job job 006</span><br><span class="line">ended run job job 006</span><br></pre></td></tr></table></figure>

<h1 id="升级配置，增加功能"><a href="#升级配置，增加功能" class="headerlink" title="升级配置，增加功能"></a>升级配置，增加功能</h1><p>之前（上面）的简单例子是不能够满足实际的需求的，只是多线程的一个简单例子。</p>
<p>这周花了些时间，增加了一些配置项，针对 Job 提供了 JobGroups，每个 Group 之间都是默认并行的，但是也可以通过 pregroup 来限定先后顺序。<br>而 group 内部，我则希望是可以配置的，既可以并行，也可以串行。</p>
<p>下面是新的 yaml 配置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">description:</span> <span class="string">sample</span> <span class="string">to</span> <span class="string">run</span> <span class="string">jobs</span></span><br><span class="line"><span class="attr">Tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">taskid:</span> <span class="number">01</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">task</span> <span class="number">01</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="string">import</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">T</span></span><br><span class="line">    <span class="attr">file:</span> <span class="number">01.</span><span class="string">txt</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">taskid:</span> <span class="number">02</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">task</span> <span class="number">02</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="string">import</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">S</span></span><br><span class="line">    <span class="attr">file:</span> <span class="number">02.</span><span class="string">txt</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">taskid:</span> <span class="number">03</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">task</span> <span class="number">03</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="string">jobgroup</span></span><br><span class="line">    <span class="attr">JobGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="number">1</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">G1</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">parallel</span></span><br><span class="line">        <span class="attr">Jobs:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">jobid:</span> <span class="number">001</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">job</span> <span class="string">G1-01</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">jobid:</span> <span class="number">002</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">job</span> <span class="string">G1-02</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">jobid:</span> <span class="number">003</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">job</span> <span class="string">G1-03</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">jobid:</span> <span class="number">004</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">job</span> <span class="string">G1-04</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="number">2</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">G2</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">parallel</span></span><br><span class="line">        <span class="attr">Jobs:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">jobid:</span> <span class="number">005</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">job</span> <span class="string">G2-05</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">jobid:</span> <span class="number">006</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">job</span> <span class="string">G2-06</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">jobid:</span> <span class="number">007</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">job</span> <span class="string">G2-07</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">jobid:</span> <span class="number">008</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">job</span> <span class="string">G2-08</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="number">3</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">G3</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">serial</span></span><br><span class="line">        <span class="attr">pregroup:</span> <span class="number">1</span></span><br><span class="line">        <span class="attr">Jobs:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">jobid:</span> <span class="number">009</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">job</span> <span class="string">G3-09</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">jobid:</span> <span class="number">010</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">job</span> <span class="string">G3-10</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">jobid:</span> <span class="number">011</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">job</span> <span class="string">G3-11</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">jobid:</span> <span class="number">012</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">job</span> <span class="string">G3-12</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">taskid:</span> <span class="number">04</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">hello</span> <span class="string">world</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="string">say</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">taskid:</span> <span class="number">05</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">test</span> <span class="string">passed</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="string">wait</span></span><br></pre></td></tr></table></figure>

<p>下面是具体的实现，已经在一些关键点加了备注：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImportInfo</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, <span class="built_in">type</span>, file</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.<span class="built_in">type</span> = <span class="built_in">type</span></span><br><span class="line">        self.file = file</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Job</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, jobid, name</span>):</span></span><br><span class="line">        self.jobid = jobid</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JobProcessor</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, queue=<span class="literal">None</span></span>):</span></span><br><span class="line">        self.queue = queue</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run_job</span>(<span class="params">self, job</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;start run job &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(job.name))</span><br><span class="line">        time.sleep(random.randint(<span class="number">1</span>, <span class="number">7</span>))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;ended run job &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(job.name))</span><br><span class="line">        self.queue.task_done()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run_jobs_parallel</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> self.queue.empty():</span><br><span class="line">            job = self.queue.get()</span><br><span class="line">            my_thread = threading.Thread(target=self.run_job, args=(job,))</span><br><span class="line">            my_thread.start()</span><br><span class="line">        self.queue.join()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run_jobs_serial</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> self.queue.empty():</span><br><span class="line">            job = self.queue.get()</span><br><span class="line">            self.run_job(job)</span><br><span class="line">        self.queue.join()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run_job_group</span>(<span class="params">self, job_group, job_group_map</span>):</span></span><br><span class="line"></span><br><span class="line">        pregroup = job_group.get(<span class="string">&#x27;pregroup&#x27;</span>, -<span class="number">1</span>)</span><br><span class="line">        jobs = job_group[<span class="string">&#x27;Jobs&#x27;</span>]</span><br><span class="line">        <span class="comment"># default mode is parallel</span></span><br><span class="line">        </span><br><span class="line">        mode = job_group.get(<span class="string">&#x27;mode&#x27;</span>, <span class="string">&#x27;parallel&#x27;</span>)</span><br><span class="line">        <span class="comment"># add jobs to the queue</span></span><br><span class="line">        </span><br><span class="line">        jobs_num = <span class="built_in">len</span>(jobs)</span><br><span class="line">        jobs_queue = queue.Queue(jobs_num)</span><br><span class="line">        job_group_map[job_group[<span class="string">&#x27;id&#x27;</span>]] = jobs_queue</span><br><span class="line">        <span class="keyword">for</span> job <span class="keyword">in</span> jobs:</span><br><span class="line">            jobs_queue.put(Job(job[<span class="string">&#x27;jobid&#x27;</span>], job[<span class="string">&#x27;name&#x27;</span>]))</span><br><span class="line">            </span><br><span class="line">        <span class="comment"># wait for pregroup run finished if have pregroup</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(pregroup != -<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">while</span>(<span class="literal">True</span>):</span><br><span class="line">                pre_queue = job_group_map.get(pregroup, <span class="literal">None</span>)</span><br><span class="line">                <span class="keyword">if</span> pre_queue:</span><br><span class="line">                    pre_queue.join()</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;### start run jobgroup:&#123;&#125; ###&#x27;</span>.<span class="built_in">format</span>(job_group[<span class="string">&#x27;name&#x27;</span>]))</span><br><span class="line">        <span class="keyword">if</span>(mode == <span class="string">&#x27;parallel&#x27;</span>):</span><br><span class="line">            JobProcessor(jobs_queue).run_jobs_parallel()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            JobProcessor(jobs_queue).run_jobs_serial()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;### end run jobgroup:&#123;&#125; ###&#x27;</span>.<span class="built_in">format</span>(job_group[<span class="string">&#x27;name&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run_job_groups</span>(<span class="params">self, job_groups</span>):</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment"># map each group queue, so that we could check the group is finished or not.</span></span><br><span class="line">        </span><br><span class="line">        job_group_map = &#123;&#125;</span><br><span class="line">        thread_list = []</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> job_group <span class="keyword">in</span> job_groups:</span><br><span class="line">            run_job_group_thread = threading.Thread(</span><br><span class="line">                target=self.run_job_group, args=(job_group, job_group_map))</span><br><span class="line">            thread_list.append(run_job_group_thread)</span><br><span class="line">            run_job_group_thread.start()</span><br><span class="line">            </span><br><span class="line">        <span class="comment"># wait for all groups are finished</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> thread <span class="keyword">in</span> thread_list:</span><br><span class="line">            thread.join()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_import</span>(<span class="params">importInfo</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;import &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(importInfo.name))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    fin = <span class="built_in">open</span>(<span class="string">&#x27;jobs.yaml&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    json_content = yaml.load(fin)</span><br><span class="line">    task_list = json_content[<span class="string">&#x27;Tasks&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> task <span class="keyword">in</span> task_list:</span><br><span class="line">        <span class="built_in">print</span>(task[<span class="string">&#x27;name&#x27;</span>], <span class="string">&#x27;|&#x27;</span>, task[<span class="string">&#x27;mode&#x27;</span>], <span class="string">&#x27;|&#x27;</span>, task.get(<span class="string">&#x27;type&#x27;</span>, <span class="string">&#x27;None&#x27;</span>), <span class="string">&#x27;|&#x27;</span>, task.get(<span class="string">&#x27;file&#x27;</span>, <span class="string">&#x27;None&#x27;</span>))</span><br><span class="line">        task_mode = task[<span class="string">&#x27;mode&#x27;</span>].lower()</span><br><span class="line">        <span class="keyword">if</span>(task_mode == <span class="string">&#x27;jobgroup&#x27;</span>):</span><br><span class="line">            JobProcessor().run_job_groups(task[<span class="string">&#x27;JobGroups&#x27;</span>])</span><br><span class="line">        <span class="keyword">elif</span>(task_mode == <span class="string">&#x27;import&#x27;</span>):</span><br><span class="line">            run_import(ImportInfo(task[<span class="string">&#x27;name&#x27;</span>], task[<span class="string">&#x27;type&#x27;</span>], task[<span class="string">&#x27;file&#x27;</span>]))</span><br><span class="line">        <span class="keyword">elif</span>(task_mode == <span class="string">&#x27;say&#x27;</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;say &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(task[<span class="string">&#x27;name&#x27;</span>]))</span><br><span class="line">        <span class="keyword">elif</span>(task_mode == <span class="string">&#x27;wait&#x27;</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;wait &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(task[<span class="string">&#x27;name&#x27;</span>]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>下面是一次跑的例子：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">c:\Users\mayn\Desktop\workspace\python_yaml&gt;python runjobs.py</span><br><span class="line">task 01 | import | T | 01.txt</span><br><span class="line">import task 01</span><br><span class="line">task 02 | import | S | 02.txt</span><br><span class="line">import task 02</span><br><span class="line">task 03 | jobgroup | None | None</span><br><span class="line"><span class="comment">### start run jobgroup:G1 ###</span></span><br><span class="line"><span class="comment">### start run jobgroup:G2 ###</span></span><br><span class="line">start run job job G1-01</span><br><span class="line">start run job job G1-02</span><br><span class="line">start run job job G2-05</span><br><span class="line">start run job job G2-06</span><br><span class="line">start run job job G1-03</span><br><span class="line">start run job job G1-04</span><br><span class="line">start run job job G2-07</span><br><span class="line">start run job job G2-08</span><br><span class="line">ended run job job G2-05</span><br><span class="line">ended run job job G1-02</span><br><span class="line">ended run job job G1-01</span><br><span class="line">ended run job job G2-06</span><br><span class="line">ended run job job G1-03</span><br><span class="line">ended run job job G2-08</span><br><span class="line">ended run job job G1-04</span><br><span class="line">ended run job job G2-07</span><br><span class="line"><span class="comment">### start run jobgroup:G3 ###</span></span><br><span class="line"><span class="comment">### end run jobgroup:G1 ###</span></span><br><span class="line">start run job job G3-09</span><br><span class="line"><span class="comment">### end run jobgroup:G2 ###</span></span><br><span class="line">ended run job job G3-09</span><br><span class="line">start run job job G3-10</span><br><span class="line">ended run job job G3-10</span><br><span class="line">start run job job G3-11</span><br><span class="line">ended run job job G3-11</span><br><span class="line">start run job job G3-12</span><br><span class="line">ended run job job G3-12</span><br><span class="line"><span class="comment">### end run jobgroup:G3 ###</span></span><br><span class="line">hello world | say | None | None</span><br><span class="line">say hello world</span><br><span class="line"><span class="built_in">test</span> passed | <span class="built_in">wait</span> | None | None</span><br><span class="line"><span class="built_in">wait</span> <span class="built_in">test</span> passed</span><br></pre></td></tr></table></figure>

<h1 id="使用-map-和-multiprocessing"><a href="#使用-map-和-multiprocessing" class="headerlink" title="使用 map 和 multiprocessing"></a>使用 map 和 multiprocessing</h1><p>在晓辉建议下，使用 map 函数结合线程池简化了代码，不用自己控制并发了，api 更简单。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool <span class="keyword">as</span> ThreadPool</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImportInfo</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, <span class="built_in">type</span>, file</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.<span class="built_in">type</span> = <span class="built_in">type</span></span><br><span class="line">        self.file = file</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Job</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, jobid, name</span>):</span></span><br><span class="line">        self.jobid = jobid</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JobProcessor</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, queue=<span class="literal">None</span></span>):</span></span><br><span class="line">        self.queue = queue</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run_job</span>(<span class="params">self, job</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;start run job &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(job.name))</span><br><span class="line">        time.sleep(random.randint(<span class="number">1</span>, <span class="number">7</span>))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;ended run job &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(job.name))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run_job_group</span>(<span class="params">self, param</span>):</span></span><br><span class="line">        job_group = param[<span class="string">&#x27;job_group&#x27;</span>]</span><br><span class="line">        job_group_map = param[<span class="string">&#x27;job_group_map&#x27;</span>]</span><br><span class="line">        pregroup = job_group.get(<span class="string">&#x27;pregroup&#x27;</span>, -<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># add jobs to a new list</span></span><br><span class="line">        jobs = [Job(job[<span class="string">&#x27;jobid&#x27;</span>], job[<span class="string">&#x27;name&#x27;</span>]) <span class="keyword">for</span> job <span class="keyword">in</span> job_group[<span class="string">&#x27;Jobs&#x27;</span>]]</span><br><span class="line">        <span class="comment"># default mode is parallel</span></span><br><span class="line">        mode = job_group.get(<span class="string">&#x27;mode&#x27;</span>, <span class="string">&#x27;parallel&#x27;</span>)</span><br><span class="line">        jobs_thread_pool = ThreadPool(<span class="built_in">len</span>(jobs))</span><br><span class="line">        job_group_map[job_group[<span class="string">&#x27;id&#x27;</span>]] = jobs_thread_pool</span><br><span class="line">        <span class="comment"># wait for pregroup run finished if have pregroup</span></span><br><span class="line">        <span class="keyword">if</span>(pregroup != -<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">while</span>(<span class="literal">True</span>):</span><br><span class="line">                pre_group_pool = job_group_map.get(pregroup, <span class="literal">None</span>)</span><br><span class="line">                <span class="keyword">if</span> pre_group_pool:</span><br><span class="line">                    pre_group_pool.close()</span><br><span class="line">                    pre_group_pool.join()</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                time.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;### start run jobgroup:&#123;&#125; ###&#x27;</span>.<span class="built_in">format</span>(job_group[<span class="string">&#x27;name&#x27;</span>]))</span><br><span class="line">        <span class="keyword">if</span>(mode == <span class="string">&#x27;parallel&#x27;</span>):</span><br><span class="line">            jobs_thread_pool.<span class="built_in">map</span>(self.run_job, jobs)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">list</span>(<span class="built_in">map</span>(self.run_job, jobs))</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;### end run jobgroup:&#123;&#125; ###&#x27;</span>.<span class="built_in">format</span>(job_group[<span class="string">&#x27;name&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run_job_groups</span>(<span class="params">self, job_groups</span>):</span></span><br><span class="line">        job_group_map = &#123;&#125;</span><br><span class="line">        groups_thread_pool = ThreadPool(<span class="built_in">len</span>(job_groups))</span><br><span class="line">        job_group_param = [&#123;<span class="string">&#x27;job_group&#x27;</span>:job_group, <span class="string">&#x27;job_group_map&#x27;</span>:job_group_map&#125; <span class="keyword">for</span> job_group <span class="keyword">in</span> job_groups]</span><br><span class="line">        groups_thread_pool.<span class="built_in">map</span>(self.run_job_group, job_group_param)</span><br><span class="line">        groups_thread_pool.close()</span><br><span class="line">        groups_thread_pool.join()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_import</span>(<span class="params">importInfo</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;import &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(importInfo.name))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    fin = <span class="built_in">open</span>(<span class="string">&#x27;jobs.yaml&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    json_content = yaml.load(fin)</span><br><span class="line">    task_list = json_content[<span class="string">&#x27;Tasks&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> task <span class="keyword">in</span> task_list:</span><br><span class="line">        <span class="built_in">print</span>(task[<span class="string">&#x27;name&#x27;</span>], <span class="string">&#x27;|&#x27;</span>, task[<span class="string">&#x27;mode&#x27;</span>], <span class="string">&#x27;|&#x27;</span>, task.get(<span class="string">&#x27;type&#x27;</span>, <span class="string">&#x27;None&#x27;</span>), <span class="string">&#x27;|&#x27;</span>, task.get(<span class="string">&#x27;file&#x27;</span>, <span class="string">&#x27;None&#x27;</span>))</span><br><span class="line">        task_mode = task[<span class="string">&#x27;mode&#x27;</span>].lower()</span><br><span class="line">        <span class="keyword">if</span>(task_mode == <span class="string">&#x27;jobgroup&#x27;</span>):</span><br><span class="line">            JobProcessor().run_job_groups(task[<span class="string">&#x27;JobGroups&#x27;</span>])</span><br><span class="line">        <span class="keyword">elif</span>(task_mode == <span class="string">&#x27;import&#x27;</span>):</span><br><span class="line">            run_import(ImportInfo(task[<span class="string">&#x27;name&#x27;</span>], task[<span class="string">&#x27;type&#x27;</span>], task[<span class="string">&#x27;file&#x27;</span>]))</span><br><span class="line">        <span class="keyword">elif</span>(task_mode == <span class="string">&#x27;say&#x27;</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;say &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(task[<span class="string">&#x27;name&#x27;</span>]))</span><br><span class="line">        <span class="keyword">elif</span>(task_mode == <span class="string">&#x27;wait&#x27;</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;wait &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(task[<span class="string">&#x27;name&#x27;</span>]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>具体实现在真正写的时候需要再调整一下，而且感觉代码还可以优化，感觉目前并不是最好的实现方式，或者说写法有点怪。。。</p>
<hr>
<p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/itogo/p/5635629.html">python 队列 Queue</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xinjing-jingxin/p/9128293.html">Python 操作 yaml 文件</a></li>
</ul>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/tags/python/">Previous</a></div><div class="pagination-next"><a href="/tags/python/page/3/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/tags/python/">1</a></li><li><a class="pagination-link is-current" href="/tags/python/page/2/">2</a></li><li><a class="pagination-link" href="/tags/python/page/3/">3</a></li><li><a class="pagination-link" href="/tags/python/page/4/">4</a></li><li><a class="pagination-link" href="/tags/python/page/5/">5</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/mybear.jpg" alt="bearfly1990"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">bearfly1990</p><p class="is-size-6 is-block">有熊在飞</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>HZ, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">81</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">100</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/bearfly1990" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/bearfly1990"><i class="fab fa-github"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-11T16:00:00.000Z">2021-08-12</time></p><p class="title"><a href="/2021/08/12/2021/08/2021-08-12-box-python-sdk/">box SDK for python</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-07T16:00:00.000Z">2021-08-08</time></p><p class="title"><a href="/2021/08/08/2021/08/2021-08-09-kafka-learn-01/">Kafka Learn - 01</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-07-20T16:00:00.000Z">2021-07-21</time></p><p class="title"><a href="/2021/07/21/2021/07/2021-07-21-jaydebeapi/">jaydebeapi</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-07-16T16:00:00.000Z">2021-07-17</time></p><p class="title"><a href="/2021/07/17/2021/07/2021-07-17-NanHu/">NanHu</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-07-03T16:00:00.000Z">2021-07-04</time></p><p class="title"><a href="/2021/07/04/2021/07/2021-07-04-folder-tree/">Folder Tree Info DFS/BFS</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">August 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/07/"><span class="level-start"><span class="level-item">July 2021</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/03/"><span class="level-start"><span class="level-item">March 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/02/"><span class="level-start"><span class="level-item">February 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/09/"><span class="level-start"><span class="level-item">September 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/06/"><span class="level-start"><span class="level-item">June 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/03/"><span class="level-start"><span class="level-item">March 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/01/"><span class="level-start"><span class="level-item">January 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/12/"><span class="level-start"><span class="level-item">December 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/11/"><span class="level-start"><span class="level-item">November 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/10/"><span class="level-start"><span class="level-item">October 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/08/"><span class="level-start"><span class="level-item">August 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/06/"><span class="level-start"><span class="level-item">June 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/05/"><span class="level-start"><span class="level-item">May 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/03/"><span class="level-start"><span class="level-item">March 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/02/"><span class="level-start"><span class="level-item">February 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/01/"><span class="level-start"><span class="level-item">January 2019</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/12/"><span class="level-start"><span class="level-item">December 2018</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/11/"><span class="level-start"><span class="level-item">November 2018</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/10/"><span class="level-start"><span class="level-item">October 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/09/"><span class="level-start"><span class="level-item">September 2018</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/08/"><span class="level-start"><span class="level-item">August 2018</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/07/"><span class="level-start"><span class="level-item">July 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/06/"><span class="level-start"><span class="level-item">June 2018</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/05/"><span class="level-start"><span class="level-item">May 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/04/"><span class="level-start"><span class="level-item">April 2018</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/2019/"><span class="tag">2019</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Apache/"><span class="tag">Apache</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Diary/"><span class="tag">Diary</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/E-R/"><span class="tag">E-R</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/HDFS/"><span class="tag">HDFS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hadoop/"><span class="tag">Hadoop</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java/"><span class="tag">Java</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Kafka/"><span class="tag">Kafka</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PIL/"><span class="tag">PIL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Pandas/"><span class="tag">Pandas</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RESTful/"><span class="tag">RESTful</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RPC/"><span class="tag">RPC</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/acm/"><span class="tag">acm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/algorithm/"><span class="tag">algorithm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/algorithms/"><span class="tag">algorithms</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/alibaba/"><span class="tag">alibaba</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/annotation/"><span class="tag">annotation</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/apidoc/"><span class="tag">apidoc</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/big-data/"><span class="tag">big data</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bigdata/"><span class="tag">bigdata</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/box/"><span class="tag">box</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/chart/"><span class="tag">chart</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/chartjs/"><span class="tag">chartjs</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/class/"><span class="tag">class</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/colorlog/"><span class="tag">colorlog</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/config/"><span class="tag">config</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/console/"><span class="tag">console</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cpu/"><span class="tag">cpu</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/csv/"><span class="tag">csv</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dairy/"><span class="tag">dairy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/data-analysis/"><span class="tag">data analysis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/data-structure/"><span class="tag">data structure</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/database/"><span class="tag">database</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/db/"><span class="tag">db</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/design-patterns/"><span class="tag">design patterns</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/diary/"><span class="tag">diary</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dokuwiki/"><span class="tag">dokuwiki</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/download/"><span class="tag">download</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/email/"><span class="tag">email</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/excel/"><span class="tag">excel</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/file/"><span class="tag">file</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flask-restful/"><span class="tag">flask-restful</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/gRPC/"><span class="tag">gRPC</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/goal/"><span class="tag">goal</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hadoop/"><span class="tag">hadoop</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hive/"><span class="tag">hive</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/httpd/"><span class="tag">httpd</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/imageio/"><span class="tag">imageio</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/io/"><span class="tag">io</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/java/"><span class="tag">java</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript/"><span class="tag">javascript</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jdbc/"><span class="tag">jdbc</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/json/"><span class="tag">json</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/life/"><span class="tag">life</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/lock/"><span class="tag">lock</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/log/"><span class="tag">log</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/manual/"><span class="tag">manual</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/matplotlib/"><span class="tag">matplotlib</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/memory/"><span class="tag">memory</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/monitor/"><span class="tag">monitor</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/moviepy/"><span class="tag">moviepy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/network/"><span class="tag">network</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/node-js/"><span class="tag">node.js</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/numpy/"><span class="tag">numpy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/openpyxl/"><span class="tag">openpyxl</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/orm/"><span class="tag">orm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pandas/"><span class="tag">pandas</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/performance/"><span class="tag">performance</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/php/"><span class="tag">php</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/powershell/"><span class="tag">powershell</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/private/"><span class="tag">private</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/progress-bar/"><span class="tag">progress bar</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/proxy/"><span class="tag">proxy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pyodbc/"><span class="tag">pyodbc</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag">45</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pytz/"><span class="tag">pytz</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pywin32/"><span class="tag">pywin32</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/reflect/"><span class="tag">reflect</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/regex/"><span class="tag">regex</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sdk/"><span class="tag">sdk</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spider/"><span class="tag">spider</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/springboot/"><span class="tag">springboot</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sql/"><span class="tag">sql</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sqlalchemy/"><span class="tag">sqlalchemy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swagger/"><span class="tag">swagger</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tasklist/"><span class="tag">tasklist</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/test/"><span class="tag">test</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/thread/"><span class="tag">thread</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tiktok/"><span class="tag">tiktok</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tkinter/"><span class="tag">tkinter</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/training/"><span class="tag">training</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/txt/"><span class="tag">txt</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/unicode/"><span class="tag">unicode</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vmware/"><span class="tag">vmware</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/work/"><span class="tag">work</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xpath/"><span class="tag">xpath</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/yaml/"><span class="tag">yaml</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8D%9A%E5%AE%A2/"><span class="tag">博客</span><span class="tag">1</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/favicon.ico" alt="Shawn&#039;Blog Test" height="28"></a><p class="is-size-7"><span>&copy; 2021 Shawn</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>