<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>BF Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="BF Blog"><meta name="msapplication-TileImage" content="/img/favicon.ico"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="BF Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="BF Blog"><meta property="og:url" content="https://bearfly1990.github.io/"><meta property="og:site_name" content="BF Blog"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://bearfly1990.github.io/img/og_image.png"><meta property="article:author" content="bearfly1990"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://bearfly1990.github.io"},"headline":"BF Blog","image":["https://bearfly1990.github.io/img/og_image.png"],"author":{"@type":"Person","name":"bearfly1990"},"publisher":{"@type":"Organization","name":"BF Blog","logo":{"@type":"ImageObject","url":"https://bearfly1990.github.io/img/favicon.ico"}},"description":""}</script><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/favicon.ico" alt="BF Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/bearfly1990"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-08-27T16:00:00.000Z" title="2019/8/28 上午12:00:00">2019-08-28</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-09-08T15:43:26.414Z" title="2020/9/8 下午11:43:26">2020-09-08</time></span><span class="level-item"> BF </span><span class="level-item">5 minutes read (About 740 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/08/28/2019/08/2019-08-28-RecentSummary/">Recent Summary 08/28/2019</a></h1><div class="content"><h1 id="搬家"><a href="#搬家" class="headerlink" title="搬家"></a>搬家</h1><p>最近从物华搬到了政苑B区，就在银泰的边上，房租果断的长了一些。因为是年付，所以优惠了些，还能接受，不过来年就不知道还有没有优惠了。</p>
<p>还好有XM帮忙收拾，周末的时间就弄好了。如果是我自己一个人的话，很多东西都不知道要塞在袋子里多久才会收拾出来，哈哈哈。</p>
<p>搬家是真的折腾。原来的物化不过也只住了一年而已。被迫的搬家是租房最大的痛点之一。</p>
<h1 id="摇号"><a href="#摇号" class="headerlink" title="摇号"></a>摇号</h1><p>这两天几个比较火的楼盘又是万人摇，像和光尘樾之类的总价还是太高了。</p>
<p>像天都城这样的价格倒真的可以试一试，只是最近心思都没有在这上面，消息得到的晚，就没有去尝试了，可能大概率是去当分母吧。</p>
<p>年初前几个月倒是看了一些，总价是最大的问题。不过现在反而不是太着急，还是看着吧。</p>
<h1 id="工作"><a href="#工作" class="headerlink" title="工作"></a>工作</h1><p>没有想到，之前不加班，每天开开心心的会被人嫌弃不上进。现在心思在工作上多一些，也会被吐槽，想不通，哈哈哈。</p>
<p>今年已经过了一大半了，目前总结的话就是“困惑”吧。对于工作，我不知道自己是不是做了没有意义的选择，没有必要的折腾。</p>
<p>或许做测试开发的工作最适合自己？还只是转型的必经之路？不知道，也不去想了，做好自己能做的事就好了，没必要想太多。</p>
<p>不管Firecall还是322，都费了自己不少心力，收获与经验的积累也是实打实的，只是真的过程有点累，心累，尤其是本地做开发的破电脑，抓狂。话说这两天这电脑还是有点乖的。</p>
<p>不过一直加班，如果之后还是这样累肯定是不行的，不知道有没有契机或者会习惯了？哈哈哈</p>
<h1 id="家人"><a href="#家人" class="headerlink" title="家人"></a>家人</h1><p>本来预想的是平均每个月可以回家一趟，结果今年工作上牵绊太多，时间上反而不太自由了。</p>
<p>这几个星期一直想回去，却总没成行，就等中秋和国庆了。中秋一定要回去一趟的。</p>
<p>母亲一个人在家，最近小舅舅又出事，母亲心里也挺难受的吧，我也没能在身边，哎。</p>
<h1 id="生活与感情"><a href="#生活与感情" class="headerlink" title="生活与感情"></a>生活与感情</h1><p>今年最大的archievement或许就是XM了吧，不过之后怎样也没法预见，加油吧~</p>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>Wish World Peace!</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-08-16T16:00:00.000Z" title="2019/8/17 上午12:00:00">2019-08-17</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-09-08T15:43:26.413Z" title="2020/9/8 下午11:43:26">2020-09-08</time></span><span class="level-item"> BF </span><span class="level-item">11 minutes read (About 1597 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/08/17/2019/08/2019-08-17-Pandas/">Process data by pandas</a></h1><div class="content"><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>最近做了一些数据处理方面的事，用到了 pandas，记录一下。</p>
<ul>
<li>python 3.6.5</li>
<li>pandas 0.25</li>
<li>xlrd 1.2.0</li>
</ul>
<p>默认包引入：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br></pre></td></tr></table></figure>

<h1 id="读取-excel"><a href="#读取-excel" class="headerlink" title="读取 excel"></a>读取 excel</h1><p>假设有一张如下数据的 excel 表格：</p>
<table>
<thead>
<tr>
<th></th>
<th>Name</th>
<th>gender</th>
<th>Company</th>
<th>Salary</th>
</tr>
</thead>
<tbody><tr>
<td>Index_A</td>
<td>Shawn</td>
<td>man</td>
<td>SS</td>
<td>6666</td>
</tr>
<tr>
<td>Index_B</td>
<td>Andy</td>
<td>man</td>
<td>GG</td>
<td>5555</td>
</tr>
<tr>
<td>Index_C</td>
<td>Richard</td>
<td>man</td>
<td></td>
<td>3333</td>
</tr>
<tr>
<td>Index_D</td>
<td>Rose</td>
<td>female</td>
<td>SS</td>
<td>7777</td>
</tr>
<tr>
<td>Index_E</td>
<td></td>
<td></td>
<td>SS</td>
<td>6666</td>
</tr>
<tr>
<td>Index_F</td>
<td>June</td>
<td>female</td>
<td>GG</td>
<td>8888</td>
</tr>
<tr>
<td>Index_G</td>
<td>Richard</td>
<td>man</td>
<td>GG</td>
<td>4444</td>
</tr>
<tr>
<td>Index_G</td>
<td>Richard</td>
<td>mans</td>
<td>GG</td>
<td>4444</td>
</tr>
</tbody></table>
<p>使用 pandas 读取：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_sheet = pd.read_excel(<span class="string">&#x27;test_file.xlsx&#x27;</span>, sheet_name=<span class="string">&#x27;salary01&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(df_sheet)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  Unnamed: 0      Name  gender Company  Salary</span><br><span class="line">0    Index_A     Shawn     man      SS  6666.0</span><br><span class="line">1    Index_B      Andy     man      GG  5555.0</span><br><span class="line">2    Index_C   Richard     man      GG  3333.0</span><br><span class="line">3    Index_D      Rose  female      SS  7777.0</span><br><span class="line">4    Index_E       NaN     NaN      SS     NaN</span><br><span class="line">5    Index_F      June  female      GG  8888.0</span><br><span class="line">6    Index_G  Richard      man      GG  4444.0</span><br><span class="line">7    Index_H      Paul    mans      GG  5656.0</span><br></pre></td></tr></table></figure>

<p>可以看到第一列没有列名，默认给了<code>Unnamed: 0</code></p>
<p>index 为 6 那行<code>Richard</code>多了一个空格(在 excel 中故意空出来)</p>
<p>没有值的 cell 里，在 dateframe 中被填充成<code>NaN</code></p>
<h2 id="指定索引"><a href="#指定索引" class="headerlink" title="指定索引"></a>指定索引</h2><p>为了使我们第一列被成我们的索引，可以在读取时加参数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_sheet = pd.read_excel(<span class="string">&#x27;test_file.xlsx&#x27;</span>, sheet_name=<span class="string">&#x27;salary01&#x27;</span>, index_col = [<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(df_sheet)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">             Name  gender Company  Salary</span><br><span class="line">Index_A     Shawn     man      SS  6666.0</span><br><span class="line">Index_B      Andy     man      GG  5555.0</span><br><span class="line">Index_C   Richard     man     NaN  3333.0</span><br><span class="line">Index_D      Rose  female      SS  7777.0</span><br><span class="line">Index_E       NaN     NaN      SS     NaN</span><br><span class="line">Index_F      June  female      GG  8888.0</span><br><span class="line">Index_G  Richard      man      GG  4444.0</span><br><span class="line">Index_H      Paul    mans      GG  5656.0</span><br></pre></td></tr></table></figure>

<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p>当我们没有指定数据类型时，pandas 会按他的默认类型加载。</p>
<p>比如<code>Salary</code>那列默认使用 float 加载，但我们想要的是 int 的话，我们可以使用 convert：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_sheet = pd.read_excel(<span class="string">&#x27;test_file.xlsx&#x27;</span>, sheet_name=<span class="string">&#x27;salary01&#x27;</span>,  converters = &#123;<span class="string">&#x27;Name&#x27;</span>: <span class="built_in">str</span>, <span class="string">&#x27;Salary&#x27;</span>: <span class="built_in">int</span>&#125;, index_col = [<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(df_sheet)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">             Name  gender Company Salary</span><br><span class="line">Index_A     Shawn     man      SS   6666</span><br><span class="line">Index_B      Andy     man      GG   5555</span><br><span class="line">Index_C   Richard     man     NaN   3333</span><br><span class="line">Index_D      Rose  female      SS   7777</span><br><span class="line">Index_E       NaN     NaN      SS    NaN</span><br><span class="line">Index_F      June  female      GG   8888</span><br><span class="line">Index_G  Richard      man      GG   4444</span><br><span class="line">Index_H      Paul    mans      GG   5656</span><br></pre></td></tr></table></figure>

<p>更多读取 excel 的详细信息可以参考最后 <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_38546295/article/details/83537558">使用 pandas 读取 excel</a></p>
<h1 id="处理数据"><a href="#处理数据" class="headerlink" title="处理数据"></a>处理数据</h1><h2 id="得到基本信息"><a href="#得到基本信息" class="headerlink" title="得到基本信息"></a>得到基本信息</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 索引值</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [&#x27;Index_A&#x27;, &#x27;Index_B&#x27;, &#x27;Index_C&#x27;, &#x27;Index_D&#x27;, &#x27;Index_E&#x27;, &#x27;Index_F&#x27;, &#x27;Index_G&#x27;, &#x27;Index_H&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df_sheet.index.tolist())</span><br><span class="line"><span class="built_in">print</span>(df_sheet.index.to_list())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 行数 8</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df_sheet.shape[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(df_sheet))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列数 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [&#x27;Name&#x27;, &#x27;gender&#x27;, &#x27;Company&#x27;, &#x27;Salary&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df_sheet.shape[<span class="number">1</span>])</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="reset-index"><a href="#reset-index" class="headerlink" title="reset_index"></a>reset_index</h2><p>在上面我们使用了第一列做为索引，有时候我们希望还是用回默认的数字做为索引，那么就可以使用<code>reset_index</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_sheet = df_sheet.reset_index()</span><br><span class="line"><span class="built_in">print</span>(df_sheet)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">     index      Name  gender Company Salary</span><br><span class="line">0  Index_A     Shawn     man      SS   6666</span><br><span class="line">1  Index_B      Andy     man      GG   5555</span><br><span class="line">2  Index_C   Richard     man     NaN   3333</span><br><span class="line">3  Index_D      Rose  female      SS   7777</span><br><span class="line">4  Index_E       NaN     NaN      SS    NaN</span><br><span class="line">5  Index_F      June  female      GG   8888</span><br><span class="line">6  Index_G  Richard      man      GG   4444</span><br><span class="line">7  Index_H      Paul    mans      GG   5656</span><br></pre></td></tr></table></figure>

<p>如果不保留原来的索引，加上<code>drop=True</code>参数就可以了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_sheet = df_sheet.reset_index(drop=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h2 id="关于-nan-和-None"><a href="#关于-nan-和-None" class="headerlink" title="关于 nan 和 None"></a>关于 nan 和 None</h2><p><code>dataframe</code>中默认的空值为<code>NaN</code>，这是<code>numpy</code>中的一个类型，特殊的 float。<br><code>Series</code>和<code>DataFrame</code>都会自动把 None 转换成 NaN 然后 运算的时候会把 NaN 当成 0。</p>
<p>详细可以参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/onemorepoint/p/8966791.html">pandas numpy 处理缺失值，none 与 nan 比较</a></p>
<p>我们最后使用的时候，比如插入数据库前，需要使用 None，所以需要转换一下。</p>
<p>首先 pandas 提供 <code>fillna</code>方法把<code>NaN</code>数据替换成其它值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_sheet[<span class="string">&#x27;Salary&#x27;</span>] = df_sheet[<span class="string">&#x27;Salary&#x27;</span>].fillna(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(df_sheet)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">     index      Name  gender Company  Salary</span><br><span class="line">0  Index_A     Shawn     man      SS    6666</span><br><span class="line">1  Index_B      Andy     man      GG    5555</span><br><span class="line">2  Index_C   Richard     man     NaN    3333</span><br><span class="line">3  Index_D      Rose  female      SS    7777</span><br><span class="line">4  Index_E       NaN     NaN      SS       0</span><br><span class="line">5  Index_F      June  female      GG    8888</span><br><span class="line">6  Index_G  Richard      man      GG    4444</span><br><span class="line">7  Index_H      Paul    mans      GG    5656</span><br></pre></td></tr></table></figure>

<p>可以看到针对<code>Salary</code>这一列把<code>Nan</code>改成了<code>0</code>，但是如果直接用<code>None</code>却是不行的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df_sheet[<span class="string">&#x27;Salary&#x27;</span>] = df_sheet[<span class="string">&#x27;Salary&#x27;</span>].fillna(<span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">&quot;Must specify a fill &#x27;value&#x27; or &#x27;method&#x27;.&quot;</span>)</span><br><span class="line">ValueError: Must specify a fill <span class="string">&#x27;value&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;method&#x27;</span>.</span><br></pre></td></tr></table></figure>

<p>那么最直接的办法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_sheet = df_sheet.where(df_sheet.notnull(), <span class="literal">None</span>)</span><br><span class="line"><span class="built_in">print</span>(df_sheet)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">     index      Name  gender Company Salary</span><br><span class="line">0  Index_A     Shawn     man      SS   6666</span><br><span class="line">1  Index_B      Andy     man      GG   5555</span><br><span class="line">2  Index_C   Richard     man    None   3333</span><br><span class="line">3  Index_D      Rose  female      SS   7777</span><br><span class="line">4  Index_E      None    None      SS   None</span><br><span class="line">5  Index_F      June  female      GG   8888</span><br><span class="line">6  Index_G  Richard      man      GG   4444</span><br><span class="line">7  Index_H      Paul    mans      GG   5656</span><br></pre></td></tr></table></figure>

<h2 id="去掉重复行"><a href="#去掉重复行" class="headerlink" title="去掉重复行"></a>去掉重复行</h2><p>假设我们多了一条重复的数据(Index_H/Index_I) 如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">     index      Name  gender Company Salary</span><br><span class="line">0  Index_A     Shawn     man      SS   6666</span><br><span class="line">1  Index_B      Andy     man      GG   5555</span><br><span class="line">2  Index_C   Richard     man    None   3333</span><br><span class="line">3  Index_D      Rose  female      SS   7777</span><br><span class="line">4  Index_E      None    None      SS   None</span><br><span class="line">5  Index_F      June  female      GG   8888</span><br><span class="line">6  Index_G  Richard      man      GG   4444</span><br><span class="line">7  Index_H      Paul    mans      GG   5656</span><br><span class="line">8  Index_I      Paul    mans      GG   5656</span><br></pre></td></tr></table></figure>

<p>我们想要只留下一条数据，那么可以使用如下的方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_sheet.drop_duplicates([<span class="string">&#x27;Name&#x27;</span>, <span class="string">&#x27;gender&#x27;</span>, <span class="string">&#x27;Company&#x27;</span>, <span class="string">&#x27;Salary&#x27;</span>], keep=<span class="string">&#x27;last&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(df_sheet)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">     index      Name  gender Company Salary</span><br><span class="line">0  Index_A     Shawn     man      SS   6666</span><br><span class="line">1  Index_B      Andy     man      GG   5555</span><br><span class="line">2  Index_C   Richard     man    None   3333</span><br><span class="line">3  Index_D      Rose  female      SS   7777</span><br><span class="line">4  Index_E      None    None      SS   None</span><br><span class="line">5  Index_F      June  female      GG   8888</span><br><span class="line">6  Index_G  Richard      man      GG   4444</span><br><span class="line">8  Index_I      Paul    mans      GG   5656</span><br></pre></td></tr></table></figure>

<p>因为使用了<code>keep=&#39;last&#39;</code>，所以<code>Index_H</code>这行被删除了。如果想只保留最前面的那条，就可以使用<code>keep=&#39;first&#39;</code></p>
<h2 id="找到有问题的行列"><a href="#找到有问题的行列" class="headerlink" title="找到有问题的行列"></a>找到有问题的行列</h2><p>在<code>Index_I</code>我们可以看到这行的<code>gender</code>为<code>mans</code>是有问题的，我们可以找到他，只允许<code>man</code>和<code>female</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df_sheet_by_gender = df_sheet[(df_sheet[<span class="string">&#x27;gender&#x27;</span>]!=<span class="string">&#x27;man&#x27;</span>) &amp; (df_sheet[<span class="string">&#x27;gender&#x27;</span>]!=<span class="string">&#x27;female&#x27;</span>)]</span><br><span class="line"><span class="built_in">print</span>(df_sheet_by_gender)</span><br><span class="line"><span class="built_in">print</span>(df_sheet_by_gender.index.tolist())</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">     index  Name gender Company Salary</span><br><span class="line">4  Index_E  None   None      SS   None</span><br><span class="line">8  Index_I  Paul   mans      GG   5656</span><br><span class="line">[4, 8]</span><br></pre></td></tr></table></figure>

<p>也可以使用下面的方式:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">&#x27;man&#x27;</span>, <span class="string">&#x27;female&#x27;</span>]</span><br><span class="line">df_sheet_by_gender = df_sheet[df_sheet[<span class="string">&#x27;gender&#x27;</span>].apply(<span class="keyword">lambda</span> x: test(x))]</span><br><span class="line"><span class="built_in">print</span>(df_sheet_by_gender)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">     index  Name gender Company Salary</span><br><span class="line">4  Index_E  None   None      SS   None</span><br><span class="line">8  Index_I  Paul   mans      GG   5656</span><br></pre></td></tr></table></figure>

<p>当然还可以使用 iloc/loc 等其它方法找到你想要的值</p>
<h2 id="新增一列"><a href="#新增一列" class="headerlink" title="新增一列"></a>新增一列</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_sheet[<span class="string">&#x27;new_column&#x27;</span>] = df_sheet[<span class="string">&#x27;Salary&#x27;</span>]*<span class="number">3</span></span><br><span class="line"><span class="built_in">print</span>(df_sheet)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">     index      Name  gender Company Salary new_column</span><br><span class="line">0  Index_A     Shawn     man      SS   6666      19998</span><br><span class="line">1  Index_B      Andy     man      GG   5555      16665</span><br><span class="line">2  Index_C   Richard     man    None   3333       9999</span><br><span class="line">3  Index_D      Rose  female      SS   7777      23331</span><br><span class="line">4  Index_E      None    None      SS   None        NaN</span><br><span class="line">5  Index_F      June  female      GG   8888      26664</span><br><span class="line">6  Index_G  Richard      man      GG   4444      13332</span><br><span class="line">8  Index_I      Paul    mans      GG   5656      16968</span><br></pre></td></tr></table></figure>

<h1 id="输出到新的-Excel-中"><a href="#输出到新的-Excel-中" class="headerlink" title="输出到新的 Excel 中"></a>输出到新的 Excel 中</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_sheet.to_excel(<span class="string">&quot;output.xlsx&quot;</span>, sheet_name=<span class="string">&#x27;newsheet&#x27;</span>, index=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<p>可以选择需要的列</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_sheet.to_excel(<span class="string">&quot;output.xlsx&quot;</span>, sheet_name=<span class="string">&#x27;newsheet&#x27;</span>, index=<span class="literal">False</span>, columns=[<span class="string">&#x27;Name&#x27;</span>, <span class="string">&#x27;Company&#x27;</span>, <span class="string">&#x27;Salary&#x27;</span>])</span><br></pre></td></tr></table></figure>

<h1 id="dataframe-to-list"><a href="#dataframe-to-list" class="headerlink" title="dataframe to list"></a>dataframe to list</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(df_sheet.index.tolist())</span><br><span class="line"><span class="built_in">print</span>(df_sheet.values.tolist())</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[0, 1, 2, 3, 4, 5, 6, 8]</span><br><span class="line">[[&#39;Index_A&#39;, &#39;Shawn&#39;, &#39;man&#39;, &#39;SS&#39;, 6666, 19998], [&#39;Index_B&#39;, &#39;Andy&#39;, &#39;man&#39;, &#39;GG&#39;, 5555, 16665], [&#39;Index_C&#39;, &#39;Richard&#39;, &#39;man&#39;, None, 3333, 9999], [&#39;Index_D&#39;, &#39;Rose&#39;, &#39;female&#39;, &#39;SS&#39;, 7777, 23331], [&#39;Index_E&#39;, None, None, &#39;SS&#39;, None, nan], [&#39;Index_F&#39;, &#39;June&#39;, &#39;female&#39;, &#39;GG&#39;, 8888, 26664], [&#39;Index_G&#39;, &#39;Richard &#39;, &#39;man&#39;, &#39;GG&#39;, 4444, 13332], [&#39;Index_I&#39;, &#39;Paul&#39;, &#39;mans&#39;, &#39;GG&#39;, 5656, 16968]]</span><br></pre></td></tr></table></figure>

<p>参考:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_34377830/article/details/81872568">Pandas 读取并修改 excel</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_38546295/article/details/83537558">使用 pandas 读取 excel</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/louyifei0824/p/9942430.html">pandas 中的空值处理</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/onemorepoint/p/8966791.html">pandas numpy 处理缺失值，none 与 nan 比较</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/kancy110/article/details/70142728">Pandas 标记删除重复记录</a></li>
<li><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/whatsnew/v0.25.0.html">pandas 0.25.0 documentation</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-06-24T16:00:00.000Z" title="2019/6/25 上午12:00:00">2019-06-25</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-09-08T15:43:26.411Z" title="2020/9/8 下午11:43:26">2020-09-08</time></span><span class="level-item"> BF </span><span class="level-item">7 minutes read (About 1103 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/06/25/2019/06/2019-06-23-TkinterDemo/">Tinkter Demo</a></h1><div class="content"><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>最近在做数据的交互与导入导出，刚开始还是按照原先的方式，把所有的参数写在配置文件中。</p>
<p>在运行前需要把配置改掉，这样很容易遗漏。</p>
<p>所以想到了写点简单的界面来配置一些选项，相对来说所见即所得。</p>
<p>Python 里可以写界面的选择很多，也有很强大和专业的库(e.g. PyQt)，但是我们这种程度的使用，用原生的 tinkter 就足够了。</p>
<h1 id="tinkter-基本信息"><a href="#tinkter-基本信息" class="headerlink" title="tinkter 基本信息"></a>tinkter 基本信息</h1><p>现在基本上都是基于 python 3.0 在开发，所以 tkinter 的组件命名也发生的一些变化。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 2.x使用这行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#from Tkinter import *</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Python 3.x使用这行</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> *</span><br></pre></td></tr></table></figure>

<h2 id="ttk"><a href="#ttk" class="headerlink" title="ttk"></a>ttk</h2><p>程序都是直接使用 tkinter 模块下的 GUI 组件的，这些组件看上去特别“复古”，也就是丑，仿佛是从 20 年前的程序上抠出来的组件。</p>
<p>为了弥补这点不足，Tkinter 后来引入了一个 ttk 组件作为补充（主要就是简单包装、美化一下），并使用功能更强大的 Combobox 取代了原来的 Listbox，且新增了 LabeledScale（带标签的 Scale）、Notebook（多文档窗口）、Progressbar（进度条）、Treeview（树）等组件。</p>
<p>ttk 作为一个模块被放在 tkinter 包下，使用 ttk 组件与使用普通的 Tkinter 组件并没有多大的区别，只要导入 ttk 模块即可</p>
<h2 id="布局"><a href="#布局" class="headerlink" title="布局"></a>布局</h2><p>UI 组件需要我们摆放位置，tinkter 提供了三种布局方式：</p>
<ul>
<li>Pack</li>
<li>Grid</li>
<li>Place</li>
</ul>
<p>相对来说 Pack 和 Grid 相对多一些，Pack 更加灵活，而 Grid 适方方正正的类表格布局，而在同一个 Frame 中，布局方式只能有一种。</p>
<h1 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h1><p>在我下面列的参考文档中有很详细的组件与细节介绍，下面我直接放一个自己写的简单Demo。<br><img src="/img/post/2019/06/2019-06-23-TkinterDemo.png" alt="2019-06-23-TkinterDemo.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> webbrowser</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> ImageTk</span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> ttk</span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> messagebox</span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gamerun</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;run game...&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_menu</span>(<span class="params">root, imgGame, imgHelp</span>):</span></span><br><span class="line">    menubar =Menu(root)</span><br><span class="line">    root.config(menu = menubar)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#实例化菜单1，创建下拉菜单，调用add_separate创建分割线</span></span><br><span class="line">    menu1 =Menu(menubar,tearoff = <span class="number">0</span>)</span><br><span class="line">    menubar.add_cascade(label = <span class="string">&quot;Edit&quot;</span>,menu = menu1)</span><br><span class="line">    menu1.add_command(label = <span class="string">&quot;Do Nothing&quot;</span>)</span><br><span class="line">    menu1.add_separator()</span><br><span class="line">    menu1.add_command(label = <span class="string">&quot;Quit&quot;</span>,command = root.quit)</span><br><span class="line"></span><br><span class="line">    menu2 =Menu(menubar,tearoff = <span class="number">0</span>)</span><br><span class="line">    menubar.add_cascade(label = <span class="string">&quot;More&quot;</span>,menu = menu2)</span><br><span class="line">    menu2.add_command(label = <span class="string">&quot;New Job&quot;</span>,image = imgGame ,compound= <span class="string">&quot;left&quot;</span>,command = <span class="keyword">lambda</span>:gamerun())</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    menu2.add_command(label = <span class="string">&quot;Tkinter&quot;</span>,image = imgHelp,compound = <span class="string">&quot;left&quot;</span>,command =</span><br><span class="line">    <span class="keyword">lambda</span>:webbrowser.<span class="built_in">open</span>(<span class="string">&quot;http://effbot.org/tkinterbook/tkinter-index.htm&quot;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_userinfo</span>(<span class="params">root</span>):</span></span><br><span class="line">    frame_user_info = ttk.LabelFrame(root, text=<span class="string">&#x27;UserInfo:&#x27;</span>)</span><br><span class="line">    frame_user_info.pack(side=TOP, fill=X)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># myLabel= Label(frame_user_info, text=&#x27;UserInfo:&#x27;, font=&quot;Helvetica 10 bold&quot;)</span></span><br><span class="line">    <span class="comment"># myLabel[&quot;relief&quot;]=tk.SOLID#设置label的样式</span></span><br><span class="line">    <span class="comment"># myLabel[&quot;width&quot;]=10</span></span><br><span class="line">    <span class="comment"># myLabel[&quot;height&quot;]=5</span></span><br><span class="line">    <span class="comment"># myLabel.pack(side=LEFT)</span></span><br><span class="line">    <span class="comment"># myLabel.grid(row=0, sticky=W)</span></span><br><span class="line">    Label(frame_user_info, text=<span class="string">&quot;Username&quot;</span>).grid(row=<span class="number">1</span>, sticky=W)</span><br><span class="line">    Label(frame_user_info, text=<span class="string">&quot;Password&quot;</span>).grid(row=<span class="number">2</span>, sticky=W)</span><br><span class="line">    username = Entry(frame_user_info).grid(row=<span class="number">1</span>, column=<span class="number">1</span>, sticky=E)</span><br><span class="line">    password = Entry(frame_user_info, show=<span class="string">&#x27;*&#x27;</span>).grid(row=<span class="number">2</span>, column=<span class="number">1</span>, sticky=E)</span><br><span class="line">    <span class="comment"># Button(frame_user_info, text=&quot;Login&quot;).grid(row=2, column=1, sticky=E)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_radio</span>(<span class="params">root</span>):</span></span><br><span class="line">    frame_radio = ttk.Labelframe(root, text=<span class="string">&#x27;Radio Test&#x27;</span>,padding=<span class="number">20</span>)</span><br><span class="line">    frame_radio.pack(fill=BOTH, expand=YES, padx=<span class="number">10</span>, pady=<span class="number">10</span>)</span><br><span class="line">    books = [<span class="string">&#x27;C++&#x27;</span>, <span class="string">&#x27;Python&#x27;</span>, <span class="string">&#x27;Linux&#x27;</span>, <span class="string">&#x27;Java&#x27;</span>]</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    books_radio = []</span><br><span class="line">    <span class="keyword">for</span> book <span class="keyword">in</span> books:</span><br><span class="line">        intVar = IntVar()</span><br><span class="line">        books_radio.append(intVar)</span><br><span class="line">        Radiobutton(frame_radio, text=book,value=i,variable=intVar,command=changed).pack(side=LEFT)</span><br><span class="line">        i = i + <span class="number">1</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">changed</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;value changed&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_checkbutton</span>(<span class="params">root</span>):</span></span><br><span class="line">    frame_checkbutton = ttk.Labelframe(root, text=<span class="string">&#x27;Checkbutton Test&#x27;</span>,padding=<span class="number">20</span>)</span><br><span class="line">    frame_checkbutton.pack(fill=BOTH, expand=YES, padx=<span class="number">10</span>, pady=<span class="number">10</span>)</span><br><span class="line">    books = [<span class="string">&#x27;C++&#x27;</span>, <span class="string">&#x27;Python&#x27;</span>, <span class="string">&#x27;Linux&#x27;</span>, <span class="string">&#x27;Java&#x27;</span>]</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    books_checkbox = []</span><br><span class="line">    <span class="keyword">for</span> book <span class="keyword">in</span> books:</span><br><span class="line">        strVar = StringVar()</span><br><span class="line">        books_checkbox.append(strVar)</span><br><span class="line">        cb = ttk.Checkbutton(frame_checkbutton,</span><br><span class="line">            text = book,</span><br><span class="line">            variable = strVar, </span><br><span class="line">            onvalue = i,</span><br><span class="line">            offvalue = <span class="string">&#x27;None&#x27;</span>,</span><br><span class="line">            command = changed) </span><br><span class="line">        cb.pack(anchor=W)</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_combobox</span>(<span class="params">root</span>):</span></span><br><span class="line">    frame_combobox = ttk.Labelframe(root, text=<span class="string">&#x27;Combobox Test&#x27;</span>,padding=<span class="number">20</span>)</span><br><span class="line">    frame_combobox.pack(fill=BOTH, expand=YES, padx=<span class="number">10</span>, pady=<span class="number">10</span>)</span><br><span class="line">    strVar = StringVar()</span><br><span class="line">    <span class="comment"># 创建Combobox组件</span></span><br><span class="line">    cb = ttk.Combobox(frame_combobox,</span><br><span class="line">        textvariable=strVar, <span class="comment"># 绑定到self.strVar变量</span></span><br><span class="line">        postcommand=changed) <span class="comment"># 当用户单击下拉箭头时触发self.choose方法</span></span><br><span class="line">    cb.pack(side=TOP)</span><br><span class="line">    <span class="comment"># 为Combobox配置多个选项</span></span><br><span class="line">    cb[<span class="string">&#x27;values&#x27;</span>] = [<span class="string">&#x27;Python&#x27;</span>, <span class="string">&#x27;Ruby&#x27;</span>, <span class="string">&#x27;Kotlin&#x27;</span>, <span class="string">&#x27;Swift&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_it</span>():</span></span><br><span class="line">    messagebox.showinfo(title=<span class="string">&#x27;Alert&#x27;</span>, message=<span class="string">&quot;Please try again!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_showinfo</span>(<span class="params">root</span>):</span></span><br><span class="line">    frame_showinfo = ttk.LabelFrame(root, text=<span class="string">&#x27;ShowInfoTest:&#x27;</span>)</span><br><span class="line">    frame_showinfo.pack(side=TOP, fill=X)</span><br><span class="line">    Button(frame_showinfo, text=<span class="string">&quot;Click Me&quot;</span>, command=show_it).pack(side=LEFT, fill=Y)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_ui</span>():</span></span><br><span class="line">    root = Tk()</span><br><span class="line">    <span class="comment"># root.geometry(&#x27;580x680+200+100&#x27;)</span></span><br><span class="line">    root.resizable(width = <span class="literal">False</span>, height = <span class="literal">False</span>) </span><br><span class="line">    root.title(<span class="string">&quot;Test&quot;</span>)</span><br><span class="line">    root.iconbitmap(<span class="string">&#x27;login.ico&#x27;</span>)</span><br><span class="line">    imgGame = PhotoImage(file=<span class="string">&#x27;game.png&#x27;</span>)</span><br><span class="line">    imgHelp = ImageTk.PhotoImage(file=<span class="string">&quot;help.png&quot;</span>)</span><br><span class="line">    init_menu(root, imgGame, imgHelp)</span><br><span class="line">    init_userinfo(root)</span><br><span class="line">    init_showinfo(root)</span><br><span class="line">    init_radio(root)</span><br><span class="line">    init_checkbutton(root)</span><br><span class="line">    init_combobox(root)</span><br><span class="line">    root.mainloop()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    init_ui()</span><br></pre></td></tr></table></figure>

<p>参考:</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://c.biancheng.net/python/tkinter/">Python Tkinter 教程（GUI 图形界面开发教程）</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/f0a3c47c9c6c">Python2.7 Tkinter 创建简单登录注册界面</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-05-12T16:00:00.000Z" title="2019/5/13 上午12:00:00">2019-05-13</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-09-08T15:43:26.409Z" title="2020/9/8 下午11:43:26">2020-09-08</time></span><span class="level-item"> BF </span><span class="level-item">4 minutes read (About 560 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/05/13/2019/05/2019-05-13-ESTEDT2GMT/">Convert EST/EDT to GMT datetime</a></h1><div class="content"><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>最近在导数据的时候，需要把日期型字符串转换成 datetime 类型再导入数据库，其中一些带时区的数据，不能直接使用 strftime 格式化。</p>
<p>数据主要带 EST 和 EDT，需要先转成 GMT 再处理。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2019&#x2F;05&#x2F;14 03:20:10 EDT</span><br><span class="line">2019&#x2F;05&#x2F;14 03:20:10 EST</span><br></pre></td></tr></table></figure>

<h1 id="时区"><a href="#时区" class="headerlink" title="时区"></a>时区</h1><p>ST: Eastern Standard Time 东部（美国）标准时间</p>
<p>EDT: Eastern Daylight Time 东部（美国）夏令时时间</p>
<p>ET: Eastern Time 东部（美国）时间</p>
<p>GMT: Greenwich Mean Time 格林尼治标准时间</p>
<p>其中，EST 和 EDT 是 ET 在不同时间段的两种说法。</p>
<p>简单来说，ET 在夏季月份（summer months) 采用 EDT, 在其他月份采用 EST 时区，因此 EDT 和 EST 是不会同时存在的。</p>
<blockquote>
<p>在美国，EST 时区的采用时间段：<br>开始时间：当年 11 月份的第一个星期天凌晨 2.00（如 2018.11.4， 周日， 2.00）<br>结束时间：次年 3 月份的第二个星期天凌晨 2.00（如 2019.3.10，周日， 2.00）<br>其余时间采用 EDT 时区。</p>
</blockquote>
<h1 id="时区转换"><a href="#时区转换" class="headerlink" title="时区转换"></a>时区转换</h1><p>EDT 比 GMT 时间慢 5 个小时，即 EDT=GMT-5</p>
<p>EST 比 GMT 时间慢 4 个小时，即 EST=GMT-4</p>
<p>北京时区比 GMT 快 8 个小时，即北京时区=GMT+8</p>
<p>因此，可以得到：</p>
<p>EDT 比北京时间慢 13 个小时，即 EDT=北京时间-13</p>
<p>EST 比北京时间慢 12 个小时，即 EST=北京时间-12</p>
<h1 id="使用-pytz"><a href="#使用-pytz" class="headerlink" title="使用 pytz"></a>使用 pytz</h1><p>pytz 是 python 时间处理的一个模块，可以使用它进行时区的转换</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime <span class="keyword">as</span> dt</span><br><span class="line"><span class="keyword">import</span> pytz</span><br><span class="line"></span><br><span class="line">utc=pytz.utc</span><br><span class="line">eastern=pytz.timezone(<span class="string">&#x27;US/Eastern&#x27;</span>)</span><br><span class="line"></span><br><span class="line">format_without_tz   =<span class="string">&#x27;%Y/%m/%d %H:%M:%S&#x27;</span></span><br><span class="line">format_with_tz      = <span class="string">&#x27;%Y/%m/%d %H:%M:%S %Z%z&#x27;</span></span><br><span class="line"></span><br><span class="line">dt_time_str_full_list = [<span class="string">&#x27;2002/10/27 01:20:00 EDT&#x27;</span>, <span class="string">&#x27;2002/10/27 01:20:00 EST&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> dt_time_str_full <span class="keyword">in</span> dt_time_str_full_list:</span><br><span class="line">    dt_time_str = dt_time_str_full[<span class="number">0</span>:-<span class="number">4</span>]</span><br><span class="line">    dt_time_tz  = dt_time_str_full[-<span class="number">3</span>:]</span><br><span class="line">    <span class="keyword">if</span> dt_time_tz == <span class="string">&#x27;EDT&#x27;</span>:</span><br><span class="line">        is_dst_flag = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        is_dst_flag = <span class="literal">False</span></span><br><span class="line">   </span><br><span class="line">    dt_time = dt.datetime.strptime(dt_time_str, format_without_tz)</span><br><span class="line">    dt_time_with_tz = eastern.localize(dt_time, is_dst=is_dst_flag)</span><br><span class="line">    dt_time_with_tz2uct = dt_time_with_tz.astimezone(utc)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&#123;&#125;=&gt;&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(dt_time_with_tz.strftime(format_with_tz), dt_time_with_tz2uct.strftime(format_with_tz)))</span><br></pre></td></tr></table></figure>
<p>output:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2002&#x2F;10&#x2F;27 01:20:00 EDT-0400&#x3D;&gt;2002&#x2F;10&#x2F;27 05:20:00 UTC+0000</span><br><span class="line">2002&#x2F;10&#x2F;27 01:20:00 EST-0500&#x3D;&gt;2002&#x2F;10&#x2F;27 06:20:00 UTC+0000</span><br></pre></td></tr></table></figure>
<hr>
<p>参考:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/ddydavie/article/details/84869903">EST，EDT 和 GMT 时区转换</a></li>
<li><a target="_blank" rel="noopener" href="https://greenwichmeantime.com/time-zone/usa/eastern-time/">格林尼治时间官网</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-03-13T16:00:00.000Z" title="2019/3/14 上午12:00:00">2019-03-14</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-09-08T15:43:26.408Z" title="2020/9/8 下午11:43:26">2020-09-08</time></span><span class="level-item"> BF </span><span class="level-item">2 minutes read (About 357 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/03/14/2019/03/2019-03-14-PyCSVColumns/">Update CSV Column Values</a></h1><div class="content"><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>在一些 csv 文件中会有日期类型，而如果我们想按日期类型导入到数据库中，那么就需要在 insert 前以 date(datetime)的类型传入。</p>
<p>假设简单的 csv 文件(sample.csv)如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HolidayDate,Region</span><br><span class="line">2019-01-01,China</span><br><span class="line">2019-01-02,China</span><br><span class="line">2019-04-01,China</span><br><span class="line">2019-05-01,China</span><br><span class="line">2019-07-07,China</span><br><span class="line">2019-10-01,China</span><br><span class="line">2019-01-05,US</span><br><span class="line">2019-06-01,US</span><br></pre></td></tr></table></figure>

<h2 id="直接使用-cvs-库"><a href="#直接使用-cvs-库" class="headerlink" title="直接使用 cvs 库"></a>直接使用 cvs 库</h2><p>读取到 csv 后，直接遍历完成：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_csv_rows_list</span>(<span class="params">file_path</span>):</span></span><br><span class="line">    csv_row_list = []</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, newline=<span class="string">&#x27;&#x27;</span>) <span class="keyword">as</span> csvfile:</span><br><span class="line">        csvReader = csv.reader(csvfile, delimiter=<span class="string">&#x27;,&#x27;</span>, quotechar=<span class="string">&#x27;|&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> csvReader:</span><br><span class="line">            csv_row_list.append(row)</span><br><span class="line">    <span class="keyword">return</span> csv_row_list</span><br><span class="line"></span><br><span class="line">csv_row_list = read_csv_rows_list(<span class="string">&#x27;sample.csv&#x27;</span>)</span><br><span class="line">csv_row_list = csv_row_list[<span class="number">1</span>:]</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> csv_row_list:</span><br><span class="line">    row[<span class="number">0</span>] = datetime.strptime(row[<span class="number">0</span>], <span class="string">&#x27;%Y-%m-%d&#x27;</span>)</span><br><span class="line">[<span class="built_in">print</span>(row) <span class="keyword">for</span> row <span class="keyword">in</span> csv_row_list]</span><br></pre></td></tr></table></figure>

<p>output:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[datetime.datetime(2019, 1, 1, 0, 0), <span class="string">&#x27;China&#x27;</span>]</span><br><span class="line">[datetime.datetime(2019, 1, 2, 0, 0), <span class="string">&#x27;China&#x27;</span>]</span><br><span class="line">[datetime.datetime(2019, 4, 1, 0, 0), <span class="string">&#x27;China&#x27;</span>]</span><br><span class="line">[datetime.datetime(2019, 5, 1, 0, 0), <span class="string">&#x27;China&#x27;</span>]</span><br><span class="line">[datetime.datetime(2019, 7, 7, 0, 0), <span class="string">&#x27;China&#x27;</span>]</span><br><span class="line">[datetime.datetime(2019, 10, 1, 0, 0), <span class="string">&#x27;China&#x27;</span>]</span><br><span class="line">[datetime.datetime(2019, 1, 5, 0, 0), <span class="string">&#x27;US&#x27;</span>]</span><br><span class="line">[datetime.datetime(2019, 6, 1, 0, 0), <span class="string">&#x27;US&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h2 id="使用-pandas"><a href="#使用-pandas" class="headerlink" title="使用 pandas"></a>使用 pandas</h2><p>如果使用 pandas 就很方便：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">data = pd.read_csv(<span class="string">&#x27;sample.csv&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>,)</span><br><span class="line">data[<span class="string">u&#x27;HolidayDate&#x27;</span>] = pd.to_datetime(data[<span class="string">u&#x27;HolidayDate&#x27;</span>])</span><br><span class="line"><span class="comment"># data[u&#x27;HolidayDate&#x27;].astype(str)</span></span><br><span class="line"><span class="comment"># data[u&#x27;HolidayDate&#x27;] = data[u&#x27;HolidayDate&#x27;].apply(lambda x :datetime.strptime(x, &#x27;%Y-%m-%d&#x27;))</span></span><br><span class="line">data = np.array(data)<span class="comment">#np.ndarray()</span></span><br><span class="line">data_list = data.tolist()</span><br><span class="line">[<span class="built_in">print</span>(row) <span class="keyword">for</span> row <span class="keyword">in</span> data_list]</span><br><span class="line"><span class="comment">#data.to_csv(&#x27;sample.output.csv&#x27;,index=False, encoding=&#x27;utf-8&#x27;)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[Timestamp(<span class="string">&#x27;2019-01-01 00:00:00&#x27;</span>), <span class="string">&#x27;China&#x27;</span>]</span><br><span class="line">[Timestamp(<span class="string">&#x27;2019-01-02 00:00:00&#x27;</span>), <span class="string">&#x27;China&#x27;</span>]</span><br><span class="line">[Timestamp(<span class="string">&#x27;2019-04-01 00:00:00&#x27;</span>), <span class="string">&#x27;China&#x27;</span>]</span><br><span class="line">[Timestamp(<span class="string">&#x27;2019-05-01 00:00:00&#x27;</span>), <span class="string">&#x27;China&#x27;</span>]</span><br><span class="line">[Timestamp(<span class="string">&#x27;2019-07-07 00:00:00&#x27;</span>), <span class="string">&#x27;China&#x27;</span>]</span><br><span class="line">[Timestamp(<span class="string">&#x27;2019-10-01 00:00:00&#x27;</span>), <span class="string">&#x27;China&#x27;</span>]</span><br><span class="line">[Timestamp(<span class="string">&#x27;2019-01-05 00:00:00&#x27;</span>), <span class="string">&#x27;US&#x27;</span>]</span><br><span class="line">[Timestamp(<span class="string">&#x27;2019-06-01 00:00:00&#x27;</span>), <span class="string">&#x27;US&#x27;</span>]</span><br></pre></td></tr></table></figure>

<hr>
<p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/xiangxianghehe/article/details/72615711">pandas DataFrame数据转为list</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/325ffa92654a">pandas处理时间和日期类型数据</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/okm6666/article/details/81003397">Pandas修改csv文件某一列的值</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-02-24T16:00:00.000Z" title="2019/2/25 上午12:00:00">2019-02-25</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-09-08T15:43:26.406Z" title="2020/9/8 下午11:43:26">2020-09-08</time></span><span class="level-item"> BF </span><span class="level-item">6 minutes read (About 854 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/02/25/2019/02/2019-02-25-BusinessDays/">Generate Business Days</a></h1><div class="content"><h1 id="背景与需求"><a href="#背景与需求" class="headerlink" title="背景与需求"></a>背景与需求</h1><p>这两天有个小的需求，想要使用 Stored Procedure 根据 Holiday 的信息，将新的一年每月的 Business Day 数量计算出来并插入一张表中。</p>
<p>这个功能我已经实现，现在就记录一下一些觉得有意思的信息，简单的介绍下自己的思路。</p>
<h1 id="简化需求"><a href="#简化需求" class="headerlink" title="简化需求"></a>简化需求</h1><p>假设有一张<code>Holiday</code>表，表示每个国家的假期计划，其中假日可能和周末两天重合，那么那天假期其实是没用了，等于没放假。</p>
<p>现在假设需要构造 2019 年每个月的 Business Days(每个月除了周末和假期，假期与周末重合就算一天)</p>
<p>现有的 Holiday 表如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> Holiday(</span><br><span class="line">HolidayDate <span class="type">date</span>,</span><br><span class="line">Region <span class="type">varchar</span>(<span class="number">15</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HolidayDate	Region</span><br><span class="line"><span class="number">2019</span><span class="number">-01</span><span class="number">-01</span>	China</span><br><span class="line"><span class="number">2019</span><span class="number">-01</span><span class="number">-02</span>	China</span><br><span class="line"><span class="number">2019</span><span class="number">-04</span><span class="number">-01</span>	China</span><br><span class="line"><span class="number">2019</span><span class="number">-05</span><span class="number">-01</span>	China</span><br><span class="line"><span class="number">2019</span><span class="number">-07</span><span class="number">-07</span>	China</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-01</span>	China</span><br><span class="line"><span class="number">2019</span><span class="number">-01</span><span class="number">-05</span>	US</span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-01</span>	US</span><br></pre></td></tr></table></figure>

<p>并有一张 Region 表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> Region(</span><br><span class="line">Region <span class="type">varchar</span>(<span class="number">15</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Region</span><br><span class="line">China</span><br><span class="line">US</span><br></pre></td></tr></table></figure>

<h1 id="构造-2019-月份数据"><a href="#构造-2019-月份数据" class="headerlink" title="构造 2019 月份数据"></a>构造 2019 月份数据</h1><p>下面使用临时表来构造 2019 年的月份数据，每年的每个月的一号是确定的。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="variable">@Table</span>_WorkDays <span class="keyword">table</span> (StartDate <span class="type">Date</span>, EndDate <span class="type">Date</span>, WorkDayNums <span class="type">int</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="variable">@Table</span>_WorkDays(StartDate) <span class="keyword">values</span>(<span class="string">&#x27;2019-01-01&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="variable">@Table</span>_WorkDays(StartDate) <span class="keyword">values</span>(<span class="string">&#x27;2019-02-01&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="variable">@Table</span>_WorkDays(StartDate) <span class="keyword">values</span>(<span class="string">&#x27;2019-03-01&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="variable">@Table</span>_WorkDays(StartDate) <span class="keyword">values</span>(<span class="string">&#x27;2019-04-01&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="variable">@Table</span>_WorkDays(StartDate) <span class="keyword">values</span>(<span class="string">&#x27;2019-05-01&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="variable">@Table</span>_WorkDays(StartDate) <span class="keyword">values</span>(<span class="string">&#x27;2019-06-01&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="variable">@Table</span>_WorkDays(StartDate) <span class="keyword">values</span>(<span class="string">&#x27;2019-07-01&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="variable">@Table</span>_WorkDays(StartDate) <span class="keyword">values</span>(<span class="string">&#x27;2019-08-01&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="variable">@Table</span>_WorkDays(StartDate) <span class="keyword">values</span>(<span class="string">&#x27;2019-09-01&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="variable">@Table</span>_WorkDays(StartDate) <span class="keyword">values</span>(<span class="string">&#x27;2019-10-01&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="variable">@Table</span>_WorkDays(StartDate) <span class="keyword">values</span>(<span class="string">&#x27;2019-11-01&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="variable">@Table</span>_WorkDays(StartDate) <span class="keyword">values</span>(<span class="string">&#x27;2019-12-01&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">StartDate	EndDate	WorkDayNums</span><br><span class="line"><span class="number">2019</span><span class="number">-01</span><span class="number">-01</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span></span><br><span class="line"><span class="number">2019</span><span class="number">-02</span><span class="number">-01</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span></span><br><span class="line"><span class="number">2019</span><span class="number">-03</span><span class="number">-01</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span></span><br><span class="line"><span class="number">2019</span><span class="number">-04</span><span class="number">-01</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span></span><br><span class="line"><span class="number">2019</span><span class="number">-05</span><span class="number">-01</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span></span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-01</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span></span><br><span class="line"><span class="number">2019</span><span class="number">-07</span><span class="number">-01</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span></span><br><span class="line"><span class="number">2019</span><span class="number">-08</span><span class="number">-01</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span></span><br><span class="line"><span class="number">2019</span><span class="number">-09</span><span class="number">-01</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span></span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-01</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span></span><br><span class="line"><span class="number">2019</span><span class="number">-11</span><span class="number">-01</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span></span><br><span class="line"><span class="number">2019</span><span class="number">-12</span><span class="number">-01</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span></span><br></pre></td></tr></table></figure>

<p>接下来计算 EndDate，通过加一个月的时间再减去一天，即月末。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update <span class="variable">@Table</span>_WorkDays <span class="keyword">set</span> EndDate <span class="operator">=</span> DATEADD(<span class="keyword">day</span>, <span class="number">-1</span>, DATEADD(<span class="keyword">month</span>, <span class="number">1</span>, StartDate))</span><br></pre></td></tr></table></figure>

<p>如果 sql server 版本 &gt;= SQL Server 2012，可以使用<code>EOMonth</code>函数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update <span class="variable">@Table</span>_WorkDays <span class="keyword">set</span> EndDate <span class="operator">=</span> EOMonth(StartDate)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">StartDate	EndDate	        WorkDayNums</span><br><span class="line"><span class="number">2019</span><span class="number">-01</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-01</span><span class="number">-31</span>	<span class="keyword">NULL</span></span><br><span class="line"><span class="number">2019</span><span class="number">-02</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-02</span><span class="number">-28</span>	<span class="keyword">NULL</span></span><br><span class="line"><span class="number">2019</span><span class="number">-03</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-03</span><span class="number">-31</span>	<span class="keyword">NULL</span></span><br><span class="line"><span class="number">2019</span><span class="number">-04</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-04</span><span class="number">-30</span>	<span class="keyword">NULL</span></span><br><span class="line"><span class="number">2019</span><span class="number">-05</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-05</span><span class="number">-31</span>	<span class="keyword">NULL</span></span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-06</span><span class="number">-30</span>	<span class="keyword">NULL</span></span><br><span class="line"><span class="number">2019</span><span class="number">-07</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-07</span><span class="number">-31</span>	<span class="keyword">NULL</span></span><br><span class="line"><span class="number">2019</span><span class="number">-08</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-08</span><span class="number">-31</span>	<span class="keyword">NULL</span></span><br><span class="line"><span class="number">2019</span><span class="number">-09</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-09</span><span class="number">-30</span>	<span class="keyword">NULL</span></span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-10</span><span class="number">-31</span>	<span class="keyword">NULL</span></span><br><span class="line"><span class="number">2019</span><span class="number">-11</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-11</span><span class="number">-30</span>	<span class="keyword">NULL</span></span><br><span class="line"><span class="number">2019</span><span class="number">-12</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-12</span><span class="number">-31</span>	<span class="keyword">NULL</span></span><br></pre></td></tr></table></figure>

<p>下面再计算出 workday 的天数，把一个月中的周末两天去掉：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">update <span class="variable">@Table</span>_WorkDays <span class="keyword">set</span> WorkDayNums <span class="operator">=</span></span><br><span class="line">	(DATEDIFF(dd, StartDate, EndDate) <span class="operator">+</span> <span class="number">1</span>)</span><br><span class="line">	<span class="operator">-</span> (DATEDIFF(wk, StartDate, EndDate) <span class="operator">*</span> <span class="number">2</span>)</span><br><span class="line">	<span class="operator">-</span> (<span class="keyword">case</span> <span class="keyword">when</span> DATENAME(dw, StartDate) <span class="operator">=</span> <span class="string">&#x27;Sunday&#x27;</span> <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>)</span><br><span class="line">	<span class="operator">-</span> (<span class="keyword">case</span> <span class="keyword">when</span> DATENAME(dw, EndDate) <span class="operator">=</span> <span class="string">&#x27;Saturday&#x27;</span> <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">StartDate	EndDate	        WorkDayNums</span><br><span class="line"><span class="number">2019</span><span class="number">-01</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-01</span><span class="number">-31</span>	<span class="number">23</span></span><br><span class="line"><span class="number">2019</span><span class="number">-02</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-02</span><span class="number">-28</span>	<span class="number">20</span></span><br><span class="line"><span class="number">2019</span><span class="number">-03</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-03</span><span class="number">-31</span>	<span class="number">21</span></span><br><span class="line"><span class="number">2019</span><span class="number">-04</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-04</span><span class="number">-30</span>	<span class="number">22</span></span><br><span class="line"><span class="number">2019</span><span class="number">-05</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-05</span><span class="number">-31</span>	<span class="number">23</span></span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-06</span><span class="number">-30</span>	<span class="number">20</span></span><br><span class="line"><span class="number">2019</span><span class="number">-07</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-07</span><span class="number">-31</span>	<span class="number">23</span></span><br><span class="line"><span class="number">2019</span><span class="number">-08</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-08</span><span class="number">-31</span>	<span class="number">22</span></span><br><span class="line"><span class="number">2019</span><span class="number">-09</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-09</span><span class="number">-30</span>	<span class="number">21</span></span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-10</span><span class="number">-31</span>	<span class="number">23</span></span><br><span class="line"><span class="number">2019</span><span class="number">-11</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-11</span><span class="number">-30</span>	<span class="number">21</span></span><br><span class="line"><span class="number">2019</span><span class="number">-12</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-12</span><span class="number">-31</span>	<span class="number">22</span></span><br></pre></td></tr></table></figure>

<p>结合 Region 表简单 join，得到每个 Region 2019 年的初始 WorkDayNums:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="variable">@Table</span>_WorkDays, Region</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">StartDate	EndDate	        WorkDayNums	Region</span><br><span class="line"><span class="number">2019</span><span class="number">-01</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-01</span><span class="number">-31</span>	<span class="number">23</span>	        China</span><br><span class="line"><span class="number">2019</span><span class="number">-01</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-01</span><span class="number">-31</span>	<span class="number">23</span>	        US</span><br><span class="line"><span class="number">2019</span><span class="number">-02</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-02</span><span class="number">-28</span>	<span class="number">20</span>	        China</span><br><span class="line"><span class="number">2019</span><span class="number">-02</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-02</span><span class="number">-28</span>	<span class="number">20</span>	        US</span><br><span class="line"><span class="number">2019</span><span class="number">-03</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-03</span><span class="number">-31</span>	<span class="number">21</span>	        China</span><br><span class="line"><span class="number">2019</span><span class="number">-03</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-03</span><span class="number">-31</span>	<span class="number">21</span>	        US</span><br><span class="line"><span class="number">2019</span><span class="number">-04</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-04</span><span class="number">-30</span>	<span class="number">22</span>	        China</span><br><span class="line"><span class="number">2019</span><span class="number">-04</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-04</span><span class="number">-30</span>	<span class="number">22</span>	        US</span><br><span class="line"><span class="number">2019</span><span class="number">-05</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-05</span><span class="number">-31</span>	<span class="number">23</span>	        China</span><br><span class="line"><span class="number">2019</span><span class="number">-05</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-05</span><span class="number">-31</span>	<span class="number">23</span>	        US</span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-06</span><span class="number">-30</span>	<span class="number">20</span>	        China</span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-06</span><span class="number">-30</span>	<span class="number">20</span>	        US</span><br><span class="line"><span class="number">2019</span><span class="number">-07</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-07</span><span class="number">-31</span>	<span class="number">23</span>	        China</span><br><span class="line"><span class="number">2019</span><span class="number">-07</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-07</span><span class="number">-31</span>	<span class="number">23</span>	        US</span><br><span class="line"><span class="number">2019</span><span class="number">-08</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-08</span><span class="number">-31</span>	<span class="number">22</span>	        China</span><br><span class="line"><span class="number">2019</span><span class="number">-08</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-08</span><span class="number">-31</span>	<span class="number">22</span>	        US</span><br><span class="line"><span class="number">2019</span><span class="number">-09</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-09</span><span class="number">-30</span>	<span class="number">21</span>	        China</span><br><span class="line"><span class="number">2019</span><span class="number">-09</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-09</span><span class="number">-30</span>	<span class="number">21</span>	        US</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-10</span><span class="number">-31</span>	<span class="number">23</span>	        China</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-10</span><span class="number">-31</span>	<span class="number">23</span>	        US</span><br><span class="line"><span class="number">2019</span><span class="number">-11</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-11</span><span class="number">-30</span>	<span class="number">21</span>	        China</span><br><span class="line"><span class="number">2019</span><span class="number">-11</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-11</span><span class="number">-30</span>	<span class="number">21</span>	        US</span><br><span class="line"><span class="number">2019</span><span class="number">-12</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-12</span><span class="number">-31</span>	<span class="number">22</span>	        China</span><br><span class="line"><span class="number">2019</span><span class="number">-12</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-12</span><span class="number">-31</span>	<span class="number">22</span>	        US</span><br></pre></td></tr></table></figure>

<h1 id="优化-Holiday-数据"><a href="#优化-Holiday-数据" class="headerlink" title="优化 Holiday 数据"></a>优化 Holiday 数据</h1><p>一个月中可能有许多天假期，所以我们需要最后算一个月的有效假期（不和周末重合）。</p>
<p>首先得出月份</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">CONVERT</span>(<span class="type">date</span>, DATEADD(<span class="keyword">month</span>, DATEDIFF(<span class="keyword">month</span>, <span class="number">0</span>, HolidayDate), <span class="number">0</span>)) <span class="keyword">as</span> TheMonth, <span class="operator">*</span> <span class="keyword">from</span> Holiday;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">TheMonth	HolidayDate	Region</span><br><span class="line"><span class="number">2019</span><span class="number">-01</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-01</span><span class="number">-01</span>	China</span><br><span class="line"><span class="number">2019</span><span class="number">-01</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-01</span><span class="number">-02</span>	China</span><br><span class="line"><span class="number">2019</span><span class="number">-04</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-04</span><span class="number">-01</span>	China</span><br><span class="line"><span class="number">2019</span><span class="number">-05</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-05</span><span class="number">-01</span>	China</span><br><span class="line"><span class="number">2019</span><span class="number">-07</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-07</span><span class="number">-07</span>	China</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-10</span><span class="number">-01</span>	China</span><br><span class="line"><span class="number">2019</span><span class="number">-01</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-01</span><span class="number">-05</span>	US</span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-01</span>	<span class="number">2019</span><span class="number">-06</span><span class="number">-01</span>	US</span><br></pre></td></tr></table></figure>

<p>然后 group by <code>TheMonth</code> 和 <code>Region</code>的时候计算有效假期（不和周末重合）：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--#HolidayNew</span></span><br><span class="line"><span class="keyword">select</span>	TheMonth, Region,</span><br><span class="line">        <span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> DATENAME(dw, HolidayDate) <span class="keyword">in</span> (<span class="string">&#x27;Saturday&#x27;</span>, <span class="string">&#x27;Sunday&#x27;</span>) <span class="keyword">then</span> <span class="number">0</span> <span class="keyword">else</span> <span class="number">1</span> <span class="keyword">end</span>) <span class="keyword">as</span> ValidHolidayDays</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">        (<span class="keyword">select</span> <span class="keyword">CONVERT</span>(<span class="type">date</span>, DATEADD(<span class="keyword">month</span>, DATEDIFF(<span class="keyword">month</span>, <span class="number">0</span>, HolidayDate), <span class="number">0</span>)) TheMonth,<span class="operator">*</span> <span class="keyword">from</span> Holiday) <span class="keyword">as</span> HolidayNew</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> TheMonth, Region</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> Region, TheMonth;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">TheMonth	Region	ValidHolidayDays</span><br><span class="line"><span class="number">2019</span><span class="number">-01</span><span class="number">-01</span>	China	<span class="number">2</span></span><br><span class="line"><span class="number">2019</span><span class="number">-04</span><span class="number">-01</span>	China	<span class="number">1</span></span><br><span class="line"><span class="number">2019</span><span class="number">-05</span><span class="number">-01</span>	China	<span class="number">1</span></span><br><span class="line"><span class="number">2019</span><span class="number">-07</span><span class="number">-01</span>	China	<span class="number">0</span></span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-01</span>	China	<span class="number">1</span></span><br><span class="line"><span class="number">2019</span><span class="number">-01</span><span class="number">-01</span>	US	<span class="number">0</span></span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-01</span>	US	<span class="number">0</span></span><br></pre></td></tr></table></figure>

<h1 id="合并-WorkDay-与-Valid-Holiday-Day"><a href="#合并-WorkDay-与-Valid-Holiday-Day" class="headerlink" title="合并 WorkDay 与 Valid Holiday Day"></a>合并 WorkDay 与 Valid Holiday Day</h1><p>将上面的#HolidayNew和最上面的初始workday结合一下，就可以得到最后的Business Day Nums。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  temp.startDate <span class="keyword">as</span> TheMonth, </span><br><span class="line">        temp.Region,</span><br><span class="line">        WorkDayNums <span class="operator">-</span> isnull(hn.ValidHolidayDays, <span class="number">0</span>) <span class="keyword">as</span> BusinessDays</span><br><span class="line"><span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="variable">@Table</span>_WorkDays, Region) <span class="keyword">as</span> temp </span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> #HolidayNew hn </span><br><span class="line"><span class="keyword">on</span> temp.StartDate <span class="operator">=</span> hn.TheMonth <span class="keyword">and</span> temp.Region <span class="operator">=</span> hn.Region</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">TheMonth	Region	BusinessDays</span><br><span class="line"><span class="number">2019</span><span class="number">-01</span><span class="number">-01</span>	China	<span class="number">21</span></span><br><span class="line"><span class="number">2019</span><span class="number">-01</span><span class="number">-01</span>	US	<span class="number">23</span></span><br><span class="line"><span class="number">2019</span><span class="number">-02</span><span class="number">-01</span>	China	<span class="number">20</span></span><br><span class="line"><span class="number">2019</span><span class="number">-02</span><span class="number">-01</span>	US	<span class="number">20</span></span><br><span class="line"><span class="number">2019</span><span class="number">-03</span><span class="number">-01</span>	China	<span class="number">21</span></span><br><span class="line"><span class="number">2019</span><span class="number">-03</span><span class="number">-01</span>	US	<span class="number">21</span></span><br><span class="line"><span class="number">2019</span><span class="number">-04</span><span class="number">-01</span>	China	<span class="number">21</span></span><br><span class="line"><span class="number">2019</span><span class="number">-04</span><span class="number">-01</span>	US	<span class="number">22</span></span><br><span class="line"><span class="number">2019</span><span class="number">-05</span><span class="number">-01</span>	China	<span class="number">22</span></span><br><span class="line"><span class="number">2019</span><span class="number">-05</span><span class="number">-01</span>	US	<span class="number">23</span></span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-01</span>	China	<span class="number">20</span></span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-01</span>	US	<span class="number">20</span></span><br><span class="line"><span class="number">2019</span><span class="number">-07</span><span class="number">-01</span>	China	<span class="number">23</span></span><br><span class="line"><span class="number">2019</span><span class="number">-07</span><span class="number">-01</span>	US	<span class="number">23</span></span><br><span class="line"><span class="number">2019</span><span class="number">-08</span><span class="number">-01</span>	China	<span class="number">22</span></span><br><span class="line"><span class="number">2019</span><span class="number">-08</span><span class="number">-01</span>	US	<span class="number">22</span></span><br><span class="line"><span class="number">2019</span><span class="number">-09</span><span class="number">-01</span>	China	<span class="number">21</span></span><br><span class="line"><span class="number">2019</span><span class="number">-09</span><span class="number">-01</span>	US	<span class="number">21</span></span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-01</span>	China	<span class="number">22</span></span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-01</span>	US	<span class="number">23</span></span><br><span class="line"><span class="number">2019</span><span class="number">-11</span><span class="number">-01</span>	China	<span class="number">21</span></span><br><span class="line"><span class="number">2019</span><span class="number">-11</span><span class="number">-01</span>	US	<span class="number">21</span></span><br><span class="line"><span class="number">2019</span><span class="number">-12</span><span class="number">-01</span>	China	<span class="number">22</span></span><br><span class="line"><span class="number">2019</span><span class="number">-12</span><span class="number">-01</span>	US	<span class="number">22</span></span><br></pre></td></tr></table></figure>

<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>这次又回顾学习了下一些日期函数的学习，包括类型转换等，还可以。</p>
<hr>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-02-18T16:00:00.000Z" title="2019/2/19 上午12:00:00">2019-02-19</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-09-08T15:43:26.404Z" title="2020/9/8 下午11:43:26">2020-09-08</time></span><span class="level-item"> BF </span><span class="level-item">16 minutes read (About 2407 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/02/19/2019/02/2019-02-19-Py2DifferPy3/">Difference between Python2 and Python3</a></h1><div class="content"><h1 id="Python2-x-与-3​​-x-版本区别"><a href="#Python2-x-与-3​​-x-版本区别" class="headerlink" title="Python2.x 与 3​​.x 版本区别"></a>Python2.x 与 3​​.x 版本区别</h1><p>Python 的 3​​.0 版本，常被称为 Python 3000，或简称 Py3k。相对于 Python 的早期版本，这是一个较大的升级。</p>
<p>为了不带入过多的累赘，Python 3.0 在设计的时候没有考虑向下相容。</p>
<p>许多针对早期 Python 版本设计的程式都无法在 Python 3.0 上正常执行。</p>
<p>为了照顾现有程式，Python 2.6 作为一个过渡版本，基本使用了 Python 2.x 的语法和库，同时考虑了向 Python 3.0 的迁移，允许使用部分 Python 3.0 的语法与函数。</p>
<p>新的 Python 程式建议使用 Python 3.0 版本的语法。</p>
<p>除非执行环境无法安装 Python 3.0 或者程式本身使用了不支援 Python 3.0 的第三方库。目前不支援 Python 3.0 的第三方库有 Twisted, py2exe, PIL 等。</p>
<p>大多数第三方库都正在努力地相容 Python 3.0 版本。即使无法立即使用 Python 3.0，也建议编写相容 Python 3.0 版本的程式，然后使用 Python 2.6, Python 2.7 来执行。</p>
<p>Python 3.0 的变化主要在以下几个方面:</p>
<h2 id="print-函数"><a href="#print-函数" class="headerlink" title="print 函数"></a>print 函数</h2><p>print 语句没有了，取而代之的是 print()函数。 Python 2.6 与 Python 2.7 部分地支持这种形式的 print 语法。在 Python 2.6 与 Python 2.7 里面，以下三种形式是等价的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span> <span class="string">&quot;fish&quot;</span></span><br><span class="line"><span class="built_in">print</span> (<span class="string">&quot;fish&quot;</span>) <span class="comment">#注意print后面有个空格</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;fish&quot;</span>) <span class="comment">#print()不能带有任何其它参数</span></span><br></pre></td></tr></table></figure>

<p>然而，Python 2.6 实际已经支持新的 print()语法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;fish&quot;</span>, <span class="string">&quot;panda&quot;</span>, sep=<span class="string">&#x27;, &#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Unicode"><a href="#Unicode" class="headerlink" title="Unicode"></a>Unicode</h2><p>Python 2 有 ASCII str() 类型，unicode() 是单独的，不是 byte 类型。</p>
<p>现在， 在 Python 3，我们最终有了 Unicode (utf-8) 字符串，以及一个字节类：byte 和 bytearrays。</p>
<p>由于 Python3.X 源码文件默认使用 utf-8 编码，这就使得以下代码是合法的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>中国 = <span class="string">&#x27;china&#x27;</span></span><br><span class="line">&gt;&gt;&gt;<span class="built_in">print</span>(中国)</span><br><span class="line">china</span><br></pre></td></tr></table></figure>

<p>Python 2.x</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">str</span> = <span class="string">&quot;我爱北京天安门&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">str</span></span><br><span class="line"><span class="string">&#x27;\xe6\x88\x91\xe7\x88\xb1\xe5\x8c\x97\xe4\xba\xac\xe5\xa4\xa9\xe5\xae\x89\xe9\x97\xa8&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">str</span> = <span class="string">u&quot;我爱北京天安门&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">str</span></span><br><span class="line"><span class="string">u&#x27;\u6211\u7231\u5317\u4eac\u5929\u5b89\u95e8&#x27;</span></span><br></pre></td></tr></table></figure>

<p>Python 3.x</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">str</span> = <span class="string">&quot;我爱北京天安门&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">str</span></span><br><span class="line"><span class="string">&#x27;我爱北京天安门&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="除法运算"><a href="#除法运算" class="headerlink" title="除法运算"></a>除法运算</h2><p>Python 中的除法较其它语言显得非常高端，有套很复杂的规则。Python 中的除法有两个运算符，/和//</p>
<p>首先来说/除法:</p>
<p>在 python 2.x 中/除法就跟我们熟悉的大多数语言，比如 Java 啊 C 啊差不多，整数相除的结果是一个整数，把小数部分完全忽略掉，浮点数除法会保留小数点的部分得到一个浮点数的结果。</p>
<p>在 python 3.x 中/除法不再这么做了，对于整数之间的相除，结果也会是浮点数。</p>
<p>Python 2.x:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span> / <span class="number">2</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1.0</span> / <span class="number">2.0</span></span><br><span class="line"><span class="number">0.5</span></span><br></pre></td></tr></table></figure>

<p>Python 3.x:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span>/<span class="number">2</span></span><br><span class="line"><span class="number">0.5</span></span><br></pre></td></tr></table></figure>

<p>而对于//除法，这种除法叫做 floor 除法，会对除法的结果自动进行一个 floor 操作，在 python 2.x 和 python 3.x 中是一致的。</p>
<p>python 2.x:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>-<span class="number">1</span> // <span class="number">2</span></span><br><span class="line">-<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>python 3.x:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>-<span class="number">1</span> // <span class="number">2</span></span><br><span class="line">-<span class="number">1</span></span><br><span class="line">注意的是并不是舍弃小数部分，而是执行 floor 操作，如果要截取整数部分，那么需要使用 math 模块的 trunc 函数</span><br></pre></td></tr></table></figure>

<p>python 3.x:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> math</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>math.trunc(<span class="number">1</span> / <span class="number">2</span>)</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>math.trunc(-<span class="number">1</span> / <span class="number">2</span>)</span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>

<h2 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h2><p>在 Python 3 中处理异常也轻微的改变了，在 Python 3 中我们现在使用 as 作为关键词。</p>
<p>捕获异常的语法由 except exc, var 改为 except exc as var。</p>
<p>使用语法 except (exc1, exc2) as var 可以同时捕获多种类别的异常。 Python 2.6 已经支持这两种语法。</p>
<ol>
<li>在 2.x 时代，所有类型的对象都是可以被直接抛出的，在 3.x 时代，只有继承自 BaseException 的对象才可以被抛出。</li>
<li>2.x raise 语句使用逗号将抛出对象类型和参数分开，3.x 取消了这种奇葩的写法，直接调用构造函数抛出对象即可。<br>在 2.x 时代，异常在代码中除了表示程序错误，还经常做一些普通控制结构应该做的事情，在 3.x 中可以看出，设计者让异常变的更加专一，只有在错误发生的情况才能去用异常捕获语句来处理。</li>
</ol>
<h2 id="xrange"><a href="#xrange" class="headerlink" title="xrange"></a>xrange</h2><p>在 Python 2 中 xrange() 创建迭代对象的用法是非常流行的。比如： for 循环或者是列表/集合/字典推导式。</p>
<p>这个表现十分像生成器（比如。”惰性求值”）。但是这个 xrange-iterable 是无穷的，意味着你可以无限遍历。</p>
<p>由于它的惰性求值，如果你不得仅仅不遍历它一次，xrange() 函数 比 range() 更快（比如 for 循环）。尽管如此，对比迭代一次，不建议你重复迭代多次，因为生成器每次都从头开始。</p>
<p>在 Python 3 中，range() 是像 xrange() 那样实现以至于一个专门的 xrange() 函数都不再存在（在 Python 3 中 xrange() 会抛出命名异常）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> timeit</span><br><span class="line"></span><br><span class="line">n = <span class="number">10000</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_range</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_xrange</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(n):</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>Python 2</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span> <span class="string">&#x27;Python&#x27;</span>, python_version()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;\ntiming range()&#x27;</span></span><br><span class="line">%timeit test_range(n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;\n\ntiming xrange()&#x27;</span></span><br><span class="line">%timeit test_xrange(n)</span><br><span class="line"></span><br><span class="line">Python <span class="number">2.7</span><span class="number">.6</span></span><br><span class="line"></span><br><span class="line">timing <span class="built_in">range</span>()</span><br><span class="line"><span class="number">1000</span> loops, best of <span class="number">3</span>: <span class="number">433</span> µs per loop</span><br><span class="line"></span><br><span class="line">timing xrange()</span><br><span class="line"><span class="number">1000</span> loops, best of <span class="number">3</span>: <span class="number">350</span> µs per loop</span><br></pre></td></tr></table></figure>

<p>Python 3</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Python&#x27;</span>, python_version())</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\ntiming range()&#x27;</span>)</span><br><span class="line">%timeit test_range(n)</span><br><span class="line"></span><br><span class="line">Python <span class="number">3.4</span><span class="number">.1</span></span><br><span class="line"></span><br><span class="line">timing <span class="built_in">range</span>()</span><br><span class="line"><span class="number">1000</span> loops, best of <span class="number">3</span>: <span class="number">520</span> µs per loop</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(xrange(<span class="number">10</span>))</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">NameError                                 Traceback (most recent call last)</span><br><span class="line">&lt;ipython-<span class="built_in">input</span>-<span class="number">5</span>-5d8f9b79ea70&gt; <span class="keyword">in</span> &lt;module&gt;()</span><br><span class="line">----&gt; 1 print(xrange(10))</span><br><span class="line"></span><br><span class="line">NameError: name <span class="string">&#x27;xrange&#x27;</span> <span class="keyword">is</span> <span class="keyword">not</span> defined</span><br></pre></td></tr></table></figure>

<h2 id="八进制字面量表示"><a href="#八进制字面量表示" class="headerlink" title="八进制字面量表示"></a>八进制字面量表示</h2><p>八进制数必须写成 0o777，原来的形式 0777 不能用了；二进制必须写成 0b111。</p>
<p>新增了一个 bin()函数用于将一个整数转换成二进制字串。 Python 2.6 已经支持这两种语法。</p>
<p>在 Python 3.x 中，表示八进制字面量的方式只有一种，就是 0o1000。</p>
<p>python 2.x</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0o1000</span></span><br><span class="line"><span class="number">512</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>01000</span><br><span class="line"><span class="number">512</span></span><br></pre></td></tr></table></figure>

<p>python 3.x</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>01000</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span></span><br><span class="line">    01000</span><br><span class="line">        ^</span><br><span class="line">SyntaxError: invalid token</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0o1000</span></span><br><span class="line"><span class="number">512</span></span><br></pre></td></tr></table></figure>

<h2 id="不等运算符"><a href="#不等运算符" class="headerlink" title="不等运算符"></a>不等运算符</h2><p>Python 2.x 中不等于有两种写法 != 和 &lt;&gt;</p>
<p>Python 3.x 中去掉了&lt;&gt;, 只有!=一种写法，还好，我从来没有使用&lt;&gt;的习惯</p>
<h2 id="去掉了-repr-表达式"><a href="#去掉了-repr-表达式" class="headerlink" title="去掉了 repr 表达式``"></a>去掉了 repr 表达式``</h2><p>Python 2.x 中反引号``相当于 repr 函数的作用</p>
<p>Python 3.x 中去掉了``这种写法，只允许使用 repr 函数，这样做的目的是为了使代码看上去更清晰么？不过我感觉用 repr 的机会很少，一般只在 debug 的时候才用，多数时候还是用 str 函数来用字符串描述对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sendMail</span>(<span class="params">from_: <span class="built_in">str</span>, to: <span class="built_in">str</span>, title: <span class="built_in">str</span>, body: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<h2 id="多个模块被改名（根据-PEP8）"><a href="#多个模块被改名（根据-PEP8）" class="headerlink" title="多个模块被改名（根据 PEP8）"></a>多个模块被改名（根据 PEP8）</h2><table>
<thead>
<tr>
<th>旧的名字</th>
<th>新的名字</th>
</tr>
</thead>
<tbody><tr>
<td>_winreg</td>
<td>winreg</td>
</tr>
<tr>
<td>ConfigParser</td>
<td>configparser</td>
</tr>
<tr>
<td>copy_reg</td>
<td>copyreg</td>
</tr>
<tr>
<td>Queue</td>
<td>queue</td>
</tr>
<tr>
<td>SocketServer</td>
<td>socketserver</td>
</tr>
<tr>
<td>repr</td>
<td>reprlib</td>
</tr>
</tbody></table>
<p>StringIO 模块现在被合并到新的 io 模组内。 new, md5, gopherlib 等模块被删除。 Python 2.6 已经支援新的 io 模组。</p>
<p>httplib, BaseHTTPServer, CGIHTTPServer, SimpleHTTPServer, Cookie, cookielib 被合并到 http 包内。</p>
<p>取消了 exec 语句，只剩下 exec()函数。 Python 2.6 已经支援 exec()函数。</p>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p>1）Py3.X 去除了 long 类型，现在只有一种整型——int，但它的行为就像 2.X 版本的 long</p>
<p>2）新增了 bytes 类型，对应于 2.X 版本的八位串，定义一个 bytes 字面量的方法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="string">b&#x27;china&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(b)</span><br><span class="line">&lt;<span class="built_in">type</span> <span class="string">&#x27;bytes&#x27;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>str 对象和 bytes 对象可以使用.encode() (str -&gt; bytes) or .decode() (bytes -&gt; str)方法相互转化。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = b.decode()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">&#x27;china&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b1 = s.encode()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b1</span><br><span class="line"><span class="string">b&#x27;china&#x27;</span></span><br></pre></td></tr></table></figure>
<p>3）dict的.keys()、.items 和.values()方法返回迭代器，而之前的iterkeys()等函数都被废弃。同时去掉的还有 dict.has_key()，用 in替代它吧.</p>
<h2 id="打开文件"><a href="#打开文件" class="headerlink" title="打开文件"></a>打开文件</h2><p>原：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">file( ..... )</span><br><span class="line">或 </span><br><span class="line"><span class="built_in">open</span>(.....)</span><br></pre></td></tr></table></figure>
<p>改为只能用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">open</span>(.....)</span><br></pre></td></tr></table></figure>
<p>从键盘录入一个字符串</p>
<p>原:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">raw_input( <span class="string">&quot;提示信息&quot;</span> )</span><br></pre></td></tr></table></figure>
<p>改为:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">input</span>( <span class="string">&quot;提示信息&quot;</span> )</span><br></pre></td></tr></table></figure>
<p>在python2.x中raw_input()和input( )，两个函数都存在，其中区别为：</p>
<p> raw_input()—将所有输入作为字符串看待，返回字符串类型<br> input()—–只能接收”数字”的输入，在对待纯数字输入时具有自己的特性，它返回所输入的数字的类型（int, float ）<br>在python3.x中raw_input()和input( )进行了整合，去除了raw_input()，仅保留了input()函数，其接收任意任性输入，将所有输入默认为字符串处理，并返回字符串类型。</p>
<h2 id="map、filter-和-reduce"><a href="#map、filter-和-reduce" class="headerlink" title="map、filter 和 reduce"></a>map、filter 和 reduce</h2><p>这三个函数号称是函数式编程的代表。在 Python3.x 和 Python2.x 中也有了很大的差异。</p>
<p>首先我们先简单的在 Python2.x 的交互下输入 map 和 filter,看到它们两者的类型是 built-in function(内置函数):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">map</span></span><br><span class="line">&lt;built-<span class="keyword">in</span> function <span class="built_in">map</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">filter</span></span><br><span class="line">&lt;built-<span class="keyword">in</span> function <span class="built_in">filter</span>&gt;</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>它们输出的结果类型都是列表:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">map</span>(<span class="keyword">lambda</span> x:x *<span class="number">2</span>, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">[<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">filter</span>(<span class="keyword">lambda</span> x:x %<span class="number">2</span> ==<span class="number">0</span>,<span class="built_in">range</span>(<span class="number">10</span>))</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>但是在Python 3.x中它们却不是这个样子了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">map</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">map</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">map</span>(<span class="params"><span class="built_in">print</span>,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span>)</span></span><br><span class="line"><span class="class">&lt;<span class="title">map</span> <span class="title">object</span> <span class="title">at</span> 0<span class="title">x10d8bd400</span>&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">filter</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">filter</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">filter</span>(<span class="params"><span class="keyword">lambda</span> x:x % <span class="number">2</span> == <span class="number">0</span>, <span class="built_in">range</span>(<span class="params"><span class="number">10</span></span>)</span>)</span></span><br><span class="line"><span class="class">&lt;<span class="title">filter</span> <span class="title">object</span> <span class="title">at</span> 0<span class="title">x10d8bd3c8</span>&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt;</span></span><br></pre></td></tr></table></figure>
<p>首先它们从函数变成了类，其次，它们的返回结果也从当初的列表成了一个可迭代的对象, 我们尝试用 next 函数来进行手工迭代:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f =<span class="built_in">filter</span>(<span class="keyword">lambda</span> x:x %<span class="number">2</span> ==<span class="number">0</span>, <span class="built_in">range</span>(<span class="number">10</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(f)</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(f)</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(f)</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(f)</span><br><span class="line"><span class="number">6</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>对于比较高端的 reduce 函数，它在 Python 3.x 中已经不属于 built-in 了，被挪到 functools 模块当中。</p>
<hr>
<p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://www.runoob.com/python/python-2x-3x.html">Python2.x与3​​.x版本区别</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/kendrick/p/7478304.html">Python2和Python3的差异</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/hanggegege/p/5840005.html">python3和Python2的区别（被坑太久了）</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-02-16T16:00:00.000Z" title="2019/2/17 上午12:00:00">2019-02-17</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-09-08T15:43:26.403Z" title="2020/9/8 下午11:43:26">2020-09-08</time></span><span class="level-item"> BF </span><span class="level-item">6 minutes read (About 888 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/02/17/2019/02/2019-02-17-HDFSOperation/">Hadoop HDFS Operation</a></h1><div class="content"><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>之前搭好了 Hadoop 环境，但是在使用的过程中还是有一些问题，现在终于解决了，至少最基础的环境没有问题了。</p>
<h1 id="基本环境"><a href="#基本环境" class="headerlink" title="基本环境"></a>基本环境</h1><p>Hadoop-2.7.3 / Java7</p>
<p>四台机子如下，<strong>hadoop00</strong> 为<strong>mater</strong>, 其余为 slave</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">192.168.137.100 hadoop00</span><br><span class="line">192.168.137.101 hadoop01</span><br><span class="line">192.168.137.102 hadoop02</span><br><span class="line">192.168.137.103 hadoop03</span><br></pre></td></tr></table></figure>

<h1 id="HDFS-的相关命令"><a href="#HDFS-的相关命令" class="headerlink" title="HDFS 的相关命令"></a>HDFS 的相关命令</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-mkdir            在HDFS创建目录    hdfs dfs -mkdir &#x2F;data</span><br><span class="line">-ls               查看当前目录      hdfs dfs -ls &#x2F;</span><br><span class="line">-ls -R            查看目录与子目录</span><br><span class="line">-put              上传一个文件      hdfs dfs -put data.txt &#x2F;data&#x2F;input</span><br><span class="line">-moveFromLocal    上传一个文件，会删除本地文件：ctrl + X</span><br><span class="line">-copyFromLocal    上传一个文件，与put一样</span><br><span class="line">-copyToLocal      下载文件  hdfs dfs -copyToLocal &#x2F;data&#x2F;input&#x2F;data.txt</span><br><span class="line">-get              下载文件  hdfs dfs -get &#x2F;data&#x2F;input&#x2F;data.txt</span><br><span class="line">-rm               删除文件  hdfs dfs -rm &#x2F;data&#x2F;input&#x2F;data.txt</span><br><span class="line">-getmerge         将目录所有的文件先合并，再下载</span><br><span class="line">-cp               拷贝： hdfs dfs -cp &#x2F;data&#x2F;input&#x2F;data.txt  &#x2F;data&#x2F;input&#x2F;data01.txt</span><br><span class="line">-mv               移动： hdfs dfs -mv &#x2F;data&#x2F;input&#x2F;data.txt  &#x2F;data&#x2F;input&#x2F;data02.txt</span><br><span class="line">-count            统计目录下的文件个数</span><br><span class="line">-text、-cat       查看文件的内容  hdfs dfs -cat &#x2F;data&#x2F;input&#x2F;data.txt</span><br><span class="line">-balancer         平衡操作</span><br></pre></td></tr></table></figure>

<h1 id="使用-Java-进行-HDFS-基本操作"><a href="#使用-Java-进行-HDFS-基本操作" class="headerlink" title="使用 Java 进行 HDFS 基本操作"></a>使用 Java 进行 HDFS 基本操作</h1><p>下面是一个非常简单的例子，需要说明的是，”root”是那台 Linux 上有权限的用户名，不然会报权限错误，有多种解决方案，可以参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/bkylry/p/8072132.html">HDFS JAVA 客户端的权限错误：Permission denied</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.bearfly.fun.hadooplearn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"><span class="keyword">import</span> java.net.URISyntaxException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileSystem;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Description</span>: App</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> bearfly1990</span></span><br><span class="line"><span class="comment">* <span class="doctag">@date</span> Feb 17, 2019 10:18:42 PM</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException, URISyntaxException </span>&#123;</span><br><span class="line">        Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">        FileSystem fs = FileSystem.get(<span class="keyword">new</span> URI(<span class="string">&quot;hdfs://hadoop00:9000&quot;</span>), conf, <span class="string">&quot;root&quot;</span>);</span><br><span class="line">        fs.mkdirs(<span class="keyword">new</span> Path(<span class="string">&quot;/folder1&quot;</span>));</span><br><span class="line"></span><br><span class="line">        Path src = <span class="keyword">new</span> Path(<span class="string">&quot;d:/test.txt&quot;</span>);</span><br><span class="line">        Path dst = <span class="keyword">new</span> Path(<span class="string">&quot;/folder1&quot;</span>);</span><br><span class="line">        fs.copyFromLocalFile(src, dst);</span><br><span class="line">        fs.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>网上有更多详细的例子。</p>
<p>最后的运行结果如下（加上上面创建的文件）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop00 ~]<span class="comment"># hdfs dfs -ls -R /</span></span><br><span class="line">drwxr-xr-x   - root supergroup          0 2019-02-17 21:23 /data</span><br><span class="line">drwxr-xr-x   - root supergroup          0 2019-02-17 21:25 /data/input</span><br><span class="line">-rw-r--r--   3 root supergroup         68 2019-02-17 21:25 /data/input/word-count-data.txt</span><br><span class="line">drwxr-xr-x   - root supergroup          0 2019-02-17 21:23 /data/output</span><br><span class="line">drwxr-xr-x   - root supergroup          0 2019-02-17 22:10 /folder1</span><br><span class="line">-rw-r--r--   3 root supergroup         20 2019-02-17 22:10 /folder1/test.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="WARN-util-NativeCodeLoader-Unable-to-load-native-hadoop-library-for-your-platform…-using-builtin-java-classes-where-applicable"><a href="#WARN-util-NativeCodeLoader-Unable-to-load-native-hadoop-library-for-your-platform…-using-builtin-java-classes-where-applicable" class="headerlink" title="WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform… using builtin-java classes where applicable"></a>WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform… using builtin-java classes where applicable</h1><p>在使用的过程中一直有报这样的 Warning,虽然可以正常运行，但是看着很烦。</p>
<p>网上有许多的问题和对应解决方案，而我这个编译的版本什么都是一样的，只要在环境变量中添加 HADOOP_OPTS 即可。</p>
<p>具体分析的时候可以把 Hadoop 的 debug log 打开<code>$ export HADOOP_ROOT_LOGGER=DEBUG,console</code>，找到对应的信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/profile</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_OPTS=<span class="string">&quot;-Djava.library.path=<span class="variable">$&#123;HADOOP_HOME&#125;</span>/lib/native&quot;</span></span><br></pre></td></tr></table></figure>

<h1 id="DataNode-Crashed"><a href="#DataNode-Crashed" class="headerlink" title="DataNode Crashed"></a>DataNode Crashed</h1><p>在使用的过程中，我还遇到了DataNode失效了。我找不到原因，所以stop hdfs 和 yarn 之后重新format了一下就好了。</p>
<p>注：在这过程中我关闭了防火墙，删除原始的目录，排除了可能的影响。</p>
<p>更多信息可以参考最后的链接。</p>
<hr>
<p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/bkylry/p/8072132.html">HDFS JAVA 客户端的权限错误：Permission denied</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/likui360/p/6558749.html">Hadoop 出现错误：WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform… using builtin-java classes where applicable，解决方案</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/l1028386804/article/details/51538611">Hadoop之—— WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform…</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/l1028386804/article/details/72857449">Hadoop之——重新格式化HDFS的方案</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/lizhonghua34/p/6437878.html">java使用FileSystem上传文件到hadoop文件系统</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-01-19T16:00:00.000Z" title="2019/1/20 上午12:00:00">2019-01-20</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-09-08T15:43:26.401Z" title="2020/9/8 下午11:43:26">2020-09-08</time></span><span class="level-item"> BF </span><span class="level-item">5 minutes read (About 808 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/01/20/2019/01/2019-01-20-CompareExcel/">Compare Excel</a></h1><div class="content"><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>下周可能有一个小任务是由于系统升级，需要保证生成的 excel 是一致的，所以写了一个非常简单的对比脚本。</p>
<h1 id="主要代码"><a href="#主要代码" class="headerlink" title="主要代码"></a>主要代码</h1><p>下面直接上代码，主要的思路就是从上到下依次对比，从 sheet name 开始，最后对比 cell 的值，数据类型，数据格式。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># author: xiche</span></span><br><span class="line"><span class="comment"># create at: 01/20/2019</span></span><br><span class="line"><span class="comment"># description:</span></span><br><span class="line"><span class="comment">#     simple script to compare excel</span></span><br><span class="line"><span class="comment"># Change log:</span></span><br><span class="line"><span class="comment"># Date          Author      Version     Description</span></span><br><span class="line"><span class="comment"># 01/20/2019    xiche       1.0         init</span></span><br><span class="line"><span class="comment"># 01/21/2019    xiche       1.1         add compare csvs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> openpyxl</span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compare_cell</span>(<span class="params">cell01, cell02</span>):</span></span><br><span class="line">    <span class="keyword">if</span>(cell01.value != cell02.value):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&#123;&#125;&#123;&#125;: &#123;&#125; / &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(cell01.column,</span><br><span class="line">                                     cell01.row, cell01.value, cell02.value))</span><br><span class="line">    <span class="keyword">elif</span>(cell01.data_type != cell02.data_type):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&#123;&#125;&#123;&#125;: &#123;&#125; / &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(cell01.column,</span><br><span class="line">                                     cell01.row, cell01.data_type, cell02.data_type))</span><br><span class="line">    <span class="keyword">elif</span>(cell01.number_format != cell02.number_format):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&#123;&#125;&#123;&#125;: &#123;&#125; / &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(cell01.column, cell01.row,</span><br><span class="line">                                     cell01.number_format, cell02.number_format))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compare_sheet</span>(<span class="params">sheet01, sheet02</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(sheet01.max_row != sheet02.max_row):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;row is not matched! &#123;&#125; / &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(sheet01.max_row, sheet02.max_row))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(sheet01.max_column != sheet02.max_column):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;column is not matched! &#123;&#125; / &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(sheet01.max_column,</span><br><span class="line">                                                      sheet02.max_column))</span><br><span class="line"></span><br><span class="line">    max_row = <span class="built_in">max</span>(sheet01.max_row, sheet02.max_row)</span><br><span class="line">    max_column = <span class="built_in">max</span>(sheet01.max_column, sheet02.max_column)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> index_row <span class="keyword">in</span> <span class="built_in">range</span>(max_row):</span><br><span class="line">        <span class="keyword">for</span> index_col <span class="keyword">in</span> <span class="built_in">range</span>(max_column):</span><br><span class="line">            compare_cell(sheet01.cell(column=index_col+<span class="number">1</span>, row=index_row+<span class="number">1</span>),</span><br><span class="line">                         sheet02.cell(column=index_col+<span class="number">1</span>, row=index_row+<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compare_excels</span>(<span class="params">excel_file01, excel_file02</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;------compare &#123;&#125; &amp; &#123;&#125;------&#x27;</span>.<span class="built_in">format</span>(excel_file01, excel_file02))</span><br><span class="line">    wb01 = openpyxl.load_workbook(excel_file01)</span><br><span class="line">    wb02 = openpyxl.load_workbook(excel_file02)</span><br><span class="line"></span><br><span class="line">    sheet_names_01 = wb01.get_sheet_names()</span><br><span class="line">    sheet_names_02 = wb02.get_sheet_names()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">len</span>(sheet_names_01) != <span class="built_in">len</span>(sheet_names_02)):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;sheets number are not matched!&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(sheet_names_01)):</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">len</span>(sheet_names_01[i]) != <span class="built_in">len</span>(sheet_names_02[i])):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;sheets name not matched!\n&#123;&#125;:&#123;&#125; / &#123;&#125;:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(excel_file01,</span><br><span class="line">                                                                   sheet_names_01[i], excel_file02, sheet_names_02[i]))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        sheet01 = wb01.get_sheet_by_name(sheet_names_01[i])</span><br><span class="line">        sheet02 = wb02.get_sheet_by_name(sheet_names_02[i])</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;compare &#123;&#125;:&#123;&#125; &amp; &#123;&#125;:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(excel_file01,</span><br><span class="line">                                             sheet01.title, excel_file02, sheet02.title))</span><br><span class="line">        compare_sheet(sheet01, sheet02)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compare_csv</span>(<span class="params">csv_file01, csv_file02</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;------compare &#123;&#125; &amp; &#123;&#125;------&#x27;</span>.<span class="built_in">format</span>(csv_file01, csv_file02))</span><br><span class="line">    is_diff = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(csv_file01, newline=<span class="string">&#x27;&#x27;</span>) <span class="keyword">as</span> csv_01, <span class="built_in">open</span>(csv_file02, newline=<span class="string">&#x27;&#x27;</span>) <span class="keyword">as</span> csv_02:</span><br><span class="line">        csv_reader_01 = csv.reader(csv_01, delimiter=<span class="string">&#x27;,&#x27;</span>, quotechar=<span class="string">&#x27;|&#x27;</span>)</span><br><span class="line">        csv_reader_02 = csv.reader(csv_02, delimiter=<span class="string">&#x27;,&#x27;</span>, quotechar=<span class="string">&#x27;|&#x27;</span>)</span><br><span class="line">        csv_list_01 = <span class="built_in">list</span>(csv_reader_01)</span><br><span class="line">        csv_list_02 = <span class="built_in">list</span>(csv_reader_02)</span><br><span class="line">        ccsv_list_02_copy = copy.deepcopy(csv_list_02)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> csv_list_01:</span><br><span class="line">            <span class="keyword">if</span> line <span class="keyword">not</span> <span class="keyword">in</span> csv_list_02:</span><br><span class="line">                is_diff = <span class="literal">True</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;&#123;&#125;:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(csv_file01, line))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                ccsv_list_02_copy.remove(line)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> ccsv_list_02_copy:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;&#123;&#125;:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(csv_file02, line))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> is_diff:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;No difference between these two csv&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="Compare-Excel"><a href="#Compare-Excel" class="headerlink" title="Compare Excel"></a>Compare Excel</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    compare_excels(<span class="string">&#x27;test01.xlsx&#x27;</span>, <span class="string">&#x27;test01.copy.xlsx&#x27;</span>)</span><br><span class="line">    compare_excels(<span class="string">&#x27;test01.xlsx&#x27;</span>, <span class="string">&#x27;test02.xlsx&#x27;</span>)</span><br><span class="line">    compare_excels(<span class="string">&#x27;test01.xlsx&#x27;</span>, <span class="string">&#x27;test03.xlsx&#x27;</span>)</span><br><span class="line">    compare_excels(<span class="string">&#x27;test01.xlsx&#x27;</span>, <span class="string">&#x27;test04.xlsx&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>目前的输出结果如下：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\mayn\Desktop\GitSpace\PowerScript\Python3\openpyxl\compare_excels&gt;python compare_excels.py</span><br><span class="line">-----<span class="literal">-compare</span> test01.xlsx &amp; test01.copy.xlsx------</span><br><span class="line"><span class="built_in">compare</span> test01.xlsx:Sheet1 &amp; test01.copy.xlsx:Sheet1</span><br><span class="line">-----<span class="literal">-compare</span> test01.xlsx &amp; test02.xlsx------</span><br><span class="line"><span class="built_in">compare</span> test01.xlsx:Sheet1 &amp; test02.xlsx:Sheet1</span><br><span class="line">row is not matched! <span class="number">4</span> / <span class="number">5</span></span><br><span class="line">B2: mm<span class="literal">-dd</span><span class="literal">-yy</span> / [<span class="variable">$</span>-<span class="number">409</span>]d\<span class="literal">-mmm</span>\<span class="literal">-yy</span>;<span class="selector-tag">@</span></span><br><span class="line">C4: Test03 / Test04</span><br><span class="line">B5: None / <span class="number">10</span>/<span class="number">21</span>/<span class="number">2010</span></span><br><span class="line">C5: None / Test05</span><br><span class="line">-----<span class="literal">-compare</span> test01.xlsx &amp; test03.xlsx------</span><br><span class="line">sheets name not matched!</span><br><span class="line">test01.xlsx:Sheet1 / test03.xlsx:NotMatch</span><br><span class="line">-----<span class="literal">-compare</span> test01.xlsx &amp; test04.xlsx------</span><br><span class="line"><span class="built_in">compare</span> test01.xlsx:Sheet1 &amp; test04.xlsx:sheet1</span><br><span class="line">row is not matched! <span class="number">4</span> / <span class="number">6</span></span><br><span class="line">column is not matched! <span class="number">3</span> / <span class="number">4</span></span><br><span class="line">B2: mm<span class="literal">-dd</span><span class="literal">-yy</span> / [<span class="variable">$</span>-<span class="number">409</span>]d\<span class="literal">-mmm</span>\<span class="literal">-yy</span>;<span class="selector-tag">@</span></span><br><span class="line">C4: Test03 / Test04</span><br><span class="line">B5: None / <span class="number">10</span>/<span class="number">21</span>/<span class="number">2010</span></span><br><span class="line">C5: None / Test05</span><br><span class="line">B6: None / test</span><br><span class="line">C6: None / test</span><br><span class="line">D6: None / test</span><br></pre></td></tr></table></figure>

<h1 id="Compare-CSV"><a href="#Compare-CSV" class="headerlink" title="Compare CSV"></a>Compare CSV</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    compare_csv(<span class="string">&#x27;demo01.csv&#x27;</span>, <span class="string">&#x27;demo01.copy.csv&#x27;</span>)</span><br><span class="line">    compare_csv(<span class="string">&#x27;demo01.csv&#x27;</span>, <span class="string">&#x27;demo02.csv&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><code>demo01.csv</code>和<code>demo02.csv</code>有两行数据不一值：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">c:\Users\mayn\Desktop\GitSpace\PowerScript\Python3\openpyxl\compare_excels&gt;python compare_excels.py</span><br><span class="line">-----<span class="literal">-compare</span> demo01.csv &amp; demo01.copy.csv------</span><br><span class="line">No difference between these two csv</span><br><span class="line">-----<span class="literal">-compare</span> demo01.csv &amp; demo02.csv------</span><br><span class="line">demo01.csv:[<span class="string">&#x27;R1&#x27;</span>, <span class="string">&#x27; R1&#x27;</span>, <span class="string">&#x27; R1&#x27;</span>]</span><br><span class="line">demo02.csv:[<span class="string">&#x27;Z5&#x27;</span>, <span class="string">&#x27; R4&#x27;</span>, <span class="string">&#x27; R4&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>不知道有没有第三方库直接提供对比的方法，自己的这个之后可以添加到自己的工具库中。</p>
<p>代码和测试的文件在：<a target="_blank" rel="noopener" href="https://github.com/bearfly1990/PowerScript/tree/master/Python3/openpyxl/compare_excels">compare_excels</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-01-14T16:00:00.000Z" title="2019/1/15 上午12:00:00">2019-01-15</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-09-08T15:43:26.400Z" title="2020/9/8 下午11:43:26">2020-09-08</time></span><span class="level-item"> BF </span><span class="level-item">6 minutes read (About 851 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/01/15/2019/01/2019-01-15-SetupHadoopCluster/">Setup Hadoop Cluster</a></h1><div class="content"><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>最近终于在虚拟上搭好了 Hadoop 的集群环境，记录一下。</p>
<h1 id="资源准备"><a href="#资源准备" class="headerlink" title="资源准备"></a>资源准备</h1><ul>
<li>jdk-8u40-linux-x64.gz</li>
<li>hadoop-2.7.3.tar.gz</li>
<li>CentOS Linux release 7.4.1708 (Core)</li>
</ul>
<p>四台机子如下，hadoop00 为<strong>mater</strong>, 其余为<strong>slave</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">192.168.137.100 hadoop00</span><br><span class="line">192.168.137.101 hadoop01</span><br><span class="line">192.168.137.102 hadoop02</span><br><span class="line">192.168.137.103 hadoop03</span><br></pre></td></tr></table></figure>

<h1 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a>配置环境</h1><ul>
<li>jdk: <code>/usr/local/apps/jdk1.8.0_40</code></li>
<li>hadoop: <code>/usr/local/apps/hadoop-2.7.3</code></li>
</ul>
<p>编辑<code>/etc/profile</code>, 将 jdk 和 hadoop 相关 key 添加到环境变量中。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/apps/jdk1.8.0_40</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/jre/lib/rt.jar:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=/usr/<span class="built_in">local</span>/apps/hadoop-2.7.3</span><br><span class="line"><span class="built_in">export</span> HADOOP_COMMON_HOME=<span class="variable">$HADOOP_HOME</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_HDFS_HOME=<span class="variable">$HADOOP_HOME</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_MAPRED_HOME=<span class="variable">$HADOOP_HOME</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_YARN_HOME=<span class="variable">$HADOOP_HOME</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_CONF_DIR=<span class="variable">$HADOOP_HOME</span>/etc/hadoop</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HADOOP_HOME</span>/bin:<span class="variable">$HADOOP_HOME</span>/sbin:<span class="variable">$HADOOP_HOME</span>/lib</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> HADOOP_COMMON_LIB_NATIVE_DIR=<span class="variable">$HADOOP_HOME</span>/lib/native</span><br><span class="line"><span class="built_in">export</span> HADOOP_OPTS=<span class="string">&quot;-Djava.library.path=<span class="variable">$HADOOP_HOME</span>/lib&quot;</span></span><br><span class="line"><span class="comment">#export HADOOP_OPTS=&quot;-Djava.library.path=$HADOOP_PREFIX/lib:$HADOOP_PREFIX/lib/native&quot;</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$HADOOP_HOME</span>/lib/native</span><br></pre></td></tr></table></figure>

<p>然后执行<code>source /usr/profile</code> 使配置生效。</p>
<p>创建为 Hadoop 之后使用的目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /usr/<span class="built_in">local</span>/hadoop/tmp</span><br><span class="line">mkdir -p /usr/<span class="built_in">local</span>/hadoop/hdfs/name</span><br><span class="line">mkdir -p /usr/<span class="built_in">local</span>/haddop/data</span><br></pre></td></tr></table></figure>

<h2 id="设置-ssh-免密登录"><a href="#设置-ssh-免密登录" class="headerlink" title="设置 ssh 免密登录"></a>设置 ssh 免密登录</h2><p>下面是生成密钥对的方式。<br>生成公钥：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t dsa -P <span class="string">&#x27;&#x27;</span> -f ~/.ssh/id_dsa</span><br></pre></td></tr></table></figure>

<p>将公钥加入验证：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat ~/.ssh/id_dsa.pub &gt;&gt; ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>

<p>尝试登录验证：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh localhost</span><br></pre></td></tr></table></figure>

<p>最后我们需要每一台都能互相访问，所以需要将所有的公钥加入<strong>authorized_keys</strong></p>
<p>那我们就要每次都通过<code>scp</code>将私钥传递下去，最后再将最后的<strong>authorized_keys</strong>传回每一台：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scp &#x2F;root&#x2F;.ssh&#x2F;authorized_key hadoop00:&#x2F;root&#x2F;.ssh</span><br><span class="line">scp &#x2F;root&#x2F;.ssh&#x2F;authorized_key hadoop01:&#x2F;root&#x2F;.ssh</span><br><span class="line">scp &#x2F;root&#x2F;.ssh&#x2F;authorized_key hadoop02:&#x2F;root&#x2F;.ssh</span><br></pre></td></tr></table></figure>

<h1 id="Hadoop-配置与运行"><a href="#Hadoop-配置与运行" class="headerlink" title="Hadoop 配置与运行"></a>Hadoop 配置与运行</h1><p>Hadoop 的解压路径为 <code>/usr/local/apps/hadoop/hadoop-2.7.3</code></p>
<p>在<code>/usr/local/apps/hadoop/hadoop-2.7.3/hadoop/etc</code>目录下有许多配置文件需要我们配置。</p>
<h2 id="hadoop-env-sh"><a href="#hadoop-env-sh" class="headerlink" title="hadoop-env.sh"></a>hadoop-env.sh</h2><p>主要是修改使用我们自己的 jdk 路径</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;apps&#x2F;&#x2F;jdk1.8.0_40</span><br></pre></td></tr></table></figure>

<h2 id="yarn-env-sh"><a href="#yarn-env-sh" class="headerlink" title="yarn-env.sh"></a>yarn-env.sh</h2><p>同样是修改 JAVA_HOME 路径：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;apps&#x2F;jdk1.8.0_40</span><br></pre></td></tr></table></figure>

<h2 id="core-site-xml"><a href="#core-site-xml" class="headerlink" title="core-site.xml"></a>core-site.xml</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://hadoop00:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>file:/usr/local/apps/hadoop-2.7.3/tmp<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;property&gt;</span></span><br><span class="line"><span class="comment">        &lt;name&gt;io.file.buffer.size&lt;/name&gt;</span></span><br><span class="line"><span class="comment">        &lt;value&gt;131072&lt;/value&gt;</span></span><br><span class="line"><span class="comment">    &lt;/property&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="hdfs-site-xml"><a href="#hdfs-site-xml" class="headerlink" title="hdfs-site.xml"></a>hdfs-site.xml</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>file:/usr/local/apps/hadoop-2.7.3/hdfs/name<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.data.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>file:/usr/local/apps/hadoop-2.7.3/hdfs/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.secondary.http-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop00:9001<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.servicerpc-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop00:10000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.webhdfs.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="mapred-site-xml"><a href="#mapred-site-xml" class="headerlink" title="mapred-site.xml"></a>mapred-site.xml</h2><p>这个文件从 mapred-site.xml.template 拷过来改：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop00:10020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop00:19888<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="yarn-site-xml"><a href="#yarn-site-xml" class="headerlink" title="yarn-site.xml"></a>yarn-site.xml</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Site specific YARN configuration properties --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop00<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services.mapreduce.shuffle.class<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.mapred.ShuffleHandler<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop00:8032<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.scheduler.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop00:8030<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.resource-tracker.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop00:8031<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.admin.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop00:8033<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop00:8088<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.memory-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>1024<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.cpu-vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">~</span><br></pre></td></tr></table></figure>

<h2 id="格式化-namenode"><a href="#格式化-namenode" class="headerlink" title="格式化 namenode"></a>格式化 namenode</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs namenode -format</span><br></pre></td></tr></table></figure>

<h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><p>将 HDFS 和 YARN 都起来：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> start HDFS</span></span><br><span class="line">start-dfs.sh</span><br><span class="line"><span class="meta">#</span><span class="bash"> start YARN</span></span><br><span class="line">start-yarn.sh</span><br></pre></td></tr></table></figure>

<p>然后使用 jps 查看 java 进程<code>jps</code>,可以看到我们想要的都起来了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop00 hadoop]# jps</span><br><span class="line">9057 ResourceManager</span><br><span class="line">9318 Jps</span><br><span class="line">8631 NameNode</span><br><span class="line">8860 SecondaryNameNode</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop01 ~]# jps</span><br><span class="line">7844 NodeManager</span><br><span class="line">7689 DataNode</span><br><span class="line">7978 Jps</span><br></pre></td></tr></table></figure>

<h2 id="通过网址访问"><a href="#通过网址访问" class="headerlink" title="通过网址访问"></a>通过网址访问</h2><p>如果启动成功，我们便能成功访问下列的网址：</p>
<p>（注意）我们需要将防火墙关闭（当然也可以把用到的端口配置一下）</p>
<p><a target="_blank" rel="noopener" href="http://hadoop00:8088/">http://hadoop00:8088</a></p>
<p><img src="/img/post/2019/01/2019-01-15-SetupHadoopCluster.01.jpg" alt="Yarn"></p>
<p><a target="_blank" rel="noopener" href="http://hadoop00:50070/">http://hadoop00:50070</a></p>
<p><img src="/img/post/2019/01/2019-01-15-SetupHadoopCluster.02.jpg" alt="Yarn"></p>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>目前搭的只是最基础的环境，后继用到其它组件时还需要继续添加。</p>
<hr>
<p>参考：《Hadoop构建数据仓库实践》等</p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/2/">Previous</a></div><div class="pagination-next"><a href="/page/4/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><a class="pagination-link" href="/page/2/">2</a></li><li><a class="pagination-link is-current" href="/page/3/">3</a></li><li><a class="pagination-link" href="/page/4/">4</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/9/">9</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/mybear.jpg" alt="bearfly1990"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">bearfly1990</p><p class="is-size-6 is-block">有熊在飞</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>HZ, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">81</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">100</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/bearfly1990" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/bearfly1990"><i class="fab fa-github"></i></a></div></div></div><!--!--></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/favicon.ico" alt="BF Blog" height="28"></a><p class="is-size-7"><span>&copy; 2021 bearfly1990</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>