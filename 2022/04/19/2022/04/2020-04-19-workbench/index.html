<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Basic Automation Workbench - BF Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="BF Blog"><meta name="msapplication-TileImage" content="/img/favicon.ico"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="BF Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Overview之前接触的Automation的项目基于SpringBoot+TestNG+Cucumber+(Lombok)。 其中每一块想要熟悉都要花比较多的时间，现在就想着先自己把基本的环境搭起来，后续再慢慢学习具体的知识点。 在这过程中，我发现网上基本没找到三者一起配置的项目，更多的是其中两者一起使用。 现在其实还有一个基础问题没解决，就是怎么打成Jar包之后运行测试用例，网上找了一圈，暂"><meta property="og:type" content="blog"><meta property="og:title" content="Basic Automation Workbench"><meta property="og:url" content="https://bearfly1990.github.io/2022/04/19/2022/04/2020-04-19-workbench/"><meta property="og:site_name" content="BF Blog"><meta property="og:description" content="Overview之前接触的Automation的项目基于SpringBoot+TestNG+Cucumber+(Lombok)。 其中每一块想要熟悉都要花比较多的时间，现在就想着先自己把基本的环境搭起来，后续再慢慢学习具体的知识点。 在这过程中，我发现网上基本没找到三者一起配置的项目，更多的是其中两者一起使用。 现在其实还有一个基础问题没解决，就是怎么打成Jar包之后运行测试用例，网上找了一圈，暂"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://bearfly1990.github.io/img/bf/java.jpg"><meta property="article:published_time" content="2022-04-18T16:00:00.000Z"><meta property="article:modified_time" content="2022-04-19T17:21:55.608Z"><meta property="article:author" content="BF"><meta property="article:tag" content="java"><meta property="article:tag" content="springboot"><meta property="article:tag" content="TestNG"><meta property="article:tag" content="Cucumber"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/bf/java.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://bearfly1990.github.io/2022/04/19/2022/04/2020-04-19-workbench/"},"headline":"Basic Automation Workbench","image":["https://bearfly1990.github.io/img/bf/java.jpg"],"datePublished":"2022-04-18T16:00:00.000Z","dateModified":"2022-04-19T17:21:55.608Z","author":{"@type":"Person","name":"BF"},"publisher":{"@type":"Organization","name":"BF Blog","logo":{"@type":"ImageObject","url":"https://bearfly1990.github.io/img/favicon.ico"}},"description":"Overview之前接触的Automation的项目基于SpringBoot+TestNG+Cucumber+(Lombok)。 其中每一块想要熟悉都要花比较多的时间，现在就想着先自己把基本的环境搭起来，后续再慢慢学习具体的知识点。 在这过程中，我发现网上基本没找到三者一起配置的项目，更多的是其中两者一起使用。 现在其实还有一个基础问题没解决，就是怎么打成Jar包之后运行测试用例，网上找了一圈，暂"}</script><link rel="canonical" href="https://bearfly1990.github.io/2022/04/19/2022/04/2020-04-19-workbench/"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/favicon.ico" alt="BF Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/bearfly1990"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-04-18T16:00:00.000Z" title="2022/4/19 上午12:00:00">2022-04-19</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-04-19T17:21:55.608Z" title="2022/4/20 上午1:21:55">2022-04-20</time></span><span class="level-item"> BF </span><span class="level-item"><a class="link-muted" href="/categories/Diary/">Diary</a></span><span class="level-item">22 minutes read (About 3239 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">Basic Automation Workbench</h1><div class="content"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>之前接触的Automation的项目基于SpringBoot+TestNG+Cucumber+(Lombok)。</p>
<p>其中每一块想要熟悉都要花比较多的时间，现在就想着先自己把基本的环境搭起来，后续再慢慢学习具体的知识点。</p>
<p>在这过程中，我发现网上基本没找到三者一起配置的项目，更多的是其中两者一起使用。</p>
<p>现在其实还有一个基础问题没解决，就是怎么打成Jar包之后运行测试用例，网上找了一圈，暂时没有特别好的办法，主要问题是文件路径问题，可能需要自己写TestNG的执行类去做。</p>
<p>项目上传在这里：<br><a target="_blank" rel="noopener" href="https://github.com/bearfly1990/bf-workbench">https://github.com/bearfly1990/bf-workbench</a></p>
<span id="more"></span>

<h2 id="基本工具"><a href="#基本工具" class="headerlink" title="基本工具"></a>基本工具</h2><p>开发工具用的IDEA，搭建最基础的Maven项目。</p>
<p>主要用的库的版本为：</p>
<ul>
<li><code>Spring Boot 2.6.6</code></li>
<li><code>Cucumber 4.2.0</code></li>
<li><code>TestNG 6.14.3</code></li>
<li><code>Lombok 1.18.12</code></li>
</ul>
<p>项目结构如下：<br><img src="/img/post/2022/04/2022-04-19-workbench/project-structure.png" alt="project-structure"></p>
<h3 id="Banner-txt"><a href="#Banner-txt" class="headerlink" title="Banner.txt"></a>Banner.txt</h3><p>我们第一件事是准备自己的Banner。</p>
<p>可以用下面的网址去生成。<br><a target="_blank" rel="noopener" href="http://patorjk.com/software/taag/#p=display&amp;h=0&amp;v=1&amp;f=3D%20Diagonal&amp;t=Type%20Something%20">http://patorjk.com/software/taag/#p=display&amp;h=0&amp;v=1&amp;f=3D%20Diagonal&amp;t=Type%20Something%20</a></p>
<p>将<code>banner.txt</code>放在<code>src/main/resources/banner.txt</code>, 可以把很多系统的变量输出来看。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">************************************************************************************************</span><br><span class="line">    <span class="variable">$&#123;application.title&#125;</span> <span class="variable">$&#123;application.version&#125;</span></span><br><span class="line">    Base on Spring Boot <span class="variable">$&#123;spring-boot.version&#125;</span></span><br><span class="line">************************************************************************************************</span><br><span class="line">System.properties:</span><br><span class="line">-------------------------------------------------------------------------------------------------</span><br><span class="line">    java.specification.version                = <span class="variable">$&#123;java.specification.version&#125;</span></span><br><span class="line">    java.specification.vendor                 = <span class="variable">$&#123;java.specification.vendor&#125;</span></span><br><span class="line">    java.specification.name                   = <span class="variable">$&#123;java.specification.name&#125;</span></span><br><span class="line">    java.vm.specification.version             = <span class="variable">$&#123;java.vm.specification.version&#125;</span></span><br><span class="line">    java.vm.specification.vendor              = <span class="variable">$&#123;java.vm.specification.vendor&#125;</span></span><br><span class="line">    java.vm.specification.name                = <span class="variable">$&#123;java.vm.specification.name&#125;</span></span><br><span class="line">    java.home                                 = <span class="variable">$&#123;java.home&#125;</span></span><br><span class="line">    java.version                              = <span class="variable">$&#123;java.version&#125;</span></span><br><span class="line">    java.vendor                               = <span class="variable">$&#123;java.vendor&#125;</span></span><br><span class="line">    java.vendor.url                           = <span class="variable">$&#123;java.vendor.url&#125;</span></span><br><span class="line">    java.vm.version                           = <span class="variable">$&#123;java.vm.version&#125;</span></span><br><span class="line">    java.vm.vendor                            = <span class="variable">$&#123;java.vm.vendor&#125;</span></span><br><span class="line">    java.vm.name                              = <span class="variable">$&#123;java.vm.name&#125;</span></span><br><span class="line">    java.class.version                        = <span class="variable">$&#123;java.class.version&#125;</span></span><br><span class="line">    java.class.path                           = <span class="variable">$&#123;java.class.path&#125;</span></span><br><span class="line">    java.library.path                         = <span class="variable">$&#123;java.library.path&#125;</span></span><br><span class="line">    java.io.tmpdir                            = <span class="variable">$&#123;java.io.tmpdir&#125;</span></span><br><span class="line">    java.ext.dirs                             = <span class="variable">$&#123;java.ext.dirs&#125;</span></span><br><span class="line">    os.name                                   = <span class="variable">$&#123;os.name&#125;</span></span><br><span class="line">    os.arch                                   = <span class="variable">$&#123;os.arch&#125;</span></span><br><span class="line">    os.version                                = <span class="variable">$&#123;os.version&#125;</span></span><br><span class="line">    user.name                                 = <span class="variable">$&#123;user.name&#125;</span></span><br><span class="line">    user.home                                 = <span class="variable">$&#123;user.home&#125;</span></span><br><span class="line">    user.dir                                  = <span class="variable">$&#123;user.dir&#125;</span></span><br><span class="line"></span><br><span class="line">██████╗ ███████╗      ██╗    ██╗ ██████╗ ██████╗ ██╗  ██╗██████╗ ███████╗███╗   ██╗ ██████╗██╗  ██╗</span><br><span class="line">██╔══██╗██╔════╝      ██║    ██║██╔═══██╗██╔══██╗██║ ██╔╝██╔══██╗██╔════╝████╗  ██║██╔════╝██║  ██║</span><br><span class="line">██████╔╝█████╗  █████╗██║ █╗ ██║██║   ██║██████╔╝█████╔╝ ██████╔╝█████╗  ██╔██╗ ██║██║     ███████║</span><br><span class="line">██╔══██╗██╔══╝  ╚════╝██║███╗██║██║   ██║██╔══██╗██╔═██╗ ██╔══██╗██╔══╝  ██║╚██╗██║██║     ██╔══██║</span><br><span class="line">██████╔╝██║           ╚███╔███╔╝╚██████╔╝██║  ██║██║  ██╗██████╔╝███████╗██║ ╚████║╚██████╗██║  ██║</span><br><span class="line">╚═════╝ ╚═╝            ╚══╝╚══╝  ╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═╝╚═════╝ ╚══════╝╚═╝  ╚═══╝ ╚═════╝╚═╝  ╚═╝</span><br><span class="line">SpringBoot<span class="variable">$&#123;spring-boot.formatted-version&#125;</span></span><br><span class="line">====================================================================================================</span><br></pre></td></tr></table></figure>

<h3 id="application-properties"><a href="#application-properties" class="headerlink" title="application.properties"></a>application.properties</h3><p>基础配置文件使用的<code>properties</code>, 用<code>yaml</code>也行，不过一般<code>properties</code>更方便点。</p>
<p>按习惯除了主配置文件外，其它<code>profile</code>按<code>dev</code>,<code>qa</code>,<code>prod</code>来命名。</p>
<ul>
<li><code>application.properties</code></li>
<li><code>application-dev.properties</code></li>
<li><code>application-qa.properties</code></li>
<li><code>application-prod.properties</code></li>
</ul>
<p>在<code>application.properties</code>中默认激活<code>qa</code> profile, 并指定<code>log4j2</code>的配置文件，并可以开启<code>debug</code>模式，更多Spring Boot默认参数可以参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/j610152753/article/details/115714468">Springboot默认配置文件application.properties的常见配置属性</a></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.profiles.active</span>=<span class="string">qa</span></span><br><span class="line"><span class="meta">logging.config</span>=<span class="string">classpath:log4j2.xml</span></span><br><span class="line"><span class="comment">#debug=true</span></span><br></pre></td></tr></table></figure>

<p>这个时候<code>application-qa.properties</code>的参数就会被加载。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">env</span>=<span class="string">qa</span></span><br><span class="line"><span class="attr">client</span>=<span class="string">bf</span></span><br><span class="line"><span class="meta">server.port</span>=<span class="string">8080</span></span><br></pre></td></tr></table></figure>

<p>通过注解配置，Spring Boot就能把配置文件中的值映射到对象中，很方便。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.bearfly.demo.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.log4j.Log4j2;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Lazy;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.PropertySource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> bearfly1990</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/4/17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Log4j2</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@PropertySource(value=&quot;classpath:$&#123;env&#125;.$&#123;client&#125;/database.properties&quot;, ignoreResourceNotFound = false)</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;sqlserver.jdbc&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SQLServerDBConfigForTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String schema;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;env&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String env;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="log4j2-xml"><a href="#log4j2-xml" class="headerlink" title="log4j2.xml"></a>log4j2.xml</h3><p>下面是简单的<code>log4j2</code>的配置，主要指定了log输出的文件名。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">status</span>=<span class="string">&quot;WARN&quot;</span> <span class="attr">packages</span>=<span class="string">&quot;org.bearfly.framework.report&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appenders</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">&quot;Console&quot;</span> <span class="attr">target</span>=<span class="string">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;%d&#123;HH:mm:ss.SSS&#125; [%t] %-5level %logger&#123;36&#125; - %msg%n&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">File</span> <span class="attr">name</span>=<span class="string">&quot;FileLog&quot;</span> <span class="attr">fileName</span>=<span class="string">&quot;bf-workbench.log&quot;</span> <span class="attr">immediateFlush</span>=<span class="string">&quot;true&quot;</span> <span class="attr">append</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;%d&#123;HH:mm:ss.SSS&#125; [%t] %-5level %logger&#123;36&#125; - %msg%n&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">File</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appenders</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">loggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.springframework&quot;</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;Console&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FileLog&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>Spring Boot</code>默认使用的是<code>logback</code>，所以在<code>pom.xml</code>中添加<code>spring-boot-starter-log4j2</code>并剔除掉原来的<code>logback</code>依赖。</p>
<p>而上文的<code>application.properties</code>中显示指定<code>log4j2</code>配置文件的好处是，如果不小心在项目中加了<code>logback</code>的依赖，在启动Spring Boot的时候就会报错。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="SpringBoot-TestNG-Cucumber"><a href="#SpringBoot-TestNG-Cucumber" class="headerlink" title="SpringBoot + TestNG + Cucumber"></a>SpringBoot + TestNG + Cucumber</h3><p>为了支持TestNG和Cucumber,我们需要加入下面的依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.cucumber<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cucumber-junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;cucumber.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.cucumber<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cucumber-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;cucumber.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.cucumber<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cucumber-testng<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;cucumber.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们将TestNG的配置文件和Cucumber的Features文件放在<code>src/test/resources</code>下面<br><img src="/img/post/2022/04/2022-04-19-workbench/test-resources.png" alt="test-resources"></p>
<p>下面就是<code>testng-qa.xml</code>的内容，指定了测试类和报表监听类。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">suite</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;http://testng.org/testng-1.0.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">suite</span> <span class="attr">name</span>=<span class="string">&quot;BF-Workbench - QA&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">test</span> <span class="attr">name</span>=<span class="string">&quot;BF-Workbench QA&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">classes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">&quot;org.bearfly.demo.testscripts.TestScriptQA&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">classes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listeners</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener</span> <span class="attr">class-name</span>=<span class="string">&quot;org.bearfly.framework.test.report.BFExtentReportListener&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listeners</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">suite</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>而对应的TestScript类如下所示，主要指定了<code>Cucumber</code>的<code>Step Definition</code>类的位置，<code>Features</code>文件的位置,要运行的<code>Tag</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.bearfly.demo.testscripts;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cucumber.api.CucumberOptions;</span><br><span class="line"><span class="keyword">import</span> cucumber.api.junit.Cucumber;</span><br><span class="line"><span class="keyword">import</span> org.bearfly.framework.test.testscripts.TestScriptBase;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> bearfly1990</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/4/17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith(Cucumber.class)</span></span><br><span class="line"><span class="meta">@CucumberOptions(glue = &#123;&quot;org.bearfly.demo.stepdef&quot;, &quot;org.bearfly.framework.test.stepdef&quot;&#125;, plugin = &#123;</span></span><br><span class="line"><span class="meta">//        &quot;com.sqa.framework.report.ExtentHtmlReport:&quot;,</span></span><br><span class="line"><span class="meta">        &quot;html:target/cucumber&quot;,</span></span><br><span class="line"><span class="meta">        &quot;json:target/cucumber/test-report.json&quot;,</span></span><br><span class="line"><span class="meta">        &quot;pretty:target/cucumber/cucumber-pretty.txt&quot;,</span></span><br><span class="line"><span class="meta">        &quot;usage:target/cucumber/cucumber-usage.json&quot;,</span></span><br><span class="line"><span class="meta">        &quot;junit:target/cucumber/cucumber-results.xml&quot;&#125;,</span></span><br><span class="line"><span class="meta">        features = &#123;&quot;src/test/resources/features&quot;&#125;,</span></span><br><span class="line"><span class="meta">        tags = &#123;&quot;@Demo&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestScriptQA</span> <span class="keyword">extends</span> <span class="title">TestScriptBase</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>而这里的父类就是<code>TestScriptBase</code>就是TestNG和Cucumber一起work的关键，继承<code>cucumber.api.testng.AbstractTestNGCucumberTests</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.bearfly.framework.test.testscripts;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cucumber.api.testng.AbstractTestNGCucumberTests;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.log4j.Log4j2;</span><br><span class="line"><span class="keyword">import</span> org.bearfly.framework.constants.TestCaseConstants;</span><br><span class="line"><span class="keyword">import</span> org.bearfly.framework.util.DateUtil;</span><br><span class="line"><span class="keyword">import</span> org.bearfly.framework.util.ExtentReportUtil;</span><br><span class="line"><span class="keyword">import</span> org.testng.annotations.BeforeTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedHashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> bearfly1990</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/4/17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Log4j2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestScriptBase</span> <span class="keyword">extends</span> <span class="title">AbstractTestNGCucumberTests</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> String TEST_NAME = <span class="string">&quot;TEST_NAME&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeTest</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span></span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;TestScriptBase SETUP SETUP&quot;</span>);</span><br><span class="line">        LinkedHashMap&lt;String, String&gt; reportInfo = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line">        String testName = <span class="string">&quot;BF-Workbench-&quot;</span>+ DateUtil.getCurrentDateStr();</span><br><span class="line">        String reportPath = TestCaseConstants.REPORT_PATH + testName + File.separator +<span class="string">&quot;BF-Workbench-TestResult.html&quot;</span>;</span><br><span class="line">        ExtentReportUtil.initialExtentReport(reportPath);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>接下来为了和SpringBoot结合到一起，我们只要在其中一个Step Definiation 类上加上@SpringBootTest就可以了。</p>
<p>所以这个时候，我们可以创建一个这样的类，放在framework级别在glue扫描下的package里面就可以了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CucumberOptions(glue = &#123;&quot;org.bearfly.demo.stepdef&quot;, &quot;org.bearfly.framework.test.stepdef&quot;&#125;...)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.bearfly.demo.stepdef;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cucumber.api.java.en.Given;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.log4j.Log4j2;</span><br><span class="line"><span class="keyword">import</span> org.bearfly.demo.service.DemoService;</span><br><span class="line"><span class="keyword">import</span> org.bearfly.framework.test.stepdef.StepDefBase;</span><br><span class="line"><span class="keyword">import</span> org.bearfly.framework.util.DevUtil;</span><br><span class="line"><span class="keyword">import</span> org.bearfly.framework.util.SystemUtil;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> bearfly1990</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/4/17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Log4j2</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonStepDef</span> <span class="keyword">extends</span> <span class="title">StepDefBase</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DemoService demoService;</span><br><span class="line">    <span class="meta">@Given(&quot;Common Step&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">commonStep</span><span class="params">()</span></span>&#123;</span><br><span class="line">        log.info(DevUtil.traceStr(<span class="string">&quot;Common Step&quot;</span>));</span><br><span class="line">        System.out.println(demoService.queryDemoDB());</span><br><span class="line">        SystemUtil.sleep(<span class="number">0.1</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面是另外一个Step Defination类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.bearfly.demo.stepdef;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cucumber.api.Scenario;</span><br><span class="line"><span class="keyword">import</span> cucumber.api.java.en.Then;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.log4j.Log4j2;</span><br><span class="line"><span class="keyword">import</span> org.bearfly.framework.adapter.db.sqlserver.SQLServerAdapter;</span><br><span class="line"><span class="keyword">import</span> org.bearfly.framework.test.stepdef.StepDefBase;</span><br><span class="line"><span class="keyword">import</span> org.bearfly.framework.util.DevUtil;</span><br><span class="line"><span class="keyword">import</span> org.bearfly.framework.util.SystemUtil;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.testng.Assert;</span><br><span class="line"><span class="keyword">import</span> org.testng.Reporter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> bearfly1990</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/4/17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Log4j2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> <span class="keyword">extends</span> <span class="title">StepDefBase</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">protected</span> SQLServerAdapter sqlServerAdapter;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeScenario</span><span class="params">(Scenario scenario)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.beforeEachScenario(scenario);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Then(&quot;Run step1 &#123;word&#125; and &#123;word&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runStep1</span><span class="params">(String username, String password)</span></span>&#123;</span><br><span class="line">        log.info(DevUtil.traceStr(<span class="string">&quot;Run step1&quot;</span>));</span><br><span class="line">        log.info(DevUtil.traceStr(username,password));</span><br><span class="line">        Reporter.log(<span class="string">&quot;正在执行testCase1&quot;</span>,<span class="keyword">true</span>);</span><br><span class="line">        Assert.assertTrue(<span class="keyword">true</span>);</span><br><span class="line">        SystemUtil.sleep(<span class="number">0.1</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Then(&quot;Run step2 (.*)&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runStep2</span><span class="params">(String fileName)</span></span>&#123;</span><br><span class="line">        log.info(DevUtil.traceStr(<span class="string">&quot;Run step2&quot;</span>));</span><br><span class="line">        log.info(fileName);</span><br><span class="line">        SystemUtil.sleep(<span class="number">0.1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Extent-Reports"><a href="#Extent-Reports" class="headerlink" title="Extent Reports"></a>Extent Reports</h3><p>上文中提到了在<code>TestNG</code>的配置文件中加了报表监听类<code>BFExtentReportListener</code>,利用<code>ExtentReport</code>提供的接口，用来自定义报表的样式。</p>
<p>我们常见的除了<code>ExtentReport</code>还有<code>Allure2</code>, <code>Allure2</code>之前在使用<code>pytest</code>测试的时候用过，感觉还不错。</p>
<p>这里如果想要使用<code>ExtentReport</code>，就先加入依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aventstack<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>extentreports-cucumber4-adapter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cucumber-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.cucumber<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>具体的实现类目前是我从网上找的简单改了一下，后期可以换别的方式，并想办法把log一起写到report中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.bearfly.framework.test.report;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.aventstack.extentreports.ExtentReports;</span><br><span class="line"><span class="keyword">import</span> com.aventstack.extentreports.ExtentTest;</span><br><span class="line"><span class="keyword">import</span> com.aventstack.extentreports.Status;</span><br><span class="line"><span class="keyword">import</span> com.aventstack.extentreports.model.TestAttribute;</span><br><span class="line"><span class="keyword">import</span> com.aventstack.extentreports.reporter.ExtentHtmlReporter;</span><br><span class="line"><span class="keyword">import</span> com.aventstack.extentreports.reporter.configuration.ResourceCDN;</span><br><span class="line"><span class="keyword">import</span> org.testng.*;</span><br><span class="line"><span class="keyword">import</span> org.testng.xml.XmlSuite;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BFExtentReportListener</span> <span class="keyword">implements</span> <span class="title">IReporter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String OUTPUT_FOLDER = <span class="string">&quot;test-output/&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String FILE_NAME = <span class="string">&quot;report.html&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ExtentReports extent;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">generateReport</span><span class="params">(List&lt;XmlSuite&gt; xmlSuites, List&lt;ISuite&gt; suites, String outputDirectory)</span> </span>&#123;</span><br><span class="line">        init();</span><br><span class="line">        <span class="keyword">boolean</span> createSuiteNode = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (suites.size() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            createSuiteNode = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (ISuite suite : suites) &#123;</span><br><span class="line">            Map&lt;String, ISuiteResult&gt; result = suite.getResults();</span><br><span class="line">            <span class="comment">// 如果suite里面没有任何用例，直接跳过，不在报告里生成</span></span><br><span class="line">            <span class="keyword">if</span> (result.size() == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 统计suite下的成功、失败、跳过的总用例数</span></span><br><span class="line">            <span class="keyword">int</span> suiteFailSize = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">int</span> suitePassSize = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">int</span> suiteSkipSize = <span class="number">0</span>;</span><br><span class="line">            ExtentTest suiteTest = <span class="keyword">null</span>;</span><br><span class="line">            <span class="comment">// 存在多个suite的情况下，在报告中将同一个一个suite的测试结果归为一类，创建一级节点。</span></span><br><span class="line">            <span class="keyword">if</span> (createSuiteNode) &#123;</span><br><span class="line">                suiteTest = extent.createTest(suite.getName()).assignCategory(suite.getName());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">boolean</span> createSuiteResultNode = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (result.size() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                createSuiteResultNode = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (ISuiteResult r : result.values()) &#123;</span><br><span class="line">                ExtentTest resultNode;</span><br><span class="line">                ITestContext context = r.getTestContext();</span><br><span class="line">                <span class="keyword">if</span> (createSuiteResultNode) &#123;</span><br><span class="line">                    <span class="comment">// 没有创建suite的情况下，将在SuiteResult的创建为一级节点，否则创建为suite的一个子节点。</span></span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">null</span> == suiteTest) &#123;</span><br><span class="line">                        resultNode = extent.createTest(r.getTestContext().getName());</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        resultNode = suiteTest.createNode(r.getTestContext().getName());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    resultNode = suiteTest;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (resultNode != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    resultNode.getModel().setName(suite.getName() + <span class="string">&quot; : &quot;</span> + r.getTestContext().getName());</span><br><span class="line">                    <span class="keyword">if</span> (resultNode.getModel().hasCategory()) &#123;</span><br><span class="line">                        resultNode.assignCategory(r.getTestContext().getName());</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        resultNode.assignCategory(suite.getName(), r.getTestContext().getName());</span><br><span class="line">                    &#125;</span><br><span class="line">                    resultNode.getModel().setStartTime(r.getTestContext().getStartDate());</span><br><span class="line">                    resultNode.getModel().setEndTime(r.getTestContext().getEndDate());</span><br><span class="line">                    <span class="comment">// 统计SuiteResult下的数据</span></span><br><span class="line">                    <span class="keyword">int</span> passSize = r.getTestContext().getPassedTests().size();</span><br><span class="line">                    <span class="keyword">int</span> failSize = r.getTestContext().getFailedTests().size();</span><br><span class="line">                    <span class="keyword">int</span> skipSize = r.getTestContext().getSkippedTests().size();</span><br><span class="line">                    suitePassSize += passSize;</span><br><span class="line">                    suiteFailSize += failSize;</span><br><span class="line">                    suiteSkipSize += skipSize;</span><br><span class="line">                    <span class="keyword">if</span> (failSize &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                        resultNode.getModel().setStatus(Status.FAIL);</span><br><span class="line">                    &#125;</span><br><span class="line">                    resultNode.getModel().setDescription(</span><br><span class="line">                            String.format(<span class="string">&quot;Pass: %s ; Fail: %s ; Skip: %s ;&quot;</span>, passSize, failSize, skipSize));</span><br><span class="line">                &#125;</span><br><span class="line">                buildTestNodes(resultNode, context.getFailedTests(), Status.FAIL);</span><br><span class="line">                buildTestNodes(resultNode, context.getSkippedTests(), Status.SKIP);</span><br><span class="line">                buildTestNodes(resultNode, context.getPassedTests(), Status.PASS);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (suiteTest != <span class="keyword">null</span>) &#123;</span><br><span class="line">                suiteTest.getModel().setDescription(</span><br><span class="line">                        String.format(<span class="string">&quot;Pass: %s ; Fail: %s ; Skip: %s ;&quot;</span>, suitePassSize, suiteFailSize, suiteSkipSize));</span><br><span class="line">                <span class="keyword">if</span> (suiteFailSize &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    suiteTest.getModel().setStatus(Status.FAIL);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// for (String s : Reporter.getOutput()) &#123;</span></span><br><span class="line">        <span class="comment">// extent.setTestRunnerOutput(s);</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">        extent.flush();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 文件夹不存在的话进行创建</span></span><br><span class="line">        File reportDir = <span class="keyword">new</span> File(OUTPUT_FOLDER);</span><br><span class="line">        <span class="keyword">if</span> (!reportDir.exists() &amp;&amp; !reportDir.isDirectory()) &#123;</span><br><span class="line">            reportDir.mkdir();</span><br><span class="line">        &#125;</span><br><span class="line">        ExtentHtmlReporter htmlReporter = <span class="keyword">new</span> ExtentHtmlReporter(System.getProperty(<span class="string">&quot;extent.reporter.html.out&quot;</span>));</span><br><span class="line">        <span class="comment">// 设置静态文件的DNS</span></span><br><span class="line">        <span class="comment">//怎么样解决cdn.rawgit.com访问不了的情况</span></span><br><span class="line">        htmlReporter.config().setResourceCDN(ResourceCDN.EXTENTREPORTS);</span><br><span class="line">        htmlReporter.config().setDocumentTitle(<span class="string">&quot;BF-Workbench Report&quot;</span>);</span><br><span class="line">        htmlReporter.config().setReportName(<span class="string">&quot;BF-Workbench Report&quot;</span>);</span><br><span class="line"><span class="comment">//        htmlReporter.config().setChartVisibilityOnOpen(true);</span></span><br><span class="line"><span class="comment">//        报表位置</span></span><br><span class="line"><span class="comment">//        htmlReporter.config().setTestViewChartLocation(ChartLocation.TOP);</span></span><br><span class="line">        <span class="comment">// htmlReporter.config().setTheme(Theme.STANDARD);</span></span><br><span class="line">        htmlReporter.config().setCSS(<span class="string">&quot;.node.level-1  ul&#123; display:none;&#125; .node.level-1.active ul&#123;display:block;&#125;&quot;</span>);</span><br><span class="line">        extent = <span class="keyword">new</span> ExtentReports();</span><br><span class="line">        extent.attachReporter(htmlReporter);</span><br><span class="line">        extent.setReportUsesManualConfiguration(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">buildTestNodes</span><span class="params">(ExtentTest extenttest, IResultMap tests, Status status)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 存在父节点时，获取父节点的标签</span></span><br><span class="line">        String[] categories = <span class="keyword">new</span> String[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> (extenttest != <span class="keyword">null</span>) &#123;</span><br><span class="line">            List&lt;TestAttribute&gt; categoryList = extenttest.getModel().getCategoryContext().getAll();</span><br><span class="line">            categories = <span class="keyword">new</span> String[categoryList.size()];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; categoryList.size(); index++) &#123;</span><br><span class="line">                categories[index] = categoryList.get(index).getName();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ExtentTest test;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (tests.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 调整用例排序，按时间排序</span></span><br><span class="line">            Set&lt;ITestResult&gt; treeSet = <span class="keyword">new</span> TreeSet&lt;ITestResult&gt;(<span class="keyword">new</span> Comparator&lt;ITestResult&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(ITestResult o1, ITestResult o2)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> o1.getStartMillis() &lt; o2.getStartMillis() ? -<span class="number">1</span> : <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            treeSet.addAll(tests.getAllResults());</span><br><span class="line">            <span class="keyword">for</span> (ITestResult result : treeSet) &#123;</span><br><span class="line">                Object[] parameters = result.getParameters();</span><br><span class="line">                String name = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                <span class="comment">// 如果有参数，则使用参数的toString组合代替报告中的name</span></span><br><span class="line">                <span class="keyword">for</span> (Object param : parameters) &#123;</span><br><span class="line">                    name += param.toString();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (name.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (name.length() &gt; <span class="number">50</span>) &#123;</span><br><span class="line">                        name = name.substring(<span class="number">0</span>, <span class="number">49</span>) + <span class="string">&quot;...&quot;</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    name = result.getMethod().getMethodName();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (extenttest == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    test = extent.createTest(name);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 作为子节点进行创建时，设置同父节点的标签一致，便于报告检索。</span></span><br><span class="line">                    test = extenttest.createNode(name).assignCategory(categories);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// test.getModel().setDescription(description.toString());</span></span><br><span class="line">                <span class="comment">// test = extent.createTest(result.getMethod().getMethodName());</span></span><br><span class="line">                <span class="keyword">for</span> (String group : result.getMethod().getGroups()) &#123;</span><br><span class="line">                    test.assignCategory(group);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                List&lt;String&gt; outputList = Reporter.getOutput(result);</span><br><span class="line">                <span class="keyword">for</span> (String output : outputList) &#123;</span><br><span class="line">                    <span class="comment">// 将用例的log输出报告中</span></span><br><span class="line">                    test.debug(output);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (result.getThrowable() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    test.log(status, result.getThrowable());</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    test.log(status, <span class="string">&quot;Test &quot;</span> + status.toString().toLowerCase() + <span class="string">&quot;ed&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                test.getModel().setStartTime(getTime(result.getStartMillis()));</span><br><span class="line">                test.getModel().setEndTime(getTime(result.getEndMillis()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Date <span class="title">getTime</span><span class="params">(<span class="keyword">long</span> millis)</span> </span>&#123;</span><br><span class="line">        Calendar calendar = Calendar.getInstance();</span><br><span class="line">        calendar.setTimeInMillis(millis);</span><br><span class="line">        <span class="keyword">return</span> calendar.getTime();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那现在要在报表中体现出来Log，暂时只能通过<code>org.testng.Assert</code>和 <code>org.testng.Reporter</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Then(&quot;Run step1 &#123;word&#125; and &#123;word&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runStep1</span><span class="params">(String username, String password)</span></span>&#123;</span><br><span class="line">    log.info(DevUtil.traceStr(<span class="string">&quot;Run step1&quot;</span>));</span><br><span class="line">    log.info(DevUtil.traceStr(username,password));</span><br><span class="line">    Reporter.log(<span class="string">&quot;正在执行testCase1&quot;</span>,<span class="keyword">true</span>);</span><br><span class="line">    Assert.assertTrue(<span class="keyword">true</span>);</span><br><span class="line">    SystemUtil.sleep(<span class="number">0.1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>报表输出也是比较简单：</p>
<p><img src="/img/post/2022/04/2022-04-19-workbench/test-report.png" alt="project-structure"></p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>不管是<code>Spring Boot</code>还是<code>TestNG</code>, <code>Cucumber</code>，各自的内容都很丰富，想了解深入还是要花很多时间。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="http://c.biancheng.net/spring_boot/">Spring Boot框架入门教程（快速学习版）</a>。</li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/28af813ea322">[TestNG]Spring/Spring Boot+Maven+TestNG整合</a>。</li>
<li>and so on</li>
</ul>
</div><div class="article-licensing box"><div class="licensing-title"><p>Basic Automation Workbench</p><p><a href="https://bearfly1990.github.io/2022/04/19/2022/04/2020-04-19-workbench/">https://bearfly1990.github.io/2022/04/19/2022/04/2020-04-19-workbench/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>BF</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2022-04-19</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2022-04-20</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/java/">java</a><a class="link-muted mr-2" rel="tag" href="/tags/springboot/">springboot</a><a class="link-muted mr-2" rel="tag" href="/tags/TestNG/">TestNG</a><a class="link-muted mr-2" rel="tag" href="/tags/Cucumber/">Cucumber</a></div><div class="sharethis-inline-share-buttons"></div><script src="http://localhost:4000" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2022/04/12/2022/04/2022-04-12-lombok-usage/"><span class="level-item">Lombok</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/mybear.jpg" alt="bearfly1990"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">bearfly1990</p><p class="is-size-6 is-block">有熊在飞</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>HZ, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">95</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">5</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">118</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/bearfly1990" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/bearfly1990"><i class="fab fa-github"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Overview"><span class="level-left"><span class="level-item">1</span><span class="level-item">Overview</span></span></a></li><li><a class="level is-mobile" href="#基本工具"><span class="level-left"><span class="level-item">2</span><span class="level-item">基本工具</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Banner-txt"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">Banner.txt</span></span></a></li><li><a class="level is-mobile" href="#application-properties"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">application.properties</span></span></a></li><li><a class="level is-mobile" href="#log4j2-xml"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">log4j2.xml</span></span></a></li><li><a class="level is-mobile" href="#SpringBoot-TestNG-Cucumber"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">SpringBoot + TestNG + Cucumber</span></span></a></li><li><a class="level is-mobile" href="#Extent-Reports"><span class="level-left"><span class="level-item">2.5</span><span class="level-item">Extent Reports</span></span></a></li></ul></li><li><a class="level is-mobile" href="#最后"><span class="level-left"><span class="level-item">3</span><span class="level-item">最后</span></span></a></li><li><a class="level is-mobile" href="#参考"><span class="level-left"><span class="level-item">4</span><span class="level-item">参考</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/favicon.ico" alt="BF Blog" height="28"></a><p class="is-size-7"><span>&copy; 2022 BF</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>