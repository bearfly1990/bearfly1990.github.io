<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Shawn&#039;Blog Test</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Shawn&#039;Blog Test"><meta name="msapplication-TileImage" content="/img/favicon.ico"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Shawn&#039;Blog Test"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Shawn&#039;Blog Test"><meta property="og:url" content="https://bearfly1990.github.io/"><meta property="og:site_name" content="Shawn&#039;Blog Test"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://bearfly1990.github.io/img/og_image.png"><meta property="article:author" content="Shawn"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://bearfly1990.github.io"},"headline":"Shawn'Blog Test","image":["https://bearfly1990.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Shawn"},"description":""}</script><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/favicon.ico" alt="Shawn&#039;Blog Test" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item is-active" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/bearfly1990"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-08-11T16:00:00.000Z" title="2021/8/12 上午12:00:00">2021-08-12</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-08-25T13:31:40.136Z" title="2021/8/25 下午9:31:40">2021-08-25</time></span><span class="level-item"> BF </span><span class="level-item">11 minutes read (About 1640 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/08/12/2021/08/2021-08-12-box-python-sdk/">box SDK for python</a></h1><div class="content"><h3 id="Box"><a href="#Box" class="headerlink" title="Box"></a>Box</h3><p>Box (<a target="_blank" rel="noopener" href="http://www.box.com/">http://www.box.com</a>) 是公司在用的网盘工具，是平时保存分享资料的重要地方。最近参与的项目客户会把文件放在网盘中，给我们发送网盘路径，让我们自己去取，这里就涉及到权限的问题。今天主要试了一下用box-sdk-python的方式去上传和下载文件。</p>
<blockquote>
<p>Note:今天访问的一些资源可能需要大家自己会科学上网。</p>
</blockquote>
<h3 id="Box-App-配置"><a href="#Box-App-配置" class="headerlink" title="Box App 配置"></a>Box App 配置</h3><p>最后代码的使用比较简单，主要是前面的一些配置需要知道一下。</p>
<p>首先要注册并登录box账号，默认的10G空间大小足够了。</p>
<p>进入到网盘后，点击左下脚的 <code>Dev Console</code><br><img src="/img/post/2021/08/box-main.png" alt="box-main"></p>
<p>这里可以新建<code>App</code>，到时候就是一个独立的文件存储的空间<br><img src="/img/post/2021/08/box-create-new-app.png" alt="box-create-new-app"></p>
<p>选择<code>Custom App</code><br><img src="/img/post/2021/08/box-create-custom-app.png" alt="box-create-custom-app"></p>
<p>再选择<code>JWT</code>方式并输出App Name<br><img src="/img/post/2021/08/box-create-custom-app-jwt.png" alt="box-create-custom-app-jwt"></p>
<p>然后在<code>Configuration</code>tab我们就能看到很多Credentials验证的信息</p>
<p>需要的一些权限要勾上<br><img src="/img/post/2021/08/box-config-access.png"><br>主要点击下面的<code>Generate a Public/Private Keypair</code>，就会在生成密钥，并下载相关配置的json文件。</p>
<blockquote>
<p>注意: 第一次用的时候需要你开启双重验证，需要手机下载<strong>Authenticator</strong> 在提示的另一个页面扫描二维码把动态口令牌导入你的手机，后面一些重要的操作都需要输入。</p>
</blockquote>
<p><img src="/img/post/2021/08/box-generate-private-public-keypair.png" alt="box-generate-private-public-keypair"><br><img src="/img/post/2021/08/box-json-config-alert.png" alt="box-json-config-alert"><br><img src="/img/post/2021/08/box-public-key.png" alt="box-public-key"><br><img src="/img/post/2021/08/box-json-config.png" alt="box-json-config.png"></p>
<p>下面是json 配置文件的信息，一会儿连接的时候需要用到的信息都在里面。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;boxAppSettings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;clientID&quot;</span>: <span class="string">&quot;r76ashyr9ehltsuq8mfbtbxml1ugzqxb&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;clientSecret&quot;</span>: <span class="string">&quot;WK0Sp3T1Hvb8hVvFYScY2JSolLfIjHSi&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;appAuth&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;publicKeyID&quot;</span>: <span class="string">&quot;4885s2em&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;privateKey&quot;</span>: <span class="string">&quot;-----BEGIN ENCRYPTED PRIVATE KEY-----\nMIIFDjBABgkqhkiG9w0BBQ0wMzAbBgkqhkiG9w0BBQwwDgQIBQLozbR/T3oCAggA\nMBQGCCqGSIb3DQMHBAgbdNCj60pETwSCBMjTF6vr+mqyEeSoy/x9RtRQbIBUYZnT\n6OHkeIgnQAZbs4VADyWitrbasEOQSD5OLfk0TFYtN/O4RQ6pj/dirwrWYCXyvB8x\nPfZ+MjzY2vAJbJle5L7dT6Eq3eZLzbluZ6IsD+KenwTpK4iZcWqgRIjTJpKOgfOl\nmP8R0KH+vnADXllnhaAQIUnbe9fsg+sM58rciFvOGxb7slyF/xecZ8vhMH6RTDA6\nhwC+8HtF76lZ0tZ7Lqo1ZMn3tasrEBIGhFnPDzNG0lFVzxUWfyhf61WSWcirMwV5\nLqt2ZPiLl5wKlVHtAjLQw8ylfv9kDRhIlPTLUr50tdfP9rxGq2yrwjr9ksoTUw9k\nK48vcp1j2nW5ekDwmhRwYbEu/hkg4t26msuOAEKiHtv2lpiEJyORinbIWJhM6BDO\nJvr1EgAStz3WgOoVIXjm99w0LaLa8TexR+wH6bmxWR7GaEgISlxqEhDxsPfg9yZl\noH/3ab81uAxWKUU9D/JaYlc6MN5D0OKFlJZll9Zfd/yIvU5fTYoAzNC/VmKcXqWz\nGIj7Y6bzB7U9glsAVGkwlrN5ReI7SZb6pisDWvNyJcSZUsjOyKFcNwMWZccdKFy+\nMg4FT/KxCtIWP+S46kkBy0RWpxKGgqtNUi/LVbw9S9GqDDrvICJiwKKQ6EGvy+8f\nCdluDENzMBQvsY9CfoYBpbNbACSxhyEePHqitOYsVucVaTtxPyPD5CYU7ZeB5XBk\nN0Ygq33jS3Exnp3b5eEArLm14L/ajmpitizhtuRIhHkHLeuP1bXGwq2ZofD4wSY9\nQw7u6uN+v6q8qRccZODSip6WsYcNzlF7E4C8Ubk7om1sniXN3Y8cPpitp8zClWun\nnQKroK9rUyw7mVTYEse8syeL/pMvSwXnkmWtppr2mMuCZ3R2MAzXLkaIMnk0yPuf\n70J9rnYOV+l3npyeGcVz0C+rograaXMaYH3ZdSe6vIJqISfibzowCzJuZDAkJCl7\nCbt5lWEAm4dhSTwYDjdA2putodh22olgFbcsm7VMOcs3+N/eQQ501NzAYlVLFgfK\n9LLtNVySjuEOaH4xSzdnIjUIquHZMlVjivxyeG+z6EdVNUYYXapzwo66al2IDu0e\nHBF+qE59MbJyZW6l7HeLOhPtB8+LqJ46h8ngSy0clCep6VNvCAcxVGGBeVx2TrGr\nwxUs/MSgONArAB+D/zA8IR/o9+uIPkJWVvImAEc9oGNxfmzPnzpS7756gHe3+Oqt\nttgxGP0Jlf0iPvaU1NDM/cJxw0kliwOad50+9QdufuZTuvxEbejxibwLNir/U3NB\n9sRFpdvOu+U3UocmfYy8jXdGTVWczk6vk/vB9WHnARTctPLAwuLyFo2jVZgjb5u3\nDzoYH7jNseI8s/vz/M0KUTt1dhNM0/nCdkXia7CAeC9L671Z5OaTUawuyvYqsrJt\nqOfHdOUraXaE9pESThjF9G5qlqZwuQlHv2sRpwTOOxrqFWveOWGEeIC8YaGYgidi\nX3f2lNY8BozAueANEwwYIkTeU7MMQ3diCC84J1+lk93DmeIrqfHRjap9Lu6ckF2a\nYITCOdpMT23GfJcRTT2MfW5Sy5nY2S2uh2L6zJwLWi/hO5xoRWEMwhvJC91mQmMq\neJs=\n-----END ENCRYPTED PRIVATE KEY-----\n&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;passphrase&quot;</span>: <span class="string">&quot;e95a0532aeccf28116ee3be84761297d&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;enterpriseID&quot;</span>: <span class="string">&quot;836874028&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面还有最重要的一步，需要开放这个App的访问权限，不然也还是没有办法使用。<br><img src="/img/post/2021/08/box-app-authorization-tab.png"><br><img src="/img/post/2021/08/box-app-authorization-submit.png"></p>
<p>在提交了请求之后，注册的邮件中就能收到request<br><img src="/img/post/2021/08/box-app-authorization-email.png"><br>点击<code>Review App</code>之后，就跳转到Review页面，点击<code>Authorize</code><br><img src="/img/post/2021/08/box-app-authorization-review.png"><br>再回到TestDemo就是Enable的状态了。<br><img src="/img/post/2021/08/box-app-authorization-enabled.png"></p>
<h3 id="Box-SDK-Python"><a href="#Box-SDK-Python" class="headerlink" title="Box SDK Python"></a>Box SDK Python</h3><p>Box为各种语言都提供了访问的SDK API，python的话有<a target="_blank" rel="noopener" href="https://github.com/box/box-python-sdk">box-python-sdk</a></p>
<p>这里有文档详细的说明了怎么操作网盘<br><a target="_blank" rel="noopener" href="https://github.com/box/box-python-sdk/tree/main/docs/usage">https://github.com/box/box-python-sdk/tree/main/docs/usage</a></p>
<p>下面是主要的简单演示:</p>
<p>我们首先要把json中的rsa private key单独放<code>.pem</code>文件中e.g.rsa_private_key.cxdemo.pem</p>
<blockquote>
<p>注意：这里需要把json文件中的\n字符串替换成真正的换行符。</p>
</blockquote>
<p>如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN ENCRYPTED PRIVATE KEY-----</span><br><span class="line">MIIFDjBABgkqhkiG9w0BBQ0wMzAbBgkqhkiG9w0BBQwwDgQIBQLozbR&#x2F;T3oCAggA</span><br><span class="line">MBQGCCqGSIb3DQMHBAgbdNCj60pETwSCBMjTF6vr+mqyEeSoy&#x2F;x9RtRQbIBUYZnT</span><br><span class="line">6OHkeIgnQAZbs4VADyWitrbasEOQSD5OLfk0TFYtN&#x2F;O4RQ6pj&#x2F;dirwrWYCXyvB8x</span><br><span class="line">PfZ+MjzY2vAJbJle5L7dT6Eq3eZLzbluZ6IsD+KenwTpK4iZcWqgRIjTJpKOgfOl</span><br><span class="line">mP8R0KH+vnADXllnhaAQIUnbe9fsg+sM58rciFvOGxb7slyF&#x2F;xecZ8vhMH6RTDA6</span><br><span class="line">hwC+8HtF76lZ0tZ7Lqo1ZMn3tasrEBIGhFnPDzNG0lFVzxUWfyhf61WSWcirMwV5</span><br><span class="line">Lqt2ZPiLl5wKlVHtAjLQw8ylfv9kDRhIlPTLUr50tdfP9rxGq2yrwjr9ksoTUw9k</span><br><span class="line">K48vcp1j2nW5ekDwmhRwYbEu&#x2F;hkg4t26msuOAEKiHtv2lpiEJyORinbIWJhM6BDO</span><br><span class="line">Jvr1EgAStz3WgOoVIXjm99w0LaLa8TexR+wH6bmxWR7GaEgISlxqEhDxsPfg9yZl</span><br><span class="line">oH&#x2F;3ab81uAxWKUU9D&#x2F;JaYlc6MN5D0OKFlJZll9Zfd&#x2F;yIvU5fTYoAzNC&#x2F;VmKcXqWz</span><br><span class="line">GIj7Y6bzB7U9glsAVGkwlrN5ReI7SZb6pisDWvNyJcSZUsjOyKFcNwMWZccdKFy+</span><br><span class="line">Mg4FT&#x2F;KxCtIWP+S46kkBy0RWpxKGgqtNUi&#x2F;LVbw9S9GqDDrvICJiwKKQ6EGvy+8f</span><br><span class="line">CdluDENzMBQvsY9CfoYBpbNbACSxhyEePHqitOYsVucVaTtxPyPD5CYU7ZeB5XBk</span><br><span class="line">N0Ygq33jS3Exnp3b5eEArLm14L&#x2F;ajmpitizhtuRIhHkHLeuP1bXGwq2ZofD4wSY9</span><br><span class="line">Qw7u6uN+v6q8qRccZODSip6WsYcNzlF7E4C8Ubk7om1sniXN3Y8cPpitp8zClWun</span><br><span class="line">nQKroK9rUyw7mVTYEse8syeL&#x2F;pMvSwXnkmWtppr2mMuCZ3R2MAzXLkaIMnk0yPuf</span><br><span class="line">70J9rnYOV+l3npyeGcVz0C+rograaXMaYH3ZdSe6vIJqISfibzowCzJuZDAkJCl7</span><br><span class="line">Cbt5lWEAm4dhSTwYDjdA2putodh22olgFbcsm7VMOcs3+N&#x2F;eQQ501NzAYlVLFgfK</span><br><span class="line">9LLtNVySjuEOaH4xSzdnIjUIquHZMlVjivxyeG+z6EdVNUYYXapzwo66al2IDu0e</span><br><span class="line">HBF+qE59MbJyZW6l7HeLOhPtB8+LqJ46h8ngSy0clCep6VNvCAcxVGGBeVx2TrGr</span><br><span class="line">wxUs&#x2F;MSgONArAB+D&#x2F;zA8IR&#x2F;o9+uIPkJWVvImAEc9oGNxfmzPnzpS7756gHe3+Oqt</span><br><span class="line">ttgxGP0Jlf0iPvaU1NDM&#x2F;cJxw0kliwOad50+9QdufuZTuvxEbejxibwLNir&#x2F;U3NB</span><br><span class="line">9sRFpdvOu+U3UocmfYy8jXdGTVWczk6vk&#x2F;vB9WHnARTctPLAwuLyFo2jVZgjb5u3</span><br><span class="line">DzoYH7jNseI8s&#x2F;vz&#x2F;M0KUTt1dhNM0&#x2F;nCdkXia7CAeC9L671Z5OaTUawuyvYqsrJt</span><br><span class="line">qOfHdOUraXaE9pESThjF9G5qlqZwuQlHv2sRpwTOOxrqFWveOWGEeIC8YaGYgidi</span><br><span class="line">X3f2lNY8BozAueANEwwYIkTeU7MMQ3diCC84J1+lk93DmeIrqfHRjap9Lu6ckF2a</span><br><span class="line">YITCOdpMT23GfJcRTT2MfW5Sy5nY2S2uh2L6zJwLWi&#x2F;hO5xoRWEMwhvJC91mQmMq</span><br><span class="line">eJs&#x3D;</span><br><span class="line">-----END ENCRYPTED PRIVATE KEY-----</span><br></pre></td></tr></table></figure>

<p>然后读取json中的配置，创建client.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> boxsdk <span class="keyword">import</span> JWTAuth</span><br><span class="line"><span class="keyword">from</span> boxsdk <span class="keyword">import</span> Client</span><br><span class="line"></span><br><span class="line">json_file = <span class="built_in">open</span> (<span class="string">&#x27;836874028_4885s2em_config.json&#x27;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">config = json.load(json_file)</span><br><span class="line"></span><br><span class="line"><span class="comment">#param2不能少，这里可以拿到临时的token，虽然这里我们用不到。</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">your_store_tokens_callback_method</span>(<span class="params">token, param2</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(token)</span><br><span class="line"></span><br><span class="line">auth = JWTAuth(</span><br><span class="line">    client_id=config[<span class="string">&#x27;boxAppSettings&#x27;</span>][<span class="string">&#x27;clientID&#x27;</span>],</span><br><span class="line">    client_secret=config[<span class="string">&#x27;boxAppSettings&#x27;</span>][<span class="string">&#x27;clientSecret&#x27;</span>],</span><br><span class="line">    enterprise_id=config[<span class="string">&#x27;enterpriseID&#x27;</span>],</span><br><span class="line">    jwt_key_id=config[<span class="string">&#x27;boxAppSettings&#x27;</span>][<span class="string">&#x27;appAuth&#x27;</span>][<span class="string">&#x27;publicKeyID&#x27;</span>],</span><br><span class="line">    rsa_private_key_file_sys_path=<span class="string">&#x27;rsa_private_key.cxdemo.pem&#x27;</span>,</span><br><span class="line">    rsa_private_key_passphrase=config[<span class="string">&#x27;boxAppSettings&#x27;</span>][<span class="string">&#x27;appAuth&#x27;</span>][<span class="string">&#x27;passphrase&#x27;</span>],</span><br><span class="line">    store_tokens=your_store_tokens_callback_method,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">access_token = auth.authenticate_instance()</span><br><span class="line">client = Client(auth)</span><br></pre></td></tr></table></figure>

<p>使用<code>client</code>就可以做许多操作了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">root_folder = client.root_folder().get()</span><br><span class="line">subfolder = root_folder.create_subfolder(<span class="string">&#x27;Test&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Created subfolder with ID &#123;0&#125;&#x27;</span>.<span class="built_in">format</span>(subfolder.<span class="built_in">id</span>))</span><br><span class="line"><span class="comment"># subfolder = client.folder(&#x27;0&#x27;).create_subfolder(&#x27;Test&#x27;)</span></span><br><span class="line">subfolder = root_folder.create_subfolder(<span class="string">&#x27;Test2&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Created subfolder with ID &#123;0&#125;&#x27;</span>.<span class="built_in">format</span>(subfolder.<span class="built_in">id</span>))</span><br><span class="line"></span><br><span class="line">subfolder = root_folder.create_subfolder(<span class="string">&#x27;Test3&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Created subfolder with ID &#123;0&#125;&#x27;</span>.<span class="built_in">format</span>(subfolder.<span class="built_in">id</span>))</span><br><span class="line"></span><br><span class="line">client.folder(folder_id=<span class="string">f&#x27;<span class="subst">&#123;subfolder.<span class="built_in">id</span>&#125;</span>&#x27;</span>).delete()</span><br><span class="line"></span><br><span class="line">uploade_file = client.folder(<span class="string">&#x27;0&#x27;</span>).upload(<span class="string">&#x27;./test.txt&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;File &quot;&#123;0&#125;&quot; uploaded to Box with file ID &#123;1&#125;&#x27;</span>.<span class="built_in">format</span>(uploade_file.name, uploade_file.<span class="built_in">id</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Write the Box file contents to disk</span></span><br><span class="line">output_file = <span class="built_in">open</span>(<span class="string">&#x27;./download.txt&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">client.file(<span class="string">f&#x27;<span class="subst">&#123;uploade_file.<span class="built_in">id</span>&#125;</span>&#x27;</span>).download_to(output_file)</span><br><span class="line"></span><br><span class="line"><span class="comment"># items = client.folder(folder_id=&#x27;0&#x27;).get_items()</span></span><br><span class="line">items = root_folder.get_items()</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;item.<span class="built_in">type</span>.capitalize()&#125;</span> <span class="subst">&#123;item.<span class="built_in">id</span>&#125;</span> is named &quot;<span class="subst">&#123;item.name&#125;</span>&quot;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>最后，我们可以进入到<code>Admin Console</code>-<code>Content</code>中去看我们App中的文件与目录<br><img src="/img/post/2021/08/box-admin-console-content.png"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-08-07T16:00:00.000Z" title="2021/8/8 上午12:00:00">2021-08-08</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-08-25T13:25:58.296Z" title="2021/8/25 下午9:25:58">2021-08-25</time></span><span class="level-item"> BF </span><span class="level-item">14 minutes read (About 2117 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/08/08/2021/08/2021-08-09-kafka-learn-01/">Kafka Learn - 01</a></h1><div class="content"><h3 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h3><p>最近报名了公司的<code>Kafka Training</code> , 主要是自己看视频。今天主要记录一下使用到的命令和练习的<code>Java Code</code>，前期的概念有时间再总结下。从CLI和Java Code的这几节来说，主要练习了<code>Producer</code>和<code>Comsumer</code>的使用，数据的推送和读取应该是一般人使用Kafka最基本和最常用的操作了吧。</p>
<h3 id="安装与配置"><a href="#安装与配置" class="headerlink" title="安装与配置"></a>安装与配置</h3><p><a target="_blank" rel="noopener" href="http://kafka.apache.org/downloads">http://kafka.apache.org/downloads</a></p>
<p>不同系统的配置大同小异，为了省事我用的是<code>windows</code>，需要把<code>D:\ProgramsDev\kafka_2.13-2.8.0\bin\windows</code>加入到环境变量中，linux到<code>bin</code>就够了。</p>
<p>在<code>data</code>目录下新建<code>kafka</code>和<code>zookeeper</code>目录。<br><img src="/img/post/2021/08/markdown-img-paste-20210809000228463.png" alt="data folder"></p>
<p>目前要动的配置文件就两个，把上面新建的目录路径加入到配置文件中：</p>
<h4 id="server-properties"><a href="#server-properties" class="headerlink" title="server.properties"></a>server.properties</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># A comma separated list of directories under which to store log files</span><br><span class="line">log.dirs&#x3D;D:&#x2F;ProgramsDev&#x2F;kafka_2.13-2.8.0&#x2F;data&#x2F;kafka</span><br><span class="line"></span><br><span class="line"># The default number of log partitions per topic. More partitions allow greater</span><br><span class="line"># parallelism for consumption, but this will also result in more files across</span><br><span class="line"># the brokers.</span><br><span class="line">num.partitions&#x3D;3</span><br></pre></td></tr></table></figure>

<h4 id="zookeeper-properties"><a href="#zookeeper-properties" class="headerlink" title="zookeeper.properties"></a>zookeeper.properties</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># the directory where the snapshot is stored.</span><br><span class="line">dataDir&#x3D;D:&#x2F;ProgramsDev&#x2F;kafka_2.13-2.8.0&#x2F;data&#x2F;zookeeper</span><br></pre></td></tr></table></figure>

<h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h3><p>注意配置文件的相对路径</p>
<p>kafka bootstrap-server <code>127.0.0.1:9092</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-server-start ./config/server.properties</span><br></pre></td></tr></table></figure>

<p>zookeeper <code>127.0.0.1:2181</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zookeeper-server-start ./config/zookeeper.properties</span><br></pre></td></tr></table></figure>

<h3 id="CLI使用"><a href="#CLI使用" class="headerlink" title="CLI使用"></a>CLI使用</h3><p>视频教材中演示的很好，这边就只是简单的把<code>Command</code>列一下，可以自己试试，理解下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics --zookeeper 127.0.0.1:2181 --topic first_topic --create --partitions 3 --replication-factor 1</span><br><span class="line">kafka-topics --zookeeper 127.0.0.1:2181 --topic second_topic --create --partitions 6 --replication-factor 1</span><br><span class="line"></span><br><span class="line">kafka-topics --zookeeper 127.0.0.1:2181 --list</span><br><span class="line">kafka-topics --zookeeper 127.0.0.1:2181 --topic first_topic --describe</span><br><span class="line">kafka-topics --zookeeper 127.0.0.1:2181 --topic second_topic --describe</span><br><span class="line">kafka-topics --zookeeper 127.0.0.1:2181 --topic second_topic --delete</span><br><span class="line"></span><br><span class="line">kafka-console-producer --broker-list 127.0.0.1:9092 --topic first_topic</span><br><span class="line">kafka-console-producer --broker-list 127.0.0.1:9092 --topic first_topic --producer-property acks=all</span><br><span class="line">kafka-topics --zookeeper 127.0.0.1:2181 --list</span><br><span class="line"></span><br><span class="line">kafka-console-consumer --bootstrap-server 127.0.0.1:9092 --topic first_topic --group my-second-application --from-beginning</span><br><span class="line"></span><br><span class="line">kafka-console-consumer --bootstrap-server 127.0.0.1:9092 --topic first_topic --group my-first-application</span><br><span class="line"></span><br><span class="line">kafka-console-consumer --bootstrap-server 127.0.0.1:9092 --topic first_topic --from-beginning</span><br><span class="line"></span><br><span class="line">kafka-console-consumer --bootstrap-server 127.0.0.1:9092 --topic first_topic</span><br><span class="line"></span><br><span class="line">kafka-console-consumer --bootstrap-server 127.0.0.1:9092 --topic first_topic --group my-third-application</span><br><span class="line"></span><br><span class="line">kafka-consumer-groups --bootstrap-server localhost:9092 --list</span><br><span class="line"></span><br><span class="line">kafka-consumer-groups --bootstrap-server localhost:9092 --describe --group my-first-application</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">kafka-consumer-groups --bootstrap-server localhost:9092 --group my-first-application --reset-offsets --shift-by 2 --execute --topic first_topic</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">kafka-consumer-groups --bootstrap-server localhost:9092 --group my-first-application --reset-offsets --to-earliest --execute --topic first_topic</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Offset-Explorer-formerly-Kafka-Tool"><a href="#Offset-Explorer-formerly-Kafka-Tool" class="headerlink" title="Offset Explorer (formerly Kafka Tool)"></a>Offset Explorer (formerly Kafka Tool)</h3><p><a target="_blank" rel="noopener" href="https://www.kafkatool.com/">https://www.kafkatool.com/</a></p>
<p>这是一个可以查看Kafka信息(Broker,Topic, Consumer, Position…)的工具。<br><img src="/img/post/2021/08/markdown-img-kafka-tool.png" alt="Kafka Tool"></p>
<h3 id="Java-Code-Practice"><a href="#Java-Code-Practice" class="headerlink" title="Java Code Practice"></a>Java Code Practice</h3><p>实际操作其实和CLI差不多的，只是用Java来实现。</p>
<h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>fun.bearfly<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kafka-learn<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kafka_2.13<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-simple<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.32<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="ProducerDemo"><a href="#ProducerDemo" class="headerlink" title="ProducerDemo"></a>ProducerDemo</h4><p>最简单的一个Producer</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fun.bearfly.kafka.learn;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.KafkaProducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.ProducerConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.ProducerRecord;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.common.serialization.StringSerializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProducerDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String bootstrapServers = <span class="string">&quot;127.0.0.1:9092&quot;</span>;</span><br><span class="line">        Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">        properties.setProperty(<span class="string">&quot;bootstrap.servers&quot;</span>, bootstrapServers);</span><br><span class="line">        properties.setProperty(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);</span><br><span class="line">        properties.setProperty(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());</span><br><span class="line">        properties.setProperty(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());</span><br><span class="line"></span><br><span class="line">        KafkaProducer&lt;String, String&gt; producer = <span class="keyword">new</span> KafkaProducer&lt;String, String&gt;(properties);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//create producer record</span></span><br><span class="line">        ProducerRecord&lt;String, String&gt; record = <span class="keyword">new</span> ProducerRecord&lt;&gt;(<span class="string">&quot;first_topic&quot;</span>, <span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">        producer.send(record);</span><br><span class="line"></span><br><span class="line">        producer.flush();</span><br><span class="line">        producer.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ProducerDemoKeys"><a href="#ProducerDemoKeys" class="headerlink" title="ProducerDemoKeys"></a>ProducerDemoKeys</h4><p>带Keys</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fun.bearfly.kafka.learn;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.common.serialization.StringSerializer;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutionException;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProducerDemoKeys</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        Logger logger = LoggerFactory.getLogger(ProducerDemoKeys.class);</span><br><span class="line"></span><br><span class="line">        String bootstrapServers = <span class="string">&quot;127.0.0.1:9092&quot;</span>;</span><br><span class="line">        Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">        properties.setProperty(<span class="string">&quot;bootstrap.servers&quot;</span>, bootstrapServers);</span><br><span class="line">        properties.setProperty(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);</span><br><span class="line">        properties.setProperty(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());</span><br><span class="line">        properties.setProperty(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());</span><br><span class="line"></span><br><span class="line">        KafkaProducer&lt;String, String&gt; producer = <span class="keyword">new</span> KafkaProducer&lt;String, String&gt;(properties);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//create producer record</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            String topic = <span class="string">&quot;first_topic&quot;</span>;</span><br><span class="line">            String value = <span class="string">&quot;hello world &quot;</span> + Integer.toString(i);</span><br><span class="line">            String key = <span class="string">&quot;id_&quot;</span> + Integer.toString(i);</span><br><span class="line"></span><br><span class="line">            logger.info(<span class="string">&quot;Key: &quot;</span> + key);</span><br><span class="line">            ProducerRecord&lt;String, String&gt; record = <span class="keyword">new</span> ProducerRecord&lt;&gt;(topic, key, value);</span><br><span class="line">            producer.send(record, <span class="keyword">new</span> Callback() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompletion</span><span class="params">(RecordMetadata recordMetadata, Exception e)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (e == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">                        sb.append(<span class="string">&quot;Received new metadata. \n&quot;</span>);</span><br><span class="line">                        sb.append(<span class="string">&quot;topic:&quot;</span>).append(recordMetadata.topic()).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                        sb.append(<span class="string">&quot;partition:&quot;</span>).append(recordMetadata.partition()).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                        sb.append(<span class="string">&quot;offset:&quot;</span>).append(recordMetadata.offset()).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                        sb.append(<span class="string">&quot;timestamp:&quot;</span>).append(recordMetadata.timestamp()).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                        logger.info(sb.toString());</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        logger.error(<span class="string">&quot;Error while producing&quot;</span>, e);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).get();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        producer.flush();</span><br><span class="line">        producer.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ProducerDemoWithCallBack"><a href="#ProducerDemoWithCallBack" class="headerlink" title="ProducerDemoWithCallBack"></a>ProducerDemoWithCallBack</h4><p>带回调</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fun.bearfly.kafka.learn;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.common.serialization.StringSerializer;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProducerDemoWithCallBack</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Logger logger = LoggerFactory.getLogger(ProducerDemoWithCallBack.class);</span><br><span class="line"></span><br><span class="line">        String bootstrapServers = <span class="string">&quot;127.0.0.1:9092&quot;</span>;</span><br><span class="line">        Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">        properties.setProperty(<span class="string">&quot;bootstrap.servers&quot;</span>, bootstrapServers);</span><br><span class="line">        properties.setProperty(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);</span><br><span class="line">        properties.setProperty(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());</span><br><span class="line">        properties.setProperty(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());</span><br><span class="line"></span><br><span class="line">        KafkaProducer&lt;String, String&gt; producer = <span class="keyword">new</span> KafkaProducer&lt;String, String&gt;(properties);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//create producer record</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            ProducerRecord&lt;String, String&gt; record = <span class="keyword">new</span> ProducerRecord&lt;&gt;(<span class="string">&quot;first_topic&quot;</span>, <span class="string">&quot;hello world&quot;</span> + Integer.toString(i));</span><br><span class="line">            producer.send(record, <span class="keyword">new</span> Callback() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompletion</span><span class="params">(RecordMetadata recordMetadata, Exception e)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (e == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">                        sb.append(<span class="string">&quot;Received new metadata. \n&quot;</span>);</span><br><span class="line">                        sb.append(<span class="string">&quot;topic:&quot;</span>).append(recordMetadata.topic()).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                        sb.append(<span class="string">&quot;partition:&quot;</span>).append(recordMetadata.partition()).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                        sb.append(<span class="string">&quot;offset:&quot;</span>).append(recordMetadata.offset()).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                        sb.append(<span class="string">&quot;timestamp:&quot;</span>).append(recordMetadata.timestamp()).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                        logger.info(sb.toString());</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        logger.error(<span class="string">&quot;Error while producing&quot;</span>, e);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        producer.flush();</span><br><span class="line">        producer.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ConsumerDemo"><a href="#ConsumerDemo" class="headerlink" title="ConsumerDemo"></a>ConsumerDemo</h4><p>订阅Topic</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fun.bearfly.kafka.learn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecord;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecords;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.KafkaConsumer;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.common.serialization.StringDeserializer;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Logger logger = LoggerFactory.getLogger(ConsumerDemo.class.getName());</span><br><span class="line">        String bootstrapServers = <span class="string">&quot;127.0.0.1:9092&quot;</span>;</span><br><span class="line">        String groupId = <span class="string">&quot;my-fourth-application&quot;</span>;</span><br><span class="line">        String topic = <span class="string">&quot;first_topic&quot;</span>;</span><br><span class="line"></span><br><span class="line">        Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">        properties.setProperty(<span class="string">&quot;bootstrap.servers&quot;</span>, bootstrapServers);</span><br><span class="line">        properties.setProperty(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);</span><br><span class="line">        properties.setProperty(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());</span><br><span class="line">        properties.setProperty(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());</span><br><span class="line">        properties.setProperty(ConsumerConfig.GROUP_ID_CONFIG, groupId);</span><br><span class="line">        properties.setProperty(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, <span class="string">&quot;earliest&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        KafkaConsumer&lt;String, String&gt; consumer = <span class="keyword">new</span> KafkaConsumer&lt;String, String&gt;(properties);</span><br><span class="line"></span><br><span class="line">        consumer.subscribe(Arrays.asList(topic));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(<span class="number">100</span>));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (ConsumerRecord&lt;String, String&gt; record : records) &#123;</span><br><span class="line">                logger.info(<span class="string">&quot;Key: &quot;</span> + record.key() + <span class="string">&quot;, Value: &quot;</span> + record.value());</span><br><span class="line">                logger.info(<span class="string">&quot;Partition: &quot;</span> + record.partition() + <span class="string">&quot;, Offset: &quot;</span> + record.offset());</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ConsumerDemoGroups"><a href="#ConsumerDemoGroups" class="headerlink" title="ConsumerDemoGroups"></a>ConsumerDemoGroups</h4><p>带Group</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fun.bearfly.kafka.learn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecord;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecords;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.KafkaConsumer;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.common.serialization.StringDeserializer;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerDemoGroups</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Logger logger = LoggerFactory.getLogger(ConsumerDemoGroups.class.getName());</span><br><span class="line">        String bootstrapServers = <span class="string">&quot;127.0.0.1:9092&quot;</span>;</span><br><span class="line">        String groupId = <span class="string">&quot;my-fifth-application&quot;</span>;</span><br><span class="line">        String topic = <span class="string">&quot;first_topic&quot;</span>;</span><br><span class="line"></span><br><span class="line">        Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">        properties.setProperty(<span class="string">&quot;bootstrap.servers&quot;</span>, bootstrapServers);</span><br><span class="line">        properties.setProperty(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);</span><br><span class="line">        properties.setProperty(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());</span><br><span class="line">        properties.setProperty(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());</span><br><span class="line">        properties.setProperty(ConsumerConfig.GROUP_ID_CONFIG, groupId);</span><br><span class="line">        properties.setProperty(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, <span class="string">&quot;earliest&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        KafkaConsumer&lt;String, String&gt; consumer = <span class="keyword">new</span> KafkaConsumer&lt;String, String&gt;(properties);</span><br><span class="line"></span><br><span class="line">        consumer.subscribe(Arrays.asList(topic));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(<span class="number">100</span>));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (ConsumerRecord&lt;String, String&gt; record : records) &#123;</span><br><span class="line">                logger.info(<span class="string">&quot;Key: &quot;</span> + record.key() + <span class="string">&quot;, Value: &quot;</span> + record.value());</span><br><span class="line">                logger.info(<span class="string">&quot;Partition: &quot;</span> + record.partition() + <span class="string">&quot;, Offset: &quot;</span> + record.offset());</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ConsumerDemoWithThread"><a href="#ConsumerDemoWithThread" class="headerlink" title="ConsumerDemoWithThread"></a>ConsumerDemoWithThread</h4><p>使用线程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fun.bearfly.kafka.learn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecord;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecords;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.KafkaConsumer;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.common.errors.WakeupException;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.common.serialization.StringDeserializer;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerDemoWithThread</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> ConsumerDemoWithThread().run();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">ConsumerDemoWithThread</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Logger logger = LoggerFactory.getLogger(ConsumerDemoWithThread.class.getName());</span><br><span class="line">        String bootstrapServers = <span class="string">&quot;127.0.0.1:9092&quot;</span>;</span><br><span class="line">        String groupId = <span class="string">&quot;my-sixth-application&quot;</span>;</span><br><span class="line">        String topic = <span class="string">&quot;first_topic&quot;</span>;</span><br><span class="line"></span><br><span class="line">        CountDownLatch latch = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        logger.info(<span class="string">&quot;Creating the consumer thread&quot;</span>);</span><br><span class="line">        Runnable myConsumerThread = <span class="keyword">new</span> ConsumerRunnable(</span><br><span class="line">                bootstrapServers,</span><br><span class="line">                groupId,</span><br><span class="line">                topic,</span><br><span class="line">                latch</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        Thread myThread = <span class="keyword">new</span> Thread(myConsumerThread);</span><br><span class="line"></span><br><span class="line">        myThread.start();</span><br><span class="line"></span><br><span class="line">        Runtime.getRuntime().addShutdownHook(<span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;Caught shutdown hook&quot;</span>);</span><br><span class="line">            ((ConsumerRunnable) myConsumerThread).shutdown();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                latch.await();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            logger.info(<span class="string">&quot;Application has exited&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        ));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            latch.await();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;Application got interrupted&quot;</span>, e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;Application is closing&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> CountDownLatch latch;</span><br><span class="line">        <span class="keyword">private</span> KafkaConsumer&lt;String, String&gt; consumer;</span><br><span class="line">        <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(ConsumerRunnable.class.getName());</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ConsumerRunnable</span><span class="params">(String bootstrapServers,</span></span></span><br><span class="line"><span class="function"><span class="params">                                String groupId,</span></span></span><br><span class="line"><span class="function"><span class="params">                                String topic,</span></span></span><br><span class="line"><span class="function"><span class="params">                                CountDownLatch latch</span></span></span><br><span class="line"><span class="function"><span class="params">        )</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.latch = latch;</span><br><span class="line">            Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">            properties.setProperty(<span class="string">&quot;bootstrap.servers&quot;</span>, bootstrapServers);</span><br><span class="line">            properties.setProperty(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);</span><br><span class="line">            properties.setProperty(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());</span><br><span class="line">            properties.setProperty(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());</span><br><span class="line">            properties.setProperty(ConsumerConfig.GROUP_ID_CONFIG, groupId);</span><br><span class="line">            properties.setProperty(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, <span class="string">&quot;earliest&quot;</span>);</span><br><span class="line">            consumer = <span class="keyword">new</span> KafkaConsumer&lt;String, String&gt;(properties);</span><br><span class="line">            consumer.subscribe(Arrays.asList(topic));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                    ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(<span class="number">100</span>));</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">for</span> (ConsumerRecord&lt;String, String&gt; record : records) &#123;</span><br><span class="line">                        logger.info(<span class="string">&quot;Key: &quot;</span> + record.key() + <span class="string">&quot;, Value: &quot;</span> + record.value());</span><br><span class="line">                        logger.info(<span class="string">&quot;Partition: &quot;</span> + record.partition() + <span class="string">&quot;, Offset: &quot;</span> + record.offset());</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (WakeupException e) &#123;</span><br><span class="line">                logger.info(<span class="string">&quot;Received shutdown signal!&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                consumer.close();</span><br><span class="line">                latch.countDown();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="comment">// special method to interrupt consumer.poll()</span></span><br><span class="line">            <span class="comment">// will throw the exception WakeUpException</span></span><br><span class="line">            consumer.wakeup();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ConsumerDemoAssignSeek"><a href="#ConsumerDemoAssignSeek" class="headerlink" title="ConsumerDemoAssignSeek"></a>ConsumerDemoAssignSeek</h4><p>指定topic offset</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fun.bearfly.kafka.learn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecord;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecords;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.KafkaConsumer;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.common.TopicPartition;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.common.serialization.StringDeserializer;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerDemoAssignSeek</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Logger logger = LoggerFactory.getLogger(ConsumerDemoAssignSeek.class.getName());</span><br><span class="line">        String bootstrapServers = <span class="string">&quot;127.0.0.1:9092&quot;</span>;</span><br><span class="line">        String groupId = <span class="string">&quot;my-seven-application&quot;</span>;</span><br><span class="line">        String topic = <span class="string">&quot;first_topic&quot;</span>;</span><br><span class="line"></span><br><span class="line">        Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">        properties.setProperty(<span class="string">&quot;bootstrap.servers&quot;</span>, bootstrapServers);</span><br><span class="line">        properties.setProperty(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);</span><br><span class="line">        properties.setProperty(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());</span><br><span class="line">        properties.setProperty(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());</span><br><span class="line"><span class="comment">//        properties.setProperty(ConsumerConfig.GROUP_ID_CONFIG, groupId);</span></span><br><span class="line">        properties.setProperty(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, <span class="string">&quot;earliest&quot;</span>);</span><br><span class="line"></span><br><span class="line">        KafkaConsumer&lt;String, String&gt; consumer = <span class="keyword">new</span> KafkaConsumer&lt;String, String&gt;(properties);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// assign and seek are mostly used to replay data or fetch a specific message</span></span><br><span class="line">        <span class="comment">// assign</span></span><br><span class="line">        TopicPartition partitionToReadFrom = <span class="keyword">new</span> TopicPartition(topic, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">long</span> offsetToReadFrom = <span class="number">15L</span>;</span><br><span class="line">        consumer.assign(Arrays.asList(partitionToReadFrom));</span><br><span class="line">        <span class="comment">//seek</span></span><br><span class="line">        consumer.seek(partitionToReadFrom, offsetToReadFrom);</span><br><span class="line"><span class="comment">//        consumer.subscribe(Arrays.asList(topic));</span></span><br><span class="line">        <span class="keyword">int</span> numberOfMessagesToRead = <span class="number">5</span>;</span><br><span class="line">        <span class="keyword">boolean</span> keepOnReading = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">int</span> numberOfMessagesReadSoFar = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (keepOnReading) &#123;</span><br><span class="line">            ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(<span class="number">100</span>));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (ConsumerRecord&lt;String, String&gt; record : records) &#123;</span><br><span class="line">                numberOfMessagesReadSoFar += <span class="number">1</span>;</span><br><span class="line">                logger.info(<span class="string">&quot;Key: &quot;</span> + record.key() + <span class="string">&quot;, Value: &quot;</span> + record.value());</span><br><span class="line">                logger.info(<span class="string">&quot;Partition: &quot;</span> + record.partition() + <span class="string">&quot;, Offset: &quot;</span> + record.offset());</span><br><span class="line">                <span class="keyword">if</span> (numberOfMessagesReadSoFar &gt;= numberOfMessagesToRead) &#123;</span><br><span class="line">                    keepOnReading = <span class="keyword">false</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        logger.info(<span class="string">&quot;Exiting the application&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h3><p>都是一些基本操作，深入学习后再回头总结下理论概念，实践出真知。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-07-20T16:00:00.000Z" title="2021/7/21 上午12:00:00">2021-07-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-07-22T16:39:42.788Z" title="2021/7/23 上午12:39:42">2021-07-23</time></span><span class="level-item"> BF </span><span class="level-item">4 minutes read (About 638 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/07/21/2021/07/2021-07-21-jaydebeapi/">jaydebeapi</a></h1><div class="content"><h3 id="JayDeBeApi"><a href="#JayDeBeApi" class="headerlink" title="JayDeBeApi"></a>JayDeBeApi</h3><p>一般来说，不同的数据库针对<code>Python</code>都有对应的Module去访问，他们基本上都使用统一的Python DB-API,除了连接上会有点区别，别的使用方式都基本一样。</p>
<table>
<thead>
<tr>
<th>数据库</th>
<th>模块</th>
</tr>
</thead>
<tbody><tr>
<td>mysql</td>
<td>pymysql</td>
</tr>
<tr>
<td>sql server</td>
<td>pymssql</td>
</tr>
<tr>
<td>Oracle</td>
<td>cx_Oracle</td>
</tr>
<tr>
<td>Teradata</td>
<td>teradatasql</td>
</tr>
<tr>
<td>etc…</td>
<td>etc…</td>
</tr>
</tbody></table>
<p>但不可避免的，有些库需要系统安装一些依赖，比如Oracle，就需要安装有对应的oralce client，cx_Oracle才能正常使用。 此外很多数据库提供odbc driver，那么就可以在安装driver之后，统一使用<code>pyodbc</code>去连接。在PA的写的在windows下query hive和impala数据的小工具，使用的就是<code>pyodbc</code>的方式。</p>
<p>但是当需要安装除模块本身外的依赖都会显得有些麻烦，今天主要是记录一下在python中使用<code>jdbc</code>(jar包)的方式连接<code>sql server</code>例子，使用的module就是<a target="_blank" rel="noopener" href="https://pypi.org/project/JayDeBeApi/"><code>JayDeBeApi</code></a></p>
<blockquote>
<p>The JayDeBeApi module allows you to connect from Python code to databases using Java JDBC. It provides a Python DB-API v2.0 to that database.</p>
<p>It works on ordinary Python (cPython) using the JPype Java integration or on Jython to make use of the Java JDBC driver.</p>
<p>In contrast to zxJDBC from the Jython project JayDeBeApi let’s you access a database with Jython AND Python with only minor code modifications. JayDeBeApi’s future goal is to provide a unique and fast interface to different types of JDBC-Drivers through a flexible plug-in mechanism.</p>
</blockquote>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install JayDeBeApi</span><br></pre></td></tr></table></figure>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>针对不同的数据库，保证连接的字符串、注册的drvier class和对应的Jar包都对应的上就行。</p>
<p>这边我本地的sql server 2017的版本，所以我去<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-CN/sql/connect/jdbc/download-microsoft-jdbc-driver-for-sql-server?view=sql-server-2017">官网</a>就下了<code>mssql-jdbc-7.4.1.jre8.jar</code>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jaydebeapi</span><br><span class="line">url = <span class="string">&#x27;jdbc:sqlserver://localhost:1433;databasename=BFTest&#x27;</span></span><br><span class="line">user = <span class="string">&#x27;xiche&#x27;</span></span><br><span class="line">password = <span class="string">&#x27;xxxxxx&#x27;</span></span><br><span class="line">dirver = <span class="string">&#x27;com.microsoft.sqlserver.jdbc.SQLServerDriver&#x27;</span></span><br><span class="line">jar = <span class="string">&#x27;./lib/mssql-jdbc-7.4.1.jre8.jar&#x27;</span></span><br><span class="line">sql = <span class="string">&#x27;select * from Test_Output&#x27;</span></span><br><span class="line">conn = jaydebeapi.connect(dirver, url, [user, password], jar)</span><br><span class="line">curs=conn.cursor()</span><br><span class="line">curs.execute(sql)</span><br><span class="line">result=curs.fetchall()</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line">curs.close()</span><br></pre></td></tr></table></figure>

<p>output:<br><img src="/img/post/2021/07/2021-07-23-jaydebeapi-output-01.png" alt="output1"></p>
<h3 id="pandas"><a href="#pandas" class="headerlink" title="pandas"></a>pandas</h3><p>一般我们拿到connection之后，可以直接传给pandas，让他来存储和处理数据，非常方便。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> jaydebeapi</span><br><span class="line">url = <span class="string">&#x27;jdbc:sqlserver://localhost:1433;databasename=BFTest&#x27;</span></span><br><span class="line">user = <span class="string">&#x27;xiche&#x27;</span></span><br><span class="line">password = <span class="string">&#x27;xxxxxx&#x27;</span></span><br><span class="line">dirver = <span class="string">&#x27;com.microsoft.sqlserver.jdbc.SQLServerDriver&#x27;</span></span><br><span class="line">jar = <span class="string">&#x27;./lib/mssql-jdbc-7.4.1.jre8.jar&#x27;</span></span><br><span class="line">sql = <span class="string">&#x27;select * from Test_Output&#x27;</span></span><br><span class="line">conn = jaydebeapi.connect(dirver, url, [user, password], jar)</span><br><span class="line">df = pd.read_sql_query(con=conn,sql=sql)</span><br><span class="line"><span class="built_in">print</span>(df)</span><br></pre></td></tr></table></figure>
<p>output:<br><img src="/img/post/2021/07/2021-07-23-jaydebeapi-output-02.png" alt="output1"></p>
<h3 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h3><p>由于Java使用的广泛性和Python本身的一些局限性，如果遇到问题时有使用Jar包的解决方案，还是比较舒服的。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-07-16T16:00:00.000Z" title="2021/7/17 上午12:00:00">2021-07-17</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-07-17T13:45:08.654Z" title="2021/7/17 下午9:45:08">2021-07-17</time></span><span class="level-item"> BF </span><span class="level-item">4 minutes read (About 610 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/07/17/2021/07/2021-07-17-NanHu/">NanHu</a></h1><div class="content"><h4 id="监工"><a href="#监工" class="headerlink" title="监工"></a>监工</h4><p>今天天气还不错，好久没有出去放放风了。</p>
<p>到崇贤还是有点距离的，高架上堵了一会儿，半个小时才到。</p>
<p>总体和上次来看的时候差不多，还是要看内部的进度，还有一年呢，早着。<br><img src="/img/post/2021/07/2021-07-17-NanHu-01-home.jpg" alt="home"></p>
<h4 id="陈记饭馆"><a href="#陈记饭馆" class="headerlink" title="陈记饭馆"></a>陈记饭馆</h4><p>上次来的时候，因为名字带<code>陈</code>字便挑了这家店，不过饭菜确实也不错，今天点了三个菜，吃的很撑。<br><img src="/img/post/2021/07/2021-07-17-NanHu-02-beef.jpg" alt="beef"><br><img src="/img/post/2021/07/2021-07-17-NanHu-03-shell.jpg" alt="shell"><br><img src="/img/post/2021/07/2021-07-17-NanHu-04-eggplant.jpg" alt="eggplant"></p>
<h4 id="南湖"><a href="#南湖" class="headerlink" title="南湖"></a>南湖</h4><p>吃饱喝足，寻摸着地图上未探寻过的点，选了南湖。<br><img src="/img/post/2021/07/2021-07-17-NanHu-05-scenery-00.jpg" alt="eggplant"><br>崇贤到南湖也不近，开了快一个小时，结果临了开到了去临安的国道上。</p>
<p>不过也是巧合，关了导航，随便找了个车能过的口子钻了进去，走到了村子里。</p>
<p>第一次看到了在树上的石榴。<br><img src="/img/post/2021/07/2021-07-17-NanHu-05-scenery-01.jpg" alt="picture"><br>好多水稻<br><img src="/img/post/2021/07/2021-07-17-NanHu-05-scenery-02.jpg" alt="picture"><br>好多片的玉米，真想掰几个:)<br><img src="/img/post/2021/07/2021-07-17-NanHu-05-scenery-03.jpg" alt="picture"><br><img src="/img/post/2021/07/2021-07-17-NanHu-05-scenery-06.jpg" alt="picture"><br>不过大部分也没成熟<br><img src="/img/post/2021/07/2021-07-17-NanHu-05-scenery-04.jpg" alt="picture"><br>路边还有好多好看的树花<br><img src="/img/post/2021/07/2021-07-17-NanHu-05-scenery-05.jpg" alt="picture"><br>在乡间小路上，两边都是稻田，真的很美很舒服<br><img src="/img/post/2021/07/2021-07-17-NanHu-05-scenery-07.jpg" alt="picture"><br><img src="/img/post/2021/07/2021-07-17-NanHu-05-scenery-08.jpg" alt="picture"><br><img src="/img/post/2021/07/2021-07-17-NanHu-05-scenery-09.jpg" alt="picture"></p>
<h4 id="村里的二傻子"><a href="#村里的二傻子" class="headerlink" title="村里的二傻子"></a>村里的二傻子</h4><p><img src="/img/post/2021/07/2021-07-17-NanHu-06-Selfie-01.jpg" alt="picture"></p>
<h4 id="和村花的合影"><a href="#和村花的合影" class="headerlink" title="和村花的合影"></a>和村花的合影</h4><p><img src="/img/post/2021/07/2021-07-17-NanHu-06-Selfie-02.jpg" alt="picture"></p>
<h4 id="湖呢？？？"><a href="#湖呢？？？" class="headerlink" title="湖呢？？？"></a>湖呢？？？</h4><p>由于二傻子只顾着开车，沿着湖堤看湖光山色时，忘记停下来多拍几张照片了😂</p>
<h4 id="南湖周边"><a href="#南湖周边" class="headerlink" title="南湖周边"></a>南湖周边</h4><p>今天还去众安绿城的南湖明月售楼部借了个厕所，高层算是真的湖景房了，住这边的话的确会比较舒服，不过周边也都还在开发，尤其是湖的东北侧。从开发商的地图中也能看到周边产业的现状和规划，未来肯定还是不错的。回程的时候，也路过了达摩院那侧（湖西南），这边的道路都好新，好几次开到还封闭着的断头路，只能掉头😂。</p>
<h4 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h4><p>还算是比较充实的一天了吧😃</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-07-03T16:00:00.000Z" title="2021/7/4 上午12:00:00">2021-07-04</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-07-04T16:19:00.215Z" title="2021/7/5 上午12:19:00">2021-07-05</time></span><span class="level-item"> BF </span><span class="level-item">12 minutes read (About 1746 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/07/04/2021/07/2021-07-04-folder-tree/">Folder Tree Info DFS/BFS</a></h1><div class="content"><h1 id="深度优先与广度优先遍历文件（夹）信息"><a href="#深度优先与广度优先遍历文件（夹）信息" class="headerlink" title="深度优先与广度优先遍历文件（夹）信息"></a>深度优先与广度优先遍历文件（夹）信息</h1><p>最近做了一个对系统目录进行管理的页面，涉及到了对目录中的文件夹和文件的信息读取的问题，刚好回顾了一下文件夹遍历的算法。</p>
<p>由于需要在页面中体现目录层级关系，需要返回的json中有<code>parent_id</code>这样标志符。当时第一个想法就是用递归的方式来遍历，就可以得到对应的关系，但是这样的话，同一目录的文件（夹）的id就不能连续了，如果使用广度优先遍历的话就可以解决这个问题。</p>
<h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><p>新建了一个测试的目录，放了一些文件：<br><img src="/img/post/2021/07/2020-07-04-Folder-DFS-BFS-01-tree.gif" alt="tree"></p>
<p>下面是更直观的文件的关系示例：<br><img src="/img/post/2021/07/2020-07-04-Folder-DFS-BFS-02-tree-map.png" alt="tree map"></p>
<h2 id="Depth-First-Search-DFS"><a href="#Depth-First-Search-DFS" class="headerlink" title="Depth-First-Search(DFS)"></a>Depth-First-Search(DFS)</h2><p>使用递归是最直接的深度优先搜索的方式，直接贴代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">iterate_folder_files_info_dfs</span>(<span class="params">current_folder, file_list, root_id, level</span>):</span></span><br><span class="line">    level = level + <span class="number">1</span></span><br><span class="line">    current_id = root_id + <span class="number">1</span></span><br><span class="line">    files_in_folder = os.listdir(current_folder)</span><br><span class="line">    <span class="keyword">for</span> file_name <span class="keyword">in</span> files_in_folder:</span><br><span class="line">        file_full_path = os.path.join(current_folder, file_name)</span><br><span class="line">        <span class="keyword">if</span> os.path.isfile(file_full_path):</span><br><span class="line">            new_file_info = &#123;</span><br><span class="line">                <span class="string">&#x27;id&#x27;</span>: current_id,</span><br><span class="line">                <span class="string">&#x27;parent_id&#x27;</span>: root_id,</span><br><span class="line">                <span class="string">&#x27;level&#x27;</span>: level,</span><br><span class="line">                <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;folder_name&#x27;</span>:current_folder,</span><br><span class="line">                <span class="string">&#x27;file_name&#x27;</span>:file_name,</span><br><span class="line">                <span class="string">&#x27;full_path&#x27;</span>:file_full_path,</span><br><span class="line">                <span class="string">&#x27;file_size&#x27;</span>:os.path.getsize(file_full_path),</span><br><span class="line">                <span class="string">&#x27;create_time&#x27;</span>:os.path.getctime(file_full_path)</span><br><span class="line">            &#125;</span><br><span class="line">            file_list.append(new_file_info)</span><br><span class="line">            current_id = current_id + <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> os.path.isdir(file_full_path):</span><br><span class="line">            new_folder_info = &#123;</span><br><span class="line">                <span class="string">&#x27;id&#x27;</span>: current_id,</span><br><span class="line">                <span class="string">&#x27;parent_id&#x27;</span>: root_id,</span><br><span class="line">                <span class="string">&#x27;level&#x27;</span>: level,</span><br><span class="line">                <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;folder&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;folder_name&#x27;</span>:current_folder,</span><br><span class="line">                <span class="string">&#x27;file_name&#x27;</span>:file_name,</span><br><span class="line">                <span class="string">&#x27;full_path&#x27;</span>:file_full_path,</span><br><span class="line">                <span class="string">&#x27;create_time&#x27;</span>:os.path.getctime(file_full_path)</span><br><span class="line">            &#125;</span><br><span class="line">            file_list.append(new_folder_info)</span><br><span class="line">            current_id = iterate_folder_files_info_dfs(file_full_path, file_list, current_id, level)</span><br><span class="line">    <span class="keyword">return</span> current_id</span><br><span class="line"></span><br><span class="line">file_list = []</span><br><span class="line">current_folder = <span class="string">r&#x27;C:\test&#x27;</span></span><br><span class="line">iterate_folder_files_info_dfs(current_folder, file_list, -<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;result.dfs.json&#x27;</span>,<span class="string">&#x27;w+&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="built_in">str</span>(file_list))</span><br></pre></td></tr></table></figure>

<p>逻辑还是比较直观的，一旦搜索到的是文件，就直接把信息加到最后的list中。如果是目录，把信息加到最后的list中后，继续向下调用搜索，只要最后一层没有目录了，就逐级向上返回自己的id。</p>
<p>最后生成的id如下图所示：<br><img src="/img/post/2021/07/2020-07-04-Folder-DFS-BFS-03-map-dfs.png" alt="dfs result"><br>可以看到ID的分布是按上到下生成（按深度）生成的，下面是最后生成的json, parent_id也没有问题。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">[&#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&#x27;parent_id&#x27;</span>: -<span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;level&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;folder&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;folder_name&#x27;</span>: <span class="string">&#x27;C:\\test&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_name&#x27;</span>: <span class="string">&#x27;classes&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;full_path&#x27;</span>: <span class="string">&#x27;C:\\test\\classes&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;create_time&#x27;</span>: <span class="number">1625323109.1690984</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;parent_id&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&#x27;level&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;folder_name&#x27;</span>: <span class="string">&#x27;C:\\test\\classes&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_name&#x27;</span>: <span class="string">&#x27;class_introduce.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;full_path&#x27;</span>: <span class="string">&#x27;C:\\test\\classes\\class_introduce.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_size&#x27;</span>: <span class="number">23</span>,</span><br><span class="line">        <span class="string">&#x27;create_time&#x27;</span>: <span class="number">1625323181.7119198</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&#x27;parent_id&#x27;</span>: -<span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;level&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;folder&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;folder_name&#x27;</span>: <span class="string">&#x27;C:\\test&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_name&#x27;</span>: <span class="string">&#x27;scores&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;full_path&#x27;</span>: <span class="string">&#x27;C:\\test\\scores&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;create_time&#x27;</span>: <span class="number">1625323098.449873</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="string">&#x27;parent_id&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&#x27;level&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;folder&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;folder_name&#x27;</span>: <span class="string">&#x27;C:\\test\\scores&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_name&#x27;</span>: <span class="string">&#x27;english&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;full_path&#x27;</span>: <span class="string">&#x27;C:\\test\\scores\\english&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;create_time&#x27;</span>: <span class="number">1625323396.2220247</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="number">4</span>,</span><br><span class="line">        <span class="string">&#x27;parent_id&#x27;</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="string">&#x27;level&#x27;</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;folder_name&#x27;</span>: <span class="string">&#x27;C:\\test\\scores\\english&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_name&#x27;</span>: <span class="string">&#x27;english1.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;full_path&#x27;</span>: <span class="string">&#x27;C:\\test\\scores\\english\\english1.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_size&#x27;</span>: <span class="number">23</span>,</span><br><span class="line">        <span class="string">&#x27;create_time&#x27;</span>: <span class="number">1625323470.866679</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="string">&#x27;parent_id&#x27;</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="string">&#x27;level&#x27;</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;folder_name&#x27;</span>: <span class="string">&#x27;C:\\test\\scores\\english&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_name&#x27;</span>: <span class="string">&#x27;english2.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;full_path&#x27;</span>: <span class="string">&#x27;C:\\test\\scores\\english\\english2.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_size&#x27;</span>: <span class="number">55</span>,</span><br><span class="line">        <span class="string">&#x27;create_time&#x27;</span>: <span class="number">1625323470.8686738</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="number">6</span>,</span><br><span class="line">        <span class="string">&#x27;parent_id&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&#x27;level&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;folder&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;folder_name&#x27;</span>: <span class="string">&#x27;C:\\test\\scores&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_name&#x27;</span>: <span class="string">&#x27;math&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;full_path&#x27;</span>: <span class="string">&#x27;C:\\test\\scores\\math&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;create_time&#x27;</span>: <span class="number">1625323316.5491896</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="number">7</span>,</span><br><span class="line">        <span class="string">&#x27;parent_id&#x27;</span>: <span class="number">6</span>,</span><br><span class="line">        <span class="string">&#x27;level&#x27;</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;folder_name&#x27;</span>: <span class="string">&#x27;C:\\test\\scores\\math&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_name&#x27;</span>: <span class="string">&#x27;math1.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;full_path&#x27;</span>: <span class="string">&#x27;C:\\test\\scores\\math\\math1.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_size&#x27;</span>: <span class="number">33</span>,</span><br><span class="line">        <span class="string">&#x27;create_time&#x27;</span>: <span class="number">1625323454.2487762</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="number">8</span>,</span><br><span class="line">        <span class="string">&#x27;parent_id&#x27;</span>: <span class="number">6</span>,</span><br><span class="line">        <span class="string">&#x27;level&#x27;</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;folder_name&#x27;</span>: <span class="string">&#x27;C:\\test\\scores\\math&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_name&#x27;</span>: <span class="string">&#x27;math2.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;full_path&#x27;</span>: <span class="string">&#x27;C:\\test\\scores\\math\\math2.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_size&#x27;</span>: <span class="number">31</span>,</span><br><span class="line">        <span class="string">&#x27;create_time&#x27;</span>: <span class="number">1625323460.5313218</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="number">9</span>,</span><br><span class="line">        <span class="string">&#x27;parent_id&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&#x27;level&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;folder_name&#x27;</span>: <span class="string">&#x27;C:\\test\\scores&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_name&#x27;</span>: <span class="string">&#x27;score_introduce.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;full_path&#x27;</span>: <span class="string">&#x27;C:\\test\\scores\\score_introduce.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_size&#x27;</span>: <span class="number">26</span>,</span><br><span class="line">        <span class="string">&#x27;create_time&#x27;</span>: <span class="number">1625323421.2782009</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="string">&#x27;parent_id&#x27;</span>: -<span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;level&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;folder_name&#x27;</span>: <span class="string">&#x27;C:\\test&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_name&#x27;</span>: <span class="string">&#x27;summary.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;full_path&#x27;</span>: <span class="string">&#x27;C:\\test\\summary.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_size&#x27;</span>: <span class="number">20</span>,</span><br><span class="line">        <span class="string">&#x27;create_time&#x27;</span>: <span class="number">1625323064.0133853</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="Breadth-First-Search-BFS"><a href="#Breadth-First-Search-BFS" class="headerlink" title="Breadth-First-Search(BFS)"></a>Breadth-First-Search(BFS)</h2><p>下面是使用广度优先算法的解决方案，代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">iterate_folder_files_info_bfs</span>(<span class="params">current_folder, file_info_list, root_id, level</span>):</span></span><br><span class="line">    level = level + <span class="number">1</span></span><br><span class="line">    current_id = root_id + <span class="number">1</span></span><br><span class="line">    files_in_folder = os.listdir(current_folder)</span><br><span class="line">    search_list = []</span><br><span class="line">    level_files_list = []</span><br><span class="line">    <span class="keyword">for</span> file_name <span class="keyword">in</span> files_in_folder:</span><br><span class="line">        file_full_path = os.path.join(current_folder, file_name)</span><br><span class="line">        level_files_list.append(file_full_path)</span><br><span class="line">    search_list.append(&#123;root_id:level_files_list&#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(search_list):</span><br><span class="line">        level_files_map = search_list.pop(<span class="number">0</span>)</span><br><span class="line">        root_id = <span class="built_in">list</span>(level_files_map.keys())[<span class="number">0</span>]</span><br><span class="line">        level_files_list = <span class="built_in">list</span>(level_files_map.values())[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> file_full_path <span class="keyword">in</span> level_files_list:</span><br><span class="line">            level_files_list_new = []</span><br><span class="line">            <span class="keyword">if</span> os.path.isfile(file_full_path):</span><br><span class="line">                new_file_info = &#123;</span><br><span class="line">                    <span class="string">&#x27;id&#x27;</span>: current_id,</span><br><span class="line">                    <span class="string">&#x27;parent_id&#x27;</span>: root_id,</span><br><span class="line">                    <span class="string">&#x27;level&#x27;</span>: level,</span><br><span class="line">                    <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;folder_name&#x27;</span>:os.path.dirname(file_full_path),</span><br><span class="line">                    <span class="string">&#x27;file_name&#x27;</span>:os.path.basename(file_full_path),</span><br><span class="line">                    <span class="string">&#x27;full_path&#x27;</span>:file_full_path,</span><br><span class="line">                    <span class="string">&#x27;file_size&#x27;</span>:os.path.getsize(file_full_path),</span><br><span class="line">                    <span class="string">&#x27;create_time&#x27;</span>:os.path.getctime(file_full_path)</span><br><span class="line">                &#125;</span><br><span class="line">                file_info_list.append(new_file_info)</span><br><span class="line">                current_id = current_id + <span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span> os.path.isdir(file_full_path):</span><br><span class="line">                new_folder_info = &#123;</span><br><span class="line">                    <span class="string">&#x27;id&#x27;</span>: current_id,</span><br><span class="line">                    <span class="string">&#x27;parent_id&#x27;</span>: root_id,</span><br><span class="line">                    <span class="string">&#x27;level&#x27;</span>: level,</span><br><span class="line">                    <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;folder&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;folder_name&#x27;</span>:os.path.dirname(file_full_path),</span><br><span class="line">                    <span class="string">&#x27;file_name&#x27;</span>:os.path.basename(file_full_path),</span><br><span class="line">                    <span class="string">&#x27;full_path&#x27;</span>:file_full_path,</span><br><span class="line">                    <span class="string">&#x27;create_time&#x27;</span>:os.path.getctime(file_full_path)</span><br><span class="line">                &#125;</span><br><span class="line">                file_info_list.append(new_folder_info)</span><br><span class="line">                <span class="keyword">for</span> sub_file_name <span class="keyword">in</span> os.listdir(file_full_path):</span><br><span class="line">                     new_file_full_path = os.path.join(file_full_path, sub_file_name)</span><br><span class="line">                     level_files_list_new.append(new_file_full_path)</span><br><span class="line">                search_list.append(&#123;current_id:level_files_list_new&#125;)</span><br><span class="line">                current_id = current_id + <span class="number">1</span></span><br><span class="line">                </span><br><span class="line">        level = level +<span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">file_info_list = []</span><br><span class="line">current_folder = <span class="string">r&#x27;C:\test&#x27;</span></span><br><span class="line">iterate_folder_files_info_bfs(current_folder, file_info_list,  -<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;result.bfs.json&#x27;</span>,<span class="string">&#x27;w+&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="built_in">str</span>(file_info_list))</span><br></pre></td></tr></table></figure>

<p>逻辑相对于DFS稍微多了一些状态的维护，初始化第一层文件和文件夹信息后，把level和名字列表组成{level:[filename, foldername…]} 的dict加入遍历状态list。然后一直循环遍历list,把level信息拿出来，一旦搜索到的是文件，就直接把信息加到最后的list中，如果是目录，把文件信息和Level重新加回list，直到<code>search_list</code>为空。</p>
<p>最后生成的id如下图所示：<br><img src="/img/post/2021/07/2020-07-04-Folder-DFS-BFS-03-map-bfs.png" alt="dfs result"><br>可以看到ID的分布是按左到右生成（按广度）生成的，下面是最后生成的json, parent_id也没有问题。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">[&#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&#x27;parent_id&#x27;</span>: -<span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;level&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;folder&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;folder_name&#x27;</span>: <span class="string">&#x27;C:\\test&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_name&#x27;</span>: <span class="string">&#x27;classes&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;full_path&#x27;</span>: <span class="string">&#x27;C:\\test\\classes&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;create_time&#x27;</span>: <span class="number">1625323109.1690984</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;parent_id&#x27;</span>: -<span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;level&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;folder&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;folder_name&#x27;</span>: <span class="string">&#x27;C:\\test&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_name&#x27;</span>: <span class="string">&#x27;scores&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;full_path&#x27;</span>: <span class="string">&#x27;C:\\test\\scores&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;create_time&#x27;</span>: <span class="number">1625323098.449873</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&#x27;parent_id&#x27;</span>: -<span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;level&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;folder_name&#x27;</span>: <span class="string">&#x27;C:\\test&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_name&#x27;</span>: <span class="string">&#x27;summary.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;full_path&#x27;</span>: <span class="string">&#x27;C:\\test\\summary.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_size&#x27;</span>: <span class="number">20</span>,</span><br><span class="line">        <span class="string">&#x27;create_time&#x27;</span>: <span class="number">1625323064.0133853</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="string">&#x27;parent_id&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&#x27;level&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;folder_name&#x27;</span>: <span class="string">&#x27;C:\\test\\classes&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_name&#x27;</span>: <span class="string">&#x27;class_introduce.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;full_path&#x27;</span>: <span class="string">&#x27;C:\\test\\classes\\class_introduce.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_size&#x27;</span>: <span class="number">23</span>,</span><br><span class="line">        <span class="string">&#x27;create_time&#x27;</span>: <span class="number">1625323181.7119198</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="number">4</span>,</span><br><span class="line">        <span class="string">&#x27;parent_id&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;level&#x27;</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;folder&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;folder_name&#x27;</span>: <span class="string">&#x27;C:\\test\\scores&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_name&#x27;</span>: <span class="string">&#x27;english&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;full_path&#x27;</span>: <span class="string">&#x27;C:\\test\\scores\\english&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;create_time&#x27;</span>: <span class="number">1625323396.2220247</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="string">&#x27;parent_id&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;level&#x27;</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;folder&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;folder_name&#x27;</span>: <span class="string">&#x27;C:\\test\\scores&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_name&#x27;</span>: <span class="string">&#x27;math&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;full_path&#x27;</span>: <span class="string">&#x27;C:\\test\\scores\\math&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;create_time&#x27;</span>: <span class="number">1625323316.5491896</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="number">6</span>,</span><br><span class="line">        <span class="string">&#x27;parent_id&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;level&#x27;</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;folder_name&#x27;</span>: <span class="string">&#x27;C:\\test\\scores&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_name&#x27;</span>: <span class="string">&#x27;score_introduce.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;full_path&#x27;</span>: <span class="string">&#x27;C:\\test\\scores\\score_introduce.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_size&#x27;</span>: <span class="number">26</span>,</span><br><span class="line">        <span class="string">&#x27;create_time&#x27;</span>: <span class="number">1625323421.2782009</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="number">7</span>,</span><br><span class="line">        <span class="string">&#x27;parent_id&#x27;</span>: <span class="number">4</span>,</span><br><span class="line">        <span class="string">&#x27;level&#x27;</span>: <span class="number">4</span>,</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;folder_name&#x27;</span>: <span class="string">&#x27;C:\\test\\scores\\english&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_name&#x27;</span>: <span class="string">&#x27;english1.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;full_path&#x27;</span>: <span class="string">&#x27;C:\\test\\scores\\english\\english1.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_size&#x27;</span>: <span class="number">23</span>,</span><br><span class="line">        <span class="string">&#x27;create_time&#x27;</span>: <span class="number">1625323470.866679</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="number">8</span>,</span><br><span class="line">        <span class="string">&#x27;parent_id&#x27;</span>: <span class="number">4</span>,</span><br><span class="line">        <span class="string">&#x27;level&#x27;</span>: <span class="number">4</span>,</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;folder_name&#x27;</span>: <span class="string">&#x27;C:\\test\\scores\\english&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_name&#x27;</span>: <span class="string">&#x27;english2.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;full_path&#x27;</span>: <span class="string">&#x27;C:\\test\\scores\\english\\english2.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_size&#x27;</span>: <span class="number">55</span>,</span><br><span class="line">        <span class="string">&#x27;create_time&#x27;</span>: <span class="number">1625323470.8686738</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="number">9</span>,</span><br><span class="line">        <span class="string">&#x27;parent_id&#x27;</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="string">&#x27;level&#x27;</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;folder_name&#x27;</span>: <span class="string">&#x27;C:\\test\\scores\\math&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_name&#x27;</span>: <span class="string">&#x27;math1.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;full_path&#x27;</span>: <span class="string">&#x27;C:\\test\\scores\\math\\math1.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_size&#x27;</span>: <span class="number">33</span>,</span><br><span class="line">        <span class="string">&#x27;create_time&#x27;</span>: <span class="number">1625323454.2487762</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="string">&#x27;parent_id&#x27;</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="string">&#x27;level&#x27;</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;folder_name&#x27;</span>: <span class="string">&#x27;C:\\test\\scores\\math&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_name&#x27;</span>: <span class="string">&#x27;math2.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;full_path&#x27;</span>: <span class="string">&#x27;C:\\test\\scores\\math\\math2.txt&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;file_size&#x27;</span>: <span class="number">31</span>,</span><br><span class="line">        <span class="string">&#x27;create_time&#x27;</span>: <span class="number">1625323460.5313218</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>深度优先搜索可以利用递归，而广度优先则需要维护好遍历的顺序，以便同一层搜索完后再向下一层搜索。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-03-10T16:00:00.000Z" title="2021/3/11 上午12:00:00">2021-03-11</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-03-11T14:06:59.606Z" title="2021/3/11 下午10:06:59">2021-03-11</time></span><span class="level-item"> BF </span><span class="level-item">7 minutes read (About 1076 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/03/11/2021/03/2021-03-11-HareData/">Pandas + Openpyxl process excel</a></h1><div class="content"><h1 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h1><table>
<thead>
<tr>
<th>date</th>
<th>update</th>
</tr>
</thead>
<tbody><tr>
<td>2021-03-11</td>
<td>1. Initial</td>
</tr>
</tbody></table>
<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>最近帮同学写了一个数据处理的小程序，用<code>python</code>开发，用来处理excel数据。</p>
<p>其实excel本身就能实现大部分功能，并不一定要用程序处理，但用代码的话更灵活一些。</p>
<h1 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h1><p>数据本身不能share，但是计算逻辑应该无所谓，所以代码已经放在<a target="_blank" rel="noopener" href="https://github.com/bearfly1990/haredata">haredata</a>。</p>
<p>程序主要用到了python库<code>pandas + openpyxl</code>，写了非常简单的<code>ui</code>界面来选择输入的文件，处理完之后数据输出写入到新的文件里。</p>
<p>为了使用方便，最后打包成了exe。</p>
<h2 id="UI"><a href="#UI" class="headerlink" title="UI"></a>UI</h2><p><img src="/img/post/2021/03/2020-03-11-HareData-01.jpg" alt="my wechat video QR"></p>
<p>在做上面的界面的时候，遇到一个问题，就是需要给界面上加图标， 就是上面左上角的钥匙孔。</p>
<p>在打包exe的时候，需要把图片也打包进去，不然就需要带着额外的数据文件，不能放在一个exe中了，会比较挫。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/MemoryD/article/details/83147300">Pyinstaller 使用+打包图片方法</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/darcymei/p/9397173.html">Pyinstaller如何将资源文件一起打包至exe中</a></li>
</ul>
<p>上面是网上找到的比较好的两个方法，第一个方法只适合图片，有点绕。</p>
<p>第二个方法能直接解决打包数据文件的问题，可以参考一下。</p>
<p>两种方法都是用临时文件，只不过第二种方法更方便一些，使用系统的临时文件夹，不用自己操心。</p>
<h2 id="Pandas计算"><a href="#Pandas计算" class="headerlink" title="Pandas计算"></a>Pandas计算</h2><p>在数据处理过程中，用到了pandas的一些数值聚合计算</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">logger.info(<span class="string">&#x27;计算n...&#x27;</span>)</span><br><span class="line">self.df_sheet_weight[<span class="string">&#x27;n&#x27;</span>] = self.df_sheet_weight.apply(<span class="keyword">lambda</span> x: self.n(x), axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">logger.info(<span class="string">&#x27;计算n2...&#x27;</span>)</span><br><span class="line">self.df_sheet_weight[<span class="string">&#x27;n2&#x27;</span>] = self.df_sheet_weight.apply(<span class="keyword">lambda</span> x: self.n2(x), axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">n2</span>(<span class="params">self, x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> self.df_sheet_weight.groupby([<span class="string">&#x27;DSDM&#x27;</span>]).size()[x[<span class="string">&#x27;DSDM&#x27;</span>]]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">c1_county</span>(<span class="params">self, x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> self.df_sheet_weight.groupby([<span class="string">&#x27;QXDM&#x27;</span>])[<span class="string">&#x27;C1/WA&#x27;</span>].<span class="built_in">sum</span>()[x[<span class="string">&#x27;QXDM&#x27;</span>]] / x[<span class="string">&#x27;n&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">c1_city</span>(<span class="params">self, x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> self.df_sheet_weight.groupby([<span class="string">&#x27;DSDM&#x27;</span>])[<span class="string">&#x27;C1/WA2&#x27;</span>].<span class="built_in">sum</span>()[x[<span class="string">&#x27;DSDM&#x27;</span>]] / x[<span class="string">&#x27;n2&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">c1_pro</span>(<span class="params">self, x</span>):</span>  <span class="comment"># C1pro</span></span><br><span class="line">    <span class="keyword">return</span> self.df_sheet_weight[<span class="string">&#x27;C1/WA3&#x27;</span>].<span class="built_in">sum</span>() / x[<span class="string">&#x27;n3&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h2 id="单元格长度自适应"><a href="#单元格长度自适应" class="headerlink" title="单元格长度自适应"></a>单元格长度自适应</h2><p>因为数值比较多，所以添加了<code>cell</code>长度自适应，因为中文字符是英文的两倍，也添加了判断。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">auto_width</span>(<span class="params">cls, sheet</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, sheet.max_column + <span class="number">1</span>):</span><br><span class="line">        max_width = <span class="number">13</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, sheet.max_row + <span class="number">1</span>):</span><br><span class="line">            cell = <span class="string">f&#x27;<span class="subst">&#123;OpenpyxlHelper.get_column_letter_from_index(i)&#125;</span><span class="subst">&#123;j&#125;</span>&#x27;</span></span><br><span class="line">            value_width = <span class="number">0.7</span> * <span class="built_in">len</span>(re.findall(<span class="string">&#x27;([\u4e00-\u9fa5])&#x27;</span>, <span class="built_in">str</span>(sheet[cell].value))) + <span class="built_in">len</span>(</span><br><span class="line">                <span class="built_in">str</span>(sheet[cell].value))</span><br><span class="line">            <span class="keyword">if</span> value_width &gt; max_width:</span><br><span class="line">                max_width = value_width</span><br><span class="line">        sheet.column_dimensions[OpenpyxlHelper.get_column_letter_from_index(i)].width = max_width + <span class="number">2</span></span><br></pre></td></tr></table></figure>

<h2 id="Openpyxl给单元格赋值及应用样式"><a href="#Openpyxl给单元格赋值及应用样式" class="headerlink" title="Openpyxl给单元格赋值及应用样式"></a>Openpyxl给单元格赋值及应用样式</h2><p>下面是一个例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_summary</span>(<span class="params">sheet_summary, df_summary, row_start, col_start_char, diff</span>):</span></span><br><span class="line">    col_start_char = OpenpyxlHelper.get_column_letter_from_str_by_diff(col_start_char, diff)</span><br><span class="line">    row_current = row_start</span><br><span class="line">    <span class="keyword">for</span> index, row <span class="keyword">in</span> df_summary.iterrows():</span><br><span class="line">        <span class="keyword">for</span> i, crop <span class="keyword">in</span> <span class="built_in">enumerate</span>(CROPS_LIST):</span><br><span class="line">            cell = sheet_summary.cell(row=row_current,</span><br><span class="line">                                      column=OpenpyxlHelper.get_column_index_from_str(col_start_char) + i)</span><br><span class="line">            cell.value = row[i]</span><br><span class="line">            cell.number_format = <span class="string">&#x27;#,##0.00&#x27;</span></span><br><span class="line"></span><br><span class="line">            cell = sheet_summary.cell(</span><br><span class="line">                row=row_current, column=OpenpyxlHelper.get_column_index_from_str_by_diff(col_start_char, -<span class="number">1</span>)</span><br><span class="line">            )</span><br><span class="line">            start_cell = <span class="string">f&#x27;<span class="subst">&#123;col_start_char&#125;</span><span class="subst">&#123;row_current&#125;</span>&#x27;</span></span><br><span class="line">            ended_cell = <span class="string">f&#x27;<span class="subst">&#123;OpenpyxlHelper.get_column_letter_from_str_by_diff(col_start_char, <span class="built_in">len</span>(CROPS_LIST) - <span class="number">1</span>)&#125;</span><span class="subst">&#123;row_current&#125;</span>&#x27;</span></span><br><span class="line">            cell.value = <span class="string">f&#x27;=sum(<span class="subst">&#123;start_cell&#125;</span>:<span class="subst">&#123;ended_cell&#125;</span>)&#x27;</span></span><br><span class="line">            cell.number_format = <span class="string">&#x27;#,##0.00&#x27;</span></span><br><span class="line">            row_current = row_current + <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>创建了一个辅助类来控制样式和列名的index与letter转换：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OpenpyxlHelper</span>:</span></span><br><span class="line">    align_left = Alignment(horizontal=<span class="string">&#x27;left&#x27;</span>, vertical=<span class="string">&#x27;center&#x27;</span>, wrap_text=<span class="literal">True</span>)</span><br><span class="line">    align_right = Alignment(horizontal=<span class="string">&#x27;right&#x27;</span>, vertical=<span class="string">&#x27;center&#x27;</span>, wrap_text=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_column_letter_from_index</span>(<span class="params">cls, val_int</span>):</span></span><br><span class="line">        <span class="keyword">return</span> get_column_letter(val_int)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_column_index_from_str</span>(<span class="params">cls, val_str</span>):</span></span><br><span class="line">        <span class="keyword">return</span> column_index_from_string(val_str)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_column_letter_from_str_by_diff</span>(<span class="params">cls, val_str, diff</span>):</span></span><br><span class="line">        <span class="keyword">return</span> cls.get_column_letter_from_index(cls.get_column_index_from_str(val_str) + diff)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_column_index_from_str_by_diff</span>(<span class="params">cls, val_str, diff</span>):</span></span><br><span class="line">        <span class="keyword">return</span> cls.get_column_index_from_str(val_str) + diff</span><br></pre></td></tr></table></figure>



<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>内容和细节还有很多，完整代码在<a target="_blank" rel="noopener" href="https://github.com/bearfly1990/haredata">haredata</a></p>
<p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/MemoryD/article/details/83147300">Pyinstaller 使用+打包图片方法</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/darcymei/p/9397173.html">Pyinstaller如何将资源文件一起打包至exe中</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44244920/article/details/111270305?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.control&dist_request_id=1328626.20828.16154238288737745&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.control">PYTHON模块openpyxl在导出EXCEL文件时设置自动列宽</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-02-08T16:00:00.000Z" title="2021/2/9 上午12:00:00">2021-02-09</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-02-21T05:34:27.201Z" title="2021/2/21 下午1:34:27">2021-02-21</time></span><span class="level-item"> BF </span><span class="level-item">14 minutes read (About 2102 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/02/09/2021/02/2021-02-09-CutCombineTiktok/">Cut and Combine Tiktok Videos</a></h1><div class="content"><h1 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h1><table>
<thead>
<tr>
<th>date</th>
<th>update</th>
</tr>
</thead>
<tbody><tr>
<td>2021-02-17</td>
<td>1. 修复了不同视频大小的压缩算法 2. 修改代码结构并支持并发预处理文件</td>
</tr>
<tr>
<td>2021-02-21</td>
<td>1. 调整代码结构，封装到类中</td>
</tr>
<tr>
<td></td>
<td>2. 优化对文件夹的批处理</td>
</tr>
<tr>
<td></td>
<td>3. 视频最后合成的分辨率由视频本身自动决定</td>
</tr>
</tbody></table>
<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>最近看到tiktok上有许多有意思的视频，所以想下载下来。但下过来的视频会有水印，主要是视频后3秒会有抖音的视频水印，很影响观感。</p>
<p>对于文字水印，需要用别的方式来下载，不太方便，后面可以再想办法。</p>
<p>现在的需求是：我在手机上下了n个视频，copy到电脑上之后，希望能去掉片尾的视频水印，并合并成一个大的视频。</p>
<h1 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h1><p>将当前目录下，所以的mp4文件的后3秒（视频水印）去掉，然后合成一个大的视频文件。</p>
<h2 id="主要代码"><a href="#主要代码" class="headerlink" title="主要代码"></a>主要代码</h2><p>在网上找了许多资料，最后决定使用moviepy。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> imageio</span><br><span class="line"><span class="keyword">import</span> win_unicode_console</span><br><span class="line">win_unicode_console.enable()</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> moviepy.video.io.VideoFileClip  <span class="keyword">import</span> VideoFileClip</span><br><span class="line"><span class="keyword">from</span> moviepy.video.compositing.concatenate <span class="keyword">import</span> concatenate_videoclips</span><br><span class="line"><span class="keyword">from</span> moviepy.editor <span class="keyword">import</span> VideoFileClip, clips_array, vfx, CompositeVideoClip</span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    output_folder = <span class="string">&#x27;./output&#x27;</span></span><br><span class="line">    files = glob.glob(<span class="string">&#x27;**/*.mp4&#x27;</span>, recursive=<span class="literal">True</span>)</span><br><span class="line">    video_list = []</span><br><span class="line">    start_sec = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            source = file</span><br><span class="line">            target = os.path.join(output_folder, source) <span class="comment">#拼接文件名路径</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(os.path.dirname(target)):</span><br><span class="line">                os.makedirs(os.path.dirname(target))</span><br><span class="line">            video = VideoFileClip(source)</span><br><span class="line">            total_seconds = video.duration</span><br><span class="line">            start_time = <span class="number">0</span></span><br><span class="line">            stop_time = total_seconds - <span class="number">3</span></span><br><span class="line">            video = video.subclip(<span class="built_in">int</span>(start_time), <span class="built_in">int</span>(stop_time))<span class="comment">#执行剪切操作</span></span><br><span class="line">            </span><br><span class="line">            video.to_videofile(target, fps=<span class="number">20</span>, remove_temp=<span class="literal">True</span>)<span class="comment">#输出文件</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># os.remove(source)</span></span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(video.size[<span class="number">0</span>],video.size[<span class="number">1</span>])</span><br><span class="line">            <span class="built_in">print</span>(video.size[<span class="number">0</span>]/<span class="number">1300</span>,video.size[<span class="number">1</span>]/<span class="number">720</span>)</span><br><span class="line">            rate_x = video.size[<span class="number">0</span>]/<span class="number">1300</span></span><br><span class="line">            rate_y = video.size[<span class="number">1</span>]/<span class="number">720</span></span><br><span class="line">            rate_max = <span class="built_in">max</span>(rate_x, rate_y)</span><br><span class="line">            <span class="keyword">if</span> rate_max &gt; <span class="number">1</span>:</span><br><span class="line">                rate_max = <span class="number">1</span>/rate_max</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                rate_max = <span class="number">1</span></span><br><span class="line">            video = video.set_start(start_sec).set_pos(<span class="string">&quot;center&quot;</span>).resize(rate_max)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;-=====&gt;&#x27;</span>, rate_max)</span><br><span class="line">            start_sec = start_sec + video.duration</span><br><span class="line">            video_list.append(video)<span class="comment">#将加载完后的视频加入列表</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;have error:&#x27;</span>,e)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            <span class="built_in">print</span>(file, <span class="string">&#x27;done&#x27;</span>)</span><br><span class="line">    final_clip = CompositeVideoClip(video_list, size=(<span class="number">1300</span>, <span class="number">720</span>))</span><br><span class="line">    final_clip.to_videofile(os.path.join(output_folder, <span class="string">&#x27;combined.mp4&#x27;</span>), fps=<span class="number">20</span>, remove_temp=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># final_clip = concatenate_videoclips(video_list)#进行视频合并</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># final_clip.write_videofile(os.path.join(output_folder, &#x27;combined.mp4&#x27;), fps=20, remove_temp=True)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># final_clip.to_videofile(os.path.join(output_folder, &#x27;combined.mp4&#x27;), fps=20, remove_temp=True)#将合并后的视频输出</span></span><br></pre></td></tr></table></figure>

<h2 id="合并成一个视频"><a href="#合并成一个视频" class="headerlink" title="合并成一个视频"></a>合并成一个视频</h2><p>这边对于每个新的视频，都重新设置位置和size，主要是为了支持后面合并不同分辨率做准备。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">video = video.set_start(start_sec).set_pos(<span class="string">&quot;center&quot;</span>).resize(video.size[<span class="number">0</span>]/<span class="number">1300</span>)</span><br><span class="line">start_sec = start_sec + video.duration</span><br><span class="line">video_list.append(video)<span class="comment">#将加载完后的视频加入列表</span></span><br></pre></td></tr></table></figure>

<p>这边使用<code>CompositeVideoClip</code>来合并视频，而上面的<code>start_sec</code>，便是每个视频在合并的视频中，开始播放的时间。如果不设置，就是一所有视频都在<code>0</code>s开始播放，大家可以想到，如果这个时间配置视频的位置，就可以达到同时放多个小视频的效果，而这里使用它，纯粹是为了支持合并多个不同的分辨率</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">final_clip = CompositeVideoClip(video_list, size=(<span class="number">1300</span>, <span class="number">720</span>))</span><br><span class="line">final_clip.to_videofile(os.path.join(output_folder, <span class="string">&#x27;combined.mp4&#x27;</span>), fps=<span class="number">20</span>, remove_temp=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<h1 id="2021-02-17更新"><a href="#2021-02-17更新" class="headerlink" title="2021-02-17更新"></a>2021-02-17更新</h1><h2 id="修复了不同视频大小的压缩算法"><a href="#修复了不同视频大小的压缩算法" class="headerlink" title="修复了不同视频大小的压缩算法"></a>修复了不同视频大小的压缩算法</h2><p>之前在合并不同大小的视频时，对于合并的算法有问题，不能适应所有的情况。</p>
<p>更新后如下，根据长和宽，适合最合适的缩放大小。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">rate_x = video.size[<span class="number">0</span>]/<span class="number">1300</span></span><br><span class="line">rate_y = video.size[<span class="number">1</span>]/<span class="number">720</span></span><br><span class="line">rate_max = <span class="built_in">max</span>(rate_x, rate_y)</span><br><span class="line"><span class="keyword">if</span> rate_max &gt; <span class="number">1</span>:</span><br><span class="line">    rate_max = <span class="number">1</span>/rate_max</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    rate_max = <span class="number">1</span></span><br><span class="line">VIDEO_LIST[i] = video.set_start(start_sec).set_pos(<span class="string">&quot;center&quot;</span>).resize(rate_max)</span><br></pre></td></tr></table></figure>
<h2 id="修改代码结构并支持并发预处理文件"><a href="#修改代码结构并支持并发预处理文件" class="headerlink" title="修改代码结构并支持并发预处理文件"></a>修改代码结构并支持并发预处理文件</h2><p>使用线程池来实现并发操作，充分使用电脑性能来做数据预处理。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">executor = ThreadPoolExecutor(max_workers=MAX_WORKERS)</span><br><span class="line">files = glob.glob(<span class="string">&#x27;**/*.mp4&#x27;</span>, recursive=<span class="literal">True</span>)</span><br><span class="line">all_task = [executor.submit(convert_video, (file)) <span class="keyword">for</span> file <span class="keyword">in</span> files]</span><br><span class="line">wait(all_task, return_when=ALL_COMPLETED)</span><br></pre></td></tr></table></figure>
<h2 id="完整新代码如下："><a href="#完整新代码如下：" class="headerlink" title="完整新代码如下："></a>完整新代码如下：</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> imageio</span><br><span class="line"><span class="keyword">import</span> win_unicode_console</span><br><span class="line">win_unicode_console.enable()</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> moviepy.video.io.VideoFileClip  <span class="keyword">import</span> VideoFileClip</span><br><span class="line"><span class="keyword">from</span> moviepy.video.compositing.concatenate <span class="keyword">import</span> concatenate_videoclips</span><br><span class="line"><span class="keyword">from</span> moviepy.editor <span class="keyword">import</span> VideoFileClip, clips_array, vfx, CompositeVideoClip</span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor, wait, ALL_COMPLETED, FIRST_COMPLETED</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">OUTPUT_FOLDER = <span class="string">&#x27;./output&#x27;</span></span><br><span class="line">VIDEO_LIST = []</span><br><span class="line">MAX_WORKERS = <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert_video</span>(<span class="params">file</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        target = os.path.join(OUTPUT_FOLDER, file) <span class="comment"># 拼接文件名路径</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(os.path.dirname(target)):</span><br><span class="line">                os.makedirs(os.path.dirname(target))</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;have error when create subfolder:&#x27;</span>,e)</span><br><span class="line">        video = VideoFileClip(file)</span><br><span class="line">        total_seconds = video.duration</span><br><span class="line">        start_time = <span class="number">0</span></span><br><span class="line">        stop_time = total_seconds - <span class="number">3</span></span><br><span class="line">        video = video.subclip(<span class="built_in">int</span>(start_time), <span class="built_in">int</span>(stop_time))<span class="comment"># 执行剪切操作</span></span><br><span class="line">        </span><br><span class="line">        video.to_videofile(target, fps=<span class="number">20</span>, remove_temp=<span class="literal">True</span>)<span class="comment"># 输出文件</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># os.remove(source)</span></span><br><span class="line">        </span><br><span class="line">        VIDEO_LIST.append(video)<span class="comment"># 将加载完后的视频加入列表</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;have error:&#x27;</span>,e)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="built_in">print</span>(file, <span class="string">&#x27;done&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">combine_videos</span>():</span></span><br><span class="line">    start_sec = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i, video <span class="keyword">in</span> <span class="built_in">enumerate</span>(VIDEO_LIST):</span><br><span class="line">        <span class="comment"># print(video.size[0],video.size[1])</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># print(video.size[0]/1300,video.size[1]/720)</span></span><br><span class="line">        </span><br><span class="line">        rate_x = video.size[<span class="number">0</span>]/<span class="number">1300</span></span><br><span class="line">        rate_y = video.size[<span class="number">1</span>]/<span class="number">720</span></span><br><span class="line">        rate_max = <span class="built_in">max</span>(rate_x, rate_y)</span><br><span class="line">        <span class="keyword">if</span> rate_max &gt; <span class="number">1</span>:</span><br><span class="line">            rate_max = <span class="number">1</span>/rate_max</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            rate_max = <span class="number">1</span></span><br><span class="line">        VIDEO_LIST[i] = video.set_start(start_sec).set_pos(<span class="string">&quot;center&quot;</span>).resize(rate_max)</span><br><span class="line">        start_sec = start_sec + video.duration</span><br><span class="line">        </span><br><span class="line">    final_clip = CompositeVideoClip(VIDEO_LIST, size=(<span class="number">1300</span>, <span class="number">720</span>))   </span><br><span class="line">    final_clip.to_videofile(os.path.join(OUTPUT_FOLDER, <span class="string">&#x27;combined.mp4&#x27;</span>), fps=<span class="number">20</span>, remove_temp=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    start_time = datetime.now()</span><br><span class="line">    executor = ThreadPoolExecutor(max_workers=MAX_WORKERS)</span><br><span class="line">    files = glob.glob(<span class="string">&#x27;**/*.mp4&#x27;</span>, recursive=<span class="literal">True</span>)</span><br><span class="line">    all_task = [executor.submit(convert_video, (file)) <span class="keyword">for</span> file <span class="keyword">in</span> files]</span><br><span class="line">    wait(all_task, return_when=ALL_COMPLETED)</span><br><span class="line">    combine_videos()</span><br><span class="line">    ended_time = datetime.now()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;time cost: <span class="subst">&#123;ended_time - start_time&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h1 id="2021-02-21更新"><a href="#2021-02-21更新" class="headerlink" title="2021-02-21更新"></a>2021-02-21更新</h1><h2 id="最后生成的视频分辨率由视频动态决定"><a href="#最后生成的视频分辨率由视频动态决定" class="headerlink" title="最后生成的视频分辨率由视频动态决定"></a>最后生成的视频分辨率由视频动态决定</h2><p>遍历所有视频时，记录下长和宽，最后取max来当作最后的分辨率</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">self.max_x_list = []</span><br><span class="line">self.max_y_list = []</span><br><span class="line"></span><br><span class="line">self.max_x = <span class="built_in">max</span>(self.max_x_list)</span><br><span class="line">self.max_y = <span class="built_in">max</span>(self.max_y_list)</span><br></pre></td></tr></table></figure>
<h2 id="根据目录分别生成合成的视频"><a href="#根据目录分别生成合成的视频" class="headerlink" title="根据目录分别生成合成的视频"></a>根据目录分别生成合成的视频</h2><p>可以一次性按顺序按目录合成视频，而不是之前的所有目录的视频，更加灵活。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">files = glob.glob(<span class="string">&#x27;**/*.mp4&#x27;</span>, recursive=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> files:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;no files found&#x27;</span>)</span><br><span class="line">    exit(<span class="number">0</span>)</span><br><span class="line">dirs = <span class="built_in">list</span>(<span class="built_in">set</span>([<span class="string">&#x27;.&#x27;</span> <span class="keyword">if</span> os.path.dirname(file)==<span class="string">&#x27;&#x27;</span> <span class="keyword">else</span> os.path.dirname(file) <span class="keyword">for</span> file <span class="keyword">in</span> files]))</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">dir</span> <span class="keyword">in</span> dirs:</span><br><span class="line">    tiktok_util = TiktokUtil(input_folder=<span class="built_in">dir</span>)</span><br><span class="line">    tiktok_util.preprocess_videos()</span><br><span class="line">    tiktok_util.combine_videos()</span><br></pre></td></tr></table></figure>
<h2 id="封装到类中"><a href="#封装到类中" class="headerlink" title="封装到类中"></a>封装到类中</h2><p>下面是完整代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> imageio</span><br><span class="line"><span class="keyword">import</span> win_unicode_console</span><br><span class="line">win_unicode_console.enable()</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> moviepy.video.io.VideoFileClip  <span class="keyword">import</span> VideoFileClip</span><br><span class="line"><span class="keyword">from</span> moviepy.video.compositing.concatenate <span class="keyword">import</span> concatenate_videoclips</span><br><span class="line"><span class="keyword">from</span> moviepy.editor <span class="keyword">import</span> VideoFileClip, clips_array, vfx, CompositeVideoClip</span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor, wait, ALL_COMPLETED, FIRST_COMPLETED</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">author: bearfly1990</span></span><br><span class="line"><span class="string">create at: 02/01/2021</span></span><br><span class="line"><span class="string">description:</span></span><br><span class="line"><span class="string">    Utils for send email</span></span><br><span class="line"><span class="string">Change log:</span></span><br><span class="line"><span class="string">Date          Author      Version    Description</span></span><br><span class="line"><span class="string">02/17/2021    bearfly1990 1.0.1      update combine video hight/width resize logic to adapt all videos.</span></span><br><span class="line"><span class="string">02/21/2021    bearfly1990 1.0.2      Get max hight/max width from all the input videos, not hard code</span></span><br><span class="line"><span class="string">                                     support detail with different folder.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TiktokUtil</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    output_folder = <span class="string">&#x27;./output&#x27;</span></span><br><span class="line">    max_workers = <span class="number">6</span></span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, remove_watermark=<span class="literal">True</span>, input_folder=<span class="string">&#x27;&#x27;</span>, output_name=<span class="string">&#x27;combined.mp4&#x27;</span></span>):</span></span><br><span class="line">        self.remove_watermark = remove_watermark</span><br><span class="line">        self.output_name = output_name</span><br><span class="line">        self.input_folder=input_folder</span><br><span class="line">        self.video_list = []</span><br><span class="line">        self.max_x_list = []</span><br><span class="line">        self.max_y_list = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">convert_video</span>(<span class="params">self, file</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            target = os.path.join(self.output_folder, file)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(os.path.dirname(target)):</span><br><span class="line">                    os.makedirs(os.path.dirname(target))</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;have error when create subfolder:&#x27;</span>,e)</span><br><span class="line">            video = VideoFileClip(file)</span><br><span class="line">            <span class="keyword">if</span> self.remove_watermark:</span><br><span class="line">                total_seconds = video.duration</span><br><span class="line">                start_time = <span class="number">0</span></span><br><span class="line">                stop_time = total_seconds - <span class="number">3</span></span><br><span class="line">                video = video.subclip(<span class="built_in">int</span>(start_time), <span class="built_in">int</span>(stop_time))</span><br><span class="line">            self.max_x_list.append(video.size[<span class="number">0</span>])</span><br><span class="line">            self.max_y_list.append(video.size[<span class="number">1</span>])</span><br><span class="line">            self.video_list.append(video)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;have error:&#x27;</span>,e)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            <span class="built_in">print</span>(file, <span class="string">&#x27;done&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">combine_videos</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.max_x = <span class="built_in">max</span>(self.max_x_list)</span><br><span class="line">        self.max_y = <span class="built_in">max</span>(self.max_y_list)</span><br><span class="line">        start_sec = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i, video <span class="keyword">in</span> <span class="built_in">enumerate</span>(self.video_list):</span><br><span class="line"></span><br><span class="line">            rate_x = video.size[<span class="number">0</span>]/self.max_x</span><br><span class="line">            rate_y = video.size[<span class="number">1</span>]/self.max_y</span><br><span class="line">            rate_max = <span class="built_in">max</span>(rate_x, rate_y)</span><br><span class="line">            <span class="keyword">if</span> rate_max &gt; <span class="number">1</span>:</span><br><span class="line">                rate_max = <span class="number">1</span>/rate_max</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                rate_max = <span class="number">1</span></span><br><span class="line">            self.video_list[i] = video.set_start(start_sec).set_pos(<span class="string">&quot;center&quot;</span>).resize(rate_max)</span><br><span class="line">            start_sec = start_sec + video.duration</span><br><span class="line">        <span class="built_in">print</span>(self.max_x, self.max_y)</span><br><span class="line">        final_clip = CompositeVideoClip(self.video_list, size=(self.max_x, self.max_y))   </span><br><span class="line">        final_clip.to_videofile(os.path.join(self.output_folder, self.input_folder, self.output_name), fps=<span class="number">20</span>, remove_temp=<span class="literal">True</span>)</span><br><span class="line">        final_clip.close()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">preprocess_videos</span>(<span class="params">self</span>):</span></span><br><span class="line">        files = glob.glob(<span class="string">f&#x27;<span class="subst">&#123;self.input_folder&#125;</span>/*.mp4&#x27;</span>, recursive=<span class="literal">True</span>)</span><br><span class="line">        executor = ThreadPoolExecutor(max_workers=self.max_workers)</span><br><span class="line">        all_task = [executor.submit(self.convert_video, (file)) <span class="keyword">for</span> file <span class="keyword">in</span> files]</span><br><span class="line">        wait(all_task, return_when=ALL_COMPLETED)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    start_time = datetime.now()</span><br><span class="line">    </span><br><span class="line">    files = glob.glob(<span class="string">&#x27;**/*.mp4&#x27;</span>, recursive=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> files:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;no files found&#x27;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    dirs = <span class="built_in">list</span>(<span class="built_in">set</span>([<span class="string">&#x27;.&#x27;</span> <span class="keyword">if</span> os.path.dirname(file)==<span class="string">&#x27;&#x27;</span> <span class="keyword">else</span> os.path.dirname(file) <span class="keyword">for</span> file <span class="keyword">in</span> files]))</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">dir</span> <span class="keyword">in</span> dirs:</span><br><span class="line">        tiktok_util = TiktokUtil(input_folder=<span class="built_in">dir</span>)</span><br><span class="line">        tiktok_util.preprocess_videos()</span><br><span class="line">        tiktok_util.combine_videos()</span><br><span class="line"></span><br><span class="line">    ended_time = datetime.now()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;time cost: <span class="subst">&#123;ended_time - start_time&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>完整代码在<a target="_blank" rel="noopener" href="https://github.com/bearfly1990/PowerScript/tree/master/Python3/moviepy/">moviepy</a></p>
<p><img src="/img/bf_wechat_video.jpg" alt="my wechat video QR"></p>
<p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1582917">使用Python+moviepy连接不同尺寸的视频文件</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/ucsheep/article/details/84630800">MoviePy不同尺寸视频vedio_clip或者图片image_clip拼接出现花屏</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/ucsheep/article/details/84387092">MoviePy问题解决汇总</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/ucsheep/article/details/81329598">MoviePy - 中文文档2-快速上手-MoviePy-视频合成</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/xiaoyu_wu/article/details/102820384">python线程池 ThreadPoolExecutor 使用详解</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2020-10-20T16:00:00.000Z" title="2020/10/21 上午12:00:00">2020-10-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-10-21T14:59:05.449Z" title="2020/10/21 下午10:59:05">2020-10-21</time></span><span class="level-item"> BF </span><span class="level-item">4 minutes read (About 655 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/10/21/2020/10/2020-10-21-QueryPyODBC/">Query hive data</a></h1><div class="content"><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>有Hue可以用来查询hive和impala的数据，但是使用起来不是特别方便，尤其想要同时把数据导出来的时候。</p>
<p>原来想尝试用java的方式，也向同事要了demo，但是需要keytab，而且还是倾向于用python。</p>
<p>最后尝试了一些python库失败(主要是这些module依赖的东西比较多，需要很多环境的配置，但是都没有权限，比较麻烦)，从同事那得知他们的Tableau本地用的是odbc的连接方式。</p>
<p>之前试过用pyodbc去连接sql server数据库，而且理论上使用odbc，只要数据源配置好就可以了，api的使用是共通的，不管什么语言都可以用odbc的方式去访问。</p>
<h1 id="第三方软件安装"><a href="#第三方软件安装" class="headerlink" title="第三方软件安装"></a>第三方软件安装</h1><ol>
<li>Cloudera hive odbc (用使用impala的话就安装 impala odbc)， 并配置好连接与数据源</li>
<li>MIT Kerberos (需要使用Kerberos认证)</li>
</ol>
<h1 id="主界面"><a href="#主界面" class="headerlink" title="主界面"></a>主界面</h1><p><img src="/img/post/2020/10/2020-10-21-QueryPyODBC-02.jpg" alt="2020-10-21-QueryPyODBC-02.jpg"></p>
<p>yaml是用来配置基本信息，像最后文件输出的目录也可以配置，当前默认<code>output</code>，lib放了一些自己封装的类和方法.</p>
<p>主界面可以看到可以选择不同的数据源（在配置文件里配置初始的数据），输入最后要存的文件名字（默认是test.{current_datetime}.csv)，输出的文件类型(csv/excel)，以及你的sql语句。<br><img src="/img/post/2020/10/2020-10-21-QueryPyODBC-01.jpg" alt="2020-10-21-QueryPyODBC-01.jpg"></p>
<p>为了更灵活，当start之前，你可以更新信息，重新query，即支持多线程查询，不过不建议一次查太多，而且要注意输出文件的名字，如果重名的话数据就会被覆盖。</p>
<p>主要查询的代码如下图所示，封装了<code>HiveUtils</code>做一些细节处理。<br><img src="/img/post/2020/10/2020-10-21-QueryPyODBC-03.jpg" alt="2020-10-21-QueryPyODBC-03.jpg"></p>
<h1 id="查询多个table和view"><a href="#查询多个table和view" class="headerlink" title="查询多个table和view"></a>查询多个table和view</h1><p>上面的工具满足了特殊的sql的需要，但是有时候，我们希望一次能把许多table/view的数据导出来查看。</p>
<p>所以也写了另外的脚本，通过把想要导出来的table/view名字列在配置文件里，一次性起多个线程去查询。</p>
<p>e.g. object.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db1.table1</span><br><span class="line">db1.table2</span><br><span class="line">db2.view1</span><br><span class="line">db3.view2</span><br></pre></td></tr></table></figure>
<p>把上面的所以数据都查出来，最后放在output目录中，文件名按table/view名字来取，方便查看。</p>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>后续会继续改进，提高平时的工作效率。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2020-09-05T16:00:00.000Z" title="2020/9/6 上午12:00:00">2020-09-06</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-09-08T15:43:26.434Z" title="2020/9/8 下午11:43:26">2020-09-08</time></span><span class="level-item"> BF </span><span class="level-item">7 minutes read (About 1100 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/09/06/2020/09/2020-09-06-MyDiary/">My Diary 2020-09-06</a></h1><div class="content"><h1 id="COVID-19"><a href="#COVID-19" class="headerlink" title="COVID-19"></a>COVID-19</h1><p>2020真的很特殊，年初的疫情，让整个世界陷入了混乱。</p>
<p>好在国内的抗疫还是卓有成效，现在都已经恢复正常的工作生活了。</p>
<p>但是因为美国的疫情，道富还是实行AB组的方式, 两周两周的轮换在家和在公司办公，现在大家都习惯了。</p>
<p>如果国内的asg site也建立起来的话，那在家办公也就会很流畅了。</p>
<p>不得不说这场疫情给改变了我们的很多生活方式。</p>
<h1 id="Work"><a href="#Work" class="headerlink" title="Work"></a>Work</h1><p>快到两年了，但到现在为止的感觉还是很不好，一开始来这边就是一个错误。</p>
<p>当时发现现实的情况与自己的预期相差非常多，并没有及时的止损，觉得是自己心态的问题，还是想融入新的角色与工作。</p>
<p>另一个角度，是我没有给自己留后路。当时是想着不顺利的话，就回老家好了，母亲一个人在老家生活，而我杭漂，真的一点意义也没有。</p>
<p>但往往事情的发展并不会与预期的一样，受困于当时的焦虑与抑郁，我没有办法做出决定，后来有了小曼，我便也没有了回家这个选项。</p>
<p>从工作性质与工作角色上来说，变化的太多。最主要的是，项目的核心业务逻辑在美国那边，即使到现在，还没有非常清晰的认识。</p>
<p>刚好也是从过年后开始，做Hadoop这块的东西，也是自己带头从无到有从印度团队那么KT过来。</p>
<p>有时候还是觉得非常的累，需要和多个团队打交道，而自己的英文水平还不够好。</p>
<p>很久没有体验过那种对工作的极度排斥，但又没有办法，硬着头皮上的感觉，真的太不舒服了。</p>
<p>内心的焦虑与压力不是一般的大，明显感觉不是那么好的工作状态，直到现在。</p>
<p>除了工作内容本身，因为与YL的同学关系，有一些人有想法，还是能感受到的。</p>
<p>有时候觉得自己太天真了，以为道富内部的组都是比较和谐，大家都比较nice的，只不过自己以前遇到的都是很kind的人。</p>
<p>所以有时候看她们的样子，还是觉得挺搞笑的，至于么。</p>
<p>想起TZ和ZP的话，的确一起工作的人比工作内容本身重要的多了，良好的合作关系真的很让人舒心。</p>
<p>有些话没有办法说，都是自己的选择，认赌服输，苦果只能自己咽。</p>
<p>还是要好好改改自己的臭毛病。</p>
<p>All in all, 做好自己能做的事，硬着头皮撑着，相信总有一天会有转机的。</p>
<h1 id="Family"><a href="#Family" class="headerlink" title="Family"></a>Family</h1><p>外婆前段时间摔了，母亲照顾的很辛苦，心情也一直不好，好在现在外婆恢复的还可以，她也放松多了。</p>
<p>XM换了工作，毕竟在一个组不太合适。我们现在换了新的地方，更有自己家的感觉了。</p>
<p>但两个人还是有些冲突和矛盾。</p>
<p>尤其最近买房的事情，也怪自己吧，太傻了，没有给力的主导，现在事情变得很奇怪，也只能走一步看一步了。</p>
<p>或许真的是我不够好吧，想要结婚的想法是奢侈的。</p>
<h1 id="Life"><a href="#Life" class="headerlink" title="Life"></a>Life</h1><p>自从换组以来，很久很久没有真正的放松过了，如果是必经的，那我也只能承受下来。</p>
<p>人生是不能逃避的。</p>
<p>不过话说回来，健康是除一切之外，最最最重要的。</p>
<p>这两年胖了好多。我的体重也是我的身心健康的晴雨表，过分的肥胖就表明我自己有问题了。</p>
<p>加油吧，快30岁的人！！！哈哈哈！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2020-06-21T16:00:00.000Z" title="2020/6/22 上午12:00:00">2020-06-22</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-09-08T15:43:26.432Z" title="2020/9/8 下午11:43:26">2020-09-08</time></span><span class="level-item"> BF </span><span class="level-item">3 minutes read (About 486 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/06/22/2020/06/2020-06-22-CheckHdfsUsage/">HDFS Space Usage</a></h1><div class="content"><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>需要统计HDFS的空间使用情况，有命令<code>hadoop fs -du /path</code>支持查看(hdfs dfs等效)。</p>
<p>但这样子只能看一个目录的情况，如果想要遍历所有的目录没有直接支持的。</p>
<h1 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h1><p>默认<code>-du</code> 是查看所给目录下子目录的占用空间大小，而加上<code>-s</code>则是列出给定的目录所占的空间。<br>所以如果给定所有已知的目录，那么就可以使用类似下面的语法</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop <span class="built_in">fs</span> -du -s /path1 /path2 /path3</span><br></pre></td></tr></table></figure>

<p>所以我们可以想办法先得到想要的目录,通过<code>-ls -R</code>遍历所有目录和文件:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop00 ~]# hadoop <span class="built_in">fs</span> -ls -R /</span><br><span class="line">drwxr-xr-x   - root supergroup          <span class="number">0</span> <span class="number">2020</span>-<span class="number">06</span>-<span class="number">22</span> <span class="number">23</span>:<span class="number">25</span> /cx</span><br><span class="line">drwxr-xr-x   - root supergroup          <span class="number">0</span> <span class="number">2020</span>-<span class="number">03</span>-<span class="number">01</span> <span class="number">21</span>:<span class="number">25</span> /cx/test</span><br><span class="line">-rw-r--r--   <span class="number">3</span> root supergroup         <span class="number">66</span> <span class="number">2020</span>-<span class="number">03</span>-<span class="number">01</span> <span class="number">21</span>:<span class="number">25</span> /cx/test/salary.csv</span><br><span class="line">drwxr-xr-x   - root supergroup          <span class="number">0</span> <span class="number">2020</span>-<span class="number">06</span>-<span class="number">22</span> <span class="number">23</span>:<span class="number">28</span> /cx/test2</span><br><span class="line">-rw-r--r--   <span class="number">3</span> root supergroup  <span class="number">879999912</span> <span class="number">2020</span>-<span class="number">06</span>-<span class="number">22</span> <span class="number">23</span>:<span class="number">28</span> /cx/test2/data.csv</span><br><span class="line">drwxr-xr-x   - root supergroup          <span class="number">0</span> <span class="number">2019</span>-<span class="number">02</span>-<span class="number">17</span> <span class="number">21</span>:<span class="number">23</span> /data</span><br><span class="line">drwxr-xr-x   - root supergroup          <span class="number">0</span> <span class="number">2019</span>-<span class="number">02</span>-<span class="number">17</span> <span class="number">21</span>:<span class="number">25</span> /data/input</span><br><span class="line">-rw-r--r--   <span class="number">3</span> root supergroup         <span class="number">68</span> <span class="number">2019</span>-<span class="number">02</span>-<span class="number">17</span> <span class="number">21</span>:<span class="number">25</span> /data/input/word-count-data.txt</span><br><span class="line">drwxr-xr-x   - root supergroup          <span class="number">0</span> <span class="number">2019</span>-<span class="number">02</span>-<span class="number">17</span> <span class="number">21</span>:<span class="number">23</span> /data/output</span><br><span class="line">drwxr-xr-x   - root supergroup          <span class="number">0</span> <span class="number">2019</span>-<span class="number">02</span>-<span class="number">17</span> <span class="number">22</span>:<span class="number">10</span> /folder1</span><br><span class="line">-rw-r--r--   <span class="number">3</span> root supergroup         <span class="number">20</span> <span class="number">2019</span>-<span class="number">02</span>-<span class="number">17</span> <span class="number">22</span>:<span class="number">10</span> /folder1/test.txt</span><br><span class="line">drwx-wx-wx   - root supergroup          <span class="number">0</span> <span class="number">2020</span>-<span class="number">03</span>-<span class="number">01</span> <span class="number">23</span>:<span class="number">20</span> /user</span><br><span class="line">drwx-wx-wx   - root supergroup          <span class="number">0</span> <span class="number">2020</span>-<span class="number">03</span>-<span class="number">01</span> <span class="number">23</span>:<span class="number">27</span> /user/hive</span><br><span class="line">drwx-wx-wx   - root supergroup          <span class="number">0</span> <span class="number">2020</span>-<span class="number">03</span>-<span class="number">01</span> <span class="number">23</span>:<span class="number">20</span> /user/hive/tmp</span><br><span class="line">drwx--x--x   - root supergroup          <span class="number">0</span> <span class="number">2020</span>-<span class="number">03</span>-<span class="number">01</span> <span class="number">23</span>:<span class="number">51</span> /user/hive/tmp/root</span><br><span class="line">drwx-wx-wx   - root supergroup          <span class="number">0</span> <span class="number">2020</span>-<span class="number">03</span>-<span class="number">01</span> <span class="number">23</span>:<span class="number">27</span> /user/hive/warehouse</span><br><span class="line">drwx-wx-wx   - root supergroup          <span class="number">0</span> <span class="number">2020</span>-<span class="number">03</span>-<span class="number">01</span> <span class="number">23</span>:<span class="number">30</span> /user/hive/warehouse/myhive.db</span><br></pre></td></tr></table></figure>

<p>之后通过<code>grep ^d</code>筛选出目录，再使用<code>awk</code>去掉不想要的值(带hive)。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop00 ~]# hdfs dfs -ls -R / | grep ^d | awk &#x27;$<span class="number">8</span>!~/.*hive.*/ &#123;<span class="built_in">print</span> $<span class="number">8</span>&#125;&#x27;</span><br><span class="line">/cx</span><br><span class="line">/cx/test</span><br><span class="line">/cx/test2</span><br><span class="line">/data</span><br><span class="line">/data/input</span><br><span class="line">/data/output</span><br><span class="line">/folder1</span><br><span class="line">/user</span><br></pre></td></tr></table></figure>

<p>最后，把上面的结果作为参数传回给<code>-du</code>命令, 可以得到想要的结果。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop00 ~]# hdfs dfs -du -h -s `hdfs dfs -ls -R / | grep ^d | awk &#x27;$<span class="number">8</span>!~/.*hive.*/ &#123;<span class="built_in">print</span> $<span class="number">8</span>&#125;&#x27;`</span><br><span class="line"><span class="number">839</span>.<span class="number">2</span> M  /cx</span><br><span class="line"><span class="number">66</span>  /cx/test</span><br><span class="line"><span class="number">839</span>.<span class="number">2</span> M  /cx/test2</span><br><span class="line"><span class="number">68</span>  /data</span><br><span class="line"><span class="number">68</span>  /data/input</span><br><span class="line"><span class="number">0</span>  /data/output</span><br><span class="line"><span class="number">20</span>  /folder1</span><br><span class="line"><span class="number">0</span>  /user</span><br></pre></td></tr></table></figure>
<p><code>-h</code>是把size转成好理解的格式。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_39457142/article/details/102611594">Hadoop fs -du -s -h 输出三列数据的含义</a></li>
<li><a target="_blank" rel="noopener" href="https://www.runoob.com/linux/linux-comm-awk.html">Linux awk 命令</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/ginvip/p/6352157.html">Linux三剑客之awk命令</a></li>
</ul>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous is-invisible is-hidden-mobile"><a href="/page/0/">Previous</a></div><div class="pagination-next"><a href="/page/2/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link is-current" href="/">1</a></li><li><a class="pagination-link" href="/page/2/">2</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/9/">9</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/mybear.jpg" alt="bearfly1990"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">bearfly1990</p><p class="is-size-6 is-block">有熊在飞</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>HZ, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">81</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">100</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/bearfly1990" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/bearfly1990"><i class="fab fa-github"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-11T16:00:00.000Z">2021-08-12</time></p><p class="title"><a href="/2021/08/12/2021/08/2021-08-12-box-python-sdk/">box SDK for python</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-07T16:00:00.000Z">2021-08-08</time></p><p class="title"><a href="/2021/08/08/2021/08/2021-08-09-kafka-learn-01/">Kafka Learn - 01</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-07-20T16:00:00.000Z">2021-07-21</time></p><p class="title"><a href="/2021/07/21/2021/07/2021-07-21-jaydebeapi/">jaydebeapi</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-07-16T16:00:00.000Z">2021-07-17</time></p><p class="title"><a href="/2021/07/17/2021/07/2021-07-17-NanHu/">NanHu</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-07-03T16:00:00.000Z">2021-07-04</time></p><p class="title"><a href="/2021/07/04/2021/07/2021-07-04-folder-tree/">Folder Tree Info DFS/BFS</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">August 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/07/"><span class="level-start"><span class="level-item">July 2021</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/03/"><span class="level-start"><span class="level-item">March 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/02/"><span class="level-start"><span class="level-item">February 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/09/"><span class="level-start"><span class="level-item">September 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/06/"><span class="level-start"><span class="level-item">June 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/03/"><span class="level-start"><span class="level-item">March 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/01/"><span class="level-start"><span class="level-item">January 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/12/"><span class="level-start"><span class="level-item">December 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/11/"><span class="level-start"><span class="level-item">November 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/10/"><span class="level-start"><span class="level-item">October 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/08/"><span class="level-start"><span class="level-item">August 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/06/"><span class="level-start"><span class="level-item">June 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/05/"><span class="level-start"><span class="level-item">May 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/03/"><span class="level-start"><span class="level-item">March 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/02/"><span class="level-start"><span class="level-item">February 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/01/"><span class="level-start"><span class="level-item">January 2019</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/12/"><span class="level-start"><span class="level-item">December 2018</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/11/"><span class="level-start"><span class="level-item">November 2018</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/10/"><span class="level-start"><span class="level-item">October 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/09/"><span class="level-start"><span class="level-item">September 2018</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/08/"><span class="level-start"><span class="level-item">August 2018</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/07/"><span class="level-start"><span class="level-item">July 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/06/"><span class="level-start"><span class="level-item">June 2018</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/05/"><span class="level-start"><span class="level-item">May 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/04/"><span class="level-start"><span class="level-item">April 2018</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/2019/"><span class="tag">2019</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Apache/"><span class="tag">Apache</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Diary/"><span class="tag">Diary</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/E-R/"><span class="tag">E-R</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/HDFS/"><span class="tag">HDFS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hadoop/"><span class="tag">Hadoop</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java/"><span class="tag">Java</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Kafka/"><span class="tag">Kafka</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PIL/"><span class="tag">PIL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Pandas/"><span class="tag">Pandas</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RESTful/"><span class="tag">RESTful</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RPC/"><span class="tag">RPC</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/acm/"><span class="tag">acm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/algorithm/"><span class="tag">algorithm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/algorithms/"><span class="tag">algorithms</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/alibaba/"><span class="tag">alibaba</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/annotation/"><span class="tag">annotation</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/apidoc/"><span class="tag">apidoc</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/big-data/"><span class="tag">big data</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bigdata/"><span class="tag">bigdata</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/box/"><span class="tag">box</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/chart/"><span class="tag">chart</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/chartjs/"><span class="tag">chartjs</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/class/"><span class="tag">class</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/colorlog/"><span class="tag">colorlog</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/config/"><span class="tag">config</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/console/"><span class="tag">console</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cpu/"><span class="tag">cpu</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/csv/"><span class="tag">csv</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dairy/"><span class="tag">dairy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/data-analysis/"><span class="tag">data analysis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/data-structure/"><span class="tag">data structure</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/database/"><span class="tag">database</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/db/"><span class="tag">db</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/design-patterns/"><span class="tag">design patterns</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/diary/"><span class="tag">diary</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dokuwiki/"><span class="tag">dokuwiki</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/download/"><span class="tag">download</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/email/"><span class="tag">email</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/excel/"><span class="tag">excel</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/file/"><span class="tag">file</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flask-restful/"><span class="tag">flask-restful</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/gRPC/"><span class="tag">gRPC</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/goal/"><span class="tag">goal</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hadoop/"><span class="tag">hadoop</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hive/"><span class="tag">hive</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/httpd/"><span class="tag">httpd</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/imageio/"><span class="tag">imageio</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/io/"><span class="tag">io</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/java/"><span class="tag">java</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript/"><span class="tag">javascript</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jdbc/"><span class="tag">jdbc</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/json/"><span class="tag">json</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/life/"><span class="tag">life</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/lock/"><span class="tag">lock</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/log/"><span class="tag">log</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/manual/"><span class="tag">manual</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/matplotlib/"><span class="tag">matplotlib</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/memory/"><span class="tag">memory</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/monitor/"><span class="tag">monitor</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/moviepy/"><span class="tag">moviepy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/network/"><span class="tag">network</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/node-js/"><span class="tag">node.js</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/numpy/"><span class="tag">numpy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/openpyxl/"><span class="tag">openpyxl</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/orm/"><span class="tag">orm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pandas/"><span class="tag">pandas</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/performance/"><span class="tag">performance</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/php/"><span class="tag">php</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/powershell/"><span class="tag">powershell</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/private/"><span class="tag">private</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/progress-bar/"><span class="tag">progress bar</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/proxy/"><span class="tag">proxy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pyodbc/"><span class="tag">pyodbc</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag">45</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pytz/"><span class="tag">pytz</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pywin32/"><span class="tag">pywin32</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/reflect/"><span class="tag">reflect</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/regex/"><span class="tag">regex</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sdk/"><span class="tag">sdk</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spider/"><span class="tag">spider</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/springboot/"><span class="tag">springboot</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sql/"><span class="tag">sql</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sqlalchemy/"><span class="tag">sqlalchemy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/swagger/"><span class="tag">swagger</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tasklist/"><span class="tag">tasklist</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/test/"><span class="tag">test</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/thread/"><span class="tag">thread</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tiktok/"><span class="tag">tiktok</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tkinter/"><span class="tag">tkinter</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/training/"><span class="tag">training</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/txt/"><span class="tag">txt</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/unicode/"><span class="tag">unicode</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vmware/"><span class="tag">vmware</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/work/"><span class="tag">work</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xpath/"><span class="tag">xpath</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/yaml/"><span class="tag">yaml</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8D%9A%E5%AE%A2/"><span class="tag">博客</span><span class="tag">1</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/favicon.ico" alt="Shawn&#039;Blog Test" height="28"></a><p class="is-size-7"><span>&copy; 2021 Shawn</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>